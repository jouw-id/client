var Vm=Object.create;var Oo=Object.defineProperty;var Km=Object.getOwnPropertyDescriptor;var qm=Object.getOwnPropertyNames;var $m=Object.getPrototypeOf,Wm=Object.prototype.hasOwnProperty;var pn=(t,e)=>()=>(t&&(e=t(t=0)),e);var _e=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Do=(t,e)=>{for(var r in e)Oo(t,r,{get:e[r],enumerable:!0})},Rf=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qm(e))!Wm.call(t,i)&&i!==r&&Oo(t,i,{get:()=>e[i],enumerable:!(n=Km(e,i))||n.enumerable});return t};var gn=(t,e,r)=>(r=t!=null?Vm($m(t)):{},Rf(e||!t||!t.__esModule?Oo(r,"default",{value:t,enumerable:!0}):r,t)),Yt=t=>Rf(Oo({},"__esModule",{value:!0}),t);var N=pn(()=>{"use strict"});function Jm(t,e){this.fun=t,this.array=e}function Cf(t){var e=Math.floor((Date.now()-yn.now())*.001),r=yn.now()*.001,n=Math.floor(r)+e,i=Math.floor(r%1*1e9);return t&&(n=n-t[0],i=i-t[1],i<0&&(n--,i+=ou)),[n,i]}var $x,yn,iu,ou,Ff=pn(()=>{"use strict";N();O();k();Jm.prototype.run=function(){this.fun.apply(null,this.array)};$x={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},yn={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0};yn.now===void 0&&(iu=Date.now(),yn.timing&&yn.timing.navigationStart&&(iu=yn.timing.navigationStart),yn.now=()=>Date.now()-iu);ou=1e9;Cf.bigint=function(t){var e=Cf(t);return typeof BigInt>"u"?e[0]*ou+e[1]:BigInt(e[0]*ou)+BigInt(e[1])}});var k=pn(()=>{"use strict";Ff()});function Gm(){if(Pf)return Ui;Pf=!0,Ui.byteLength=l,Ui.toByteArray=f,Ui.fromByteArray=w;for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=n.length;i<a;++i)t[i]=n[i],e[n.charCodeAt(i)]=i;e[45]=62,e[95]=63;function u(E){var x=E.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var A=E.indexOf("=");A===-1&&(A=x);var I=A===x?0:4-A%4;return[A,I]}function l(E){var x=u(E),A=x[0],I=x[1];return(A+I)*3/4-I}function d(E,x,A){return(x+A)*3/4-A}function f(E){var x,A=u(E),I=A[0],D=A[1],U=new r(d(E,I,D)),z=0,P=D>0?I-4:I,F;for(F=0;F<P;F+=4)x=e[E.charCodeAt(F)]<<18|e[E.charCodeAt(F+1)]<<12|e[E.charCodeAt(F+2)]<<6|e[E.charCodeAt(F+3)],U[z++]=x>>16&255,U[z++]=x>>8&255,U[z++]=x&255;return D===2&&(x=e[E.charCodeAt(F)]<<2|e[E.charCodeAt(F+1)]>>4,U[z++]=x&255),D===1&&(x=e[E.charCodeAt(F)]<<10|e[E.charCodeAt(F+1)]<<4|e[E.charCodeAt(F+2)]>>2,U[z++]=x>>8&255,U[z++]=x&255),U}function g(E){return t[E>>18&63]+t[E>>12&63]+t[E>>6&63]+t[E&63]}function _(E,x,A){for(var I,D=[],U=x;U<A;U+=3)I=(E[U]<<16&16711680)+(E[U+1]<<8&65280)+(E[U+2]&255),D.push(g(I));return D.join("")}function w(E){for(var x,A=E.length,I=A%3,D=[],U=16383,z=0,P=A-I;z<P;z+=U)D.push(_(E,z,z+U>P?P:z+U));return I===1?(x=E[A-1],D.push(t[x>>2]+t[x<<4&63]+"==")):I===2&&(x=(E[A-2]<<8)+E[A-1],D.push(t[x>>10]+t[x>>4&63]+t[x<<2&63]+"=")),D.join("")}return Ui}function zm(){if(Nf)return Lo;Nf=!0;return Lo.read=function(t,e,r,n,i){var a,u,l=i*8-n-1,d=(1<<l)-1,f=d>>1,g=-7,_=r?i-1:0,w=r?-1:1,E=t[e+_];for(_+=w,a=E&(1<<-g)-1,E>>=-g,g+=l;g>0;a=a*256+t[e+_],_+=w,g-=8);for(u=a&(1<<-g)-1,a>>=-g,g+=n;g>0;u=u*256+t[e+_],_+=w,g-=8);if(a===0)a=1-f;else{if(a===d)return u?NaN:(E?-1:1)*(1/0);u=u+Math.pow(2,n),a=a-f}return(E?-1:1)*u*Math.pow(2,a-n)},Lo.write=function(t,e,r,n,i,a){var u,l,d,f=a*8-i-1,g=(1<<f)-1,_=g>>1,w=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=n?0:a-1,x=n?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,u=g):(u=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-u))<1&&(u--,d*=2),u+_>=1?e+=w/d:e+=w*Math.pow(2,1-_),e*d>=2&&(u++,d/=2),u+_>=g?(l=0,u=g):u+_>=1?(l=(e*d-1)*Math.pow(2,i),u=u+_):(l=e*Math.pow(2,_-1)*Math.pow(2,i),u=0));i>=8;t[r+E]=l&255,E+=x,l/=256,i-=8);for(u=u<<i|l,f+=i;f>0;t[r+E]=u&255,E+=x,u/=256,f-=8);t[r+E-x]|=A*128},Lo}function Of(){if(kf)return mn;kf=!0;let t=Gm(),e=zm(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;mn.Buffer=u,mn.SlowBuffer=D,mn.INSPECT_MAX_BYTES=50;let n=2147483647;mn.kMaxLength=n,u.TYPED_ARRAY_SUPPORT=i(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{let C=new Uint8Array(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,Uint8Array.prototype),Object.setPrototypeOf(C,m),C.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function a(C){if(C>n)throw new RangeError('The value "'+C+'" is invalid for option "size"');let m=new Uint8Array(C);return Object.setPrototypeOf(m,u.prototype),m}function u(C,m,p){if(typeof C=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(C)}return l(C,m,p)}u.poolSize=8192;function l(C,m,p){if(typeof C=="string")return _(C,m);if(ArrayBuffer.isView(C))return E(C);if(C==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C);if(Xe(C,ArrayBuffer)||C&&Xe(C.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Xe(C,SharedArrayBuffer)||C&&Xe(C.buffer,SharedArrayBuffer)))return x(C,m,p);if(typeof C=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let H=C.valueOf&&C.valueOf();if(H!=null&&H!==C)return u.from(H,m,p);let ee=A(C);if(ee)return ee;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof C[Symbol.toPrimitive]=="function")return u.from(C[Symbol.toPrimitive]("string"),m,p);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C)}u.from=function(C,m,p){return l(C,m,p)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function d(C){if(typeof C!="number")throw new TypeError('"size" argument must be of type number');if(C<0)throw new RangeError('The value "'+C+'" is invalid for option "size"')}function f(C,m,p){return d(C),C<=0?a(C):m!==void 0?typeof p=="string"?a(C).fill(m,p):a(C).fill(m):a(C)}u.alloc=function(C,m,p){return f(C,m,p)};function g(C){return d(C),a(C<0?0:I(C)|0)}u.allocUnsafe=function(C){return g(C)},u.allocUnsafeSlow=function(C){return g(C)};function _(C,m){if((typeof m!="string"||m==="")&&(m="utf8"),!u.isEncoding(m))throw new TypeError("Unknown encoding: "+m);let p=U(C,m)|0,H=a(p),ee=H.write(C,m);return ee!==p&&(H=H.slice(0,ee)),H}function w(C){let m=C.length<0?0:I(C.length)|0,p=a(m);for(let H=0;H<m;H+=1)p[H]=C[H]&255;return p}function E(C){if(Xe(C,Uint8Array)){let m=new Uint8Array(C);return x(m.buffer,m.byteOffset,m.byteLength)}return w(C)}function x(C,m,p){if(m<0||C.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(C.byteLength<m+(p||0))throw new RangeError('"length" is outside of buffer bounds');let H;return m===void 0&&p===void 0?H=new Uint8Array(C):p===void 0?H=new Uint8Array(C,m):H=new Uint8Array(C,m,p),Object.setPrototypeOf(H,u.prototype),H}function A(C){if(u.isBuffer(C)){let m=I(C.length)|0,p=a(m);return p.length===0||C.copy(p,0,0,m),p}if(C.length!==void 0)return typeof C.length!="number"||Ht(C.length)?a(0):w(C);if(C.type==="Buffer"&&Array.isArray(C.data))return w(C.data)}function I(C){if(C>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return C|0}function D(C){return+C!=C&&(C=0),u.alloc(+C)}u.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==u.prototype},u.compare=function(m,p){if(Xe(m,Uint8Array)&&(m=u.from(m,m.offset,m.byteLength)),Xe(p,Uint8Array)&&(p=u.from(p,p.offset,p.byteLength)),!u.isBuffer(m)||!u.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===p)return 0;let H=m.length,ee=p.length;for(let X=0,pe=Math.min(H,ee);X<pe;++X)if(m[X]!==p[X]){H=m[X],ee=p[X];break}return H<ee?-1:ee<H?1:0},u.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(m,p){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return u.alloc(0);let H;if(p===void 0)for(p=0,H=0;H<m.length;++H)p+=m[H].length;let ee=u.allocUnsafe(p),X=0;for(H=0;H<m.length;++H){let pe=m[H];if(Xe(pe,Uint8Array))X+pe.length>ee.length?(u.isBuffer(pe)||(pe=u.from(pe)),pe.copy(ee,X)):Uint8Array.prototype.set.call(ee,pe,X);else if(u.isBuffer(pe))pe.copy(ee,X);else throw new TypeError('"list" argument must be an Array of Buffers');X+=pe.length}return ee};function U(C,m){if(u.isBuffer(C))return C.length;if(ArrayBuffer.isView(C)||Xe(C,ArrayBuffer))return C.byteLength;if(typeof C!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof C);let p=C.length,H=arguments.length>2&&arguments[2]===!0;if(!H&&p===0)return 0;let ee=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":return ve(C).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p*2;case"hex":return p>>>1;case"base64":return De(C).length;default:if(ee)return H?-1:ve(C).length;m=(""+m).toLowerCase(),ee=!0}}u.byteLength=U;function z(C,m,p){let H=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((p===void 0||p>this.length)&&(p=this.length),p<=0)||(p>>>=0,m>>>=0,p<=m))return"";for(C||(C="utf8");;)switch(C){case"hex":return Oe(this,m,p);case"utf8":case"utf-8":return Le(this,m,p);case"ascii":return Rt(this,m,p);case"latin1":case"binary":return Re(this,m,p);case"base64":return ze(this,m,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _t(this,m,p);default:if(H)throw new TypeError("Unknown encoding: "+C);C=(C+"").toLowerCase(),H=!0}}u.prototype._isBuffer=!0;function P(C,m,p){let H=C[m];C[m]=C[p],C[p]=H}u.prototype.swap16=function(){let m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<m;p+=2)P(this,p,p+1);return this},u.prototype.swap32=function(){let m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<m;p+=4)P(this,p,p+3),P(this,p+1,p+2);return this},u.prototype.swap64=function(){let m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<m;p+=8)P(this,p,p+7),P(this,p+1,p+6),P(this,p+2,p+5),P(this,p+3,p+4);return this},u.prototype.toString=function(){let m=this.length;return m===0?"":arguments.length===0?Le(this,0,m):z.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(m){if(!u.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:u.compare(this,m)===0},u.prototype.inspect=function(){let m="",p=mn.INSPECT_MAX_BYTES;return m=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(m+=" ... "),"<Buffer "+m+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(m,p,H,ee,X){if(Xe(m,Uint8Array)&&(m=u.from(m,m.offset,m.byteLength)),!u.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(p===void 0&&(p=0),H===void 0&&(H=m?m.length:0),ee===void 0&&(ee=0),X===void 0&&(X=this.length),p<0||H>m.length||ee<0||X>this.length)throw new RangeError("out of range index");if(ee>=X&&p>=H)return 0;if(ee>=X)return-1;if(p>=H)return 1;if(p>>>=0,H>>>=0,ee>>>=0,X>>>=0,this===m)return 0;let pe=X-ee,Ce=H-p,Je=Math.min(pe,Ce),Be=this.slice(ee,X),Ge=m.slice(p,H);for(let He=0;He<Je;++He)if(Be[He]!==Ge[He]){pe=Be[He],Ce=Ge[He];break}return pe<Ce?-1:Ce<pe?1:0};function F(C,m,p,H,ee){if(C.length===0)return-1;if(typeof p=="string"?(H=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),p=+p,Ht(p)&&(p=ee?0:C.length-1),p<0&&(p=C.length+p),p>=C.length){if(ee)return-1;p=C.length-1}else if(p<0)if(ee)p=0;else return-1;if(typeof m=="string"&&(m=u.from(m,H)),u.isBuffer(m))return m.length===0?-1:te(C,m,p,H,ee);if(typeof m=="number")return m=m&255,typeof Uint8Array.prototype.indexOf=="function"?ee?Uint8Array.prototype.indexOf.call(C,m,p):Uint8Array.prototype.lastIndexOf.call(C,m,p):te(C,[m],p,H,ee);throw new TypeError("val must be string, number or Buffer")}function te(C,m,p,H,ee){let X=1,pe=C.length,Ce=m.length;if(H!==void 0&&(H=String(H).toLowerCase(),H==="ucs2"||H==="ucs-2"||H==="utf16le"||H==="utf-16le")){if(C.length<2||m.length<2)return-1;X=2,pe/=2,Ce/=2,p/=2}function Je(Ge,He){return X===1?Ge[He]:Ge.readUInt16BE(He*X)}let Be;if(ee){let Ge=-1;for(Be=p;Be<pe;Be++)if(Je(C,Be)===Je(m,Ge===-1?0:Be-Ge)){if(Ge===-1&&(Ge=Be),Be-Ge+1===Ce)return Ge*X}else Ge!==-1&&(Be-=Be-Ge),Ge=-1}else for(p+Ce>pe&&(p=pe-Ce),Be=p;Be>=0;Be--){let Ge=!0;for(let He=0;He<Ce;He++)if(Je(C,Be+He)!==Je(m,He)){Ge=!1;break}if(Ge)return Be}return-1}u.prototype.includes=function(m,p,H){return this.indexOf(m,p,H)!==-1},u.prototype.indexOf=function(m,p,H){return F(this,m,p,H,!0)},u.prototype.lastIndexOf=function(m,p,H){return F(this,m,p,H,!1)};function oe(C,m,p,H){p=Number(p)||0;let ee=C.length-p;H?(H=Number(H),H>ee&&(H=ee)):H=ee;let X=m.length;H>X/2&&(H=X/2);let pe;for(pe=0;pe<H;++pe){let Ce=parseInt(m.substr(pe*2,2),16);if(Ht(Ce))return pe;C[p+pe]=Ce}return pe}function M(C,m,p,H){return Me(ve(m,C.length-p),C,p,H)}function he(C,m,p,H){return Me(Ie(m),C,p,H)}function me(C,m,p,H){return Me(De(m),C,p,H)}function xe(C,m,p,H){return Me(Ve(m,C.length-p),C,p,H)}u.prototype.write=function(m,p,H,ee){if(p===void 0)ee="utf8",H=this.length,p=0;else if(H===void 0&&typeof p=="string")ee=p,H=this.length,p=0;else if(isFinite(p))p=p>>>0,isFinite(H)?(H=H>>>0,ee===void 0&&(ee="utf8")):(ee=H,H=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let X=this.length-p;if((H===void 0||H>X)&&(H=X),m.length>0&&(H<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");ee||(ee="utf8");let pe=!1;for(;;)switch(ee){case"hex":return oe(this,m,p,H);case"utf8":case"utf-8":return M(this,m,p,H);case"ascii":case"latin1":case"binary":return he(this,m,p,H);case"base64":return me(this,m,p,H);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xe(this,m,p,H);default:if(pe)throw new TypeError("Unknown encoding: "+ee);ee=(""+ee).toLowerCase(),pe=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ze(C,m,p){return m===0&&p===C.length?t.fromByteArray(C):t.fromByteArray(C.slice(m,p))}function Le(C,m,p){p=Math.min(C.length,p);let H=[],ee=m;for(;ee<p;){let X=C[ee],pe=null,Ce=X>239?4:X>223?3:X>191?2:1;if(ee+Ce<=p){let Je,Be,Ge,He;switch(Ce){case 1:X<128&&(pe=X);break;case 2:Je=C[ee+1],(Je&192)===128&&(He=(X&31)<<6|Je&63,He>127&&(pe=He));break;case 3:Je=C[ee+1],Be=C[ee+2],(Je&192)===128&&(Be&192)===128&&(He=(X&15)<<12|(Je&63)<<6|Be&63,He>2047&&(He<55296||He>57343)&&(pe=He));break;case 4:Je=C[ee+1],Be=C[ee+2],Ge=C[ee+3],(Je&192)===128&&(Be&192)===128&&(Ge&192)===128&&(He=(X&15)<<18|(Je&63)<<12|(Be&63)<<6|Ge&63,He>65535&&He<1114112&&(pe=He))}}pe===null?(pe=65533,Ce=1):pe>65535&&(pe-=65536,H.push(pe>>>10&1023|55296),pe=56320|pe&1023),H.push(pe),ee+=Ce}return lt(H)}let ct=4096;function lt(C){let m=C.length;if(m<=ct)return String.fromCharCode.apply(String,C);let p="",H=0;for(;H<m;)p+=String.fromCharCode.apply(String,C.slice(H,H+=ct));return p}function Rt(C,m,p){let H="";p=Math.min(C.length,p);for(let ee=m;ee<p;++ee)H+=String.fromCharCode(C[ee]&127);return H}function Re(C,m,p){let H="";p=Math.min(C.length,p);for(let ee=m;ee<p;++ee)H+=String.fromCharCode(C[ee]);return H}function Oe(C,m,p){let H=C.length;(!m||m<0)&&(m=0),(!p||p<0||p>H)&&(p=H);let ee="";for(let X=m;X<p;++X)ee+=Se[C[X]];return ee}function _t(C,m,p){let H=C.slice(m,p),ee="";for(let X=0;X<H.length-1;X+=2)ee+=String.fromCharCode(H[X]+H[X+1]*256);return ee}u.prototype.slice=function(m,p){let H=this.length;m=~~m,p=p===void 0?H:~~p,m<0?(m+=H,m<0&&(m=0)):m>H&&(m=H),p<0?(p+=H,p<0&&(p=0)):p>H&&(p=H),p<m&&(p=m);let ee=this.subarray(m,p);return Object.setPrototypeOf(ee,u.prototype),ee};function je(C,m,p){if(C%1!==0||C<0)throw new RangeError("offset is not uint");if(C+m>p)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(m,p,H){m=m>>>0,p=p>>>0,H||je(m,p,this.length);let ee=this[m],X=1,pe=0;for(;++pe<p&&(X*=256);)ee+=this[m+pe]*X;return ee},u.prototype.readUintBE=u.prototype.readUIntBE=function(m,p,H){m=m>>>0,p=p>>>0,H||je(m,p,this.length);let ee=this[m+--p],X=1;for(;p>0&&(X*=256);)ee+=this[m+--p]*X;return ee},u.prototype.readUint8=u.prototype.readUInt8=function(m,p){return m=m>>>0,p||je(m,1,this.length),this[m]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(m,p){return m=m>>>0,p||je(m,2,this.length),this[m]|this[m+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(m,p){return m=m>>>0,p||je(m,2,this.length),this[m]<<8|this[m+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(m,p){return m=m>>>0,p||je(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(m,p){return m=m>>>0,p||je(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},u.prototype.readBigUInt64LE=Ke(function(m){m=m>>>0,$(m,"offset");let p=this[m],H=this[m+7];(p===void 0||H===void 0)&&Y(m,this.length-8);let ee=p+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,X=this[++m]+this[++m]*2**8+this[++m]*2**16+H*2**24;return BigInt(ee)+(BigInt(X)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ke(function(m){m=m>>>0,$(m,"offset");let p=this[m],H=this[m+7];(p===void 0||H===void 0)&&Y(m,this.length-8);let ee=p*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],X=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+H;return(BigInt(ee)<<BigInt(32))+BigInt(X)}),u.prototype.readIntLE=function(m,p,H){m=m>>>0,p=p>>>0,H||je(m,p,this.length);let ee=this[m],X=1,pe=0;for(;++pe<p&&(X*=256);)ee+=this[m+pe]*X;return X*=128,ee>=X&&(ee-=Math.pow(2,8*p)),ee},u.prototype.readIntBE=function(m,p,H){m=m>>>0,p=p>>>0,H||je(m,p,this.length);let ee=p,X=1,pe=this[m+--ee];for(;ee>0&&(X*=256);)pe+=this[m+--ee]*X;return X*=128,pe>=X&&(pe-=Math.pow(2,8*p)),pe},u.prototype.readInt8=function(m,p){return m=m>>>0,p||je(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},u.prototype.readInt16LE=function(m,p){m=m>>>0,p||je(m,2,this.length);let H=this[m]|this[m+1]<<8;return H&32768?H|4294901760:H},u.prototype.readInt16BE=function(m,p){m=m>>>0,p||je(m,2,this.length);let H=this[m+1]|this[m]<<8;return H&32768?H|4294901760:H},u.prototype.readInt32LE=function(m,p){return m=m>>>0,p||je(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},u.prototype.readInt32BE=function(m,p){return m=m>>>0,p||je(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},u.prototype.readBigInt64LE=Ke(function(m){m=m>>>0,$(m,"offset");let p=this[m],H=this[m+7];(p===void 0||H===void 0)&&Y(m,this.length-8);let ee=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(H<<24);return(BigInt(ee)<<BigInt(32))+BigInt(p+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),u.prototype.readBigInt64BE=Ke(function(m){m=m>>>0,$(m,"offset");let p=this[m],H=this[m+7];(p===void 0||H===void 0)&&Y(m,this.length-8);let ee=(p<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(ee)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+H)}),u.prototype.readFloatLE=function(m,p){return m=m>>>0,p||je(m,4,this.length),e.read(this,m,!0,23,4)},u.prototype.readFloatBE=function(m,p){return m=m>>>0,p||je(m,4,this.length),e.read(this,m,!1,23,4)},u.prototype.readDoubleLE=function(m,p){return m=m>>>0,p||je(m,8,this.length),e.read(this,m,!0,52,8)},u.prototype.readDoubleBE=function(m,p){return m=m>>>0,p||je(m,8,this.length),e.read(this,m,!1,52,8)};function qe(C,m,p,H,ee,X){if(!u.isBuffer(C))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>ee||m<X)throw new RangeError('"value" argument is out of bounds');if(p+H>C.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(m,p,H,ee){if(m=+m,p=p>>>0,H=H>>>0,!ee){let Ce=Math.pow(2,8*H)-1;qe(this,m,p,H,Ce,0)}let X=1,pe=0;for(this[p]=m&255;++pe<H&&(X*=256);)this[p+pe]=m/X&255;return p+H},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(m,p,H,ee){if(m=+m,p=p>>>0,H=H>>>0,!ee){let Ce=Math.pow(2,8*H)-1;qe(this,m,p,H,Ce,0)}let X=H-1,pe=1;for(this[p+X]=m&255;--X>=0&&(pe*=256);)this[p+X]=m/pe&255;return p+H},u.prototype.writeUint8=u.prototype.writeUInt8=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,1,255,0),this[p]=m&255,p+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,2,65535,0),this[p]=m&255,this[p+1]=m>>>8,p+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,2,65535,0),this[p]=m>>>8,this[p+1]=m&255,p+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,4,4294967295,0),this[p+3]=m>>>24,this[p+2]=m>>>16,this[p+1]=m>>>8,this[p]=m&255,p+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,4,4294967295,0),this[p]=m>>>24,this[p+1]=m>>>16,this[p+2]=m>>>8,this[p+3]=m&255,p+4};function Ft(C,m,p,H,ee){S(m,H,ee,C,p,7);let X=Number(m&BigInt(4294967295));C[p++]=X,X=X>>8,C[p++]=X,X=X>>8,C[p++]=X,X=X>>8,C[p++]=X;let pe=Number(m>>BigInt(32)&BigInt(4294967295));return C[p++]=pe,pe=pe>>8,C[p++]=pe,pe=pe>>8,C[p++]=pe,pe=pe>>8,C[p++]=pe,p}function Mt(C,m,p,H,ee){S(m,H,ee,C,p,7);let X=Number(m&BigInt(4294967295));C[p+7]=X,X=X>>8,C[p+6]=X,X=X>>8,C[p+5]=X,X=X>>8,C[p+4]=X;let pe=Number(m>>BigInt(32)&BigInt(4294967295));return C[p+3]=pe,pe=pe>>8,C[p+2]=pe,pe=pe>>8,C[p+1]=pe,pe=pe>>8,C[p]=pe,p+8}u.prototype.writeBigUInt64LE=Ke(function(m,p=0){return Ft(this,m,p,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ke(function(m,p=0){return Mt(this,m,p,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(m,p,H,ee){if(m=+m,p=p>>>0,!ee){let Je=Math.pow(2,8*H-1);qe(this,m,p,H,Je-1,-Je)}let X=0,pe=1,Ce=0;for(this[p]=m&255;++X<H&&(pe*=256);)m<0&&Ce===0&&this[p+X-1]!==0&&(Ce=1),this[p+X]=(m/pe>>0)-Ce&255;return p+H},u.prototype.writeIntBE=function(m,p,H,ee){if(m=+m,p=p>>>0,!ee){let Je=Math.pow(2,8*H-1);qe(this,m,p,H,Je-1,-Je)}let X=H-1,pe=1,Ce=0;for(this[p+X]=m&255;--X>=0&&(pe*=256);)m<0&&Ce===0&&this[p+X+1]!==0&&(Ce=1),this[p+X]=(m/pe>>0)-Ce&255;return p+H},u.prototype.writeInt8=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,1,127,-128),m<0&&(m=255+m+1),this[p]=m&255,p+1},u.prototype.writeInt16LE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,2,32767,-32768),this[p]=m&255,this[p+1]=m>>>8,p+2},u.prototype.writeInt16BE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,2,32767,-32768),this[p]=m>>>8,this[p+1]=m&255,p+2},u.prototype.writeInt32LE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,4,2147483647,-2147483648),this[p]=m&255,this[p+1]=m>>>8,this[p+2]=m>>>16,this[p+3]=m>>>24,p+4},u.prototype.writeInt32BE=function(m,p,H){return m=+m,p=p>>>0,H||qe(this,m,p,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[p]=m>>>24,this[p+1]=m>>>16,this[p+2]=m>>>8,this[p+3]=m&255,p+4},u.prototype.writeBigInt64LE=Ke(function(m,p=0){return Ft(this,m,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ke(function(m,p=0){return Mt(this,m,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function tr(C,m,p,H,ee,X){if(p+H>C.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function wt(C,m,p,H,ee){return m=+m,p=p>>>0,ee||tr(C,m,p,4),e.write(C,m,p,H,23,4),p+4}u.prototype.writeFloatLE=function(m,p,H){return wt(this,m,p,!0,H)},u.prototype.writeFloatBE=function(m,p,H){return wt(this,m,p,!1,H)};function Pt(C,m,p,H,ee){return m=+m,p=p>>>0,ee||tr(C,m,p,8),e.write(C,m,p,H,52,8),p+8}u.prototype.writeDoubleLE=function(m,p,H){return Pt(this,m,p,!0,H)},u.prototype.writeDoubleBE=function(m,p,H){return Pt(this,m,p,!1,H)},u.prototype.copy=function(m,p,H,ee){if(!u.isBuffer(m))throw new TypeError("argument should be a Buffer");if(H||(H=0),!ee&&ee!==0&&(ee=this.length),p>=m.length&&(p=m.length),p||(p=0),ee>0&&ee<H&&(ee=H),ee===H||m.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(H<0||H>=this.length)throw new RangeError("Index out of range");if(ee<0)throw new RangeError("sourceEnd out of bounds");ee>this.length&&(ee=this.length),m.length-p<ee-H&&(ee=m.length-p+H);let X=ee-H;return this===m&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(p,H,ee):Uint8Array.prototype.set.call(m,this.subarray(H,ee),p),X},u.prototype.fill=function(m,p,H,ee){if(typeof m=="string"){if(typeof p=="string"?(ee=p,p=0,H=this.length):typeof H=="string"&&(ee=H,H=this.length),ee!==void 0&&typeof ee!="string")throw new TypeError("encoding must be a string");if(typeof ee=="string"&&!u.isEncoding(ee))throw new TypeError("Unknown encoding: "+ee);if(m.length===1){let pe=m.charCodeAt(0);(ee==="utf8"&&pe<128||ee==="latin1")&&(m=pe)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(p<0||this.length<p||this.length<H)throw new RangeError("Out of range index");if(H<=p)return this;p=p>>>0,H=H===void 0?this.length:H>>>0,m||(m=0);let X;if(typeof m=="number")for(X=p;X<H;++X)this[X]=m;else{let pe=u.isBuffer(m)?m:u.from(m,ee),Ce=pe.length;if(Ce===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(X=0;X<H-p;++X)this[X+p]=pe[X%Ce]}return this};let Qe={};function $e(C,m,p){Qe[C]=class extends p{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${C}]`,this.stack,delete this.name}get code(){return C}set code(ee){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ee,writable:!0})}toString(){return`${this.name} [${C}]: ${this.message}`}}}$e("ERR_BUFFER_OUT_OF_BOUNDS",function(C){return C?`${C} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),$e("ERR_INVALID_ARG_TYPE",function(C,m){return`The "${C}" argument must be of type number. Received type ${typeof m}`},TypeError),$e("ERR_OUT_OF_RANGE",function(C,m,p){let H=`The value of "${C}" is out of range.`,ee=p;return Number.isInteger(p)&&Math.abs(p)>2**32?ee=Q(String(p)):typeof p=="bigint"&&(ee=String(p),(p>BigInt(2)**BigInt(32)||p<-(BigInt(2)**BigInt(32)))&&(ee=Q(ee)),ee+="n"),H+=` It must be ${m}. Received ${ee}`,H},RangeError);function Q(C){let m="",p=C.length,H=C[0]==="-"?1:0;for(;p>=H+4;p-=3)m=`_${C.slice(p-3,p)}${m}`;return`${C.slice(0,p)}${m}`}function v(C,m,p){$(m,"offset"),(C[m]===void 0||C[m+p]===void 0)&&Y(m,C.length-(p+1))}function S(C,m,p,H,ee,X){if(C>p||C<m){let pe=typeof m=="bigint"?"n":"",Ce;throw m===0||m===BigInt(0)?Ce=`>= 0${pe} and < 2${pe} ** ${(X+1)*8}${pe}`:Ce=`>= -(2${pe} ** ${(X+1)*8-1}${pe}) and < 2 ** ${(X+1)*8-1}${pe}`,new Qe.ERR_OUT_OF_RANGE("value",Ce,C)}v(H,ee,X)}function $(C,m){if(typeof C!="number")throw new Qe.ERR_INVALID_ARG_TYPE(m,"number",C)}function Y(C,m,p){throw Math.floor(C)!==C?($(C,p),new Qe.ERR_OUT_OF_RANGE("offset","an integer",C)):m<0?new Qe.ERR_BUFFER_OUT_OF_BOUNDS:new Qe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,C)}let ue=/[^+/0-9A-Za-z-_]/g;function de(C){if(C=C.split("=")[0],C=C.trim().replace(ue,""),C.length<2)return"";for(;C.length%4!==0;)C=C+"=";return C}function ve(C,m){m=m||1/0;let p,H=C.length,ee=null,X=[];for(let pe=0;pe<H;++pe){if(p=C.charCodeAt(pe),p>55295&&p<57344){if(!ee){if(p>56319){(m-=3)>-1&&X.push(239,191,189);continue}else if(pe+1===H){(m-=3)>-1&&X.push(239,191,189);continue}ee=p;continue}if(p<56320){(m-=3)>-1&&X.push(239,191,189),ee=p;continue}p=(ee-55296<<10|p-56320)+65536}else ee&&(m-=3)>-1&&X.push(239,191,189);if(ee=null,p<128){if((m-=1)<0)break;X.push(p)}else if(p<2048){if((m-=2)<0)break;X.push(p>>6|192,p&63|128)}else if(p<65536){if((m-=3)<0)break;X.push(p>>12|224,p>>6&63|128,p&63|128)}else if(p<1114112){if((m-=4)<0)break;X.push(p>>18|240,p>>12&63|128,p>>6&63|128,p&63|128)}else throw new Error("Invalid code point")}return X}function Ie(C){let m=[];for(let p=0;p<C.length;++p)m.push(C.charCodeAt(p)&255);return m}function Ve(C,m){let p,H,ee,X=[];for(let pe=0;pe<C.length&&!((m-=2)<0);++pe)p=C.charCodeAt(pe),H=p>>8,ee=p%256,X.push(ee),X.push(H);return X}function De(C){return t.toByteArray(de(C))}function Me(C,m,p,H){let ee;for(ee=0;ee<H&&!(ee+p>=m.length||ee>=C.length);++ee)m[ee+p]=C[ee];return ee}function Xe(C,m){return C instanceof m||C!=null&&C.constructor!=null&&C.constructor.name!=null&&C.constructor.name===m.name}function Ht(C){return C!==C}let Se=function(){let C="0123456789abcdef",m=new Array(256);for(let p=0;p<16;++p){let H=p*16;for(let ee=0;ee<16;++ee)m[H+ee]=C[p]+C[ee]}return m}();function Ke(C){return typeof BigInt>"u"?Pe:C}function Pe(){throw new Error("BigInt not supported")}return mn}var Ui,Pf,Lo,Nf,mn,kf,Df=pn(()=>{"use strict";N();O();k();Ui={},Pf=!1;Lo={},Nf=!1;mn={},kf=!1});var Sr={};Do(Sr,{Buffer:()=>ie,INSPECT_MAX_BYTES:()=>Ym,default:()=>Yr,kMaxLength:()=>Qm});var Yr,ie,Ym,Qm,ir=pn(()=>{"use strict";N();O();k();Df();Yr=Of();Yr.Buffer;Yr.SlowBuffer;Yr.INSPECT_MAX_BYTES;Yr.kMaxLength;ie=Yr.Buffer,Ym=Yr.INSPECT_MAX_BYTES,Qm=Yr.kMaxLength});var O=pn(()=>{"use strict";ir()});var Yi={};Do(Yi,{EventEmitter:()=>H0,default:()=>Sn,defaultMaxListeners:()=>V0,init:()=>K0,listenerCount:()=>q0,on:()=>$0,once:()=>W0});function M0(){if(yd)return os;yd=!0;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(F,te,oe){return Function.prototype.apply.call(F,te,oe)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:r=function(F){return Object.getOwnPropertyNames(F)};function n(P){console&&console.warn&&console.warn(P)}var i=Number.isNaN||function(F){return F!==F};function a(){a.init.call(this)}os=a,os.once=D,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function l(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(P){if(typeof P!="number"||P<0||i(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");u=P}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(F){if(typeof F!="number"||F<0||i(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this};function d(P){return P._maxListeners===void 0?a.defaultMaxListeners:P._maxListeners}a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(F){for(var te=[],oe=1;oe<arguments.length;oe++)te.push(arguments[oe]);var M=F==="error",he=this._events;if(he!==void 0)M=M&&he.error===void 0;else if(!M)return!1;if(M){var me;if(te.length>0&&(me=te[0]),me instanceof Error)throw me;var xe=new Error("Unhandled error."+(me?" ("+me.message+")":""));throw xe.context=me,xe}var ze=he[F];if(ze===void 0)return!1;if(typeof ze=="function")e(ze,this,te);else for(var Le=ze.length,ct=x(ze,Le),oe=0;oe<Le;++oe)e(ct[oe],this,te);return!0};function f(P,F,te,oe){var M,he,me;if(l(te),he=P._events,he===void 0?(he=P._events=Object.create(null),P._eventsCount=0):(he.newListener!==void 0&&(P.emit("newListener",F,te.listener?te.listener:te),he=P._events),me=he[F]),me===void 0)me=he[F]=te,++P._eventsCount;else if(typeof me=="function"?me=he[F]=oe?[te,me]:[me,te]:oe?me.unshift(te):me.push(te),M=d(P),M>0&&me.length>M&&!me.warned){me.warned=!0;var xe=new Error("Possible EventEmitter memory leak detected. "+me.length+" "+String(F)+" listeners added. Use emitter.setMaxListeners() to increase limit");xe.name="MaxListenersExceededWarning",xe.emitter=P,xe.type=F,xe.count=me.length,n(xe)}return P}a.prototype.addListener=function(F,te){return f(this,F,te,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(F,te){return f(this,F,te,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(P,F,te){var oe={fired:!1,wrapFn:void 0,target:P,type:F,listener:te},M=g.bind(oe);return M.listener=te,oe.wrapFn=M,M}a.prototype.once=function(F,te){return l(te),this.on(F,_(this,F,te)),this},a.prototype.prependOnceListener=function(F,te){return l(te),this.prependListener(F,_(this,F,te)),this},a.prototype.removeListener=function(F,te){var oe,M,he,me,xe;if(l(te),M=this._events,M===void 0)return this;if(oe=M[F],oe===void 0)return this;if(oe===te||oe.listener===te)--this._eventsCount===0?this._events=Object.create(null):(delete M[F],M.removeListener&&this.emit("removeListener",F,oe.listener||te));else if(typeof oe!="function"){for(he=-1,me=oe.length-1;me>=0;me--)if(oe[me]===te||oe[me].listener===te){xe=oe[me].listener,he=me;break}if(he<0)return this;he===0?oe.shift():A(oe,he),oe.length===1&&(M[F]=oe[0]),M.removeListener!==void 0&&this.emit("removeListener",F,xe||te)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(F){var te,oe,M;if(oe=this._events,oe===void 0)return this;if(oe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):oe[F]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete oe[F]),this;if(arguments.length===0){var he=Object.keys(oe),me;for(M=0;M<he.length;++M)me=he[M],me!=="removeListener"&&this.removeAllListeners(me);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(te=oe[F],typeof te=="function")this.removeListener(F,te);else if(te!==void 0)for(M=te.length-1;M>=0;M--)this.removeListener(F,te[M]);return this};function w(P,F,te){var oe=P._events;if(oe===void 0)return[];var M=oe[F];return M===void 0?[]:typeof M=="function"?te?[M.listener||M]:[M]:te?I(M):x(M,M.length)}a.prototype.listeners=function(F){return w(this,F,!0)},a.prototype.rawListeners=function(F){return w(this,F,!1)},a.listenerCount=function(P,F){return typeof P.listenerCount=="function"?P.listenerCount(F):E.call(P,F)},a.prototype.listenerCount=E;function E(P){var F=this._events;if(F!==void 0){var te=F[P];if(typeof te=="function")return 1;if(te!==void 0)return te.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function x(P,F){for(var te=new Array(F),oe=0;oe<F;++oe)te[oe]=P[oe];return te}function A(P,F){for(;F+1<P.length;F++)P[F]=P[F+1];P.pop()}function I(P){for(var F=new Array(P.length),te=0;te<F.length;++te)F[te]=P[te].listener||P[te];return F}function D(P,F){return new Promise(function(te,oe){function M(me){P.removeListener(F,he),oe(me)}function he(){typeof P.removeListener=="function"&&P.removeListener("error",M),te([].slice.call(arguments))}z(P,F,he,{once:!0}),F!=="error"&&U(P,M,{once:!0})})}function U(P,F,te){typeof P.on=="function"&&z(P,"error",F,te)}function z(P,F,te,oe){if(typeof P.on=="function")oe.once?P.once(F,te):P.on(F,te);else if(typeof P.addEventListener=="function")P.addEventListener(F,function M(he){oe.once&&P.removeEventListener(F,M),te(he)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}return os}var os,yd,Sn,H0,V0,K0,q0,$0,W0,ai=pn(()=>{"use strict";N();O();k();os={},yd=!1;Sn=M0();Sn.once;Sn.once=function(t,e){return new Promise((r,n)=>{function i(...u){a!==void 0&&t.removeListener("error",a),r(u)}let a;e!=="error"&&(a=u=>{t.removeListener(name,i),n(u)},t.once("error",a)),t.once(e,i)})};Sn.on=function(t,e){let r=[],n=[],i=null,a=!1,u={async next(){let f=r.shift();if(f)return createIterResult(f,!1);if(i){let g=Promise.reject(i);return i=null,g}return a?createIterResult(void 0,!0):new Promise((g,_)=>n.push({resolve:g,reject:_}))},async return(){t.removeListener(e,l),t.removeListener("error",d),a=!0;for(let f of n)f.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(f){i=f,t.removeListener(e,l),t.removeListener("error",d)},[Symbol.asyncIterator](){return this}};return t.on(e,l),t.on("error",d),u;function l(...f){let g=n.shift();g?g.resolve(createIterResult(f,!1)):r.push(f)}function d(f){a=!0;let g=n.shift();g?g.reject(f):i=f,u.return()}};({EventEmitter:H0,defaultMaxListeners:V0,init:K0,listenerCount:q0,on:$0,once:W0}=Sn)});var Du=_e((Qi,Ou)=>{"use strict";N();O();k();(function(e,r){if(typeof Qi=="object"&&typeof Ou=="object")Ou.exports=r();else if(typeof define=="function"&&define.amd)define([],r);else{var n=r();for(var i in n)(typeof Qi=="object"?Qi:e)[i]=n[i]}})(Qi,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(n,i,a){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:a})},r.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var u in n)r.d(a,u,function(l){return n[l]}.bind(null,u));return a},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="",r(r.s=22)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function l(d,f){for(var g=0;g<f.length;g++){var _=f[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(d,_.key,_)}}return function(d,f,g){return f&&l(d.prototype,f),g&&l(d,g),d}}(),i={debug:function(){},info:function(){},warn:function(){},error:function(){}},a=void 0,u=void 0;(e.Log=function(){function l(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.reset=function(){u=3,a=i},l.debug=function(){if(u>=4){for(var f=arguments.length,g=Array(f),_=0;_<f;_++)g[_]=arguments[_];a.debug.apply(a,Array.from(g))}},l.info=function(){if(u>=3){for(var f=arguments.length,g=Array(f),_=0;_<f;_++)g[_]=arguments[_];a.info.apply(a,Array.from(g))}},l.warn=function(){if(u>=2){for(var f=arguments.length,g=Array(f),_=0;_<f;_++)g[_]=arguments[_];a.warn.apply(a,Array.from(g))}},l.error=function(){if(u>=1){for(var f=arguments.length,g=Array(f),_=0;_<f;_++)g[_]=arguments[_];a.error.apply(a,Array.from(g))}},n(l,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return u},set:function(f){if(!(0<=f&&f<=4))throw new Error("Invalid log level");u=f}},{key:"logger",get:function(){return a},set:function(f){if(!f.debug&&f.info&&(f.debug=f.info),!(f.debug&&f.info&&f.warn&&f.error))throw new Error("Invalid logger");a=f}}]),l}()).reset()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function l(d,f){for(var g=0;g<f.length;g++){var _=f[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(d,_.key,_)}}return function(d,f,g){return f&&l(d.prototype,f),g&&l(d,g),d}}(),i={setInterval:function(l){function d(f,g){return l.apply(this,arguments)}return d.toString=function(){return l.toString()},d}(function(l,d){return setInterval(l,d)}),clearInterval:function(l){function d(f){return l.apply(this,arguments)}return d.toString=function(){return l.toString()},d}(function(l){return clearInterval(l)})},a=!1,u=null;e.Global=function(){function l(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,l)}return l._testing=function(){a=!0},l.setXMLHttpRequest=function(f){u=f},n(l,null,[{key:"location",get:function(){if(!a)return location}},{key:"localStorage",get:function(){if(!a&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!a&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!a&&typeof window<"u")return u||XMLHttpRequest}},{key:"timer",get:function(){if(!a)return i}}]),l}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataService=void 0;var n=function(){function d(f,g){for(var _=0;_<g.length;_++){var w=g[_];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,g,_){return g&&d(f.prototype,g),_&&d(f,_),f}}(),i=r(0),a=r(7);function u(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}var l=".well-known/openid-configuration";e.MetadataService=function(){function d(f){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.JsonService;if(u(this,d),!f)throw i.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=f,this._jsonService=new g(["application/jwk-set+json"])}return d.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},d.prototype.getMetadata=function(){var g=this;return this._settings.metadata?(i.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(i.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(_){i.Log.debug("MetadataService.getMetadata: json received");var w=g._settings.metadataSeed||{};return g._settings.metadata=Object.assign({},w,_),g._settings.metadata})):(i.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},d.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},d.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},d.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},d.prototype.getTokenEndpoint=function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",g)},d.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},d.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},d.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},d.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},d.prototype._getMetadataProperty=function(g){var _=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return i.Log.debug("MetadataService.getMetadataProperty for: "+g),this.getMetadata().then(function(w){if(i.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),w[g]===void 0){if(_===!0)return void i.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+g);throw i.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+g),new Error("Metadata does not contain property "+g)}return w[g]})},d.prototype.getSigningKeys=function(){var g=this;return this._settings.signingKeys?(i.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(_){return i.Log.debug("MetadataService.getSigningKeys: jwks_uri received",_),g._jsonService.getJson(_).then(function(w){if(i.Log.debug("MetadataService.getSigningKeys: key set received",w),!w.keys)throw i.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return g._settings.signingKeys=w.keys,g._settings.signingKeys})})},n(d,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(l)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=l))),this._metadataUrl}}]),d}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UrlUtility=void 0;var n=r(0),i=r(1);e.UrlUtility=function(){function a(){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.addQueryParam=function(l,d,f){return l.indexOf("?")<0&&(l+="?"),l[l.length-1]!=="?"&&(l+="&"),l+=encodeURIComponent(d),l+="=",l+=encodeURIComponent(f)},a.parseUrlFragment=function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.Global;typeof l!="string"&&(l=f.location.href);var g=l.lastIndexOf(d);g>=0&&(l=l.substr(g+1)),d==="?"&&(g=l.indexOf("#"))>=0&&(l=l.substr(0,g));for(var _,w={},E=/([^&=]+)=([^&]*)/g,x=0;_=E.exec(l);)if(w[decodeURIComponent(_[1])]=decodeURIComponent(_[2].replace(/\+/g," ")),x++>50)return n.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",l),{error:"Response exceeded expected number of parameters"};for(var A in w)return w;return{}},a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JoseUtil=void 0;var n=r(26),i=function(u){return u&&u.__esModule?u:{default:u}}(r(33));e.JoseUtil=(0,i.default)({jws:n.jws,KeyUtil:n.KeyUtil,X509:n.X509,crypto:n.crypto,hextob64u:n.hextob64u,b64tohex:n.b64tohex,AllowedSigningAlgs:n.AllowedSigningAlgs})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OidcClientSettings=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},i=function(){function A(I,D){for(var U=0;U<D.length;U++){var z=D[U];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(I,z.key,z)}}return function(I,D,U){return D&&A(I.prototype,D),U&&A(I,U),I}}(),a=r(0),u=r(23),l=r(6),d=r(24),f=r(2);function g(A,I){if(!(A instanceof I))throw new TypeError("Cannot call a class as a function")}var _=".well-known/openid-configuration",w="id_token",E="openid",x="client_secret_post";e.OidcClientSettings=function(){function A(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},D=I.authority,U=I.metadataUrl,z=I.metadata,P=I.signingKeys,F=I.metadataSeed,te=I.client_id,oe=I.client_secret,M=I.response_type,he=M===void 0?w:M,me=I.scope,xe=me===void 0?E:me,ze=I.redirect_uri,Le=I.post_logout_redirect_uri,ct=I.client_authentication,lt=ct===void 0?x:ct,Rt=I.prompt,Re=I.display,Oe=I.max_age,_t=I.ui_locales,je=I.acr_values,qe=I.resource,Ft=I.response_mode,Mt=I.filterProtocolClaims,tr=Mt===void 0||Mt,wt=I.loadUserInfo,Pt=wt===void 0||wt,Qe=I.staleStateAge,$e=Qe===void 0?900:Qe,Q=I.clockSkew,v=Q===void 0?300:Q,S=I.clockService,$=S===void 0?new u.ClockService:S,Y=I.userInfoJwtIssuer,ue=Y===void 0?"OP":Y,de=I.mergeClaims,ve=de!==void 0&&de,Ie=I.stateStore,Ve=Ie===void 0?new l.WebStorageStateStore:Ie,De=I.ResponseValidatorCtor,Me=De===void 0?d.ResponseValidator:De,Xe=I.MetadataServiceCtor,Ht=Xe===void 0?f.MetadataService:Xe,Se=I.extraQueryParams,Ke=Se===void 0?{}:Se,Pe=I.extraTokenParams,C=Pe===void 0?{}:Pe;g(this,A),this._authority=D,this._metadataUrl=U,this._metadata=z,this._metadataSeed=F,this._signingKeys=P,this._client_id=te,this._client_secret=oe,this._response_type=he,this._scope=xe,this._redirect_uri=ze,this._post_logout_redirect_uri=Le,this._client_authentication=lt,this._prompt=Rt,this._display=Re,this._max_age=Oe,this._ui_locales=_t,this._acr_values=je,this._resource=qe,this._response_mode=Ft,this._filterProtocolClaims=!!tr,this._loadUserInfo=!!Pt,this._staleStateAge=$e,this._clockSkew=v,this._clockService=$,this._userInfoJwtIssuer=ue,this._mergeClaims=!!ve,this._stateStore=Ve,this._validator=new Me(this),this._metadataService=new Ht(this),this._extraQueryParams=(Ke===void 0?"undefined":n(Ke))==="object"?Ke:{},this._extraTokenParams=(C===void 0?"undefined":n(C))==="object"?C:{}}return A.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},i(A,[{key:"client_id",get:function(){return this._client_id},set:function(D){if(this._client_id)throw a.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=D}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(D){if(this._authority)throw a.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=D}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(_)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=_)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(D){this._metadata=D}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(D){this._metadataSeed=D}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(D){this._signingKeys=D}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(D){(D===void 0?"undefined":n(D))==="object"?this._extraQueryParams=D:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(D){(D===void 0?"undefined":n(D))==="object"?this._extraTokenParams=D:this._extraTokenParams={}}}]),A}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebStorageStateStore=void 0;var n=r(0),i=r(1);function a(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}e.WebStorageStateStore=function(){function u(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=l.prefix,f=d===void 0?"oidc.":d,g=l.store,_=g===void 0?i.Global.localStorage:g;a(this,u),this._store=_,this._prefix=f}return u.prototype.set=function(d,f){return n.Log.debug("WebStorageStateStore.set",d),d=this._prefix+d,this._store.setItem(d,f),Promise.resolve()},u.prototype.get=function(d){n.Log.debug("WebStorageStateStore.get",d),d=this._prefix+d;var f=this._store.getItem(d);return Promise.resolve(f)},u.prototype.remove=function(d){n.Log.debug("WebStorageStateStore.remove",d),d=this._prefix+d;var f=this._store.getItem(d);return this._store.removeItem(d),Promise.resolve(f)},u.prototype.getAllKeys=function(){n.Log.debug("WebStorageStateStore.getAllKeys");for(var d=[],f=0;f<this._store.length;f++){var g=this._store.key(f);g.indexOf(this._prefix)===0&&d.push(g.substr(this._prefix.length))}return Promise.resolve(d)},u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JsonService=void 0;var n=r(0),i=r(1);function a(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}e.JsonService=function(){function u(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i.Global.XMLHttpRequest,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;a(this,u),l&&Array.isArray(l)?this._contentTypes=l.slice():this._contentTypes=[],this._contentTypes.push("application/json"),f&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=d,this._jwtHandler=f}return u.prototype.getJson=function(d,f){var g=this;if(!d)throw n.Log.error("JsonService.getJson: No url passed"),new Error("url");return n.Log.debug("JsonService.getJson, url: ",d),new Promise(function(_,w){var E=new g._XMLHttpRequest;E.open("GET",d);var x=g._contentTypes,A=g._jwtHandler;E.onload=function(){if(n.Log.debug("JsonService.getJson: HTTP response received, status",E.status),E.status===200){var I=E.getResponseHeader("Content-Type");if(I){var D=x.find(function(U){if(I.startsWith(U))return!0});if(D=="application/jwt")return void A(E).then(_,w);if(D)try{return void _(JSON.parse(E.responseText))}catch(U){return n.Log.error("JsonService.getJson: Error parsing JSON response",U.message),void w(U)}}w(Error("Invalid response Content-Type: "+I+", from URL: "+d))}else w(Error(E.statusText+" ("+E.status+")"))},E.onerror=function(){n.Log.error("JsonService.getJson: network error"),w(Error("Network Error"))},f&&(n.Log.debug("JsonService.getJson: token passed, setting Authorization header"),E.setRequestHeader("Authorization","Bearer "+f)),E.send()})},u.prototype.postForm=function(d,f,g){var _=this;if(!d)throw n.Log.error("JsonService.postForm: No url passed"),new Error("url");return n.Log.debug("JsonService.postForm, url: ",d),new Promise(function(w,E){var x=new _._XMLHttpRequest;x.open("POST",d);var A=_._contentTypes;x.onload=function(){if(n.Log.debug("JsonService.postForm: HTTP response received, status",x.status),x.status!==200){if(x.status===400&&(P=x.getResponseHeader("Content-Type"))&&A.find(function(F){if(P.startsWith(F))return!0}))try{var z=JSON.parse(x.responseText);if(z&&z.error)return n.Log.error("JsonService.postForm: Error from server: ",z.error),void E(new Error(z.error))}catch(F){return n.Log.error("JsonService.postForm: Error parsing JSON response",F.message),void E(F)}E(Error(x.statusText+" ("+x.status+")"))}else{var P;if((P=x.getResponseHeader("Content-Type"))&&A.find(function(F){if(P.startsWith(F))return!0}))try{return void w(JSON.parse(x.responseText))}catch(F){return n.Log.error("JsonService.postForm: Error parsing JSON response",F.message),void E(F)}E(Error("Invalid response Content-Type: "+P+", from URL: "+d))}},x.onerror=function(){n.Log.error("JsonService.postForm: network error"),E(Error("Network Error"))};var I="";for(var D in f){var U=f[D];U&&(I.length>0&&(I+="&"),I+=encodeURIComponent(D),I+="=",I+=encodeURIComponent(U))}x.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g!==void 0&&x.setRequestHeader("Authorization","Basic "+btoa(g)),x.send(I)})},u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninRequest=void 0;var n=r(0),i=r(3),a=r(13);e.SigninRequest=function(){function u(l){var d=l.url,f=l.client_id,g=l.redirect_uri,_=l.response_type,w=l.scope,E=l.authority,x=l.data,A=l.prompt,I=l.display,D=l.max_age,U=l.ui_locales,z=l.id_token_hint,P=l.login_hint,F=l.acr_values,te=l.resource,oe=l.response_mode,M=l.request,he=l.request_uri,me=l.extraQueryParams,xe=l.request_type,ze=l.client_secret,Le=l.extraTokenParams,ct=l.skipUserInfo;if(function(qe,Ft){if(!(qe instanceof Ft))throw new TypeError("Cannot call a class as a function")}(this,u),!d)throw n.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!f)throw n.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!g)throw n.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!_)throw n.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!w)throw n.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!E)throw n.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var lt=u.isOidc(_),Rt=u.isCode(_);oe||(oe=u.isCode(_)?"query":null),this.state=new a.SigninState({nonce:lt,data:x,client_id:f,authority:E,redirect_uri:g,code_verifier:Rt,request_type:xe,response_mode:oe,client_secret:ze,scope:w,extraTokenParams:Le,skipUserInfo:ct}),d=i.UrlUtility.addQueryParam(d,"client_id",f),d=i.UrlUtility.addQueryParam(d,"redirect_uri",g),d=i.UrlUtility.addQueryParam(d,"response_type",_),d=i.UrlUtility.addQueryParam(d,"scope",w),d=i.UrlUtility.addQueryParam(d,"state",this.state.id),lt&&(d=i.UrlUtility.addQueryParam(d,"nonce",this.state.nonce)),Rt&&(d=i.UrlUtility.addQueryParam(d,"code_challenge",this.state.code_challenge),d=i.UrlUtility.addQueryParam(d,"code_challenge_method","S256"));var Re={prompt:A,display:I,max_age:D,ui_locales:U,id_token_hint:z,login_hint:P,acr_values:F,resource:te,request:M,request_uri:he,response_mode:oe};for(var Oe in Re)Re[Oe]&&(d=i.UrlUtility.addQueryParam(d,Oe,Re[Oe]));for(var _t in me)d=i.UrlUtility.addQueryParam(d,_t,me[_t]);this.url=d}return u.isOidc=function(d){return!!d.split(/\s+/g).filter(function(f){return f==="id_token"})[0]},u.isOAuth=function(d){return!!d.split(/\s+/g).filter(function(f){return f==="token"})[0]},u.isCode=function(d){return!!d.split(/\s+/g).filter(function(f){return f==="code"})[0]},u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0;var n=function(){function l(d,f){for(var g=0;g<f.length;g++){var _=f[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(d,_.key,_)}}return function(d,f,g){return f&&l(d.prototype,f),g&&l(d,g),d}}(),i=r(0),a=function(d){return d&&d.__esModule?d:{default:d}}(r(14));function u(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}e.State=function(){function l(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=d.id,g=d.data,_=d.created,w=d.request_type;u(this,l),this._id=f||(0,a.default)(),this._data=g,this._created=typeof _=="number"&&_>0?_:parseInt(Date.now()/1e3),this._request_type=w}return l.prototype.toStorageString=function(){return i.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},l.fromStorageString=function(f){return i.Log.debug("State.fromStorageString"),new l(JSON.parse(f))},l.clearStaleState=function(f,g){var _=Date.now()/1e3-g;return f.getAllKeys().then(function(w){i.Log.debug("State.clearStaleState: got keys",w);for(var E=[],x=function(U){var z=w[U];I=f.get(z).then(function(P){var F=!1;if(P)try{var te=l.fromStorageString(P);i.Log.debug("State.clearStaleState: got item from key: ",z,te.created),te.created<=_&&(F=!0)}catch(oe){i.Log.error("State.clearStaleState: Error parsing state for key",z,oe.message),F=!0}else i.Log.debug("State.clearStaleState: no item in storage for key: ",z),F=!0;if(F)return i.Log.debug("State.clearStaleState: removed item for key: ",z),f.remove(z)}),E.push(I)},A=0;A<w.length;A++){var I;x(A)}return i.Log.debug("State.clearStaleState: waiting on promise count:",E.length),Promise.all(E)})},n(l,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),l}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OidcClient=void 0;var n=function(){function x(A,I){for(var D=0;D<I.length;D++){var U=I[D];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(A,U.key,U)}}return function(A,I,D){return I&&x(A.prototype,I),D&&x(A,D),A}}(),i=r(0),a=r(5),u=r(12),l=r(8),d=r(34),f=r(35),g=r(36),_=r(13),w=r(9);function E(x,A){if(!(x instanceof A))throw new TypeError("Cannot call a class as a function")}e.OidcClient=function(){function x(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};E(this,x),A instanceof a.OidcClientSettings?this._settings=A:this._settings=new a.OidcClientSettings(A)}return x.prototype.createSigninRequest=function(){var I=this,D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=D.response_type,z=D.scope,P=D.redirect_uri,F=D.data,te=D.state,oe=D.prompt,M=D.display,he=D.max_age,me=D.ui_locales,xe=D.id_token_hint,ze=D.login_hint,Le=D.acr_values,ct=D.resource,lt=D.request,Rt=D.request_uri,Re=D.response_mode,Oe=D.extraQueryParams,_t=D.extraTokenParams,je=D.request_type,qe=D.skipUserInfo,Ft=arguments[1];i.Log.debug("OidcClient.createSigninRequest");var Mt=this._settings.client_id;U=U||this._settings.response_type,z=z||this._settings.scope,P=P||this._settings.redirect_uri,oe=oe||this._settings.prompt,M=M||this._settings.display,he=he||this._settings.max_age,me=me||this._settings.ui_locales,Le=Le||this._settings.acr_values,ct=ct||this._settings.resource,Re=Re||this._settings.response_mode,Oe=Oe||this._settings.extraQueryParams,_t=_t||this._settings.extraTokenParams;var tr=this._settings.authority;return l.SigninRequest.isCode(U)&&U!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(wt){i.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",wt);var Pt=new l.SigninRequest({url:wt,client_id:Mt,redirect_uri:P,response_type:U,scope:z,data:F||te,authority:tr,prompt:oe,display:M,max_age:he,ui_locales:me,id_token_hint:xe,login_hint:ze,acr_values:Le,resource:ct,request:lt,request_uri:Rt,extraQueryParams:Oe,extraTokenParams:_t,request_type:je,response_mode:Re,client_secret:I._settings.client_secret,skipUserInfo:qe}),Qe=Pt.state;return(Ft=Ft||I._stateStore).set(Qe.id,Qe.toStorageString()).then(function(){return Pt})})},x.prototype.readSigninResponseState=function(I,D){var U=arguments.length>2&&arguments[2]!==void 0&&arguments[2];i.Log.debug("OidcClient.readSigninResponseState");var z=this._settings.response_mode==="query"||!this._settings.response_mode&&l.SigninRequest.isCode(this._settings.response_type),P=z?"?":"#",F=new d.SigninResponse(I,P);if(!F.state)return i.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));D=D||this._stateStore;var te=U?D.remove.bind(D):D.get.bind(D);return te(F.state).then(function(oe){if(!oe)throw i.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:_.SigninState.fromStorageString(oe),response:F}})},x.prototype.processSigninResponse=function(I,D){var U=this;return i.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(I,D,!0).then(function(z){var P=z.state,F=z.response;return i.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),U._validator.validateSigninResponse(P,F)})},x.prototype.createSignoutRequest=function(){var I=this,D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=D.id_token_hint,z=D.data,P=D.state,F=D.post_logout_redirect_uri,te=D.extraQueryParams,oe=D.request_type,M=arguments[1];return i.Log.debug("OidcClient.createSignoutRequest"),F=F||this._settings.post_logout_redirect_uri,te=te||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(he){if(!he)throw i.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");i.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",he);var me=new f.SignoutRequest({url:he,id_token_hint:U,post_logout_redirect_uri:F,data:z||P,extraQueryParams:te,request_type:oe}),xe=me.state;return xe&&(i.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(M=M||I._stateStore).set(xe.id,xe.toStorageString())),me})},x.prototype.readSignoutResponseState=function(I,D){var U=arguments.length>2&&arguments[2]!==void 0&&arguments[2];i.Log.debug("OidcClient.readSignoutResponseState");var z=new g.SignoutResponse(I);if(!z.state)return i.Log.debug("OidcClient.readSignoutResponseState: No state in response"),z.error?(i.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",z.error),Promise.reject(new u.ErrorResponse(z))):Promise.resolve({state:void 0,response:z});var P=z.state;D=D||this._stateStore;var F=U?D.remove.bind(D):D.get.bind(D);return F(P).then(function(te){if(!te)throw i.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:w.State.fromStorageString(te),response:z}})},x.prototype.processSignoutResponse=function(I,D){var U=this;return i.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(I,D,!0).then(function(z){var P=z.state,F=z.response;return P?(i.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),U._validator.validateSignoutResponse(P,F)):(i.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),F)})},x.prototype.clearStaleState=function(I){return i.Log.debug("OidcClient.clearStaleState"),I=I||this._stateStore,w.State.clearStaleState(I,this.settings.staleStateAge)},n(x,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),x}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenClient=void 0;var n=r(7),i=r(2),a=r(0);function u(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}e.TokenClient=function(){function l(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n.JsonService,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.MetadataService;if(u(this,l),!d)throw a.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=d,this._jsonService=new f,this._metadataService=new g(this._settings)}return l.prototype.exchangeCode=function(){var f=this,g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(g=Object.assign({},g)).grant_type=g.grant_type||"authorization_code",g.client_id=g.client_id||this._settings.client_id,g.client_secret=g.client_secret||this._settings.client_secret,g.redirect_uri=g.redirect_uri||this._settings.redirect_uri;var _=void 0,w=g._client_authentication||this._settings._client_authentication;return delete g._client_authentication,g.code?g.redirect_uri?g.code_verifier?g.client_id?g.client_secret||w!="client_secret_basic"?(w=="client_secret_basic"&&(_=g.client_id+":"+g.client_secret,delete g.client_id,delete g.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(E){return a.Log.debug("TokenClient.exchangeCode: Received token endpoint"),f._jsonService.postForm(E,g,_).then(function(x){return a.Log.debug("TokenClient.exchangeCode: response received"),x})})):(a.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(a.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(a.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(a.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(a.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},l.prototype.exchangeRefreshToken=function(){var f=this,g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(g=Object.assign({},g)).grant_type=g.grant_type||"refresh_token",g.client_id=g.client_id||this._settings.client_id,g.client_secret=g.client_secret||this._settings.client_secret;var _=void 0,w=g._client_authentication||this._settings._client_authentication;return delete g._client_authentication,g.refresh_token?g.client_id?(w=="client_secret_basic"&&(_=g.client_id+":"+g.client_secret,delete g.client_id,delete g.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(E){return a.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),f._jsonService.postForm(E,g,_).then(function(x){return a.Log.debug("TokenClient.exchangeRefreshToken: response received"),x})})):(a.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(a.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},l}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorResponse=void 0;var n=r(0);function i(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function a(u,l){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!l||typeof l!="object"&&typeof l!="function"?u:l}e.ErrorResponse=function(u){function l(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=d.error,g=d.error_description,_=d.error_uri,w=d.state,E=d.session_state;if(i(this,l),!f)throw n.Log.error("No error passed to ErrorResponse"),new Error("error");var x=a(this,u.call(this,g||f));return x.name="ErrorResponse",x.error=f,x.error_description=g,x.error_uri=_,x.state=w,x.session_state=E,x}return function(f,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);f.prototype=Object.create(g&&g.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(f,g):f.__proto__=g)}(l,u),l}(Error)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninState=void 0;var n=function(){function g(_,w){for(var E=0;E<w.length;E++){var x=w[E];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(_,x.key,x)}}return function(_,w,E){return w&&g(_.prototype,w),E&&g(_,E),_}}(),i=r(0),a=r(9),u=r(4),l=function(_){return _&&_.__esModule?_:{default:_}}(r(14));function d(g,_){if(!(g instanceof _))throw new TypeError("Cannot call a class as a function")}function f(g,_){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!_||typeof _!="object"&&typeof _!="function"?g:_}e.SigninState=function(g){function _(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=w.nonce,x=w.authority,A=w.client_id,I=w.redirect_uri,D=w.code_verifier,U=w.response_mode,z=w.client_secret,P=w.scope,F=w.extraTokenParams,te=w.skipUserInfo;d(this,_);var oe=f(this,g.call(this,arguments[0]));if(E===!0?oe._nonce=(0,l.default)():E&&(oe._nonce=E),D===!0?oe._code_verifier=(0,l.default)()+(0,l.default)()+(0,l.default)():D&&(oe._code_verifier=D),oe.code_verifier){var M=u.JoseUtil.hashString(oe.code_verifier,"SHA256");oe._code_challenge=u.JoseUtil.hexToBase64Url(M)}return oe._redirect_uri=I,oe._authority=x,oe._client_id=A,oe._response_mode=U,oe._client_secret=z,oe._scope=P,oe._extraTokenParams=F,oe._skipUserInfo=te,oe}return function(E,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);E.prototype=Object.create(x&&x.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(E,x):E.__proto__=x)}(_,g),_.prototype.toStorageString=function(){return i.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},_.fromStorageString=function(E){return i.Log.debug("SigninState.fromStorageString"),new _(JSON.parse(E))},n(_,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),_}(a.State)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return(n!="undefined"&&n!==null&&n.getRandomValues!==void 0?i:a)().replace(/-/g,"")};var n=typeof window<"u"?window.crypto||window.msCrypto:null;function i(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(u){return(u^n.getRandomValues(new Uint8Array(1))[0]&15>>u/4).toString(16)})}function a(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(u){return(u^16*Math.random()>>u/4).toString(16)})}t.exports=e.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.User=void 0;var n=function(){function a(u,l){for(var d=0;d<l.length;d++){var f=l[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,l,d){return l&&a(u.prototype,l),d&&a(u,d),u}}(),i=r(0);e.User=function(){function a(u){var l=u.id_token,d=u.session_state,f=u.access_token,g=u.refresh_token,_=u.token_type,w=u.scope,E=u.profile,x=u.expires_at,A=u.state;(function(D,U){if(!(D instanceof U))throw new TypeError("Cannot call a class as a function")})(this,a),this.id_token=l,this.session_state=d,this.access_token=f,this.refresh_token=g,this.token_type=_,this.scope=w,this.profile=E,this.expires_at=x,this.state=A}return a.prototype.toStorageString=function(){return i.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},a.fromStorageString=function(l){return i.Log.debug("User.fromStorageString"),new a(JSON.parse(l))},n(a,[{key:"expires_in",get:function(){if(this.expires_at){var l=parseInt(Date.now()/1e3);return this.expires_at-l}},set:function(l){var d=parseInt(l);if(typeof d=="number"&&d>0){var f=parseInt(Date.now()/1e3);this.expires_at=f+d}}},{key:"expired",get:function(){var l=this.expires_in;if(l!==void 0)return l<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AccessTokenEvents=void 0;var n=r(0),i=r(46);function a(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}e.AccessTokenEvents=function(){function u(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=l.accessTokenExpiringNotificationTime,f=d===void 0?60:d,g=l.accessTokenExpiringTimer,_=g===void 0?new i.Timer("Access token expiring"):g,w=l.accessTokenExpiredTimer,E=w===void 0?new i.Timer("Access token expired"):w;a(this,u),this._accessTokenExpiringNotificationTime=f,this._accessTokenExpiring=_,this._accessTokenExpired=E}return u.prototype.load=function(d){if(d.access_token&&d.expires_in!==void 0){var f=d.expires_in;if(n.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",f),f>0){var g=f-this._accessTokenExpiringNotificationTime;g<=0&&(g=1),n.Log.debug("AccessTokenEvents.load: registering expiring timer in:",g),this._accessTokenExpiring.init(g)}else n.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var _=f+1;n.Log.debug("AccessTokenEvents.load: registering expired timer in:",_),this._accessTokenExpired.init(_)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},u.prototype.unload=function(){n.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},u.prototype.addAccessTokenExpiring=function(d){this._accessTokenExpiring.addHandler(d)},u.prototype.removeAccessTokenExpiring=function(d){this._accessTokenExpiring.removeHandler(d)},u.prototype.addAccessTokenExpired=function(d){this._accessTokenExpired.addHandler(d)},u.prototype.removeAccessTokenExpired=function(d){this._accessTokenExpired.removeHandler(d)},u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Event=void 0;var n=r(0);e.Event=function(){function i(a){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,i),this._name=a,this._callbacks=[]}return i.prototype.addHandler=function(u){this._callbacks.push(u)},i.prototype.removeHandler=function(u){var l=this._callbacks.findIndex(function(d){return d===u});l>=0&&this._callbacks.splice(l,1)},i.prototype.raise=function(){n.Log.debug("Event: Raising event: "+this._name);for(var u=0;u<this._callbacks.length;u++){var l;(l=this._callbacks)[u].apply(l,arguments)}},i}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionMonitor=void 0;var n=function(){function d(f,g){for(var _=0;_<g.length;_++){var w=g[_];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,g,_){return g&&d(f.prototype,g),_&&d(f,_),f}}(),i=r(0),a=r(19),u=r(1);function l(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}e.SessionMonitor=function(){function d(f){var g=this,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.CheckSessionIFrame,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.Global.timer;if(l(this,d),!f)throw i.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=f,this._CheckSessionIFrameCtor=_,this._timer=w,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(E){E?g._start(E):g._settings.monitorAnonymousSession&&g._userManager.querySessionStatus().then(function(x){var A={session_state:x.session_state};x.sub&&x.sid&&(A.profile={sub:x.sub,sid:x.sid}),g._start(A)}).catch(function(x){i.Log.error("SessionMonitor ctor: error from querySessionStatus:",x.message)})}).catch(function(E){i.Log.error("SessionMonitor ctor: error from getUser:",E.message)}))}return d.prototype._start=function(g){var _=this,w=g.session_state;w&&(g.profile?(this._sub=g.profile.sub,this._sid=g.profile.sid,i.Log.debug("SessionMonitor._start: session_state:",w,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,i.Log.debug("SessionMonitor._start: session_state:",w,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(w):this._metadataService.getCheckSessionIframe().then(function(E){if(E){i.Log.debug("SessionMonitor._start: Initializing check session iframe");var x=_._client_id,A=_._checkSessionInterval,I=_._stopCheckSessionOnError;_._checkSessionIFrame=new _._CheckSessionIFrameCtor(_._callback.bind(_),x,E,A,I),_._checkSessionIFrame.load().then(function(){_._checkSessionIFrame.start(w)})}else i.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(E){i.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",E.message)}))},d.prototype._stop=function(){var g=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(i.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var _=this._timer.setInterval(function(){g._timer.clearInterval(_),g._userManager.querySessionStatus().then(function(w){var E={session_state:w.session_state};w.sub&&w.sid&&(E.profile={sub:w.sub,sid:w.sid}),g._start(E)}).catch(function(w){i.Log.error("SessionMonitor: error from querySessionStatus:",w.message)})},1e3)},d.prototype._callback=function(){var g=this;this._userManager.querySessionStatus().then(function(_){var w=!0;_?_.sub===g._sub?(w=!1,g._checkSessionIFrame.start(_.session_state),_.sid===g._sid?i.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",_.session_state):(i.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",_.session_state),g._userManager.events._raiseUserSessionChanged())):i.Log.debug("SessionMonitor._callback: Different subject signed into OP:",_.sub):i.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),w&&(g._sub?(i.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),g._userManager.events._raiseUserSignedOut()):(i.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),g._userManager.events._raiseUserSignedIn()))}).catch(function(_){g._sub&&(i.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",_.message),g._userManager.events._raiseUserSignedOut())})},n(d,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),d}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CheckSessionIFrame=void 0;var n=r(0);function i(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}e.CheckSessionIFrame=function(){function a(u,l,d,f){var g=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];i(this,a),this._callback=u,this._client_id=l,this._url=d,this._interval=f||2e3,this._stopOnError=g;var _=d.indexOf("/",d.indexOf("//")+2);this._frame_origin=d.substr(0,_),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=d}return a.prototype.load=function(){var l=this;return new Promise(function(d){l._frame.onload=function(){d()},window.document.body.appendChild(l._frame),l._boundMessageEvent=l._message.bind(l),window.addEventListener("message",l._boundMessageEvent,!1)})},a.prototype._message=function(l){l.origin===this._frame_origin&&l.source===this._frame.contentWindow&&(l.data==="error"?(n.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):l.data==="changed"?(n.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):n.Log.debug("CheckSessionIFrame: "+l.data+" message from check session op iframe"))},a.prototype.start=function(l){var d=this;if(this._session_state!==l){n.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=l;var f=function(){d._frame.contentWindow.postMessage(d._client_id+" "+d._session_state,d._frame_origin)};f(),this._timer=window.setInterval(f,this._interval)}},a.prototype.stop=function(){this._session_state=null,this._timer&&(n.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenRevocationClient=void 0;var n=r(0),i=r(2),a=r(1);function u(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}var l="access_token",d="refresh_token";e.TokenRevocationClient=function(){function f(g){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.Global.XMLHttpRequest,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.MetadataService;if(u(this,f),!g)throw n.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=g,this._XMLHttpRequestCtor=_,this._metadataService=new w(this._settings)}return f.prototype.revoke=function(_,w){var E=this,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!_)throw n.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(x!==l&&x!=d)throw n.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(A){if(A){n.Log.debug("TokenRevocationClient.revoke: Revoking "+x);var I=E._settings.client_id,D=E._settings.client_secret;return E._revoke(A,I,D,_,x)}if(w)throw n.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},f.prototype._revoke=function(_,w,E,x,A){var I=this;return new Promise(function(D,U){var z=new I._XMLHttpRequestCtor;z.open("POST",_),z.onload=function(){n.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",z.status),z.status===200?D():U(Error(z.statusText+" ("+z.status+")"))},z.onerror=function(){n.Log.debug("TokenRevocationClient.revoke: Network Error."),U("Network Error")};var P="client_id="+encodeURIComponent(w);E&&(P+="&client_secret="+encodeURIComponent(E)),P+="&token_type_hint="+encodeURIComponent(A),P+="&token="+encodeURIComponent(x),z.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),z.send(P)})},f}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaPopupWindow=void 0;var n=function(){function a(u,l){for(var d=0;d<l.length;d++){var f=l[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,l,d){return l&&a(u.prototype,l),d&&a(u,d),u}}(),i=r(0);e.CordovaPopupWindow=function(){function a(u){var l=this;(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,a),this._promise=new Promise(function(d,f){l._resolve=d,l._reject=f}),this.features=u.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=u.popupWindowTarget||"_blank",this.redirect_uri=u.startUrl,i.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return a.prototype._isInAppBrowserInstalled=function(l){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(d){return l.hasOwnProperty(d)})},a.prototype.navigate=function(l){if(l&&l.url){if(!window.cordova)return this._error("cordova is undefined");var d=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(d)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(l.url,this.target,this.features),this._popup?(i.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},a.prototype._loadStartCallback=function(l){l.url.indexOf(this.redirect_uri)===0&&this._success({url:l.url})},a.prototype._exitCallback=function(l){this._error(l)},a.prototype._success=function(l){this._cleanup(),i.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(l)},a.prototype._error=function(l){this._cleanup(),i.Log.error(l),this._reject(new Error(l))},a.prototype.close=function(){this._cleanup()},a.prototype._cleanup=function(){this._popup&&(i.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},n(a,[{key:"promise",get:function(){return this._promise}}]),a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(10),a=r(5),u=r(6),l=r(37),d=r(38),f=r(16),g=r(2),_=r(48),w=r(49),E=r(19),x=r(20),A=r(18),I=r(1),D=r(15),U=r(50);e.default={Version:U.Version,Log:n.Log,OidcClient:i.OidcClient,OidcClientSettings:a.OidcClientSettings,WebStorageStateStore:u.WebStorageStateStore,InMemoryWebStorage:l.InMemoryWebStorage,UserManager:d.UserManager,AccessTokenEvents:f.AccessTokenEvents,MetadataService:g.MetadataService,CordovaPopupNavigator:_.CordovaPopupNavigator,CordovaIFrameNavigator:w.CordovaIFrameNavigator,CheckSessionIFrame:E.CheckSessionIFrame,TokenRevocationClient:x.TokenRevocationClient,SessionMonitor:A.SessionMonitor,Global:I.Global,User:D.User},t.exports=e.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ClockService=function(){function n(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,n)}return n.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},n}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResponseValidator=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},i=r(0),a=r(2),u=r(25),l=r(11),d=r(12),f=r(4);function g(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")}var _=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];e.ResponseValidator=function(){function w(E){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.MetadataService,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.UserInfoService,I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:f.JoseUtil,D=arguments.length>4&&arguments[4]!==void 0?arguments[4]:l.TokenClient;if(g(this,w),!E)throw i.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=E,this._metadataService=new x(this._settings),this._userInfoService=new A(this._settings),this._joseUtil=I,this._tokenClient=new D(this._settings)}return w.prototype.validateSigninResponse=function(x,A){var I=this;return i.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(x,A).then(function(D){return i.Log.debug("ResponseValidator.validateSigninResponse: state processed"),I._validateTokens(x,D).then(function(U){return i.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),I._processClaims(x,U).then(function(z){return i.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),z})})})},w.prototype.validateSignoutResponse=function(x,A){return x.id!==A.state?(i.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(i.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),A.state=x.data,A.error?(i.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",A.error),Promise.reject(new d.ErrorResponse(A))):Promise.resolve(A))},w.prototype._processSigninParams=function(x,A){if(x.id!==A.state)return i.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!x.client_id)return i.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!x.authority)return i.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==x.authority)return i.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=x.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==x.client_id)return i.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=x.client_id;return i.Log.debug("ResponseValidator._processSigninParams: state validated"),A.state=x.data,A.error?(i.Log.warn("ResponseValidator._processSigninParams: Response was error",A.error),Promise.reject(new d.ErrorResponse(A))):x.nonce&&!A.id_token?(i.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!x.nonce&&A.id_token?(i.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):x.code_verifier&&!A.code?(i.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!x.code_verifier&&A.code?(i.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(A.scope||(A.scope=x.scope),Promise.resolve(A))},w.prototype._processClaims=function(x,A){var I=this;if(A.isOpenIdConnect){if(i.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),A.profile=this._filterProtocolClaims(A.profile),x.skipUserInfo!==!0&&this._settings.loadUserInfo&&A.access_token)return i.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(A.access_token).then(function(D){return i.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),D.sub!==A.profile.sub?(i.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(A.profile=I._mergeClaims(A.profile,D),i.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",A.profile),A)});i.Log.debug("ResponseValidator._processClaims: not loading user info")}else i.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(A)},w.prototype._mergeClaims=function(x,A){var I=Object.assign({},x);for(var D in A){var U=A[D];Array.isArray(U)||(U=[U]);for(var z=0;z<U.length;z++){var P=U[z];I[D]?Array.isArray(I[D])?I[D].indexOf(P)<0&&I[D].push(P):I[D]!==P&&((P===void 0?"undefined":n(P))==="object"&&this._settings.mergeClaims?I[D]=this._mergeClaims(I[D],P):I[D]=[I[D],P]):I[D]=P}}return I},w.prototype._filterProtocolClaims=function(x){i.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",x);var A=Object.assign({},x);return this._settings._filterProtocolClaims?(_.forEach(function(I){delete A[I]}),i.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",A)):i.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),A},w.prototype._validateTokens=function(x,A){return A.code?(i.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(x,A)):A.id_token?A.access_token?(i.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(x,A)):(i.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(x,A)):(i.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(A))},w.prototype._processCode=function(x,A){var I=this,D={client_id:x.client_id,client_secret:x.client_secret,code:A.code,redirect_uri:x.redirect_uri,code_verifier:x.code_verifier};return x.extraTokenParams&&n(x.extraTokenParams)==="object"&&Object.assign(D,x.extraTokenParams),this._tokenClient.exchangeCode(D).then(function(U){for(var z in U)A[z]=U[z];return A.id_token?(i.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),I._validateIdTokenAttributes(x,A)):(i.Log.debug("ResponseValidator._processCode: token response successful, returning response"),A)})},w.prototype._validateIdTokenAttributes=function(x,A){var I=this;return this._metadataService.getIssuer().then(function(D){var U=x.client_id,z=I._settings.clockSkew;return i.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",z),I._settings.getEpochTime().then(function(P){return I._joseUtil.validateJwtAttributes(A.id_token,D,U,z,P).then(function(F){return x.nonce&&x.nonce!==F.nonce?(i.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):F.sub?(A.profile=F,A):(i.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},w.prototype._validateIdTokenAndAccessToken=function(x,A){var I=this;return this._validateIdToken(x,A).then(function(D){return I._validateAccessToken(D)})},w.prototype._getSigningKeyForJwt=function(x){var A=this;return this._metadataService.getSigningKeys().then(function(I){var D=x.header.kid;if(!I)return i.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));i.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var U=void 0;if(D)U=I.filter(function(z){return z.kid===D})[0];else{if((I=A._filterByAlg(I,x.header.alg)).length>1)return i.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));U=I[0]}return Promise.resolve(U)})},w.prototype._getSigningKeyForJwtWithSingleRetry=function(x){var A=this;return this._getSigningKeyForJwt(x).then(function(I){return I?Promise.resolve(I):(A._metadataService.resetSigningKeys(),A._getSigningKeyForJwt(x))})},w.prototype._validateIdToken=function(x,A){var I=this;if(!x.nonce)return i.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var D=this._joseUtil.parseJwt(A.id_token);return D&&D.header&&D.payload?x.nonce!==D.payload.nonce?(i.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(U){return i.Log.debug("ResponseValidator._validateIdToken: Received issuer"),I._getSigningKeyForJwtWithSingleRetry(D).then(function(z){if(!z)return i.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var P=x.client_id,F=I._settings.clockSkew;return i.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",F),I._joseUtil.validateJwt(A.id_token,z,U,P,F).then(function(){return i.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),D.payload.sub?(A.profile=D.payload,A):(i.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(i.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",D),Promise.reject(new Error("Failed to parse id_token")))},w.prototype._filterByAlg=function(x,A){var I=null;if(A.startsWith("RS"))I="RSA";else if(A.startsWith("PS"))I="PS";else{if(!A.startsWith("ES"))return i.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",A),[];I="EC"}return i.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",I),x=x.filter(function(D){return D.kty===I}),i.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",I,x.length),x},w.prototype._validateAccessToken=function(x){if(!x.profile)return i.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!x.profile.at_hash)return i.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!x.id_token)return i.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var A=this._joseUtil.parseJwt(x.id_token);if(!A||!A.header)return i.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",A),Promise.reject(new Error("Failed to parse id_token"));var I=A.header.alg;if(!I||I.length!==5)return i.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",I),Promise.reject(new Error("Unsupported alg: "+I));var D=I.substr(2,3);if(!D)return i.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",I,D),Promise.reject(new Error("Unsupported alg: "+I));if((D=parseInt(D))!==256&&D!==384&&D!==512)return i.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",I,D),Promise.reject(new Error("Unsupported alg: "+I));var U="sha"+D,z=this._joseUtil.hashString(x.access_token,U);if(!z)return i.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",U),Promise.reject(new Error("Failed to validate at_hash"));var P=z.substr(0,z.length/2),F=this._joseUtil.hexToBase64Url(P);return F!==x.profile.at_hash?(i.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",F,x.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(i.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(x))},w}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserInfoService=void 0;var n=r(7),i=r(2),a=r(0),u=r(4);function l(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}e.UserInfoService=function(){function d(f){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n.JsonService,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.MetadataService,w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:u.JoseUtil;if(l(this,d),!f)throw a.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=f,this._jsonService=new g(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new _(this._settings),this._joseUtil=w}return d.prototype.getClaims=function(g){var _=this;return g?this._metadataService.getUserInfoEndpoint().then(function(w){return a.Log.debug("UserInfoService.getClaims: received userinfo url",w),_._jsonService.getJson(w,g).then(function(E){return a.Log.debug("UserInfoService.getClaims: claims received",E),E})}):(a.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},d.prototype._getClaimsFromJwt=function(g){var _=this;try{var w=this._joseUtil.parseJwt(g.responseText);if(!w||!w.header||!w.payload)return a.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",w),Promise.reject(new Error("Failed to parse id_token"));var E=w.header.kid,x=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":x=this._metadataService.getIssuer();break;case"ANY":x=Promise.resolve(w.payload.iss);break;default:x=Promise.resolve(this._settings.userInfoJwtIssuer)}return x.then(function(A){return a.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+A),_._metadataService.getSigningKeys().then(function(I){if(!I)return a.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));a.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var D=void 0;if(E)D=I.filter(function(P){return P.kid===E})[0];else{if((I=_._filterByAlg(I,w.header.alg)).length>1)return a.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));D=I[0]}if(!D)return a.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var U=_._settings.client_id,z=_._settings.clockSkew;return a.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",z),_._joseUtil.validateJwt(g.responseText,D,A,U,z,void 0,!0).then(function(){return a.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),w.payload})})})}catch(A){return a.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",A.message),void reject(A)}},d.prototype._filterByAlg=function(g,_){var w=null;if(_.startsWith("RS"))w="RSA";else if(_.startsWith("PS"))w="PS";else{if(!_.startsWith("ES"))return a.Log.debug("UserInfoService._filterByAlg: alg not supported: ",_),[];w="EC"}return a.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",w),g=g.filter(function(E){return E.kty===w}),a.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",w,g.length),g},d}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AllowedSigningAlgs=e.b64tohex=e.hextob64u=e.crypto=e.X509=e.KeyUtil=e.jws=void 0;var n=r(27);e.jws=n.jws,e.KeyUtil=n.KEYUTIL,e.X509=n.X509,e.crypto=n.crypto,e.hextob64u=n.hextob64u,e.b64tohex=n.b64tohex,e.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(t,e,r){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var i,a,u,l,d,f,g,_,w,E,x,A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},I={userAgent:!1},D={},U=U||(i=Math,u=(a={}).lib={},l=u.Base=function(){function s(){}return{extend:function(c){s.prototype=this;var h=new s;return c&&h.mixIn(c),h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var h in c)c.hasOwnProperty(h)&&(this[h]=c[h]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=u.WordArray=l.extend({init:function(o,c){o=this.words=o||[],this.sigBytes=c??4*o.length},toString:function(o){return(o||g).stringify(this)},concat:function(o){var c=this.words,h=o.words,y=this.sigBytes,b=o.sigBytes;if(this.clamp(),y%4)for(var R=0;R<b;R++){var B=h[R>>>2]>>>24-R%4*8&255;c[y+R>>>2]|=B<<24-(y+R)%4*8}else for(R=0;R<b;R+=4)c[y+R>>>2]=h[R>>>2];return this.sigBytes+=b,this},clamp:function(){var o=this.words,c=this.sigBytes;o[c>>>2]&=4294967295<<32-c%4*8,o.length=i.ceil(c/4)},clone:function(){var o=l.clone.call(this);return o.words=this.words.slice(0),o},random:function(o){for(var c=[],h=0;h<o;h+=4)c.push(4294967296*i.random()|0);return new d.init(c,o)}}),f=a.enc={},g=f.Hex={stringify:function(o){for(var c=o.words,h=o.sigBytes,y=[],b=0;b<h;b++){var R=c[b>>>2]>>>24-b%4*8&255;y.push((R>>>4).toString(16)),y.push((15&R).toString(16))}return y.join("")},parse:function(o){for(var c=o.length,h=[],y=0;y<c;y+=2)h[y>>>3]|=parseInt(o.substr(y,2),16)<<24-y%8*4;return new d.init(h,c/2)}},_=f.Latin1={stringify:function(o){for(var c=o.words,h=o.sigBytes,y=[],b=0;b<h;b++){var R=c[b>>>2]>>>24-b%4*8&255;y.push(String.fromCharCode(R))}return y.join("")},parse:function(o){for(var c=o.length,h=[],y=0;y<c;y++)h[y>>>2]|=(255&o.charCodeAt(y))<<24-y%4*8;return new d.init(h,c)}},w=f.Utf8={stringify:function(o){try{return decodeURIComponent(escape(_.stringify(o)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(o){return _.parse(unescape(encodeURIComponent(o)))}},E=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(o){typeof o=="string"&&(o=w.parse(o)),this._data.concat(o),this._nDataBytes+=o.sigBytes},_process:function(o){var c=this._data,h=c.words,y=c.sigBytes,b=this.blockSize,R=y/(4*b),B=(R=o?i.ceil(R):i.max((0|R)-this._minBufferSize,0))*b,L=i.min(4*B,y);if(B){for(var j=0;j<B;j+=b)this._doProcessBlock(h,j);var V=h.splice(0,B);c.sigBytes-=L}return new d.init(V,L)},clone:function(){var o=l.clone.call(this);return o._data=this._data.clone(),o},_minBufferSize:0}),u.Hasher=E.extend({cfg:l.extend(),init:function(o){this.cfg=this.cfg.extend(o),this.reset()},reset:function(){E.reset.call(this),this._doReset()},update:function(o){return this._append(o),this._process(),this},finalize:function(o){return o&&this._append(o),this._doFinalize()},blockSize:16,_createHelper:function(o){return function(c,h){return new o.init(h).finalize(c)}},_createHmacHelper:function(o){return function(c,h){return new x.HMAC.init(o,h).finalize(c)}}}),x=a.algo={},a);(function(s){var o,c=(o=U).lib,h=c.Base,y=c.WordArray;(o=o.x64={}).Word=h.extend({init:function(R,B){this.high=R,this.low=B}}),o.WordArray=h.extend({init:function(R,B){R=this.words=R||[],this.sigBytes=B??8*R.length},toX32:function(){for(var R=this.words,B=R.length,L=[],j=0;j<B;j++){var V=R[j];L.push(V.high),L.push(V.low)}return y.create(L,this.sigBytes)},clone:function(){for(var R=h.clone.call(this),B=R.words=this.words.slice(0),L=B.length,j=0;j<L;j++)B[j]=B[j].clone();return R}})})(),function(){var s=U,o=s.lib.WordArray;s.enc.Base64={stringify:function(h){var y=h.words,b=h.sigBytes,R=this._map;h.clamp(),h=[];for(var B=0;B<b;B+=3)for(var L=(y[B>>>2]>>>24-B%4*8&255)<<16|(y[B+1>>>2]>>>24-(B+1)%4*8&255)<<8|y[B+2>>>2]>>>24-(B+2)%4*8&255,j=0;4>j&&B+.75*j<b;j++)h.push(R.charAt(L>>>6*(3-j)&63));if(y=R.charAt(64))for(;h.length%4;)h.push(y);return h.join("")},parse:function(h){var y=h.length,b=this._map;(R=b.charAt(64))&&(R=h.indexOf(R))!=-1&&(y=R);for(var R=[],B=0,L=0;L<y;L++)if(L%4){var j=b.indexOf(h.charAt(L-1))<<L%4*2,V=b.indexOf(h.charAt(L))>>>6-L%4*2;R[B>>>2]|=(j|V)<<24-B%4*8,B++}return o.create(R,B)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(s){for(var o=U,c=(y=o.lib).WordArray,h=y.Hasher,y=o.algo,b=[],R=[],B=function(ce){return 4294967296*(ce-(0|ce))|0},L=2,j=0;64>j;){var V;e:{V=L;for(var q=s.sqrt(V),G=2;G<=q;G++)if(!(V%G)){V=!1;break e}V=!0}V&&(8>j&&(b[j]=B(s.pow(L,.5))),R[j]=B(s.pow(L,1/3)),j++),L++}var Z=[];y=y.SHA256=h.extend({_doReset:function(){this._hash=new c.init(b.slice(0))},_doProcessBlock:function(ce,le){for(var T=this._hash.words,K=T[0],W=T[1],J=T[2],se=T[3],fe=T[4],be=T[5],ge=T[6],Ne=T[7],we=0;64>we;we++){if(16>we)Z[we]=0|ce[le+we];else{var Ee=Z[we-15],Ye=Z[we-2];Z[we]=((Ee<<25|Ee>>>7)^(Ee<<14|Ee>>>18)^Ee>>>3)+Z[we-7]+((Ye<<15|Ye>>>17)^(Ye<<13|Ye>>>19)^Ye>>>10)+Z[we-16]}Ee=Ne+((fe<<26|fe>>>6)^(fe<<21|fe>>>11)^(fe<<7|fe>>>25))+(fe&be^~fe&ge)+R[we]+Z[we],Ye=((K<<30|K>>>2)^(K<<19|K>>>13)^(K<<10|K>>>22))+(K&W^K&J^W&J),Ne=ge,ge=be,be=fe,fe=se+Ee|0,se=J,J=W,W=K,K=Ee+Ye|0}T[0]=T[0]+K|0,T[1]=T[1]+W|0,T[2]=T[2]+J|0,T[3]=T[3]+se|0,T[4]=T[4]+fe|0,T[5]=T[5]+be|0,T[6]=T[6]+ge|0,T[7]=T[7]+Ne|0},_doFinalize:function(){var ce=this._data,le=ce.words,T=8*this._nDataBytes,K=8*ce.sigBytes;return le[K>>>5]|=128<<24-K%32,le[14+(K+64>>>9<<4)]=s.floor(T/4294967296),le[15+(K+64>>>9<<4)]=T,ce.sigBytes=4*le.length,this._process(),this._hash},clone:function(){var ce=h.clone.call(this);return ce._hash=this._hash.clone(),ce}}),o.SHA256=h._createHelper(y),o.HmacSHA256=h._createHmacHelper(y)}(Math),function(){function s(){return h.create.apply(h,arguments)}for(var o=U,c=o.lib.Hasher,h=(b=o.x64).Word,y=b.WordArray,b=o.algo,R=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],B=[],L=0;80>L;L++)B[L]=s();b=b.SHA512=c.extend({_doReset:function(){this._hash=new y.init([new h.init(1779033703,4089235720),new h.init(3144134277,2227873595),new h.init(1013904242,4271175723),new h.init(2773480762,1595750129),new h.init(1359893119,2917565137),new h.init(2600822924,725511199),new h.init(528734635,4215389547),new h.init(1541459225,327033209)])},_doProcessBlock:function(V,q){for(var G=(W=this._hash.words)[0],Z=W[1],re=W[2],ce=W[3],le=W[4],T=W[5],K=W[6],W=W[7],J=G.high,se=G.low,fe=Z.high,be=Z.low,ge=re.high,Ne=re.low,we=ce.high,Ee=ce.low,Ye=le.high,rt=le.low,et=T.high,Jt=T.low,Lt=K.high,Vt=K.low,ft=W.high,Et=W.low,Nt=J,Kt=se,Pi=fe,Yn=be,Ni=ge,Qn=Ne,tu=we,ki=Ee,fr=Ye,nr=rt,No=et,Oi=Jt,ko=Lt,Di=Vt,ru=ft,Li=Et,dr=0;80>dr;dr++){var fn=B[dr];if(16>dr)var Lr=fn.high=0|V[q+2*dr],nt=fn.low=0|V[q+2*dr+1];else{Lr=((nt=(Lr=B[dr-15]).high)>>>1|(Ur=Lr.low)<<31)^(nt>>>8|Ur<<24)^nt>>>7;var Ur=(Ur>>>1|nt<<31)^(Ur>>>8|nt<<24)^(Ur>>>7|nt<<25),Xn=((nt=(Xn=B[dr-2]).high)>>>19|(xt=Xn.low)<<13)^(nt<<3|xt>>>29)^nt>>>6,xt=(xt>>>19|nt<<13)^(xt<<3|nt>>>29)^(xt>>>6|nt<<26),nu=(nt=B[dr-7]).high,dn=(hn=B[dr-16]).high,hn=hn.low;Lr=(Lr=(Lr=Lr+nu+((nt=Ur+nt.low)>>>0<Ur>>>0?1:0))+Xn+((nt=nt+xt)>>>0<xt>>>0?1:0))+dn+((nt=nt+hn)>>>0<hn>>>0?1:0),fn.high=Lr,fn.low=nt}nu=fr&No^~fr&ko,hn=nr&Oi^~nr&Di,fn=Nt&Pi^Nt&Ni^Pi&Ni;var Mm=Kt&Yn^Kt&Qn^Yn&Qn,Hm=(Ur=(Nt>>>28|Kt<<4)^(Nt<<30|Kt>>>2)^(Nt<<25|Kt>>>7),Xn=(Kt>>>28|Nt<<4)^(Kt<<30|Nt>>>2)^(Kt<<25|Nt>>>7),(xt=R[dr]).high),Tf=xt.low;dn=ru+((fr>>>14|nr<<18)^(fr>>>18|nr<<14)^(fr<<23|nr>>>9))+((xt=Li+((nr>>>14|fr<<18)^(nr>>>18|fr<<14)^(nr<<23|fr>>>9)))>>>0<Li>>>0?1:0),ru=ko,Li=Di,ko=No,Di=Oi,No=fr,Oi=nr,fr=tu+(dn=(dn=(dn=dn+nu+((xt=xt+hn)>>>0<hn>>>0?1:0))+Hm+((xt=xt+Tf)>>>0<Tf>>>0?1:0))+Lr+((xt=xt+nt)>>>0<nt>>>0?1:0))+((nr=ki+xt|0)>>>0<ki>>>0?1:0)|0,tu=Ni,ki=Qn,Ni=Pi,Qn=Yn,Pi=Nt,Yn=Kt,Nt=dn+(fn=Ur+fn+((nt=Xn+Mm)>>>0<Xn>>>0?1:0))+((Kt=xt+nt|0)>>>0<xt>>>0?1:0)|0}se=G.low=se+Kt,G.high=J+Nt+(se>>>0<Kt>>>0?1:0),be=Z.low=be+Yn,Z.high=fe+Pi+(be>>>0<Yn>>>0?1:0),Ne=re.low=Ne+Qn,re.high=ge+Ni+(Ne>>>0<Qn>>>0?1:0),Ee=ce.low=Ee+ki,ce.high=we+tu+(Ee>>>0<ki>>>0?1:0),rt=le.low=rt+nr,le.high=Ye+fr+(rt>>>0<nr>>>0?1:0),Jt=T.low=Jt+Oi,T.high=et+No+(Jt>>>0<Oi>>>0?1:0),Vt=K.low=Vt+Di,K.high=Lt+ko+(Vt>>>0<Di>>>0?1:0),Et=W.low=Et+Li,W.high=ft+ru+(Et>>>0<Li>>>0?1:0)},_doFinalize:function(){var V=this._data,q=V.words,G=8*this._nDataBytes,Z=8*V.sigBytes;return q[Z>>>5]|=128<<24-Z%32,q[30+(Z+128>>>10<<5)]=Math.floor(G/4294967296),q[31+(Z+128>>>10<<5)]=G,V.sigBytes=4*q.length,this._process(),this._hash.toX32()},clone:function(){var V=c.clone.call(this);return V._hash=this._hash.clone(),V},blockSize:32}),o.SHA512=c._createHelper(b),o.HmacSHA512=c._createHmacHelper(b)}(),function(){var s=U,o=(y=s.x64).Word,c=y.WordArray,h=(y=s.algo).SHA512,y=y.SHA384=h.extend({_doReset:function(){this._hash=new c.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var R=h._doFinalize.call(this);return R.sigBytes-=16,R}});s.SHA384=h._createHelper(y),s.HmacSHA384=h._createHmacHelper(y)}();var z,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function F(s){var o,c,h="";for(o=0;o+3<=s.length;o+=3)c=parseInt(s.substring(o,o+3),16),h+=P.charAt(c>>6)+P.charAt(63&c);for(o+1==s.length?(c=parseInt(s.substring(o,o+1),16),h+=P.charAt(c<<2)):o+2==s.length&&(c=parseInt(s.substring(o,o+2),16),h+=P.charAt(c>>2)+P.charAt((3&c)<<4)),"=";(3&h.length)>0;)h+="=";return h}function te(s){var o,c,h,y="",b=0;for(o=0;o<s.length&&s.charAt(o)!="=";++o)(h=P.indexOf(s.charAt(o)))<0||(b==0?(y+=Le(h>>2),c=3&h,b=1):b==1?(y+=Le(c<<2|h>>4),c=15&h,b=2):b==2?(y+=Le(c),y+=Le(h>>2),c=3&h,b=3):(y+=Le(c<<2|h>>4),y+=Le(15&h),b=0));return b==1&&(y+=Le(c<<2)),y}function oe(s){var o,c=te(s),h=new Array;for(o=0;2*o<c.length;++o)h[o]=parseInt(c.substring(2*o,2*o+2),16);return h}function M(s,o,c){s!=null&&(typeof s=="number"?this.fromNumber(s,o,c):o==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,o))}function he(){return new M(null)}I.appName=="Microsoft Internet Explorer"?(M.prototype.am=function(o,c,h,y,b,R){for(var B=32767&c,L=c>>15;--R>=0;){var j=32767&this[o],V=this[o++]>>15,q=L*j+V*B;b=((j=B*j+((32767&q)<<15)+h[y]+(1073741823&b))>>>30)+(q>>>15)+L*V+(b>>>30),h[y++]=1073741823&j}return b},z=30):I.appName!="Netscape"?(M.prototype.am=function(o,c,h,y,b,R){for(;--R>=0;){var B=c*this[o++]+h[y]+b;b=Math.floor(B/67108864),h[y++]=67108863&B}return b},z=26):(M.prototype.am=function(o,c,h,y,b,R){for(var B=16383&c,L=c>>14;--R>=0;){var j=16383&this[o],V=this[o++]>>14,q=L*j+V*B;b=((j=B*j+((16383&q)<<14)+h[y]+b)>>28)+(q>>14)+L*V,h[y++]=268435455&j}return b},z=28),M.prototype.DB=z,M.prototype.DM=(1<<z)-1,M.prototype.DV=1<<z,M.prototype.FV=Math.pow(2,52),M.prototype.F1=52-z,M.prototype.F2=2*z-52;var me,xe,ze=new Array;for(me=48,xe=0;xe<=9;++xe)ze[me++]=xe;for(me=97,xe=10;xe<36;++xe)ze[me++]=xe;for(me=65,xe=10;xe<36;++xe)ze[me++]=xe;function Le(s){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(s)}function ct(s,o){var c=ze[s.charCodeAt(o)];return c??-1}function lt(s){var o=he();return o.fromInt(s),o}function Rt(s){var o,c=1;return(o=s>>>16)!=0&&(s=o,c+=16),(o=s>>8)!=0&&(s=o,c+=8),(o=s>>4)!=0&&(s=o,c+=4),(o=s>>2)!=0&&(s=o,c+=2),(o=s>>1)!=0&&(s=o,c+=1),c}function Re(s){this.m=s}function Oe(s){this.m=s,this.mp=s.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function _t(s,o){return s&o}function je(s,o){return s|o}function qe(s,o){return s^o}function Ft(s,o){return s&~o}function Mt(s){if(s==0)return-1;var o=0;return!(65535&s)&&(s>>=16,o+=16),!(255&s)&&(s>>=8,o+=8),!(15&s)&&(s>>=4,o+=4),!(3&s)&&(s>>=2,o+=2),!(1&s)&&++o,o}function tr(s){for(var o=0;s!=0;)s&=s-1,++o;return o}function wt(){}function Pt(s){return s}function Qe(s){this.r2=he(),this.q3=he(),M.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}Re.prototype.convert=function(o){return o.s<0||o.compareTo(this.m)>=0?o.mod(this.m):o},Re.prototype.revert=function(o){return o},Re.prototype.reduce=function(o){o.divRemTo(this.m,null,o)},Re.prototype.mulTo=function(o,c,h){o.multiplyTo(c,h),this.reduce(h)},Re.prototype.sqrTo=function(o,c){o.squareTo(c),this.reduce(c)},Oe.prototype.convert=function(o){var c=he();return o.abs().dlShiftTo(this.m.t,c),c.divRemTo(this.m,null,c),o.s<0&&c.compareTo(M.ZERO)>0&&this.m.subTo(c,c),c},Oe.prototype.revert=function(o){var c=he();return o.copyTo(c),this.reduce(c),c},Oe.prototype.reduce=function(o){for(;o.t<=this.mt2;)o[o.t++]=0;for(var c=0;c<this.m.t;++c){var h=32767&o[c],y=h*this.mpl+((h*this.mph+(o[c]>>15)*this.mpl&this.um)<<15)&o.DM;for(o[h=c+this.m.t]+=this.m.am(0,y,o,c,0,this.m.t);o[h]>=o.DV;)o[h]-=o.DV,o[++h]++}o.clamp(),o.drShiftTo(this.m.t,o),o.compareTo(this.m)>=0&&o.subTo(this.m,o)},Oe.prototype.mulTo=function(o,c,h){o.multiplyTo(c,h),this.reduce(h)},Oe.prototype.sqrTo=function(o,c){o.squareTo(c),this.reduce(c)},M.prototype.copyTo=function(o){for(var c=this.t-1;c>=0;--c)o[c]=this[c];o.t=this.t,o.s=this.s},M.prototype.fromInt=function(o){this.t=1,this.s=o<0?-1:0,o>0?this[0]=o:o<-1?this[0]=o+this.DV:this.t=0},M.prototype.fromString=function(o,c){var h;if(c==16)h=4;else if(c==8)h=3;else if(c==256)h=8;else if(c==2)h=1;else if(c==32)h=5;else{if(c!=4)return void this.fromRadix(o,c);h=2}this.t=0,this.s=0;for(var y=o.length,b=!1,R=0;--y>=0;){var B=h==8?255&o[y]:ct(o,y);B<0?o.charAt(y)=="-"&&(b=!0):(b=!1,R==0?this[this.t++]=B:R+h>this.DB?(this[this.t-1]|=(B&(1<<this.DB-R)-1)<<R,this[this.t++]=B>>this.DB-R):this[this.t-1]|=B<<R,(R+=h)>=this.DB&&(R-=this.DB))}h==8&&128&o[0]&&(this.s=-1,R>0&&(this[this.t-1]|=(1<<this.DB-R)-1<<R)),this.clamp(),b&&M.ZERO.subTo(this,this)},M.prototype.clamp=function(){for(var o=this.s&this.DM;this.t>0&&this[this.t-1]==o;)--this.t},M.prototype.dlShiftTo=function(o,c){var h;for(h=this.t-1;h>=0;--h)c[h+o]=this[h];for(h=o-1;h>=0;--h)c[h]=0;c.t=this.t+o,c.s=this.s},M.prototype.drShiftTo=function(o,c){for(var h=o;h<this.t;++h)c[h-o]=this[h];c.t=Math.max(this.t-o,0),c.s=this.s},M.prototype.lShiftTo=function(o,c){var h,y=o%this.DB,b=this.DB-y,R=(1<<b)-1,B=Math.floor(o/this.DB),L=this.s<<y&this.DM;for(h=this.t-1;h>=0;--h)c[h+B+1]=this[h]>>b|L,L=(this[h]&R)<<y;for(h=B-1;h>=0;--h)c[h]=0;c[B]=L,c.t=this.t+B+1,c.s=this.s,c.clamp()},M.prototype.rShiftTo=function(o,c){c.s=this.s;var h=Math.floor(o/this.DB);if(h>=this.t)c.t=0;else{var y=o%this.DB,b=this.DB-y,R=(1<<y)-1;c[0]=this[h]>>y;for(var B=h+1;B<this.t;++B)c[B-h-1]|=(this[B]&R)<<b,c[B-h]=this[B]>>y;y>0&&(c[this.t-h-1]|=(this.s&R)<<b),c.t=this.t-h,c.clamp()}},M.prototype.subTo=function(o,c){for(var h=0,y=0,b=Math.min(o.t,this.t);h<b;)y+=this[h]-o[h],c[h++]=y&this.DM,y>>=this.DB;if(o.t<this.t){for(y-=o.s;h<this.t;)y+=this[h],c[h++]=y&this.DM,y>>=this.DB;y+=this.s}else{for(y+=this.s;h<o.t;)y-=o[h],c[h++]=y&this.DM,y>>=this.DB;y-=o.s}c.s=y<0?-1:0,y<-1?c[h++]=this.DV+y:y>0&&(c[h++]=y),c.t=h,c.clamp()},M.prototype.multiplyTo=function(o,c){var h=this.abs(),y=o.abs(),b=h.t;for(c.t=b+y.t;--b>=0;)c[b]=0;for(b=0;b<y.t;++b)c[b+h.t]=h.am(0,y[b],c,b,0,h.t);c.s=0,c.clamp(),this.s!=o.s&&M.ZERO.subTo(c,c)},M.prototype.squareTo=function(o){for(var c=this.abs(),h=o.t=2*c.t;--h>=0;)o[h]=0;for(h=0;h<c.t-1;++h){var y=c.am(h,c[h],o,2*h,0,1);(o[h+c.t]+=c.am(h+1,2*c[h],o,2*h+1,y,c.t-h-1))>=c.DV&&(o[h+c.t]-=c.DV,o[h+c.t+1]=1)}o.t>0&&(o[o.t-1]+=c.am(h,c[h],o,2*h,0,1)),o.s=0,o.clamp()},M.prototype.divRemTo=function(o,c,h){var y=o.abs();if(!(y.t<=0)){var b=this.abs();if(b.t<y.t)return c?.fromInt(0),void(h!=null&&this.copyTo(h));h==null&&(h=he());var R=he(),B=this.s,L=o.s,j=this.DB-Rt(y[y.t-1]);j>0?(y.lShiftTo(j,R),b.lShiftTo(j,h)):(y.copyTo(R),b.copyTo(h));var V=R.t,q=R[V-1];if(q!=0){var G=q*(1<<this.F1)+(V>1?R[V-2]>>this.F2:0),Z=this.FV/G,re=(1<<this.F1)/G,ce=1<<this.F2,le=h.t,T=le-V,K=c??he();for(R.dlShiftTo(T,K),h.compareTo(K)>=0&&(h[h.t++]=1,h.subTo(K,h)),M.ONE.dlShiftTo(V,K),K.subTo(R,R);R.t<V;)R[R.t++]=0;for(;--T>=0;){var W=h[--le]==q?this.DM:Math.floor(h[le]*Z+(h[le-1]+ce)*re);if((h[le]+=R.am(0,W,h,T,0,V))<W)for(R.dlShiftTo(T,K),h.subTo(K,h);h[le]<--W;)h.subTo(K,h)}c!=null&&(h.drShiftTo(V,c),B!=L&&M.ZERO.subTo(c,c)),h.t=V,h.clamp(),j>0&&h.rShiftTo(j,h),B<0&&M.ZERO.subTo(h,h)}}},M.prototype.invDigit=function(){if(this.t<1)return 0;var o=this[0];if(!(1&o))return 0;var c=3&o;return(c=(c=(c=(c=c*(2-(15&o)*c)&15)*(2-(255&o)*c)&255)*(2-((65535&o)*c&65535))&65535)*(2-o*c%this.DV)%this.DV)>0?this.DV-c:-c},M.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},M.prototype.exp=function(o,c){if(o>4294967295||o<1)return M.ONE;var h=he(),y=he(),b=c.convert(this),R=Rt(o)-1;for(b.copyTo(h);--R>=0;)if(c.sqrTo(h,y),(o&1<<R)>0)c.mulTo(y,b,h);else{var B=h;h=y,y=B}return c.revert(h)},M.prototype.toString=function(o){if(this.s<0)return"-"+this.negate().toString(o);var c;if(o==16)c=4;else if(o==8)c=3;else if(o==2)c=1;else if(o==32)c=5;else{if(o!=4)return this.toRadix(o);c=2}var h,y=(1<<c)-1,b=!1,R="",B=this.t,L=this.DB-B*this.DB%c;if(B-- >0)for(L<this.DB&&(h=this[B]>>L)>0&&(b=!0,R=Le(h));B>=0;)L<c?(h=(this[B]&(1<<L)-1)<<c-L,h|=this[--B]>>(L+=this.DB-c)):(h=this[B]>>(L-=c)&y,L<=0&&(L+=this.DB,--B)),h>0&&(b=!0),b&&(R+=Le(h));return b?R:"0"},M.prototype.negate=function(){var o=he();return M.ZERO.subTo(this,o),o},M.prototype.abs=function(){return this.s<0?this.negate():this},M.prototype.compareTo=function(o){var c=this.s-o.s;if(c!=0)return c;var h=this.t;if((c=h-o.t)!=0)return this.s<0?-c:c;for(;--h>=0;)if((c=this[h]-o[h])!=0)return c;return 0},M.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Rt(this[this.t-1]^this.s&this.DM)},M.prototype.mod=function(o){var c=he();return this.abs().divRemTo(o,null,c),this.s<0&&c.compareTo(M.ZERO)>0&&o.subTo(c,c),c},M.prototype.modPowInt=function(o,c){var h;return h=o<256||c.isEven()?new Re(c):new Oe(c),this.exp(o,h)},M.ZERO=lt(0),M.ONE=lt(1),wt.prototype.convert=Pt,wt.prototype.revert=Pt,wt.prototype.mulTo=function(o,c,h){o.multiplyTo(c,h)},wt.prototype.sqrTo=function(o,c){o.squareTo(c)},Qe.prototype.convert=function(o){if(o.s<0||o.t>2*this.m.t)return o.mod(this.m);if(o.compareTo(this.m)<0)return o;var c=he();return o.copyTo(c),this.reduce(c),c},Qe.prototype.revert=function(o){return o},Qe.prototype.reduce=function(o){for(o.drShiftTo(this.m.t-1,this.r2),o.t>this.m.t+1&&(o.t=this.m.t+1,o.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);o.compareTo(this.r2)<0;)o.dAddOffset(1,this.m.t+1);for(o.subTo(this.r2,o);o.compareTo(this.m)>=0;)o.subTo(this.m,o)},Qe.prototype.mulTo=function(o,c,h){o.multiplyTo(c,h),this.reduce(h)},Qe.prototype.sqrTo=function(o,c){o.squareTo(c),this.reduce(c)};var $e=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Q=(1<<26)/$e[$e.length-1];function v(){this.i=0,this.j=0,this.S=new Array}M.prototype.chunkSize=function(o){return Math.floor(Math.LN2*this.DB/Math.log(o))},M.prototype.toRadix=function(o){if(o==null&&(o=10),this.signum()==0||o<2||o>36)return"0";var c=this.chunkSize(o),h=Math.pow(o,c),y=lt(h),b=he(),R=he(),B="";for(this.divRemTo(y,b,R);b.signum()>0;)B=(h+R.intValue()).toString(o).substr(1)+B,b.divRemTo(y,b,R);return R.intValue().toString(o)+B},M.prototype.fromRadix=function(o,c){this.fromInt(0),c==null&&(c=10);for(var h=this.chunkSize(c),y=Math.pow(c,h),b=!1,R=0,B=0,L=0;L<o.length;++L){var j=ct(o,L);j<0?o.charAt(L)=="-"&&this.signum()==0&&(b=!0):(B=c*B+j,++R>=h&&(this.dMultiply(y),this.dAddOffset(B,0),R=0,B=0))}R>0&&(this.dMultiply(Math.pow(c,R)),this.dAddOffset(B,0)),b&&M.ZERO.subTo(this,this)},M.prototype.fromNumber=function(o,c,h){if(typeof c=="number")if(o<2)this.fromInt(1);else for(this.fromNumber(o,h),this.testBit(o-1)||this.bitwiseTo(M.ONE.shiftLeft(o-1),je,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>o&&this.subTo(M.ONE.shiftLeft(o-1),this);else{var y=new Array,b=7&o;y.length=1+(o>>3),c.nextBytes(y),b>0?y[0]&=(1<<b)-1:y[0]=0,this.fromString(y,256)}},M.prototype.bitwiseTo=function(o,c,h){var y,b,R=Math.min(o.t,this.t);for(y=0;y<R;++y)h[y]=c(this[y],o[y]);if(o.t<this.t){for(b=o.s&this.DM,y=R;y<this.t;++y)h[y]=c(this[y],b);h.t=this.t}else{for(b=this.s&this.DM,y=R;y<o.t;++y)h[y]=c(b,o[y]);h.t=o.t}h.s=c(this.s,o.s),h.clamp()},M.prototype.changeBit=function(o,c){var h=M.ONE.shiftLeft(o);return this.bitwiseTo(h,c,h),h},M.prototype.addTo=function(o,c){for(var h=0,y=0,b=Math.min(o.t,this.t);h<b;)y+=this[h]+o[h],c[h++]=y&this.DM,y>>=this.DB;if(o.t<this.t){for(y+=o.s;h<this.t;)y+=this[h],c[h++]=y&this.DM,y>>=this.DB;y+=this.s}else{for(y+=this.s;h<o.t;)y+=o[h],c[h++]=y&this.DM,y>>=this.DB;y+=o.s}c.s=y<0?-1:0,y>0?c[h++]=y:y<-1&&(c[h++]=this.DV+y),c.t=h,c.clamp()},M.prototype.dMultiply=function(o){this[this.t]=this.am(0,o-1,this,0,0,this.t),++this.t,this.clamp()},M.prototype.dAddOffset=function(o,c){if(o!=0){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=o;this[c]>=this.DV;)this[c]-=this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}},M.prototype.multiplyLowerTo=function(o,c,h){var y,b=Math.min(this.t+o.t,c);for(h.s=0,h.t=b;b>0;)h[--b]=0;for(y=h.t-this.t;b<y;++b)h[b+this.t]=this.am(0,o[b],h,b,0,this.t);for(y=Math.min(o.t,c);b<y;++b)this.am(0,o[b],h,b,0,c-b);h.clamp()},M.prototype.multiplyUpperTo=function(o,c,h){--c;var y=h.t=this.t+o.t-c;for(h.s=0;--y>=0;)h[y]=0;for(y=Math.max(c-this.t,0);y<o.t;++y)h[this.t+y-c]=this.am(c-y,o[y],h,0,0,this.t+y-c);h.clamp(),h.drShiftTo(1,h)},M.prototype.modInt=function(o){if(o<=0)return 0;var c=this.DV%o,h=this.s<0?o-1:0;if(this.t>0)if(c==0)h=this[0]%o;else for(var y=this.t-1;y>=0;--y)h=(c*h+this[y])%o;return h},M.prototype.millerRabin=function(o){var c=this.subtract(M.ONE),h=c.getLowestSetBit();if(h<=0)return!1;var y=c.shiftRight(h);(o=o+1>>1)>$e.length&&(o=$e.length);for(var b=he(),R=0;R<o;++R){b.fromInt($e[Math.floor(Math.random()*$e.length)]);var B=b.modPow(y,this);if(B.compareTo(M.ONE)!=0&&B.compareTo(c)!=0){for(var L=1;L++<h&&B.compareTo(c)!=0;)if((B=B.modPowInt(2,this)).compareTo(M.ONE)==0)return!1;if(B.compareTo(c)!=0)return!1}}return!0},M.prototype.clone=function(){var o=he();return this.copyTo(o),o},M.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},M.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},M.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},M.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},M.prototype.toByteArray=function(){var o=this.t,c=new Array;c[0]=this.s;var h,y=this.DB-o*this.DB%8,b=0;if(o-- >0)for(y<this.DB&&(h=this[o]>>y)!=(this.s&this.DM)>>y&&(c[b++]=h|this.s<<this.DB-y);o>=0;)y<8?(h=(this[o]&(1<<y)-1)<<8-y,h|=this[--o]>>(y+=this.DB-8)):(h=this[o]>>(y-=8)&255,y<=0&&(y+=this.DB,--o)),128&h&&(h|=-256),b==0&&(128&this.s)!=(128&h)&&++b,(b>0||h!=this.s)&&(c[b++]=h);return c},M.prototype.equals=function(o){return this.compareTo(o)==0},M.prototype.min=function(o){return this.compareTo(o)<0?this:o},M.prototype.max=function(o){return this.compareTo(o)>0?this:o},M.prototype.and=function(o){var c=he();return this.bitwiseTo(o,_t,c),c},M.prototype.or=function(o){var c=he();return this.bitwiseTo(o,je,c),c},M.prototype.xor=function(o){var c=he();return this.bitwiseTo(o,qe,c),c},M.prototype.andNot=function(o){var c=he();return this.bitwiseTo(o,Ft,c),c},M.prototype.not=function(){for(var o=he(),c=0;c<this.t;++c)o[c]=this.DM&~this[c];return o.t=this.t,o.s=~this.s,o},M.prototype.shiftLeft=function(o){var c=he();return o<0?this.rShiftTo(-o,c):this.lShiftTo(o,c),c},M.prototype.shiftRight=function(o){var c=he();return o<0?this.lShiftTo(-o,c):this.rShiftTo(o,c),c},M.prototype.getLowestSetBit=function(){for(var o=0;o<this.t;++o)if(this[o]!=0)return o*this.DB+Mt(this[o]);return this.s<0?this.t*this.DB:-1},M.prototype.bitCount=function(){for(var o=0,c=this.s&this.DM,h=0;h<this.t;++h)o+=tr(this[h]^c);return o},M.prototype.testBit=function(o){var c=Math.floor(o/this.DB);return c>=this.t?this.s!=0:(this[c]&1<<o%this.DB)!=0},M.prototype.setBit=function(o){return this.changeBit(o,je)},M.prototype.clearBit=function(o){return this.changeBit(o,Ft)},M.prototype.flipBit=function(o){return this.changeBit(o,qe)},M.prototype.add=function(o){var c=he();return this.addTo(o,c),c},M.prototype.subtract=function(o){var c=he();return this.subTo(o,c),c},M.prototype.multiply=function(o){var c=he();return this.multiplyTo(o,c),c},M.prototype.divide=function(o){var c=he();return this.divRemTo(o,c,null),c},M.prototype.remainder=function(o){var c=he();return this.divRemTo(o,null,c),c},M.prototype.divideAndRemainder=function(o){var c=he(),h=he();return this.divRemTo(o,c,h),new Array(c,h)},M.prototype.modPow=function(o,c){var h,y,b=o.bitLength(),R=lt(1);if(b<=0)return R;h=b<18?1:b<48?3:b<144?4:b<768?5:6,y=b<8?new Re(c):c.isEven()?new Qe(c):new Oe(c);var B=new Array,L=3,j=h-1,V=(1<<h)-1;if(B[1]=y.convert(this),h>1){var q=he();for(y.sqrTo(B[1],q);L<=V;)B[L]=he(),y.mulTo(q,B[L-2],B[L]),L+=2}var G,Z,re=o.t-1,ce=!0,le=he();for(b=Rt(o[re])-1;re>=0;){for(b>=j?G=o[re]>>b-j&V:(G=(o[re]&(1<<b+1)-1)<<j-b,re>0&&(G|=o[re-1]>>this.DB+b-j)),L=h;!(1&G);)G>>=1,--L;if((b-=L)<0&&(b+=this.DB,--re),ce)B[G].copyTo(R),ce=!1;else{for(;L>1;)y.sqrTo(R,le),y.sqrTo(le,R),L-=2;L>0?y.sqrTo(R,le):(Z=R,R=le,le=Z),y.mulTo(le,B[G],R)}for(;re>=0&&!(o[re]&1<<b);)y.sqrTo(R,le),Z=R,R=le,le=Z,--b<0&&(b=this.DB-1,--re)}return y.revert(R)},M.prototype.modInverse=function(o){var c=o.isEven();if(this.isEven()&&c||o.signum()==0)return M.ZERO;for(var h=o.clone(),y=this.clone(),b=lt(1),R=lt(0),B=lt(0),L=lt(1);h.signum()!=0;){for(;h.isEven();)h.rShiftTo(1,h),c?(b.isEven()&&R.isEven()||(b.addTo(this,b),R.subTo(o,R)),b.rShiftTo(1,b)):R.isEven()||R.subTo(o,R),R.rShiftTo(1,R);for(;y.isEven();)y.rShiftTo(1,y),c?(B.isEven()&&L.isEven()||(B.addTo(this,B),L.subTo(o,L)),B.rShiftTo(1,B)):L.isEven()||L.subTo(o,L),L.rShiftTo(1,L);h.compareTo(y)>=0?(h.subTo(y,h),c&&b.subTo(B,b),R.subTo(L,R)):(y.subTo(h,y),c&&B.subTo(b,B),L.subTo(R,L))}return y.compareTo(M.ONE)!=0?M.ZERO:L.compareTo(o)>=0?L.subtract(o):L.signum()<0?(L.addTo(o,L),L.signum()<0?L.add(o):L):L},M.prototype.pow=function(o){return this.exp(o,new wt)},M.prototype.gcd=function(o){var c=this.s<0?this.negate():this.clone(),h=o.s<0?o.negate():o.clone();if(c.compareTo(h)<0){var y=c;c=h,h=y}var b=c.getLowestSetBit(),R=h.getLowestSetBit();if(R<0)return c;for(b<R&&(R=b),R>0&&(c.rShiftTo(R,c),h.rShiftTo(R,h));c.signum()>0;)(b=c.getLowestSetBit())>0&&c.rShiftTo(b,c),(b=h.getLowestSetBit())>0&&h.rShiftTo(b,h),c.compareTo(h)>=0?(c.subTo(h,c),c.rShiftTo(1,c)):(h.subTo(c,h),h.rShiftTo(1,h));return R>0&&h.lShiftTo(R,h),h},M.prototype.isProbablePrime=function(o){var c,h=this.abs();if(h.t==1&&h[0]<=$e[$e.length-1]){for(c=0;c<$e.length;++c)if(h[0]==$e[c])return!0;return!1}if(h.isEven())return!1;for(c=1;c<$e.length;){for(var y=$e[c],b=c+1;b<$e.length&&y<Q;)y*=$e[b++];for(y=h.modInt(y);c<b;)if(y%$e[c++]==0)return!1}return h.millerRabin(o)},M.prototype.square=function(){var o=he();return this.squareTo(o),o},v.prototype.init=function(o){var c,h,y;for(c=0;c<256;++c)this.S[c]=c;for(h=0,c=0;c<256;++c)h=h+this.S[c]+o[c%o.length]&255,y=this.S[c],this.S[c]=this.S[h],this.S[h]=y;this.i=0,this.j=0},v.prototype.next=function(){var o;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,o=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=o,this.S[o+this.S[this.i]&255]};var S,$,Y;function ue(){(function(o){$[Y++]^=255&o,$[Y++]^=o>>8&255,$[Y++]^=o>>16&255,$[Y++]^=o>>24&255,Y>=256&&(Y-=256)})(new Date().getTime())}if($==null){var de;if($=new Array,Y=0,D!==void 0&&(D.crypto!==void 0||D.msCrypto!==void 0)){var ve=D.crypto||D.msCrypto;if(ve.getRandomValues){var Ie=new Uint8Array(32);for(ve.getRandomValues(Ie),de=0;de<32;++de)$[Y++]=Ie[de]}else if(I.appName=="Netscape"&&I.appVersion<"5"){var Ve=D.crypto.random(32);for(de=0;de<Ve.length;++de)$[Y++]=255&Ve.charCodeAt(de)}}for(;Y<256;)de=Math.floor(65536*Math.random()),$[Y++]=de>>>8,$[Y++]=255&de;Y=0,ue()}function De(){if(S==null){for(ue(),(S=function(){return new v}()).init($),Y=0;Y<$.length;++Y)$[Y]=0;Y=0}return S.next()}function Me(){}function Xe(s,o){return new M(s,o)}function Ht(s,o,c){for(var h="",y=0;h.length<o;)h+=c(String.fromCharCode.apply(String,s.concat([(4278190080&y)>>24,(16711680&y)>>16,(65280&y)>>8,255&y]))),y+=1;return h}function Se(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Ke(s,o){this.x=o,this.q=s}function Pe(s,o,c,h){this.curve=s,this.x=o,this.y=c,this.z=h??M.ONE,this.zinv=null}function C(s,o,c){this.q=s,this.a=this.fromBigInteger(o),this.b=this.fromBigInteger(c),this.infinity=new Pe(this,null,null)}Me.prototype.nextBytes=function(o){var c;for(c=0;c<o.length;++c)o[c]=De()},Se.prototype.doPublic=function(o){return o.modPowInt(this.e,this.n)},Se.prototype.setPublic=function(o,c){if(this.isPublic=!0,this.isPrivate=!1,typeof o!="string")this.n=o,this.e=c;else{if(!(o!=null&&c!=null&&o.length>0&&c.length>0))throw"Invalid RSA public key";this.n=Xe(o,16),this.e=parseInt(c,16)}},Se.prototype.encrypt=function(o){var c=function(R,B){if(B<R.length+11)throw"Message too long for RSA";for(var L=new Array,j=R.length-1;j>=0&&B>0;){var V=R.charCodeAt(j--);V<128?L[--B]=V:V>127&&V<2048?(L[--B]=63&V|128,L[--B]=V>>6|192):(L[--B]=63&V|128,L[--B]=V>>6&63|128,L[--B]=V>>12|224)}L[--B]=0;for(var q=new Me,G=new Array;B>2;){for(G[0]=0;G[0]==0;)q.nextBytes(G);L[--B]=G[0]}return L[--B]=2,L[--B]=0,new M(L)}(o,this.n.bitLength()+7>>3);if(c==null)return null;var h=this.doPublic(c);if(h==null)return null;var y=h.toString(16);return 1&y.length?"0"+y:y},Se.prototype.encryptOAEP=function(o,c,h){var y=function(L,j,V,q){var G=p.crypto.MessageDigest,Z=p.crypto.Util,re=null;if(V||(V="sha1"),typeof V=="string"&&(re=G.getCanonicalAlgName(V),q=G.getHashLength(re),V=function(ge){return rr(Z.hashHex(br(ge),re))}),L.length+2*q+2>j)throw"Message too long for RSA";var ce,le="";for(ce=0;ce<j-L.length-2*q-2;ce+=1)le+="\0";var T=V("")+le+""+L,K=new Array(q);new Me().nextBytes(K);var W=Ht(K,T.length,V),J=[];for(ce=0;ce<T.length;ce+=1)J[ce]=T.charCodeAt(ce)^W.charCodeAt(ce);var se=Ht(J,K.length,V),fe=[0];for(ce=0;ce<K.length;ce+=1)fe[ce+1]=K[ce]^se.charCodeAt(ce);return new M(fe.concat(J))}(o,this.n.bitLength()+7>>3,c,h);if(y==null)return null;var b=this.doPublic(y);if(b==null)return null;var R=b.toString(16);return 1&R.length?"0"+R:R},Se.prototype.type="RSA",Ke.prototype.equals=function(o){return o==this||this.q.equals(o.q)&&this.x.equals(o.x)},Ke.prototype.toBigInteger=function(){return this.x},Ke.prototype.negate=function(){return new Ke(this.q,this.x.negate().mod(this.q))},Ke.prototype.add=function(o){return new Ke(this.q,this.x.add(o.toBigInteger()).mod(this.q))},Ke.prototype.subtract=function(o){return new Ke(this.q,this.x.subtract(o.toBigInteger()).mod(this.q))},Ke.prototype.multiply=function(o){return new Ke(this.q,this.x.multiply(o.toBigInteger()).mod(this.q))},Ke.prototype.square=function(){return new Ke(this.q,this.x.square().mod(this.q))},Ke.prototype.divide=function(o){return new Ke(this.q,this.x.multiply(o.toBigInteger().modInverse(this.q)).mod(this.q))},Pe.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Pe.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Pe.prototype.equals=function(o){return o==this||(this.isInfinity()?o.isInfinity():o.isInfinity()?this.isInfinity():!!o.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(o.z)).mod(this.curve.q).equals(M.ZERO)&&o.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(o.z)).mod(this.curve.q).equals(M.ZERO))},Pe.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(M.ZERO)&&!this.y.toBigInteger().equals(M.ZERO)},Pe.prototype.negate=function(){return new Pe(this.curve,this.x,this.y.negate(),this.z)},Pe.prototype.add=function(o){if(this.isInfinity())return o;if(o.isInfinity())return this;var c=o.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(o.z)).mod(this.curve.q),h=o.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(o.z)).mod(this.curve.q);if(M.ZERO.equals(h))return M.ZERO.equals(c)?this.twice():this.curve.getInfinity();var y=new M("3"),b=this.x.toBigInteger(),R=this.y.toBigInteger(),B=(o.x.toBigInteger(),o.y.toBigInteger(),h.square()),L=B.multiply(h),j=b.multiply(B),V=c.square().multiply(this.z),q=V.subtract(j.shiftLeft(1)).multiply(o.z).subtract(L).multiply(h).mod(this.curve.q),G=j.multiply(y).multiply(c).subtract(R.multiply(L)).subtract(V.multiply(c)).multiply(o.z).add(c.multiply(L)).mod(this.curve.q),Z=L.multiply(this.z).multiply(o.z).mod(this.curve.q);return new Pe(this.curve,this.curve.fromBigInteger(q),this.curve.fromBigInteger(G),Z)},Pe.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var o=new M("3"),c=this.x.toBigInteger(),h=this.y.toBigInteger(),y=h.multiply(this.z),b=y.multiply(h).mod(this.curve.q),R=this.curve.a.toBigInteger(),B=c.square().multiply(o);M.ZERO.equals(R)||(B=B.add(this.z.square().multiply(R)));var L=(B=B.mod(this.curve.q)).square().subtract(c.shiftLeft(3).multiply(b)).shiftLeft(1).multiply(y).mod(this.curve.q),j=B.multiply(o).multiply(c).subtract(b.shiftLeft(1)).shiftLeft(2).multiply(b).subtract(B.square().multiply(B)).mod(this.curve.q),V=y.square().multiply(y).shiftLeft(3).mod(this.curve.q);return new Pe(this.curve,this.curve.fromBigInteger(L),this.curve.fromBigInteger(j),V)},Pe.prototype.multiply=function(o){if(this.isInfinity())return this;if(o.signum()==0)return this.curve.getInfinity();var c,h=o,y=h.multiply(new M("3")),b=this.negate(),R=this,B=this.curve.q.subtract(o),L=B.multiply(new M("3")),j=new Pe(this.curve,this.x,this.y),V=j.negate();for(c=y.bitLength()-2;c>0;--c){R=R.twice();var q=y.testBit(c);q!=h.testBit(c)&&(R=R.add(q?this:b))}for(c=L.bitLength()-2;c>0;--c){j=j.twice();var G=L.testBit(c);G!=B.testBit(c)&&(j=j.add(G?j:V))}return R},Pe.prototype.multiplyTwo=function(o,c,h){var y;y=o.bitLength()>h.bitLength()?o.bitLength()-1:h.bitLength()-1;for(var b=this.curve.getInfinity(),R=this.add(c);y>=0;)b=b.twice(),o.testBit(y)?b=h.testBit(y)?b.add(R):b.add(this):h.testBit(y)&&(b=b.add(c)),--y;return b},C.prototype.getQ=function(){return this.q},C.prototype.getA=function(){return this.a},C.prototype.getB=function(){return this.b},C.prototype.equals=function(o){return o==this||this.q.equals(o.q)&&this.a.equals(o.a)&&this.b.equals(o.b)},C.prototype.getInfinity=function(){return this.infinity},C.prototype.fromBigInteger=function(o){return new Ke(this.q,o)},C.prototype.decodePointHex=function(o){switch(parseInt(o.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var c=(o.length-2)/2,h=o.substr(2,c),y=o.substr(c+2,c);return new Pe(this,this.fromBigInteger(new M(h,16)),this.fromBigInteger(new M(y,16)));default:return null}},Ke.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Pe.prototype.getEncoded=function(s){var o=function(R,B){var L=R.toByteArrayUnsigned();if(B<L.length)L=L.slice(L.length-B);else for(;B>L.length;)L.unshift(0);return L},c=this.getX().toBigInteger(),h=this.getY().toBigInteger(),y=o(c,32);return s?h.isEven()?y.unshift(2):y.unshift(3):(y.unshift(4),y=y.concat(o(h,32))),y},Pe.decodeFrom=function(s,o){o[0];var c=o.length-1,h=o.slice(1,1+c/2),y=o.slice(1+c/2,1+c);h.unshift(0),y.unshift(0);var b=new M(h),R=new M(y);return new Pe(s,s.fromBigInteger(b),s.fromBigInteger(R))},Pe.decodeFromHex=function(s,o){o.substr(0,2);var c=o.length-2,h=o.substr(2,c/2),y=o.substr(2+c/2,c/2),b=new M(h,16),R=new M(y,16);return new Pe(s,s.fromBigInteger(b),s.fromBigInteger(R))},Pe.prototype.add2D=function(s){if(this.isInfinity())return s;if(s.isInfinity())return this;if(this.x.equals(s.x))return this.y.equals(s.y)?this.twice():this.curve.getInfinity();var o=s.x.subtract(this.x),c=s.y.subtract(this.y).divide(o),h=c.square().subtract(this.x).subtract(s.x),y=c.multiply(this.x.subtract(h)).subtract(this.y);return new Pe(this.curve,h,y)},Pe.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var s=this.curve.fromBigInteger(M.valueOf(2)),o=this.curve.fromBigInteger(M.valueOf(3)),c=this.x.square().multiply(o).add(this.curve.a).divide(this.y.multiply(s)),h=c.square().subtract(this.x.multiply(s)),y=c.multiply(this.x.subtract(h)).subtract(this.y);return new Pe(this.curve,h,y)},Pe.prototype.multiply2D=function(s){if(this.isInfinity())return this;if(s.signum()==0)return this.curve.getInfinity();var o,c=s,h=c.multiply(new M("3")),y=this.negate(),b=this;for(o=h.bitLength()-2;o>0;--o){b=b.twice();var R=h.testBit(o);R!=c.testBit(o)&&(b=b.add2D(R?this:y))}return b},Pe.prototype.isOnCurve=function(){var s=this.getX().toBigInteger(),o=this.getY().toBigInteger(),c=this.curve.getA().toBigInteger(),h=this.curve.getB().toBigInteger(),y=this.curve.getQ(),b=o.multiply(o).mod(y),R=s.multiply(s).multiply(s).add(c.multiply(s)).add(h).mod(y);return b.equals(R)},Pe.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Pe.prototype.validate=function(){var s=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var o=this.getX().toBigInteger(),c=this.getY().toBigInteger();if(o.compareTo(M.ONE)<0||o.compareTo(s.subtract(M.ONE))>0)throw new Error("x coordinate out of bounds");if(c.compareTo(M.ONE)<0||c.compareTo(s.subtract(M.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(s).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var m=function(){var s=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),o=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),c={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function h(R,B,L){return B?c[B]:String.fromCharCode(parseInt(L,16))}var y=new String(""),b=Object.hasOwnProperty;return function(R,B){var L,j,V=R.match(s),q=V[0],G=!1;q==="{"?L={}:q==="["?L=[]:(L=[],G=!0);for(var Z=[L],re=1-G,ce=V.length;re<ce;++re){var le;switch((q=V[re]).charCodeAt(0)){default:(le=Z[0])[j||le.length]=+q,j=void 0;break;case 34:if((q=q.substring(1,q.length-1)).indexOf("\\")!==-1&&(q=q.replace(o,h)),le=Z[0],!j){if(!(le instanceof Array)){j=q||y;break}j=le.length}le[j]=q,j=void 0;break;case 91:le=Z[0],Z.unshift(le[j||le.length]=[]),j=void 0;break;case 93:Z.shift();break;case 102:(le=Z[0])[j||le.length]=!1,j=void 0;break;case 110:(le=Z[0])[j||le.length]=null,j=void 0;break;case 116:(le=Z[0])[j||le.length]=!0,j=void 0;break;case 123:le=Z[0],Z.unshift(le[j||le.length]={}),j=void 0;break;case 125:Z.shift()}}if(G){if(Z.length!==1)throw new Error;L=L[0]}else if(Z.length)throw new Error;return B&&(L=function T(K,W){var J=K[W];if(J&&(J===void 0?"undefined":A(J))==="object"){var se=null;for(var fe in J)if(b.call(J,fe)&&J!==K){var be=T(J,fe);be!==void 0?J[fe]=be:(se||(se=[]),se.push(fe))}if(se)for(var ge=se.length;--ge>=0;)delete J[se[ge]]}return B.call(K,W,J)}({"":L},"")),L}}();p!==void 0&&p||(e.KJUR=p={}),p.asn1!==void 0&&p.asn1||(p.asn1={}),p.asn1.ASN1Util=new function(){this.integerToByteHex=function(s){var o=s.toString(16);return o.length%2==1&&(o="0"+o),o},this.bigIntToMinTwosComplementsHex=function(s){var o=s.toString(16);if(o.substr(0,1)!="-")o.length%2==1?o="0"+o:o.match(/^[0-7]/)||(o="00"+o);else{var c=o.substr(1).length;c%2==1?c+=1:o.match(/^[0-7]/)||(c+=2);for(var h="",y=0;y<c;y++)h+="f";o=new M(h,16).xor(s).add(M.ONE).toString(16).replace(/^-/,"")}return o},this.getPEMStringFromHex=function(s,o){return Wt(s,o)},this.newObject=function(s){var o=p.asn1,c=o.ASN1Object,h=o.DERBoolean,y=o.DERInteger,b=o.DERBitString,R=o.DEROctetString,B=o.DERNull,L=o.DERObjectIdentifier,j=o.DEREnumerated,V=o.DERUTF8String,q=o.DERNumericString,G=o.DERPrintableString,Z=o.DERTeletexString,re=o.DERIA5String,ce=o.DERUTCTime,le=o.DERGeneralizedTime,T=o.DERVisibleString,K=o.DERBMPString,W=o.DERSequence,J=o.DERSet,se=o.DERTaggedObject,fe=o.ASN1Util.newObject;if(s instanceof o.ASN1Object)return s;var be=Object.keys(s);if(be.length!=1)throw new Error("key of param shall be only one.");var ge=be[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+ge+":")==-1)throw new Error("undefined key: "+ge);if(ge=="bool")return new h(s[ge]);if(ge=="int")return new y(s[ge]);if(ge=="bitstr")return new b(s[ge]);if(ge=="octstr")return new R(s[ge]);if(ge=="null")return new B(s[ge]);if(ge=="oid")return new L(s[ge]);if(ge=="enum")return new j(s[ge]);if(ge=="utf8str")return new V(s[ge]);if(ge=="numstr")return new q(s[ge]);if(ge=="prnstr")return new G(s[ge]);if(ge=="telstr")return new Z(s[ge]);if(ge=="ia5str")return new re(s[ge]);if(ge=="utctime")return new ce(s[ge]);if(ge=="gentime")return new le(s[ge]);if(ge=="visstr")return new T(s[ge]);if(ge=="bmpstr")return new K(s[ge]);if(ge=="asn1")return new c(s[ge]);if(ge=="seq"){for(var Ne=s[ge],we=[],Ee=0;Ee<Ne.length;Ee++){var Ye=fe(Ne[Ee]);we.push(Ye)}return new W({array:we})}if(ge=="set"){for(Ne=s[ge],we=[],Ee=0;Ee<Ne.length;Ee++)Ye=fe(Ne[Ee]),we.push(Ye);return new J({array:we})}if(ge=="tag"){var rt=s[ge];if(Object.prototype.toString.call(rt)==="[object Array]"&&rt.length==3){var et=fe(rt[2]);return new se({tag:rt[0],explicit:rt[1],obj:et})}return new se(rt)}},this.jsonToASN1HEX=function(s){return this.newObject(s).getEncodedHex()}},p.asn1.ASN1Util.oidHexToInt=function(s){for(var o="",c=parseInt(s.substr(0,2),16),h=(o=Math.floor(c/40)+"."+c%40,""),y=2;y<s.length;y+=2){var b=("00000000"+parseInt(s.substr(y,2),16).toString(2)).slice(-8);h+=b.substr(1,7),b.substr(0,1)=="0"&&(o=o+"."+new M(h,2).toString(10),h="")}return o},p.asn1.ASN1Util.oidIntToHex=function(s){var o=function(L){var j=L.toString(16);return j.length==1&&(j="0"+j),j},c=function(L){var j="",V=new M(L,10).toString(2),q=7-V.length%7;q==7&&(q=0);for(var G="",Z=0;Z<q;Z++)G+="0";for(V=G+V,Z=0;Z<V.length-1;Z+=7){var re=V.substr(Z,7);Z!=V.length-7&&(re="1"+re),j+=o(parseInt(re,2))}return j};if(!s.match(/^[0-9.]+$/))throw"malformed oid string: "+s;var h="",y=s.split("."),b=40*parseInt(y[0])+parseInt(y[1]);h+=o(b),y.splice(0,2);for(var R=0;R<y.length;R++)h+=c(y[R]);return h},p.asn1.ASN1Object=function(s){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var o=this.hV.length/2,c=o.toString(16);if(c.length%2==1&&(c="0"+c),o<128)return c;var h=c.length/2;if(h>15)throw"ASN.1 length too long to represent by 8x: n = "+o.toString(16);return(128+h).toString(16)+c},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(o){this.params=o},s!=null&&s.tlv!=null&&(this.hTLV=s.tlv,this.isModified=!1)},p.asn1.DERAbstractString=function(s){p.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(o){this.hTLV=null,this.isModified=!0,this.s=o,this.hV=Qa(this.s).toLowerCase()},this.setStringHex=function(o){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=o},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"?this.setString(s):s.str!==void 0?this.setString(s.str):s.hex!==void 0&&this.setStringHex(s.hex))},at(p.asn1.DERAbstractString,p.asn1.ASN1Object),p.asn1.DERAbstractTime=function(s){p.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(o){var c=o.getTime()+6e4*o.getTimezoneOffset();return new Date(c)},this.formatDate=function(o,c,h){var y=this.zeroPadding,b=this.localDateToUTC(o),R=String(b.getFullYear());c=="utc"&&(R=R.substr(2,2));var B=R+y(String(b.getMonth()+1),2)+y(String(b.getDate()),2)+y(String(b.getHours()),2)+y(String(b.getMinutes()),2)+y(String(b.getSeconds()),2);if(h===!0){var L=b.getMilliseconds();if(L!=0){var j=y(String(L),3);B=B+"."+(j=j.replace(/[0]+$/,""))}}return B+"Z"},this.zeroPadding=function(o,c){return o.length>=c?o:new Array(c-o.length+1).join("0")+o},this.getString=function(){return this.s},this.setString=function(o){this.hTLV=null,this.isModified=!0,this.s=o,this.hV=Be(o)},this.setByDateValue=function(o,c,h,y,b,R){var B=new Date(Date.UTC(o,c-1,h,y,b,R,0));this.setByDate(B)},this.getFreshValueHex=function(){return this.hV}},at(p.asn1.DERAbstractTime,p.asn1.ASN1Object),p.asn1.DERAbstractStructured=function(s){p.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(o){this.hTLV=null,this.isModified=!0,this.asn1Array=o},this.appendASN1Object=function(o){this.hTLV=null,this.isModified=!0,this.asn1Array.push(o)},this.asn1Array=new Array,s!==void 0&&s.array!==void 0&&(this.asn1Array=s.array)},at(p.asn1.DERAbstractStructured,p.asn1.ASN1Object),p.asn1.DERBoolean=function(s){p.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=s==0?"010100":"0101ff"},at(p.asn1.DERBoolean,p.asn1.ASN1Object),p.asn1.DERInteger=function(s){p.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(o){this.hTLV=null,this.isModified=!0,this.hV=p.asn1.ASN1Util.bigIntToMinTwosComplementsHex(o)},this.setByInteger=function(o){var c=new M(String(o),10);this.setByBigInteger(c)},this.setValueHex=function(o){this.hV=o},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.bigint!==void 0?this.setByBigInteger(s.bigint):s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},at(p.asn1.DERInteger,p.asn1.ASN1Object),p.asn1.DERBitString=function(s){if(s!==void 0&&s.obj!==void 0){var o=p.asn1.ASN1Util.newObject(s.obj);s.hex="00"+o.getEncodedHex()}p.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(c){this.hTLV=null,this.isModified=!0,this.hV=c},this.setUnusedBitsAndHexValue=function(c,h){if(c<0||7<c)throw"unused bits shall be from 0 to 7: u = "+c;var y="0"+c;this.hTLV=null,this.isModified=!0,this.hV=y+h},this.setByBinaryString=function(c){var h=8-(c=c.replace(/0+$/,"")).length%8;h==8&&(h=0);for(var y=0;y<=h;y++)c+="0";var b="";for(y=0;y<c.length-1;y+=8){var R=c.substr(y,8),B=parseInt(R,2).toString(16);B.length==1&&(B="0"+B),b+=B}this.hTLV=null,this.isModified=!0,this.hV="0"+h+b},this.setByBooleanArray=function(c){for(var h="",y=0;y<c.length;y++)c[y]==1?h+="1":h+="0";this.setByBinaryString(h)},this.newFalseArray=function(c){for(var h=new Array(c),y=0;y<c;y++)h[y]=!1;return h},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"&&s.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(s):s.hex!==void 0?this.setHexValueIncludingUnusedBits(s.hex):s.bin!==void 0?this.setByBinaryString(s.bin):s.array!==void 0&&this.setByBooleanArray(s.array))},at(p.asn1.DERBitString,p.asn1.ASN1Object),p.asn1.DEROctetString=function(s){if(s!==void 0&&s.obj!==void 0){var o=p.asn1.ASN1Util.newObject(s.obj);s.hex=o.getEncodedHex()}p.asn1.DEROctetString.superclass.constructor.call(this,s),this.hT="04"},at(p.asn1.DEROctetString,p.asn1.DERAbstractString),p.asn1.DERNull=function(){p.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},at(p.asn1.DERNull,p.asn1.ASN1Object),p.asn1.DERObjectIdentifier=function(s){p.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(o){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=o},this.setValueOidString=function(o){var c=function(y){var b=function(G){var Z=G.toString(16);return Z.length==1&&(Z="0"+Z),Z},R=function(G){var Z="",re=parseInt(G,10).toString(2),ce=7-re.length%7;ce==7&&(ce=0);for(var le="",T=0;T<ce;T++)le+="0";for(re=le+re,T=0;T<re.length-1;T+=7){var K=re.substr(T,7);T!=re.length-7&&(K="1"+K),Z+=b(parseInt(K,2))}return Z};try{if(!y.match(/^[0-9.]+$/))return null;var B="",L=y.split("."),j=40*parseInt(L[0],10)+parseInt(L[1],10);B+=b(j),L.splice(0,2);for(var V=0;V<L.length;V++)B+=R(L[V]);return B}catch{return null}}(o);if(c==null)throw new Error("malformed oid string: "+o);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=c},this.setValueName=function(o){var c=p.asn1.x509.OID.name2oid(o);if(c==="")throw new Error("DERObjectIdentifier oidName undefined: "+o);this.setValueOidString(c)},this.setValueNameOrOid=function(o){o.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(o):this.setValueName(o)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(o){typeof o=="string"?this.setValueNameOrOid(o):o.oid!==void 0?this.setValueNameOrOid(o.oid):o.name!==void 0?this.setValueNameOrOid(o.name):o.hex!==void 0&&this.setValueHex(o.hex)},s!==void 0&&this.setByParam(s)},at(p.asn1.DERObjectIdentifier,p.asn1.ASN1Object),p.asn1.DEREnumerated=function(s){p.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(o){this.hTLV=null,this.isModified=!0,this.hV=p.asn1.ASN1Util.bigIntToMinTwosComplementsHex(o)},this.setByInteger=function(o){var c=new M(String(o),10);this.setByBigInteger(c)},this.setValueHex=function(o){this.hV=o},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},at(p.asn1.DEREnumerated,p.asn1.ASN1Object),p.asn1.DERUTF8String=function(s){p.asn1.DERUTF8String.superclass.constructor.call(this,s),this.hT="0c"},at(p.asn1.DERUTF8String,p.asn1.DERAbstractString),p.asn1.DERNumericString=function(s){p.asn1.DERNumericString.superclass.constructor.call(this,s),this.hT="12"},at(p.asn1.DERNumericString,p.asn1.DERAbstractString),p.asn1.DERPrintableString=function(s){p.asn1.DERPrintableString.superclass.constructor.call(this,s),this.hT="13"},at(p.asn1.DERPrintableString,p.asn1.DERAbstractString),p.asn1.DERTeletexString=function(s){p.asn1.DERTeletexString.superclass.constructor.call(this,s),this.hT="14"},at(p.asn1.DERTeletexString,p.asn1.DERAbstractString),p.asn1.DERIA5String=function(s){p.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="16"},at(p.asn1.DERIA5String,p.asn1.DERAbstractString),p.asn1.DERVisibleString=function(s){p.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="1a"},at(p.asn1.DERVisibleString,p.asn1.DERAbstractString),p.asn1.DERBMPString=function(s){p.asn1.DERBMPString.superclass.constructor.call(this,s),this.hT="1e"},at(p.asn1.DERBMPString,p.asn1.DERAbstractString),p.asn1.DERUTCTime=function(s){p.asn1.DERUTCTime.superclass.constructor.call(this,s),this.hT="17",this.setByDate=function(o){this.hTLV=null,this.isModified=!0,this.date=o,this.s=this.formatDate(this.date,"utc"),this.hV=Be(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=Be(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{12}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date))},at(p.asn1.DERUTCTime,p.asn1.DERAbstractTime),p.asn1.DERGeneralizedTime=function(s){p.asn1.DERGeneralizedTime.superclass.constructor.call(this,s),this.hT="18",this.withMillis=!1,this.setByDate=function(o){this.hTLV=null,this.isModified=!0,this.date=o,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Be(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Be(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{14}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date),s.millis===!0&&(this.withMillis=!0))},at(p.asn1.DERGeneralizedTime,p.asn1.DERAbstractTime),p.asn1.DERSequence=function(s){p.asn1.DERSequence.superclass.constructor.call(this,s),this.hT="30",this.getFreshValueHex=function(){for(var o="",c=0;c<this.asn1Array.length;c++)o+=this.asn1Array[c].getEncodedHex();return this.hV=o,this.hV}},at(p.asn1.DERSequence,p.asn1.DERAbstractStructured),p.asn1.DERSet=function(s){p.asn1.DERSet.superclass.constructor.call(this,s),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var o=new Array,c=0;c<this.asn1Array.length;c++){var h=this.asn1Array[c];o.push(h.getEncodedHex())}return this.sortFlag==1&&o.sort(),this.hV=o.join(""),this.hV},s!==void 0&&s.sortflag!==void 0&&s.sortflag==0&&(this.sortFlag=!1)},at(p.asn1.DERSet,p.asn1.DERAbstractStructured),p.asn1.DERTaggedObject=function(s){p.asn1.DERTaggedObject.superclass.constructor.call(this);var o=p.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(c,h,y){this.hT=h,this.isExplicit=c,this.asn1Object=y,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=y.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,h),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(c){c.tag!=null&&(this.hT=c.tag),c.explicit!=null&&(this.isExplicit=c.explicit),c.tage!=null&&(this.hT=c.tage,this.isExplicit=!0),c.tagi!=null&&(this.hT=c.tagi,this.isExplicit=!1),c.obj!=null&&(c.obj instanceof o.ASN1Object?(this.asn1Object=c.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):A(c.obj)=="object"&&(this.asn1Object=o.ASN1Util.newObject(c.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},s!=null&&this.setByParam(s)},at(p.asn1.DERTaggedObject,p.asn1.ASN1Object);var p,H,ee,X=new function(){};function pe(s){for(var o=new Array,c=0;c<s.length;c++)o[c]=s.charCodeAt(c);return o}function Ce(s){for(var o="",c=0;c<s.length;c++)o+=String.fromCharCode(s[c]);return o}function Je(s){for(var o="",c=0;c<s.length;c++){var h=s[c].toString(16);h.length==1&&(h="0"+h),o+=h}return o}function Be(s){return Je(pe(s))}function Ge(s){return s=(s=(s=s.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function He(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=(s=s.replace(/-/g,"+")).replace(/_/g,"/")}function bt(s){return s.length%2==1&&(s="0"+s),Ge(F(s))}function Ze(s){return te(He(s))}function Qa(s){return Co(Po(s))}function vt(s){return decodeURIComponent(Fo(s))}function rr(s){for(var o="",c=0;c<s.length-1;c+=2)o+=String.fromCharCode(parseInt(s.substr(c,2),16));return o}function br(s){for(var o="",c=0;c<s.length;c++)o+=("0"+s.charCodeAt(c).toString(16)).slice(-2);return o}function gf(s){return F(s)}function yf(s){var o=gf(s).replace(/(.{64})/g,`$1\r
`);return o=o.replace(/\r\n$/,"")}function mf(s){return te(s.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Wt(s,o){return"-----BEGIN "+o+`-----\r
`+yf(s)+`\r
-----END `+o+`-----\r
`}function vr(s,o){if(s.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+o;return mf(s=o!==void 0?(s=s.replace(new RegExp("^[^]*-----BEGIN "+o+"-----"),"")).replace(new RegExp("-----END "+o+"-----[^]*$"),""):(s=s.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Xa(s){var o,c,h,y,b,R,B,L,j,V,q;if(q=s.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return L=q[1],o=parseInt(L),L.length===2&&(50<=o&&o<100?o=1900+o:0<=o&&o<50&&(o=2e3+o)),c=parseInt(q[2])-1,h=parseInt(q[3]),y=parseInt(q[4]),b=parseInt(q[5]),R=parseInt(q[6]),B=0,(j=q[7])!==""&&(V=(j.substr(1)+"00").substr(0,3),B=parseInt(V)),Date.UTC(o,c,h,y,b,R,B);throw"unsupported zulu format: "+s}function _f(s){return~~(Xa(s)/1e3)}function Co(s){return s.replace(/%/g,"")}function Fo(s){return s.replace(/(..)/g,"%$1")}function wf(s){var o="malformed IPv6 address";if(!s.match(/^[0-9A-Fa-f:]+$/))throw o;var c=(s=s.toLowerCase()).split(":").length-1;if(c<2)throw o;var h=":".repeat(7-c+2),y=(s=s.replace("::",h)).split(":");if(y.length!=8)throw o;for(var b=0;b<8;b++)y[b]=("0000"+y[b]).slice(-4);return y.join("")}function bf(s){if(!s.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var o=(s=s.toLowerCase()).match(/.{1,4}/g),c=0;c<8;c++)o[c]=o[c].replace(/^0+/,""),o[c]==""&&(o[c]="0");var h=(s=":"+o.join(":")+":").match(/:(0:){2,}/g);if(h===null)return s.slice(1,-1);var y="";for(c=0;c<h.length;c++)h[c].length>y.length&&(y=h[c]);return(s=s.replace(y,"::")).slice(1,-1)}function Za(s){var o="malformed hex value";if(!s.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw o;if(s.length!=8)return s.length==32?bf(s):s;try{return parseInt(s.substr(0,2),16)+"."+parseInt(s.substr(2,2),16)+"."+parseInt(s.substr(4,2),16)+"."+parseInt(s.substr(6,2),16)}catch{throw o}}function vf(s){return s.match(/.{4}/g).map(function(c){var h=parseInt(c.substr(0,2),16),y=parseInt(c.substr(2),16);if(h==0&y<128)return String.fromCharCode(y);if(h<8){var b=128|63&y;return vt((192|(7&h)<<3|(192&y)>>6).toString(16)+b.toString(16))}b=128|(15&h)<<2|(192&y)>>6;var R=128|63&y;return vt((224|(240&h)>>4).toString(16)+b.toString(16)+R.toString(16))}).join("")}function Po(s){for(var o=encodeURIComponent(s),c="",h=0;h<o.length;h++)o[h]=="%"?(c+=o.substr(h,3),h+=2):c=c+"%"+Be(o[h]);return c}function Sf(s){return!(s.length%2!=0||!s.match(/^[0-9a-f]+$/)&&!s.match(/^[0-9A-F]+$/))}function eu(s){return s.length%2==1?"0"+s:s.substr(0,1)>"7"?"00"+s:s}X.getLblen=function(s,o){if(s.substr(o+2,1)!="8")return 1;var c=parseInt(s.substr(o+3,1));return c==0?-1:0<c&&c<10?c+1:-2},X.getL=function(s,o){var c=X.getLblen(s,o);return c<1?"":s.substr(o+2,2*c)},X.getVblen=function(s,o){var c;return(c=X.getL(s,o))==""?-1:(c.substr(0,1)==="8"?new M(c.substr(2),16):new M(c,16)).intValue()},X.getVidx=function(s,o){var c=X.getLblen(s,o);return c<0?c:o+2*(c+1)},X.getV=function(s,o){var c=X.getVidx(s,o),h=X.getVblen(s,o);return s.substr(c,2*h)},X.getTLV=function(s,o){return s.substr(o,2)+X.getL(s,o)+X.getV(s,o)},X.getTLVblen=function(s,o){return 2+2*X.getLblen(s,o)+2*X.getVblen(s,o)},X.getNextSiblingIdx=function(s,o){return X.getVidx(s,o)+2*X.getVblen(s,o)},X.getChildIdx=function(s,o){var c,h,y,b=X,R=[];c=b.getVidx(s,o),h=2*b.getVblen(s,o),s.substr(o,2)=="03"&&(c+=2,h-=2),y=0;for(var B=c;y<=h;){var L=b.getTLVblen(s,B);if((y+=L)<=h&&R.push(B),B+=L,y>=h)break}return R},X.getNthChildIdx=function(s,o,c){return X.getChildIdx(s,o)[c]},X.getIdxbyList=function(s,o,c,h){var y,b,R=X;return c.length==0?h!==void 0&&s.substr(o,2)!==h?-1:o:(y=c.shift())>=(b=R.getChildIdx(s,o)).length?-1:R.getIdxbyList(s,b[y],c,h)},X.getIdxbyListEx=function(s,o,c,h){var y,b,R=X;if(c.length==0)return h!==void 0&&s.substr(o,2)!==h?-1:o;y=c.shift(),b=R.getChildIdx(s,o);for(var B=0,L=0;L<b.length;L++){var j=s.substr(b[L],2);if(typeof y=="number"&&!R.isContextTag(j)&&B==y||typeof y=="string"&&R.isContextTag(j,y))return R.getIdxbyListEx(s,b[L],c,h);R.isContextTag(j)||B++}return-1},X.getTLVbyList=function(s,o,c,h){var y=X,b=y.getIdxbyList(s,o,c,h);return b==-1||b>=s.length?null:y.getTLV(s,b)},X.getTLVbyListEx=function(s,o,c,h){var y=X,b=y.getIdxbyListEx(s,o,c,h);return b==-1?null:y.getTLV(s,b)},X.getVbyList=function(s,o,c,h,y){var b,R,B=X;return(b=B.getIdxbyList(s,o,c,h))==-1||b>=s.length?null:(R=B.getV(s,b),y===!0&&(R=R.substr(2)),R)},X.getVbyListEx=function(s,o,c,h,y){var b,R,B=X;return(b=B.getIdxbyListEx(s,o,c,h))==-1?null:(R=B.getV(s,b),s.substr(b,2)=="03"&&y!==!1&&(R=R.substr(2)),R)},X.getInt=function(s,o,c){c==null&&(c=-1);try{var h=s.substr(o,2);if(h!="02"&&h!="03")return c;var y=X.getV(s,o);return h=="02"?parseInt(y,16):function(R){try{var B=R.substr(0,2);if(B=="00")return parseInt(R.substr(2),16);var L=parseInt(B,16),j=R.substr(2),V=parseInt(j,16).toString(2);return V=="0"&&(V="00000000"),V=V.slice(0,0-L),parseInt(V,2)}catch{return-1}}(y)}catch{return c}},X.getOID=function(s,o,c){c==null&&(c=null);try{return s.substr(o,2)!="06"?c:function(y){if(!Sf(y))return null;try{var b=[],R=y.substr(0,2),B=parseInt(R,16);b[0]=new String(Math.floor(B/40)),b[1]=new String(B%40);for(var L=y.substr(2),j=[],V=0;V<L.length/2;V++)j.push(parseInt(L.substr(2*V,2),16));var q=[],G="";for(V=0;V<j.length;V++)128&j[V]?G+=Ef((127&j[V]).toString(2),7):(G+=Ef((127&j[V]).toString(2),7),q.push(new String(parseInt(G,2))),G="");var Z=b.join(".");return q.length>0&&(Z=Z+"."+q.join(".")),Z}catch{return null}}(X.getV(s,o))}catch{return c}},X.getOIDName=function(s,o,c){c==null&&(c=null);try{var h=X.getOID(s,o,c);if(h==c)return c;var y=p.asn1.x509.OID.oid2name(h);return y==""?h:y}catch{return c}},X.getString=function(s,o,c){c==null&&(c=null);try{return rr(X.getV(s,o))}catch{return c}},X.hextooidstr=function(s){var o=function(G,Z){return G.length>=Z?G:new Array(Z-G.length+1).join("0")+G},c=[],h=s.substr(0,2),y=parseInt(h,16);c[0]=new String(Math.floor(y/40)),c[1]=new String(y%40);for(var b=s.substr(2),R=[],B=0;B<b.length/2;B++)R.push(parseInt(b.substr(2*B,2),16));var L=[],j="";for(B=0;B<R.length;B++)128&R[B]?j+=o((127&R[B]).toString(2),7):(j+=o((127&R[B]).toString(2),7),L.push(new String(parseInt(j,2))),j="");var V=c.join(".");return L.length>0&&(V=V+"."+L.join(".")),V},X.dump=function(s,o,c,h){var y=X,b=y.getV,R=y.dump,B=y.getChildIdx,L=s;s instanceof p.asn1.ASN1Object&&(L=s.getEncodedHex());var j=function(ge,Ne){return ge.length<=2*Ne?ge:ge.substr(0,Ne)+"..(total "+ge.length/2+"bytes).."+ge.substr(ge.length-Ne,Ne)};o===void 0&&(o={ommit_long_octet:32}),c===void 0&&(c=0),h===void 0&&(h="");var V,q=o.ommit_long_octet;if((V=L.substr(c,2))=="01")return(G=b(L,c))=="00"?h+`BOOLEAN FALSE
`:h+`BOOLEAN TRUE
`;if(V=="02")return h+"INTEGER "+j(G=b(L,c),q)+`
`;if(V=="03"){var G=b(L,c);if(y.isASN1HEX(G.substr(2))){var Z=h+`BITSTRING, encapsulates
`;return Z+=R(G.substr(2),o,0,h+"  ")}return h+"BITSTRING "+j(G,q)+`
`}if(V=="04")return G=b(L,c),y.isASN1HEX(G)?(Z=h+`OCTETSTRING, encapsulates
`,Z+=R(G,o,0,h+"  ")):h+"OCTETSTRING "+j(G,q)+`
`;if(V=="05")return h+`NULL
`;if(V=="06"){var re=b(L,c),ce=p.asn1.ASN1Util.oidHexToInt(re),le=p.asn1.x509.OID.oid2name(ce),T=ce.replace(/\./g," ");return le!=""?h+"ObjectIdentifier "+le+" ("+T+`)
`:h+"ObjectIdentifier ("+T+`)
`}if(V=="0a")return h+"ENUMERATED "+parseInt(b(L,c))+`
`;if(V=="0c")return h+"UTF8String '"+vt(b(L,c))+`'
`;if(V=="13")return h+"PrintableString '"+vt(b(L,c))+`'
`;if(V=="14")return h+"TeletexString '"+vt(b(L,c))+`'
`;if(V=="16")return h+"IA5String '"+vt(b(L,c))+`'
`;if(V=="17")return h+"UTCTime "+vt(b(L,c))+`
`;if(V=="18")return h+"GeneralizedTime "+vt(b(L,c))+`
`;if(V=="1a")return h+"VisualString '"+vt(b(L,c))+`'
`;if(V=="1e")return h+"BMPString '"+vf(b(L,c))+`'
`;if(V=="30"){if(L.substr(c,4)=="3000")return h+`SEQUENCE {}
`;Z=h+`SEQUENCE
`;var K=o;if(((se=B(L,c)).length==2||se.length==3)&&L.substr(se[0],2)=="06"&&L.substr(se[se.length-1],2)=="04"){le=y.oidname(b(L,se[0]));var W=JSON.parse(JSON.stringify(o));W.x509ExtName=le,K=W}for(var J=0;J<se.length;J++)Z+=R(L,K,se[J],h+"  ");return Z}if(V=="31"){Z=h+`SET
`;var se=B(L,c);for(J=0;J<se.length;J++)Z+=R(L,o,se[J],h+"  ");return Z}if(128&(V=parseInt(V,16))){var fe=31&V;if(32&V){for(Z=h+"["+fe+`]
`,se=B(L,c),J=0;J<se.length;J++)Z+=R(L,o,se[J],h+"  ");return Z}if(G=b(L,c),X.isASN1HEX(G)){var Z=h+"["+fe+`]
`;return Z+=R(G,o,0,h+"  ")}return(G.substr(0,8)=="68747470"||o.x509ExtName==="subjectAltName"&&fe==2)&&(G=vt(G)),Z=h+"["+fe+"] "+G+`
`}return h+"UNKNOWN("+V+") "+b(L,c)+`
`},X.isContextTag=function(s,o){var c,h;s=s.toLowerCase();try{c=parseInt(s,16)}catch{return-1}if(o===void 0)return(192&c)==128;try{return o.match(/^\[[0-9]+\]$/)!=null&&!((h=parseInt(o.substr(1,o.length-1),10))>31)&&(192&c)==128&&(31&c)==h}catch{return!1}},X.isASN1HEX=function(s){var o=X;if(s.length%2==1)return!1;var c=o.getVblen(s,0),h=s.substr(0,2),y=o.getL(s,0);return s.length-h.length-y.length==2*c},X.checkStrictDER=function(s,o,c,h,y){var b=X;if(c===void 0){if(typeof s!="string")throw new Error("not hex string");if(s=s.toLowerCase(),!p.lang.String.isHex(s))throw new Error("not hex string");c=s.length,y=(h=s.length/2)<128?1:Math.ceil(h.toString(16))+1}if(b.getL(s,o).length>2*y)throw new Error("L of TLV too long: idx="+o);var R=b.getVblen(s,o);if(R>h)throw new Error("value of L too long than hex: idx="+o);var B=b.getTLV(s,o),L=B.length-2-b.getL(s,o).length;if(L!==2*R)throw new Error("V string length and L's value not the same:"+L+"/"+2*R);if(o===0&&s.length!=B.length)throw new Error("total length and TLV length unmatch:"+s.length+"!="+B.length);var j=s.substr(o,2);if(j==="02"){var V=b.getVidx(s,o);if(s.substr(V,2)=="00"&&s.charCodeAt(V+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(j,16)){for(var q=b.getVblen(s,o),G=0,Z=b.getChildIdx(s,o),re=0;re<Z.length;re++)G+=b.getTLV(s,Z[re]).length,b.checkStrictDER(s,Z[re],c,h,y);if(2*q!=G)throw new Error("sum of children's TLV length and L unmatch: "+2*q+"!="+G)}},X.oidname=function(s){var o=p.asn1;p.lang.String.isHex(s)&&(s=o.ASN1Util.oidHexToInt(s));var c=o.x509.OID.oid2name(s);return c===""&&(c=s),c},p!==void 0&&p||(e.KJUR=p={}),p.lang!==void 0&&p.lang||(p.lang={}),p.lang.String=function(){},typeof n=="function"?(e.utf8tob64u=H=function(o){return Ge(n.from(o,"utf8").toString("base64"))},e.b64utoutf8=ee=function(o){return n.from(He(o),"base64").toString("utf8")}):(e.utf8tob64u=H=function(o){return bt(Co(Po(o)))},e.b64utoutf8=ee=function(o){return decodeURIComponent(Fo(Ze(o)))}),p.lang.String.isInteger=function(s){return!!s.match(/^[0-9]+$/)||!!s.match(/^-[0-9]+$/)},p.lang.String.isHex=function(s){return Sf(s)},p.lang.String.isBase64=function(s){return!(!(s=s.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||s.length%4!=0)},p.lang.String.isBase64URL=function(s){return!s.match(/[+/=]/)&&(s=He(s),p.lang.String.isBase64(s))},p.lang.String.isIntegerArray=function(s){return!!(s=s.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},p.lang.String.isPrintable=function(s){return s.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},p.lang.String.isIA5=function(s){return s.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},p.lang.String.isMail=function(s){return s.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var Ef=function(o,c,h){return h==null&&(h="0"),o.length>=c?o:new Array(c-o.length+1).join(h)+o};function at(s,o){var c=function(){};c.prototype=o.prototype,s.prototype=new c,s.prototype.constructor=s,s.superclass=o.prototype,o.prototype.constructor==Object.prototype.constructor&&(o.prototype.constructor=o)}p!==void 0&&p||(e.KJUR=p={}),p.crypto!==void 0&&p.crypto||(p.crypto={}),p.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:U.algo.MD5,sha1:U.algo.SHA1,sha224:U.algo.SHA224,sha256:U.algo.SHA256,sha384:U.algo.SHA384,sha512:U.algo.SHA512,ripemd160:U.algo.RIPEMD160},this.getDigestInfoHex=function(s,o){if(this.DIGESTINFOHEAD[o]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+o;return this.DIGESTINFOHEAD[o]+s},this.getPaddedDigestInfoHex=function(s,o,c){var h=this.getDigestInfoHex(s,o),y=c/4;if(h.length+22>y)throw"key is too short for SigAlg: keylen="+c+","+o;for(var b="0001",R="00"+h,B="",L=y-b.length-R.length,j=0;j<L;j+=2)B+="ff";return b+B+R},this.hashString=function(s,o){return new p.crypto.MessageDigest({alg:o}).digestString(s)},this.hashHex=function(s,o){return new p.crypto.MessageDigest({alg:o}).digestHex(s)},this.sha1=function(s){return this.hashString(s,"sha1")},this.sha256=function(s){return this.hashString(s,"sha256")},this.sha256Hex=function(s){return this.hashHex(s,"sha256")},this.sha512=function(s){return this.hashString(s,"sha512")},this.sha512Hex=function(s){return this.hashHex(s,"sha512")},this.isKey=function(s){return s instanceof Se||s instanceof p.crypto.DSA||s instanceof p.crypto.ECDSA}},p.crypto.Util.md5=function(s){return new p.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(s)},p.crypto.Util.ripemd160=function(s){return new p.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(s)},p.crypto.Util.SECURERANDOMGEN=new Me,p.crypto.Util.getRandomHexOfNbytes=function(s){var o=new Array(s);return p.crypto.Util.SECURERANDOMGEN.nextBytes(o),Je(o)},p.crypto.Util.getRandomBigIntegerOfNbytes=function(s){return new M(p.crypto.Util.getRandomHexOfNbytes(s),16)},p.crypto.Util.getRandomHexOfNbits=function(s){var o=s%8,c=new Array((s-o)/8+1);return p.crypto.Util.SECURERANDOMGEN.nextBytes(c),c[0]=(255<<o&255^255)&c[0],Je(c)},p.crypto.Util.getRandomBigIntegerOfNbits=function(s){return new M(p.crypto.Util.getRandomHexOfNbits(s),16)},p.crypto.Util.getRandomBigIntegerZeroToMax=function(s){for(var o=s.bitLength();;){var c=p.crypto.Util.getRandomBigIntegerOfNbits(o);if(s.compareTo(c)!=-1)return c}},p.crypto.Util.getRandomBigIntegerMinToMax=function(s,o){var c=s.compareTo(o);if(c==1)throw"biMin is greater than biMax";if(c==0)return s;var h=o.subtract(s);return p.crypto.Util.getRandomBigIntegerZeroToMax(h).add(s)},p.crypto.MessageDigest=function(s){this.setAlgAndProvider=function(o,c){if((o=p.crypto.MessageDigest.getCanonicalAlgName(o))!==null&&c===void 0&&(c=p.crypto.Util.DEFAULTPROVIDER[o]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(o)!=-1&&c=="cryptojs"){try{this.md=p.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[o].create()}catch(h){throw"setAlgAndProvider hash alg set fail alg="+o+"/"+h}this.updateString=function(h){this.md.update(h)},this.updateHex=function(h){var y=U.enc.Hex.parse(h);this.md.update(y)},this.digest=function(){return this.md.finalize().toString(U.enc.Hex)},this.digestString=function(h){return this.updateString(h),this.digest()},this.digestHex=function(h){return this.updateHex(h),this.digest()}}if(":sha256:".indexOf(o)!=-1&&c=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(h){throw"setAlgAndProvider hash alg set fail alg="+o+"/"+h}this.updateString=function(h){this.md.update(h)},this.updateHex=function(h){var y=sjcl.codec.hex.toBits(h);this.md.update(y)},this.digest=function(){var h=this.md.finalize();return sjcl.codec.hex.fromBits(h)},this.digestString=function(h){return this.updateString(h),this.digest()},this.digestHex=function(h){return this.updateHex(h),this.digest()}}},this.updateString=function(o){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(o){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(o){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(o){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},s!==void 0&&s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},p.crypto.MessageDigest.getCanonicalAlgName=function(s){return typeof s=="string"&&(s=(s=s.toLowerCase()).replace(/-/,"")),s},p.crypto.MessageDigest.getHashLength=function(s){var o=p.crypto.MessageDigest,c=o.getCanonicalAlgName(s);if(o.HASHLENGTH[c]===void 0)throw"not supported algorithm: "+s;return o.HASHLENGTH[c]},p.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},p.crypto.Mac=function(s){this.setAlgAndProvider=function(o,c){if((o=o.toLowerCase())==null&&(o="hmacsha1"),(o=o.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+o;c===void 0&&(c=p.crypto.Util.DEFAULTPROVIDER[o]),this.algProv=o+"/"+c;var h=o.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(h)!=-1&&c=="cryptojs"){try{var y=p.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[h];this.mac=U.algo.HMAC.create(y,this.pass)}catch(b){throw"setAlgAndProvider hash alg set fail hashAlg="+h+"/"+b}this.updateString=function(b){this.mac.update(b)},this.updateHex=function(b){var R=U.enc.Hex.parse(b);this.mac.update(R)},this.doFinal=function(){return this.mac.finalize().toString(U.enc.Hex)},this.doFinalString=function(b){return this.updateString(b),this.doFinal()},this.doFinalHex=function(b){return this.updateHex(b),this.doFinal()}}},this.updateString=function(o){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(o){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(o){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(o){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(o){if(typeof o=="string"){var c=o;return o.length%2!=1&&o.match(/^[0-9A-Fa-f]+$/)||(c=br(o)),void(this.pass=U.enc.Hex.parse(c))}if((o===void 0?"undefined":A(o))!="object")throw"KJUR.crypto.Mac unsupported password type: "+o;if(c=null,o.hex!==void 0){if(o.hex.length%2!=0||!o.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+o.hex;c=o.hex}if(o.utf8!==void 0&&(c=Qa(o.utf8)),o.rstr!==void 0&&(c=br(o.rstr)),o.b64!==void 0&&(c=te(o.b64)),o.b64u!==void 0&&(c=Ze(o.b64u)),c==null)throw"KJUR.crypto.Mac unsupported password type: "+o;this.pass=U.enc.Hex.parse(c)},s!==void 0&&(s.pass!==void 0&&this.setPassword(s.pass),s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},p.crypto.Signature=function(s){var o=null;if(this._setAlgNames=function(){var c=this.algName.match(/^(.+)with(.+)$/);c&&(this.mdAlgName=c[1].toLowerCase(),this.pubkeyAlgName=c[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(c,h){for(var y="",b=h/4-c.length,R=0;R<b;R++)y+="0";return y+c},this.setAlgAndProvider=function(c,h){if(this._setAlgNames(),h!="cryptojs/jsrsa")throw new Error("provider not supported: "+h);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new p.crypto.MessageDigest({alg:this.mdAlgName})}catch(y){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+y)}this.init=function(y,b){var R=null;try{R=b===void 0?yt.getKey(y):yt.getKey(y,b)}catch(B){throw"init failed:"+B}if(R.isPrivate===!0)this.prvKey=R,this.state="SIGN";else{if(R.isPublic!==!0)throw"init failed.:"+R;this.pubKey=R,this.state="VERIFY"}},this.updateString=function(y){this.md.updateString(y)},this.updateHex=function(y){this.md.updateHex(y)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&p.crypto.ECDSA!==void 0&&(this.prvKey=new p.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Se&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Se&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof p.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof p.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(y){return this.updateString(y),this.sign()},this.signHex=function(y){return this.updateHex(y),this.sign()},this.verify=function(y){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&p.crypto.ECDSA!==void 0&&(this.pubKey=new p.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Se&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,y,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Se&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(p.crypto.ECDSA!==void 0&&this.pubKey instanceof p.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(p.crypto.DSA!==void 0&&this.pubKey instanceof p.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(c,h){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(c){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(c){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(c){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(c){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(c){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=s,s!==void 0&&(s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0?this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=s.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),s.psssaltlen!==void 0&&(this.pssSaltLen=s.psssaltlen),s.prvkeypem!==void 0)){if(s.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{o=yt.getKey(s.prvkeypem),this.init(o)}catch(c){throw"fatal error to load pem private key: "+c}}},p.crypto.Cipher=function(s){},p.crypto.Cipher.encrypt=function(s,o,c){if(o instanceof Se&&o.isPublic){var h=p.crypto.Cipher.getAlgByKeyAndName(o,c);if(h==="RSA")return o.encrypt(s);if(h==="RSAOAEP")return o.encryptOAEP(s,"sha1");var y=h.match(/^RSAOAEP(\d+)$/);if(y!==null)return o.encryptOAEP(s,"sha"+y[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.encrypt: unsupported key or algorithm"},p.crypto.Cipher.decrypt=function(s,o,c){if(o instanceof Se&&o.isPrivate){var h=p.crypto.Cipher.getAlgByKeyAndName(o,c);if(h==="RSA")return o.decrypt(s);if(h==="RSAOAEP")return o.decryptOAEP(s,"sha1");var y=h.match(/^RSAOAEP(\d+)$/);if(y!==null)return o.decryptOAEP(s,"sha"+y[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.decrypt: unsupported key or algorithm"},p.crypto.Cipher.getAlgByKeyAndName=function(s,o){if(s instanceof Se){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(o)!=-1)return o;if(o==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+o}throw"getAlgByKeyAndName: not supported algorithm name: "+o},p.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},p!==void 0&&p||(e.KJUR=p={}),p.crypto!==void 0&&p.crypto||(p.crypto={}),p.crypto.ECDSA=function(s){var o=Error,c=M,h=Pe,y=p.crypto.ECDSA,b=p.crypto.ECParameterDB,R=y.getName,B=X,L=B.getVbyListEx,j=B.isASN1HEX,V=new Me;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(q){return new c(q.bitLength(),V).mod(q.subtract(c.ONE)).add(c.ONE)},this.setNamedCurve=function(q){this.ecparams=b.getByName(q),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=q},this.setPrivateKeyHex=function(q){this.isPrivate=!0,this.prvKeyHex=q},this.setPublicKeyHex=function(q){this.isPublic=!0,this.pubKeyHex=q},this.getPublicKeyXYHex=function(){var q=this.pubKeyHex;if(q.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var G=this.ecparams.keylen/4;if(q.length!==2+2*G)throw"malformed public key hex length";var Z={};return Z.x=q.substr(2,G),Z.y=q.substr(2+G),Z},this.getShortNISTPCurveName=function(){var q=this.curveName;return q==="secp256r1"||q==="NIST P-256"||q==="P-256"||q==="prime256v1"?"P-256":q==="secp384r1"||q==="NIST P-384"||q==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var q=this.ecparams.n,G=this.getBigRandom(q),Z=this.ecparams.G.multiply(G),re=Z.getX().toBigInteger(),ce=Z.getY().toBigInteger(),le=this.ecparams.keylen/4,T=("0000000000"+G.toString(16)).slice(-le),K="04"+("0000000000"+re.toString(16)).slice(-le)+("0000000000"+ce.toString(16)).slice(-le);return this.setPrivateKeyHex(T),this.setPublicKeyHex(K),{ecprvhex:T,ecpubhex:K}},this.signWithMessageHash=function(q){return this.signHex(q,this.prvKeyHex)},this.signHex=function(q,G){var Z=new c(G,16),re=this.ecparams.n,ce=new c(q.substring(0,this.ecparams.keylen/4),16);do var le=this.getBigRandom(re),T=this.ecparams.G.multiply(le).getX().toBigInteger().mod(re);while(T.compareTo(c.ZERO)<=0);var K=le.modInverse(re).multiply(ce.add(Z.multiply(T))).mod(re);return y.biRSSigToASN1Sig(T,K)},this.sign=function(q,G){var Z=G,re=this.ecparams.n,ce=c.fromByteArrayUnsigned(q);do var le=this.getBigRandom(re),T=this.ecparams.G.multiply(le).getX().toBigInteger().mod(re);while(T.compareTo(M.ZERO)<=0);var K=le.modInverse(re).multiply(ce.add(Z.multiply(T))).mod(re);return this.serializeSig(T,K)},this.verifyWithMessageHash=function(q,G){return this.verifyHex(q,G,this.pubKeyHex)},this.verifyHex=function(q,G,Z){try{var re,ce,le=y.parseSigHex(G);re=le.r,ce=le.s;var T=h.decodeFromHex(this.ecparams.curve,Z),K=new c(q.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(K,re,ce,T)}catch{return!1}},this.verify=function(q,G,Z){var re,ce,le;if(Bitcoin.Util.isArray(G)){var T=this.parseSig(G);re=T.r,ce=T.s}else{if((G===void 0?"undefined":A(G))!=="object"||!G.r||!G.s)throw"Invalid value for signature";re=G.r,ce=G.s}if(Z instanceof Pe)le=Z;else{if(!Bitcoin.Util.isArray(Z))throw"Invalid format for pubkey value, must be byte array or ECPointFp";le=h.decodeFrom(this.ecparams.curve,Z)}var K=c.fromByteArrayUnsigned(q);return this.verifyRaw(K,re,ce,le)},this.verifyRaw=function(q,G,Z,re){var ce=this.ecparams.n,le=this.ecparams.G;if(G.compareTo(c.ONE)<0||G.compareTo(ce)>=0||Z.compareTo(c.ONE)<0||Z.compareTo(ce)>=0)return!1;var T=Z.modInverse(ce),K=q.multiply(T).mod(ce),W=G.multiply(T).mod(ce);return le.multiply(K).add(re.multiply(W)).getX().toBigInteger().mod(ce).equals(G)},this.serializeSig=function(q,G){var Z=q.toByteArraySigned(),re=G.toByteArraySigned(),ce=[];return ce.push(2),ce.push(Z.length),(ce=ce.concat(Z)).push(2),ce.push(re.length),(ce=ce.concat(re)).unshift(ce.length),ce.unshift(48),ce},this.parseSig=function(q){var G;if(q[0]!=48)throw new Error("Signature not a valid DERSequence");if(q[G=2]!=2)throw new Error("First element in signature must be a DERInteger");var Z=q.slice(G+2,G+2+q[G+1]);if(q[G+=2+q[G+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var re=q.slice(G+2,G+2+q[G+1]);return G+=2+q[G+1],{r:c.fromByteArrayUnsigned(Z),s:c.fromByteArrayUnsigned(re)}},this.parseSigCompact=function(q){if(q.length!==65)throw"Signature has the wrong length";var G=q[0]-27;if(G<0||G>7)throw"Invalid signature type";var Z=this.ecparams.n;return{r:c.fromByteArrayUnsigned(q.slice(1,33)).mod(Z),s:c.fromByteArrayUnsigned(q.slice(33,65)).mod(Z),i:G}},this.readPKCS5PrvKeyHex=function(q){if(j(q)===!1)throw new Error("not ASN.1 hex string");var G,Z,re;try{G=L(q,0,["[0]",0],"06"),Z=L(q,0,[1],"04");try{re=L(q,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=R(G),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(re),this.setPrivateKeyHex(Z),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(q){if(j(q)===!1)throw new o("not ASN.1 hex string");var G,Z,re;try{L(q,0,[1,0],"06"),G=L(q,0,[1,1],"06"),Z=L(q,0,[2,0,1],"04");try{re=L(q,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new o("malformed PKCS#8 plain ECC private key")}if(this.curveName=R(G),this.curveName===void 0)throw new o("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(re),this.setPrivateKeyHex(Z),this.isPublic=!1},this.readPKCS8PubKeyHex=function(q){if(j(q)===!1)throw new o("not ASN.1 hex string");var G,Z;try{L(q,0,[0,0],"06"),G=L(q,0,[0,1],"06"),Z=L(q,0,[1],"03")}catch{throw new o("malformed PKCS#8 ECC public key")}if(this.curveName=R(G),this.curveName===null)throw new o("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(Z)},this.readCertPubKeyHex=function(q,G){if(j(q)===!1)throw new o("not ASN.1 hex string");var Z,re;try{Z=L(q,0,[0,5,0,1],"06"),re=L(q,0,[0,5,1],"03")}catch{throw new o("malformed X.509 certificate ECC public key")}if(this.curveName=R(Z),this.curveName===null)throw new o("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(re)},s!==void 0&&s.curve!==void 0&&(this.curveName=s.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),s!==void 0&&(s.prv!==void 0&&this.setPrivateKeyHex(s.prv),s.pub!==void 0&&this.setPublicKeyHex(s.pub))},p.crypto.ECDSA.parseSigHex=function(s){var o=p.crypto.ECDSA.parseSigHexInHexRS(s);return{r:new M(o.r,16),s:new M(o.s,16)}},p.crypto.ECDSA.parseSigHexInHexRS=function(s){var o=X,c=o.getChildIdx,h=o.getV;if(o.checkStrictDER(s,0),s.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var y=c(s,0);if(y.length!=2)throw new Error("signature shall have two elements");var b=y[0],R=y[1];if(s.substr(b,2)!="02")throw new Error("1st item not ASN.1 integer");if(s.substr(R,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:h(s,b),s:h(s,R)}},p.crypto.ECDSA.asn1SigToConcatSig=function(s){var o=p.crypto.ECDSA.parseSigHexInHexRS(s),c=o.r,h=o.s;if(c.substr(0,2)=="00"&&c.length%32==2&&(c=c.substr(2)),h.substr(0,2)=="00"&&h.length%32==2&&(h=h.substr(2)),c.length%32==30&&(c="00"+c),h.length%32==30&&(h="00"+h),c.length%32!=0)throw"unknown ECDSA sig r length error";if(h.length%32!=0)throw"unknown ECDSA sig s length error";return c+h},p.crypto.ECDSA.concatSigToASN1Sig=function(s){if(s.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var o=s.substr(0,s.length/2),c=s.substr(s.length/2);return p.crypto.ECDSA.hexRSSigToASN1Sig(o,c)},p.crypto.ECDSA.hexRSSigToASN1Sig=function(s,o){var c=new M(s,16),h=new M(o,16);return p.crypto.ECDSA.biRSSigToASN1Sig(c,h)},p.crypto.ECDSA.biRSSigToASN1Sig=function(s,o){var c=p.asn1,h=new c.DERInteger({bigint:s}),y=new c.DERInteger({bigint:o});return new c.DERSequence({array:[h,y]}).getEncodedHex()},p.crypto.ECDSA.getName=function(s){return s==="2b8104001f"?"secp192k1":s==="2a8648ce3d030107"?"secp256r1":s==="2b8104000a"?"secp256k1":s==="2b81040021"?"secp224r1":s==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(s)!==-1?"secp256r1":"|secp256k1|".indexOf(s)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(s)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(s)!==-1?"secp384r1":null},p!==void 0&&p||(e.KJUR=p={}),p.crypto!==void 0&&p.crypto||(p.crypto={}),p.crypto.ECParameterDB=new function(){var s={},o={};function c(h){return new M(h,16)}this.getByName=function(h){var y=h;if(o[y]!==void 0&&(y=o[h]),s[y]!==void 0)return s[y];throw"unregistered EC curve name: "+y},this.regist=function(h,y,b,R,B,L,j,V,q,G,Z,re){s[h]={};var ce=c(b),le=c(R),T=c(B),K=c(L),W=c(j),J=new C(ce,le,T),se=J.decodePointHex("04"+V+q);s[h].name=h,s[h].keylen=y,s[h].curve=J,s[h].G=se,s[h].n=K,s[h].h=W,s[h].oid=Z,s[h].info=re;for(var fe=0;fe<G.length;fe++)o[G[fe]]=h}},p.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),p.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),p.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),p.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),p.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),p.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),p.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),p.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),p.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),p.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var yt=function(){var s=function(j,V,q){return o(U.AES,j,V,q)},o=function(j,V,q,G){var Z=U.enc.Hex.parse(V),re=U.enc.Hex.parse(q),ce=U.enc.Hex.parse(G),le={};le.key=re,le.iv=ce,le.ciphertext=Z;var T=j.decrypt(le,re,{iv:ce});return U.enc.Hex.stringify(T)},c=function(j,V,q){return h(U.AES,j,V,q)},h=function(j,V,q,G){var Z=U.enc.Hex.parse(V),re=U.enc.Hex.parse(q),ce=U.enc.Hex.parse(G),le=j.encrypt(Z,re,{iv:ce}),T=U.enc.Hex.parse(le.toString());return U.enc.Base64.stringify(T)},y={"AES-256-CBC":{proc:s,eproc:c,keylen:32,ivlen:16},"AES-192-CBC":{proc:s,eproc:c,keylen:24,ivlen:16},"AES-128-CBC":{proc:s,eproc:c,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(j,V,q){return o(U.TripleDES,j,V,q)},eproc:function(j,V,q){return h(U.TripleDES,j,V,q)},keylen:24,ivlen:8},"DES-CBC":{proc:function(j,V,q){return o(U.DES,j,V,q)},eproc:function(j,V,q){return h(U.DES,j,V,q)},keylen:8,ivlen:8}},b=function(j){var V={},q=j.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));q&&(V.cipher=q[1],V.ivsalt=q[2]);var G=j.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));G&&(V.type=G[1]);var Z=-1,re=0;j.indexOf(`\r
\r
`)!=-1&&(Z=j.indexOf(`\r
\r
`),re=2),j.indexOf(`

`)!=-1&&(Z=j.indexOf(`

`),re=1);var ce=j.indexOf("-----END");if(Z!=-1&&ce!=-1){var le=j.substring(Z+2*re,ce-re);le=le.replace(/\s+/g,""),V.data=le}return V},R=function(j,V,q){for(var G=q.substring(0,16),Z=U.enc.Hex.parse(G),re=U.enc.Utf8.parse(V),ce=y[j].keylen+y[j].ivlen,le="",T=null;;){var K=U.algo.MD5.create();if(T!=null&&K.update(T),K.update(re),K.update(Z),T=K.finalize(),(le+=U.enc.Hex.stringify(T)).length>=2*ce)break}var W={};return W.keyhex=le.substr(0,2*y[j].keylen),W.ivhex=le.substr(2*y[j].keylen,2*y[j].ivlen),W},B=function(j,V,q,G){var Z=U.enc.Base64.parse(j),re=U.enc.Hex.stringify(Z);return(0,y[V].proc)(re,q,G)};return{version:"1.0.0",parsePKCS5PEM:function(j){return b(j)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(j,V,q){return R(j,V,q)},decryptKeyB64:function(j,V,q,G){return B(j,V,q,G)},getDecryptedKeyHex:function(j,V){var q=b(j),G=(q.type,q.cipher),Z=q.ivsalt,re=q.data,ce=R(G,V,Z).keyhex;return B(re,G,ce,Z)},getEncryptedPKCS5PEMFromPrvKeyHex:function(j,V,q,G,Z){var re="";if(G!==void 0&&G!=null||(G="AES-256-CBC"),y[G]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+G);Z!==void 0&&Z!=null||(Z=function(T){var K=U.lib.WordArray.random(T);return U.enc.Hex.stringify(K)}(y[G].ivlen).toUpperCase());var ce=function(T,K,W,J){return(0,y[K].eproc)(T,W,J)}(V,G,R(G,q,Z).keyhex,Z);return re="-----BEGIN "+j+` PRIVATE KEY-----\r
`,re+=`Proc-Type: 4,ENCRYPTED\r
`,re+="DEK-Info: "+G+","+Z+`\r
`,re+=`\r
`,re+=ce.replace(/(.{64})/g,`$1\r
`),re+=`\r
-----END `+j+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(j){var V=X,q=V.getChildIdx,G=V.getV,Z={},re=q(j,0);if(re.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+re.length);Z.ciphertext=G(j,re[1]);var ce=q(j,re[0]);if(ce.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+ce.length);if(G(j,ce[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var le=q(j,ce[1]);if(ce.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+le.length);var T=q(j,le[1]);if(T.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+T.length);if(G(j,T[0])!="2a864886f70d0307")throw"this only supports TripleDES";Z.encryptionSchemeAlg="TripleDES",Z.encryptionSchemeIV=G(j,T[1]);var K=q(j,le[0]);if(K.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+K.length);if(G(j,K[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var W=q(j,K[1]);if(W.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+W.length);Z.pbkdf2Salt=G(j,W[0]);var J=G(j,W[1]);try{Z.pbkdf2Iter=parseInt(J,16)}catch{throw new Error("malformed format pbkdf2Iter: "+J)}return Z},getPBKDF2KeyHexFromParam:function(j,V){var q=U.enc.Hex.parse(j.pbkdf2Salt),G=j.pbkdf2Iter,Z=U.PBKDF2(V,q,{keySize:6,iterations:G});return U.enc.Hex.stringify(Z)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(j,V){var q=vr(j,"ENCRYPTED PRIVATE KEY"),G=this.parseHexOfEncryptedPKCS8(q),Z=yt.getPBKDF2KeyHexFromParam(G,V),re={};re.ciphertext=U.enc.Hex.parse(G.ciphertext);var ce=U.enc.Hex.parse(Z),le=U.enc.Hex.parse(G.encryptionSchemeIV),T=U.TripleDES.decrypt(re,ce,{iv:le});return U.enc.Hex.stringify(T)},getKeyFromEncryptedPKCS8PEM:function(j,V){var q=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(j,V);return this.getKeyFromPlainPrivatePKCS8Hex(q)},parsePlainPrivatePKCS8Hex:function(j){var V=X,q=V.getChildIdx,G=V.getV,Z={algparam:null};if(j.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var re=q(j,0);if(re.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(j.substr(re[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var ce=q(j,re[1]);if(ce.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(j.substr(ce[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(Z.algoid=G(j,ce[0]),j.substr(ce[1],2)=="06"&&(Z.algparam=G(j,ce[1])),j.substr(re[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return Z.keyidx=V.getVidx(j,re[2]),Z},getKeyFromPlainPrivatePKCS8PEM:function(j){var V=vr(j,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(V)},getKeyFromPlainPrivatePKCS8Hex:function(j){var V,q=this.parsePlainPrivatePKCS8Hex(j);if(q.algoid=="2a864886f70d010101")V=new Se;else if(q.algoid=="2a8648ce380401")V=new p.crypto.DSA;else{if(q.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");V=new p.crypto.ECDSA}return V.readPKCS8PrvKeyHex(j),V},_getKeyFromPublicPKCS8Hex:function(j){var V,q=X.getVbyList(j,0,[0,0],"06");if(q==="2a864886f70d010101")V=new Se;else if(q==="2a8648ce380401")V=new p.crypto.DSA;else{if(q!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");V=new p.crypto.ECDSA}return V.readPKCS8PubKeyHex(j),V},parsePublicRawRSAKeyHex:function(j){var V=X,q=V.getChildIdx,G=V.getV,Z={};if(j.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var re=q(j,0);if(re.length!=2)throw new Error("malformed RSA key(code:002)");if(j.substr(re[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(Z.n=G(j,re[0]),j.substr(re[1],2)!="02")throw new Error("malformed RSA key(code:004)");return Z.e=G(j,re[1]),Z},parsePublicPKCS8Hex:function(j){var V=X,q=V.getChildIdx,G=V.getV,Z={algparam:null},re=q(j,0);if(re.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+re.length);var ce=re[0];if(j.substr(ce,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var le=q(j,ce);if(le.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(j.substr(le[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(Z.algoid=G(j,le[0]),j.substr(le[1],2)=="06"?Z.algparam=G(j,le[1]):j.substr(le[1],2)=="30"&&(Z.algparam={},Z.algparam.p=V.getVbyList(j,le[1],[0],"02"),Z.algparam.q=V.getVbyList(j,le[1],[1],"02"),Z.algparam.g=V.getVbyList(j,le[1],[2],"02")),j.substr(re[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return Z.key=G(j,re[1]).substr(2),Z}}}();yt.getKey=function(s,o,c){var h=(le=X).getChildIdx,y=(le.getV,le.getVbyList),b=p.crypto,R=b.ECDSA,B=b.DSA,L=Se,j=vr,V=yt;if(L!==void 0&&s instanceof L||R!==void 0&&s instanceof R||B!==void 0&&s instanceof B)return s;if(s.curve!==void 0&&s.xy!==void 0&&s.d===void 0)return new R({pub:s.xy,curve:s.curve});if(s.curve!==void 0&&s.d!==void 0)return new R({prv:s.d,curve:s.curve});if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(Ee=new L).setPublic(s.n,s.e),Ee;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.co!==void 0&&s.qi===void 0)return(Ee=new L).setPrivateEx(s.n,s.e,s.d,s.p,s.q,s.dp,s.dq,s.co),Ee;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p===void 0)return(Ee=new L).setPrivate(s.n,s.e,s.d),Ee;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x===void 0)return(Ee=new B).setPublic(s.p,s.q,s.g,s.y),Ee;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x!==void 0)return(Ee=new B).setPrivate(s.p,s.q,s.g,s.y,s.x),Ee;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(Ee=new L).setPublic(Ze(s.n),Ze(s.e)),Ee;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.qi!==void 0)return(Ee=new L).setPrivateEx(Ze(s.n),Ze(s.e),Ze(s.d),Ze(s.p),Ze(s.q),Ze(s.dp),Ze(s.dq),Ze(s.qi)),Ee;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0)return(Ee=new L).setPrivate(Ze(s.n),Ze(s.e),Ze(s.d)),Ee;if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d===void 0){var q=(we=new R({curve:s.crv})).ecparams.keylen/4,G="04"+("0000000000"+Ze(s.x)).slice(-q)+("0000000000"+Ze(s.y)).slice(-q);return we.setPublicKeyHex(G),we}if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d!==void 0){q=(we=new R({curve:s.crv})).ecparams.keylen/4,G="04"+("0000000000"+Ze(s.x)).slice(-q)+("0000000000"+Ze(s.y)).slice(-q);var Z=("0000000000"+Ze(s.d)).slice(-q);return we.setPublicKeyHex(G),we.setPrivateKeyHex(Z),we}if(c==="pkcs5prv"){var re,ce=s,le=X;if((re=h(ce,0)).length===9)(Ee=new L).readPKCS5PrvKeyHex(ce);else if(re.length===6)(Ee=new B).readPKCS5PrvKeyHex(ce);else{if(!(re.length>2&&ce.substr(re[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(Ee=new R).readPKCS5PrvKeyHex(ce)}return Ee}if(c==="pkcs8prv")return Ee=V.getKeyFromPlainPrivatePKCS8Hex(s);if(c==="pkcs8pub")return V._getKeyFromPublicPKCS8Hex(s);if(c==="x509pub")return St.getPublicKeyFromCertHex(s);if(s.indexOf("-END CERTIFICATE-",0)!=-1||s.indexOf("-END X509 CERTIFICATE-",0)!=-1||s.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return St.getPublicKeyFromCertPEM(s);if(s.indexOf("-END PUBLIC KEY-")!=-1){var T=vr(s,"PUBLIC KEY");return V._getKeyFromPublicPKCS8Hex(T)}if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var K=j(s,"RSA PRIVATE KEY");return V.getKey(K,null,"pkcs5prv")}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var W=y(et=j(s,"DSA PRIVATE KEY"),0,[1],"02"),J=y(et,0,[2],"02"),se=y(et,0,[3],"02"),fe=y(et,0,[4],"02"),be=y(et,0,[5],"02");return(Ee=new B).setPrivate(new M(W,16),new M(J,16),new M(se,16),new M(fe,16),new M(be,16)),Ee}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1)return K=j(s,"EC PRIVATE KEY"),V.getKey(K,null,"pkcs5prv");if(s.indexOf("-END PRIVATE KEY-")!=-1)return V.getKeyFromPlainPrivatePKCS8PEM(s);if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var ge=V.getDecryptedKeyHex(s,o),Ne=new Se;return Ne.readPKCS5PrvKeyHex(ge),Ne}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var we,Ee=y(et=V.getDecryptedKeyHex(s,o),0,[1],"04"),Ye=y(et,0,[2,0],"06"),rt=y(et,0,[3,0],"03").substr(2);if(p.crypto.OID.oidhex2name[Ye]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ye);return(we=new R({curve:p.crypto.OID.oidhex2name[Ye]})).setPublicKeyHex(rt),we.setPrivateKeyHex(Ee),we.isPublic=!1,we}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var et;return W=y(et=V.getDecryptedKeyHex(s,o),0,[1],"02"),J=y(et,0,[2],"02"),se=y(et,0,[3],"02"),fe=y(et,0,[4],"02"),be=y(et,0,[5],"02"),(Ee=new B).setPrivate(new M(W,16),new M(J,16),new M(se,16),new M(fe,16),new M(be,16)),Ee}if(s.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return V.getKeyFromEncryptedPKCS8PEM(s,o);throw new Error("not supported argument")},yt.generateKeypair=function(s,o){if(s=="RSA"){var c=o;(R=new Se).generate(c,"10001"),R.isPrivate=!0,R.isPublic=!0;var h=new Se,y=R.n.toString(16),b=R.e.toString(16);return h.setPublic(y,b),h.isPrivate=!1,h.isPublic=!0,(B={}).prvKeyObj=R,B.pubKeyObj=h,B}if(s=="EC"){var R,B,L=o,j=new p.crypto.ECDSA({curve:L}).generateKeyPairHex();return(R=new p.crypto.ECDSA({curve:L})).setPublicKeyHex(j.ecpubhex),R.setPrivateKeyHex(j.ecprvhex),R.isPrivate=!0,R.isPublic=!1,(h=new p.crypto.ECDSA({curve:L})).setPublicKeyHex(j.ecpubhex),h.isPrivate=!1,h.isPublic=!0,(B={}).prvKeyObj=R,B.pubKeyObj=h,B}throw new Error("unknown algorithm: "+s)},yt.getPEM=function(s,o,c,h,y,b){var R=p,B=R.asn1,L=B.DERObjectIdentifier,j=B.DERInteger,V=B.ASN1Util.newObject,q=B.x509.SubjectPublicKeyInfo,G=R.crypto,Z=G.DSA,re=G.ECDSA,ce=Se;function le(we){return V({seq:[{int:0},{int:{bigint:we.n}},{int:we.e},{int:{bigint:we.d}},{int:{bigint:we.p}},{int:{bigint:we.q}},{int:{bigint:we.dmp1}},{int:{bigint:we.dmq1}},{int:{bigint:we.coeff}}]})}function T(we){return V({seq:[{int:1},{octstr:{hex:we.prvKeyHex}},{tag:["a0",!0,{oid:{name:we.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+we.pubKeyHex}}]}]})}function K(we){return V({seq:[{int:0},{int:{bigint:we.p}},{int:{bigint:we.q}},{int:{bigint:we.g}},{int:{bigint:we.y}},{int:{bigint:we.x}}]})}if((ce!==void 0&&s instanceof ce||Z!==void 0&&s instanceof Z||re!==void 0&&s instanceof re)&&s.isPublic==1&&(o===void 0||o=="PKCS8PUB"))return Wt(fe=new q(s).getEncodedHex(),"PUBLIC KEY");if(o=="PKCS1PRV"&&ce!==void 0&&s instanceof ce&&(c===void 0||c==null)&&s.isPrivate==1)return Wt(fe=le(s).getEncodedHex(),"RSA PRIVATE KEY");if(o=="PKCS1PRV"&&re!==void 0&&s instanceof re&&(c===void 0||c==null)&&s.isPrivate==1){var W=new L({name:s.curveName}).getEncodedHex(),J=T(s).getEncodedHex(),se="";return se+=Wt(W,"EC PARAMETERS"),se+=Wt(J,"EC PRIVATE KEY")}if(o=="PKCS1PRV"&&Z!==void 0&&s instanceof Z&&(c===void 0||c==null)&&s.isPrivate==1)return Wt(fe=K(s).getEncodedHex(),"DSA PRIVATE KEY");if(o=="PKCS5PRV"&&ce!==void 0&&s instanceof ce&&c!==void 0&&c!=null&&s.isPrivate==1){var fe=le(s).getEncodedHex();return h===void 0&&(h="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",fe,c,h,b)}if(o=="PKCS5PRV"&&re!==void 0&&s instanceof re&&c!==void 0&&c!=null&&s.isPrivate==1)return fe=T(s).getEncodedHex(),h===void 0&&(h="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",fe,c,h,b);if(o=="PKCS5PRV"&&Z!==void 0&&s instanceof Z&&c!==void 0&&c!=null&&s.isPrivate==1)return fe=K(s).getEncodedHex(),h===void 0&&(h="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",fe,c,h,b);var be=function(Ee,Ye){var rt=ge(Ee,Ye);return new V({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:rt.pbkdf2Salt}},{int:rt.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:rt.encryptionSchemeIV}}]}]}]},{octstr:{hex:rt.ciphertext}}]}).getEncodedHex()},ge=function(Ee,Ye){var rt=U.lib.WordArray.random(8),et=U.lib.WordArray.random(8),Jt=U.PBKDF2(Ye,rt,{keySize:6,iterations:100}),Lt=U.enc.Hex.parse(Ee),Vt=U.TripleDES.encrypt(Lt,Jt,{iv:et})+"",ft={};return ft.ciphertext=Vt,ft.pbkdf2Salt=U.enc.Hex.stringify(rt),ft.pbkdf2Iter=100,ft.encryptionSchemeAlg="DES-EDE3-CBC",ft.encryptionSchemeIV=U.enc.Hex.stringify(et),ft};if(o=="PKCS8PRV"&&ce!=null&&s instanceof ce&&s.isPrivate==1){var Ne=le(s).getEncodedHex();return fe=V({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Ne}}]}).getEncodedHex(),c===void 0||c==null?Wt(fe,"PRIVATE KEY"):Wt(J=be(fe,c),"ENCRYPTED PRIVATE KEY")}if(o=="PKCS8PRV"&&re!==void 0&&s instanceof re&&s.isPrivate==1)return Ne=new V({seq:[{int:1},{octstr:{hex:s.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+s.pubKeyHex}}]}]}).getEncodedHex(),fe=V({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:s.curveName}}]},{octstr:{hex:Ne}}]}).getEncodedHex(),c===void 0||c==null?Wt(fe,"PRIVATE KEY"):Wt(J=be(fe,c),"ENCRYPTED PRIVATE KEY");if(o=="PKCS8PRV"&&Z!==void 0&&s instanceof Z&&s.isPrivate==1)return Ne=new j({bigint:s.x}).getEncodedHex(),fe=V({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:s.p}},{int:{bigint:s.q}},{int:{bigint:s.g}}]}]},{octstr:{hex:Ne}}]}).getEncodedHex(),c===void 0||c==null?Wt(fe,"PRIVATE KEY"):Wt(J=be(fe,c),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},yt.getKeyFromCSRPEM=function(s){var o=vr(s,"CERTIFICATE REQUEST");return yt.getKeyFromCSRHex(o)},yt.getKeyFromCSRHex=function(s){var o=yt.parseCSRHex(s);return yt.getKey(o.p8pubkeyhex,null,"pkcs8pub")},yt.parseCSRHex=function(s){var o=X,c=o.getChildIdx,h=o.getTLV,y={},b=s;if(b.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var R=c(b,0);if(R.length<1)throw new Error("malformed CSR(code:002)");if(b.substr(R[0],2)!="30")throw new Error("malformed CSR(code:003)");var B=c(b,R[0]);if(B.length<3)throw new Error("malformed CSR(code:004)");return y.p8pubkeyhex=h(b,B[2]),y},yt.getKeyID=function(s){var o=yt,c=X;typeof s=="string"&&s.indexOf("BEGIN ")!=-1&&(s=o.getKey(s));var h=vr(o.getPEM(s)),y=c.getIdxbyList(h,0,[1]),b=c.getV(h,y).substring(2);return p.crypto.Util.hashHex(b,"sha1")},yt.getJWKFromKey=function(s){var o={};if(s instanceof Se&&s.isPrivate)return o.kty="RSA",o.n=bt(s.n.toString(16)),o.e=bt(s.e.toString(16)),o.d=bt(s.d.toString(16)),o.p=bt(s.p.toString(16)),o.q=bt(s.q.toString(16)),o.dp=bt(s.dmp1.toString(16)),o.dq=bt(s.dmq1.toString(16)),o.qi=bt(s.coeff.toString(16)),o;if(s instanceof Se&&s.isPublic)return o.kty="RSA",o.n=bt(s.n.toString(16)),o.e=bt(s.e.toString(16)),o;if(s instanceof p.crypto.ECDSA&&s.isPrivate){if((h=s.getShortNISTPCurveName())!=="P-256"&&h!=="P-384")throw new Error("unsupported curve name for JWT: "+h);var c=s.getPublicKeyXYHex();return o.kty="EC",o.crv=h,o.x=bt(c.x),o.y=bt(c.y),o.d=bt(s.prvKeyHex),o}if(s instanceof p.crypto.ECDSA&&s.isPublic){var h;if((h=s.getShortNISTPCurveName())!=="P-256"&&h!=="P-384")throw new Error("unsupported curve name for JWT: "+h);return c=s.getPublicKeyXYHex(),o.kty="EC",o.crv=h,o.x=bt(c.x),o.y=bt(c.y),o}throw new Error("not supported key object")},Se.getPosArrayOfChildrenFromHex=function(s){return X.getChildIdx(s,0)},Se.getHexValueArrayOfChildrenFromHex=function(s){var o,c=X.getV,h=c(s,(o=Se.getPosArrayOfChildrenFromHex(s))[0]),y=c(s,o[1]),b=c(s,o[2]),R=c(s,o[3]),B=c(s,o[4]),L=c(s,o[5]),j=c(s,o[6]),V=c(s,o[7]),q=c(s,o[8]);return(o=new Array).push(h,y,b,R,B,L,j,V,q),o},Se.prototype.readPrivateKeyFromPEMString=function(s){var o=vr(s),c=Se.getHexValueArrayOfChildrenFromHex(o);this.setPrivateEx(c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},Se.prototype.readPKCS5PrvKeyHex=function(s){var o=Se.getHexValueArrayOfChildrenFromHex(s);this.setPrivateEx(o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8])},Se.prototype.readPKCS8PrvKeyHex=function(s){var o,c,h,y,b,R,B,L,j=X,V=j.getVbyListEx;if(j.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");try{o=V(s,0,[2,0,1],"02"),c=V(s,0,[2,0,2],"02"),h=V(s,0,[2,0,3],"02"),y=V(s,0,[2,0,4],"02"),b=V(s,0,[2,0,5],"02"),R=V(s,0,[2,0,6],"02"),B=V(s,0,[2,0,7],"02"),L=V(s,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(o,c,h,y,b,R,B,L)},Se.prototype.readPKCS5PubKeyHex=function(s){var o=X,c=o.getV;if(o.isASN1HEX(s)===!1)throw new Error("keyHex is not ASN.1 hex string");var h=o.getChildIdx(s,0);if(h.length!==2||s.substr(h[0],2)!=="02"||s.substr(h[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var y=c(s,h[0]),b=c(s,h[1]);this.setPublic(y,b)},Se.prototype.readPKCS8PubKeyHex=function(s){var o=X;if(o.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");if(o.getTLVbyListEx(s,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var c=o.getTLVbyListEx(s,0,[1,0]);this.readPKCS5PubKeyHex(c)},Se.prototype.readCertPubKeyHex=function(s,o){var c,h;(c=new St).readCertHex(s),h=c.getPublicKeyHex(),this.readPKCS8PubKeyHex(h)},new RegExp("[^0-9a-f]","gi");function xf(s,o){for(var c="",h=o/4-s.length,y=0;y<h;y++)c+="0";return c+s}function Af(s,o,c){for(var h="",y=0;h.length<o;)h+=rr(c(br(s+String.fromCharCode.apply(String,[(4278190080&y)>>24,(16711680&y)>>16,(65280&y)>>8,255&y])))),y+=1;return h}function If(s){for(var o in p.crypto.Util.DIGESTINFOHEAD){var c=p.crypto.Util.DIGESTINFOHEAD[o],h=c.length;if(s.substring(0,h)==c)return[o,s.substring(h)]}return[]}function St(s){var o,c=X,h=c.getChildIdx,y=c.getV,b=c.getTLV,R=c.getVbyList,B=c.getVbyListEx,L=c.getTLVbyList,j=c.getTLVbyListEx,V=c.getIdxbyList,q=c.getIdxbyListEx,G=c.getVidx,Z=c.getInt,re=c.oidname,ce=c.hextooidstr,le=vr;try{o=p.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var T=L(this.hex,0,[0,0]);if(T.substr(0,2)=="a0"){var K=L(T,0,[0]),W=Z(K,0);if(W<0||2<W)throw new Error("malformed version field");return this.version=W+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return B(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var T=j(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(T)},this.getAlgorithmIdentifierName=function(T){for(var K in o)if(T===o[K])return K;return re(B(T,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return L(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return L(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var T=R(this.hex,0,[0,4+this.foffset,0]);return T=T.replace(/(..)/g,"%$1"),T=decodeURIComponent(T)},this.getNotAfter=function(){var T=R(this.hex,0,[0,4+this.foffset,1]);return T=T.replace(/(..)/g,"%$1"),T=decodeURIComponent(T)},this.getPublicKeyHex=function(){return c.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return V(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var T=this.getPublicKeyIdx();return V(this.hex,T,[1,0],"30")},this.getPublicKey=function(){return yt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var T=L(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(T)},this.getSignatureValueHex=function(){return R(this.hex,0,[2],"03",!0)},this.verifySignature=function(T){var K=this.getSignatureAlgorithmField(),W=this.getSignatureValueHex(),J=L(this.hex,0,[0],"30"),se=new p.crypto.Signature({alg:K});return se.init(T),se.updateHex(J),se.verify(W)},this.parseExt=function(T){var K,W,J;if(T===void 0){if(J=this.hex,this.version!==3)return-1;K=V(J,0,[0,7,0],"30"),W=h(J,K)}else{J=vr(T);var se=V(J,0,[0,3,0,0],"06");if(y(J,se)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);K=V(J,0,[0,3,0,1,0],"30"),W=h(J,K),this.hex=J}this.aExtInfo=new Array;for(var fe=0;fe<W.length;fe++){var be={critical:!1},ge=0;h(J,W[fe]).length===3&&(be.critical=!0,ge=1),be.oid=c.hextooidstr(R(J,W[fe],[0],"06"));var Ne=V(J,W[fe],[1+ge]);be.vidx=G(J,Ne),this.aExtInfo.push(be)}},this.getExtInfo=function(T){var K=this.aExtInfo,W=T;if(T.match(/^[0-9.]+$/)||(W=p.asn1.x509.OID.name2oid(T)),W!==""){for(var J=0;J<K.length;J++)if(K[J].oid===W)return K[J]}},this.getExtBasicConstraints=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("basicConstraints");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"basicConstraints"};if(K&&(J.critical=!0),T==="3000")return J;if(T==="30030101ff")return J.cA=!0,J;if(T.substr(0,12)==="30060101ff02"){var se=y(T,10),fe=parseInt(se,16);return J.cA=!0,J.pathLen=fe,J}throw new Error("hExtV parse error: "+T)},this.getExtKeyUsage=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("keyUsage");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"keyUsage"};return K&&(J.critical=!0),J.names=this.getExtKeyUsageString(T).split(","),J},this.getExtKeyUsageBin=function(T){if(T===void 0){var K=this.getExtInfo("keyUsage");if(K===void 0)return"";T=b(this.hex,K.vidx)}if(T.length!=8&&T.length!=10)throw new Error("malformed key usage value: "+T);var W="000000000000000"+parseInt(T.substr(6),16).toString(2);return T.length==8&&(W=W.slice(-8)),T.length==10&&(W=W.slice(-16)),(W=W.replace(/0+$/,""))==""&&(W="0"),W},this.getExtKeyUsageString=function(T){for(var K=this.getExtKeyUsageBin(T),W=new Array,J=0;J<K.length;J++)K.substr(J,1)=="1"&&W.push(St.KEYUSAGE_NAME[J]);return W.join(",")},this.getExtSubjectKeyIdentifier=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("subjectKeyIdentifier");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"subjectKeyIdentifier"};K&&(J.critical=!0);var se=y(T,0);return J.kid={hex:se},J},this.getExtAuthorityKeyIdentifier=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("authorityKeyIdentifier");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"authorityKeyIdentifier"};K&&(J.critical=!0);for(var se=h(T,0),fe=0;fe<se.length;fe++){var be=T.substr(se[fe],2);if(be==="80"&&(J.kid={hex:y(T,se[fe])}),be==="a1"){var ge=b(T,se[fe]),Ne=this.getGeneralNames(ge);J.issuer=Ne[0].dn}be==="82"&&(J.sn={hex:y(T,se[fe])})}return J},this.getExtExtKeyUsage=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("extKeyUsage");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"extKeyUsage",array:[]};K&&(J.critical=!0);for(var se=h(T,0),fe=0;fe<se.length;fe++)J.array.push(re(y(T,se[fe])));return J},this.getExtExtKeyUsageName=function(){var T=this.getExtInfo("extKeyUsage");if(T===void 0)return T;var K=new Array,W=b(this.hex,T.vidx);if(W==="")return K;for(var J=h(W,0),se=0;se<J.length;se++)K.push(re(y(W,J[se])));return K},this.getExtSubjectAltName=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("subjectAltName");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"subjectAltName",array:[]};return K&&(J.critical=!0),J.array=this.getGeneralNames(T),J},this.getExtIssuerAltName=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("issuerAltName");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"issuerAltName",array:[]};return K&&(J.critical=!0),J.array=this.getGeneralNames(T),J},this.getGeneralNames=function(T){for(var K=h(T,0),W=[],J=0;J<K.length;J++){var se=this.getGeneralName(b(T,K[J]));se!==void 0&&W.push(se)}return W},this.getGeneralName=function(T){var K=T.substr(0,2),W=y(T,0),J=rr(W);return K=="81"?{rfc822:J}:K=="82"?{dns:J}:K=="86"?{uri:J}:K=="87"?{ip:Za(W)}:K=="a4"?{dn:this.getX500Name(W)}:void 0},this.getExtSubjectAltName2=function(){var T,K,W,J=this.getExtInfo("subjectAltName");if(J===void 0)return J;for(var se=new Array,fe=b(this.hex,J.vidx),be=h(fe,0),ge=0;ge<be.length;ge++)W=fe.substr(be[ge],2),T=y(fe,be[ge]),W==="81"&&(K=vt(T),se.push(["MAIL",K])),W==="82"&&(K=vt(T),se.push(["DNS",K])),W==="84"&&(K=St.hex2dn(T,0),se.push(["DN",K])),W==="86"&&(K=vt(T),se.push(["URI",K])),W==="87"&&(K=Za(T),se.push(["IP",K]));return se},this.getExtCRLDistributionPoints=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("cRLDistributionPoints");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"cRLDistributionPoints",array:[]};K&&(J.critical=!0);for(var se=h(T,0),fe=0;fe<se.length;fe++){var be=b(T,se[fe]);J.array.push(this.getDistributionPoint(be))}return J},this.getDistributionPoint=function(T){for(var K={},W=h(T,0),J=0;J<W.length;J++){var se=T.substr(W[J],2),fe=b(T,W[J]);se=="a0"&&(K.dpname=this.getDistributionPointName(fe))}return K},this.getDistributionPointName=function(T){for(var K={},W=h(T,0),J=0;J<W.length;J++){var se=T.substr(W[J],2),fe=b(T,W[J]);se=="a0"&&(K.full=this.getGeneralNames(fe))}return K},this.getExtCRLDistributionPointsURI=function(){var T=this.getExtInfo("cRLDistributionPoints");if(T===void 0)return T;for(var K=new Array,W=h(this.hex,T.vidx),J=0;J<W.length;J++)try{var se=vt(R(this.hex,W[J],[0,0,0],"86"));K.push(se)}catch{}return K},this.getExtAIAInfo=function(){var T=this.getExtInfo("authorityInfoAccess");if(T===void 0)return T;for(var K={ocsp:[],caissuer:[]},W=h(this.hex,T.vidx),J=0;J<W.length;J++){var se=R(this.hex,W[J],[0],"06"),fe=R(this.hex,W[J],[1],"86");se==="2b06010505073001"&&K.ocsp.push(vt(fe)),se==="2b06010505073002"&&K.caissuer.push(vt(fe))}return K},this.getExtAuthorityInfoAccess=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("authorityInfoAccess");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"authorityInfoAccess",array:[]};K&&(J.critical=!0);for(var se=h(T,0),fe=0;fe<se.length;fe++){var be=B(T,se[fe],[0],"06"),ge=vt(R(T,se[fe],[1],"86"));if(be=="2b06010505073001")J.array.push({ocsp:ge});else{if(be!="2b06010505073002")throw new Error("unknown method: "+be);J.array.push({caissuer:ge})}}return J},this.getExtCertificatePolicies=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("certificatePolicies");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"certificatePolicies",array:[]};K&&(J.critical=!0);for(var se=h(T,0),fe=0;fe<se.length;fe++){var be=b(T,se[fe]),ge=this.getPolicyInformation(be);J.array.push(ge)}return J},this.getPolicyInformation=function(T){var K={},W=R(T,0,[0],"06");K.policyoid=re(W);var J=q(T,0,[1],"30");if(J!=-1){K.array=[];for(var se=h(T,J),fe=0;fe<se.length;fe++){var be=b(T,se[fe]),ge=this.getPolicyQualifierInfo(be);K.array.push(ge)}}return K},this.getPolicyQualifierInfo=function(T){var K={},W=R(T,0,[0],"06");if(W==="2b06010505070201"){var J=B(T,0,[1],"16");K.cps=rr(J)}else if(W==="2b06010505070202"){var se=L(T,0,[1],"30");K.unotice=this.getUserNotice(se)}return K},this.getUserNotice=function(T){for(var K={},W=h(T,0),J=0;J<W.length;J++){var se=b(T,W[J]);se.substr(0,2)!="30"&&(K.exptext=this.getDisplayText(se))}return K},this.getDisplayText=function(T){var K={};return K.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[T.substr(0,2)],K.str=rr(y(T,0)),K},this.getExtCRLNumber=function(T,K){var W={extname:"cRLNumber"};if(K&&(W.critical=!0),T.substr(0,2)=="02")return W.num={hex:y(T,0)},W;throw new Error("hExtV parse error: "+T)},this.getExtCRLReason=function(T,K){var W={extname:"cRLReason"};if(K&&(W.critical=!0),T.substr(0,2)=="0a")return W.code=parseInt(y(T,0),16),W;throw new Error("hExtV parse error: "+T)},this.getExtOcspNonce=function(T,K){var W={extname:"ocspNonce"};K&&(W.critical=!0);var J=y(T,0);return W.hex=J,W},this.getExtOcspNoCheck=function(T,K){var W={extname:"ocspNoCheck"};return K&&(W.critical=!0),W},this.getExtAdobeTimeStamp=function(T,K){if(T===void 0&&K===void 0){var W=this.getExtInfo("adobeTimeStamp");if(W===void 0)return;T=b(this.hex,W.vidx),K=W.critical}var J={extname:"adobeTimeStamp"};K&&(J.critical=!0);var se=h(T,0);if(se.length>1){var fe=b(T,se[1]),be=this.getGeneralName(fe);be.uri!=null&&(J.uri=be.uri)}if(se.length>2){var ge=b(T,se[2]);ge=="0101ff"&&(J.reqauth=!0),ge=="010100"&&(J.reqauth=!1)}return J},this.getX500NameRule=function(T){for(var K=null,W=[],J=0;J<T.length;J++)for(var se=T[J],fe=0;fe<se.length;fe++)W.push(se[fe]);for(J=0;J<W.length;J++){var be=W[J],ge=be.ds,Ne=be.value,we=be.type;if(""+ge,ge!="prn"&&ge!="utf8"&&ge!="ia5")return"mixed";if(ge=="ia5"){if(we!="CN")return"mixed";if(p.lang.String.isMail(Ne))continue;return"mixed"}if(we=="C"){if(ge=="prn")continue;return"mixed"}if(""+ge,K==null)K=ge;else if(K!==ge)return"mixed"}return K??"prn"},this.getX500Name=function(T){var K=this.getX500NameArray(T);return{array:K,str:this.dnarraytostr(K)}},this.getX500NameArray=function(T){for(var K=[],W=h(T,0),J=0;J<W.length;J++)K.push(this.getRDN(b(T,W[J])));return K},this.getRDN=function(T){for(var K=[],W=h(T,0),J=0;J<W.length;J++)K.push(this.getAttrTypeAndValue(b(T,W[J])));return K},this.getAttrTypeAndValue=function(T){var K={type:null,value:null,ds:null},W=h(T,0),J=R(T,W[0],[],"06"),se=R(T,W[1],[]),fe=p.asn1.ASN1Util.oidHexToInt(J);return K.type=p.asn1.x509.OID.oid2atype(fe),K.ds=this.HEX2STAG[T.substr(W[1],2)],K.ds!="bmp"?K.value=vt(se):K.value=vf(se),K},this.readCertPEM=function(T){this.readCertHex(le(T))},this.readCertHex=function(T){this.hex=T,this.getVersion();try{V(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var T={};return T.version=this.getVersion(),T.serial={hex:this.getSerialNumberHex()},T.sigalg=this.getSignatureAlgorithmField(),T.issuer=this.getIssuer(),T.notbefore=this.getNotBefore(),T.notafter=this.getNotAfter(),T.subject=this.getSubject(),T.sbjpubkey=Wt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(T.ext=this.getExtParamArray()),T.sighex=this.getSignatureValueHex(),T},this.getExtParamArray=function(T){T==null&&q(this.hex,0,[0,"[3]"])!=-1&&(T=j(this.hex,0,[0,"[3]",0],"30"));for(var K=[],W=h(T,0),J=0;J<W.length;J++){var se=b(T,W[J]),fe=this.getExtParam(se);fe!=null&&K.push(fe)}return K},this.getExtParam=function(T){var K=h(T,0).length;if(K!=2&&K!=3)throw new Error("wrong number elements in Extension: "+K+" "+T);var W=ce(R(T,0,[0],"06")),J=!1;K==3&&L(T,0,[1])=="0101ff"&&(J=!0);var se=L(T,0,[K-1,0]),fe=void 0;if(W=="2.5.29.14"?fe=this.getExtSubjectKeyIdentifier(se,J):W=="2.5.29.15"?fe=this.getExtKeyUsage(se,J):W=="2.5.29.17"?fe=this.getExtSubjectAltName(se,J):W=="2.5.29.18"?fe=this.getExtIssuerAltName(se,J):W=="2.5.29.19"?fe=this.getExtBasicConstraints(se,J):W=="2.5.29.31"?fe=this.getExtCRLDistributionPoints(se,J):W=="2.5.29.32"?fe=this.getExtCertificatePolicies(se,J):W=="2.5.29.35"?fe=this.getExtAuthorityKeyIdentifier(se,J):W=="2.5.29.37"?fe=this.getExtExtKeyUsage(se,J):W=="1.3.6.1.5.5.7.1.1"?fe=this.getExtAuthorityInfoAccess(se,J):W=="2.5.29.20"?fe=this.getExtCRLNumber(se,J):W=="2.5.29.21"?fe=this.getExtCRLReason(se,J):W=="1.3.6.1.5.5.7.48.1.2"?fe=this.getExtOcspNonce(se,J):W=="1.3.6.1.5.5.7.48.1.5"?fe=this.getExtOcspNoCheck(se,J):W=="1.2.840.113583.1.1.9.1"&&(fe=this.getExtAdobeTimeStamp(se,J)),fe!=null)return fe;var be={extname:W,extn:se};return J&&(be.critical=!0),be},this.findExt=function(T,K){for(var W=0;W<T.length;W++)if(T[W].extname==K)return T[W];return null},this.updateExtCDPFullURI=function(T,K){var W=this.findExt(T,"cRLDistributionPoints");if(W!=null&&W.array!=null){for(var J=W.array,se=0;se<J.length;se++)if(J[se].dpname!=null&&J[se].dpname.full!=null)for(var fe=J[se].dpname.full,be=0;be<fe.length;be++){var ge=fe[se];ge.uri!=null&&(ge.uri=K)}}},this.updateExtAIAOCSP=function(T,K){var W=this.findExt(T,"authorityInfoAccess");if(W!=null&&W.array!=null)for(var J=W.array,se=0;se<J.length;se++)J[se].ocsp!=null&&(J[se].ocsp=K)},this.updateExtAIACAIssuer=function(T,K){var W=this.findExt(T,"authorityInfoAccess");if(W!=null&&W.array!=null)for(var J=W.array,se=0;se<J.length;se++)J[se].caissuer!=null&&(J[se].caissuer=K)},this.dnarraytostr=function(T){return"/"+T.map(function(K){return function(J){return J.map(function(se){return function(be){return be.type+"="+be.value}(se).replace(/\+/,"\\+")}).join("+")}(K).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var T,K,W,J=function(Jt){return JSON.stringify(Jt.array).replace(/[\[\]\{\}\"]/g,"")},se=function(Jt){for(var Lt="",Vt=Jt.array,ft=0;ft<Vt.length;ft++){var Et=Vt[ft];if(Lt+="    policy oid: "+Et.policyoid+`
`,Et.array!==void 0)for(var Nt=0;Nt<Et.array.length;Nt++){var Kt=Et.array[Nt];Kt.cps!==void 0&&(Lt+="    cps: "+Kt.cps+`
`)}}return Lt},fe=function(Jt){for(var Lt="",Vt=Jt.array,ft=0;ft<Vt.length;ft++){var Et=Vt[ft];try{Et.dpname.full[0].uri!==void 0&&(Lt+="    "+Et.dpname.full[0].uri+`
`)}catch{}try{Et.dname.full[0].dn.hex!==void 0&&(Lt+="    "+St.hex2dn(Et.dpname.full[0].dn.hex)+`
`)}catch{}}return Lt},be=function(Jt){for(var Lt="",Vt=Jt.array,ft=0;ft<Vt.length;ft++){var Et=Vt[ft];Et.caissuer!==void 0&&(Lt+="    caissuer: "+Et.caissuer+`
`),Et.ocsp!==void 0&&(Lt+="    ocsp: "+Et.ocsp+`
`)}return Lt};if(T=`Basic Fields
`,T+="  serial number: "+this.getSerialNumberHex()+`
`,T+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,T+="  issuer: "+this.getIssuerString()+`
`,T+="  notBefore: "+this.getNotBefore()+`
`,T+="  notAfter: "+this.getNotAfter()+`
`,T+="  subject: "+this.getSubjectString()+`
`,T+=`  subject public key info: 
`,T+="    key algorithm: "+(K=this.getPublicKey()).type+`
`,K.type==="RSA"&&(T+="    n="+eu(K.n.toString(16)).substr(0,16)+`...
`,T+="    e="+eu(K.e.toString(16))+`
`),(W=this.aExtInfo)!=null){T+=`X509v3 Extensions:
`;for(var ge=0;ge<W.length;ge++){var Ne=W[ge],we=p.asn1.x509.OID.oid2name(Ne.oid);we===""&&(we=Ne.oid);var Ee="";if(Ne.critical===!0&&(Ee="CRITICAL"),T+="  "+we+" "+Ee+`:
`,we==="basicConstraints"){var Ye=this.getExtBasicConstraints();Ye.cA===void 0?T+=`    {}
`:(T+="    cA=true",Ye.pathLen!==void 0&&(T+=", pathLen="+Ye.pathLen),T+=`
`)}else if(we==="keyUsage")T+="    "+this.getExtKeyUsageString()+`
`;else if(we==="subjectKeyIdentifier")T+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(we==="authorityKeyIdentifier"){var rt=this.getExtAuthorityKeyIdentifier();rt.kid!==void 0&&(T+="    kid="+rt.kid.hex+`
`)}else we==="extKeyUsage"?T+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:we==="subjectAltName"?T+="    "+J(this.getExtSubjectAltName())+`
`:we==="cRLDistributionPoints"?T+=fe(this.getExtCRLDistributionPoints()):we==="authorityInfoAccess"?T+=be(this.getExtAuthorityInfoAccess()):we==="certificatePolicies"&&(T+=se(this.getExtCertificatePolicies()))}}return T+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,T+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof s=="string"&&(s.indexOf("-----BEGIN")!=-1?this.readCertPEM(s):p.lang.String.isHex(s)&&this.readCertHex(s))}Se.prototype.sign=function(s,o){var c=function(y){return p.crypto.Util.hashString(y,o)}(s);return this.signWithMessageHash(c,o)},Se.prototype.signWithMessageHash=function(s,o){var c=Xe(p.crypto.Util.getPaddedDigestInfoHex(s,o,this.n.bitLength()),16);return xf(this.doPrivate(c).toString(16),this.n.bitLength())},Se.prototype.signPSS=function(s,o,c){var h=function(b){return p.crypto.Util.hashHex(b,o)}(br(s));return c===void 0&&(c=-1),this.signWithMessageHashPSS(h,o,c)},Se.prototype.signWithMessageHashPSS=function(s,o,c){var h,y=rr(s),b=y.length,R=this.n.bitLength()-1,B=Math.ceil(R/8),L=function(T){return p.crypto.Util.hashHex(T,o)};if(c===-1||c===void 0)c=b;else if(c===-2)c=B-b-2;else if(c<-2)throw new Error("invalid salt length");if(B<b+c+2)throw new Error("data too long");var j="";c>0&&(j=new Array(c),new Me().nextBytes(j),j=String.fromCharCode.apply(String,j));var V=rr(L(br("\0\0\0\0\0\0\0\0"+y+j))),q=[];for(h=0;h<B-c-b-2;h+=1)q[h]=0;var G=String.fromCharCode.apply(String,q)+""+j,Z=Af(V,G.length,L),re=[];for(h=0;h<G.length;h+=1)re[h]=G.charCodeAt(h)^Z.charCodeAt(h);var ce=65280>>8*B-R&255;for(re[0]&=~ce,h=0;h<b;h++)re.push(V.charCodeAt(h));return re.push(188),xf(this.doPrivate(new M(re)).toString(16),this.n.bitLength())},Se.prototype.verify=function(s,o){if((o=o.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var c=Xe(o,16),h=this.n.bitLength();if(c.bitLength()>h)return!1;var y=this.doPublic(c).toString(16);if(y.length+3!=h/4)return!1;var b=If(y.replace(/^1f+00/,""));if(b.length==0)return!1;var R=b[0];return b[1]==function(L){return p.crypto.Util.hashString(L,R)}(s)},Se.prototype.verifyWithMessageHash=function(s,o){if(o.length!=Math.ceil(this.n.bitLength()/4))return!1;var c=Xe(o,16);if(c.bitLength()>this.n.bitLength())return 0;var h=If(this.doPublic(c).toString(16).replace(/^1f+00/,""));return h.length==0?!1:(h[0],h[1]==s)},Se.prototype.verifyPSS=function(s,o,c,h){var y=function(R){return p.crypto.Util.hashHex(R,c)}(br(s));return h===void 0&&(h=-1),this.verifyWithMessageHashPSS(y,o,c,h)},Se.prototype.verifyWithMessageHashPSS=function(s,o,c,h){if(o.length!=Math.ceil(this.n.bitLength()/4))return!1;var y,b=new M(o,16),R=function(W){return p.crypto.Util.hashHex(W,c)},B=rr(s),L=B.length,j=this.n.bitLength()-1,V=Math.ceil(j/8);if(h===-1||h===void 0)h=L;else if(h===-2)h=V-L-2;else if(h<-2)throw new Error("invalid salt length");if(V<L+h+2)throw new Error("data too long");var q=this.doPublic(b).toByteArray();for(y=0;y<q.length;y+=1)q[y]&=255;for(;q.length<V;)q.unshift(0);if(q[V-1]!==188)throw new Error("encoded message does not end in 0xbc");var G=(q=String.fromCharCode.apply(String,q)).substr(0,V-L-1),Z=q.substr(G.length,L),re=65280>>8*V-j&255;if(G.charCodeAt(0)&re)throw new Error("bits beyond keysize not zero");var ce=Af(Z,G.length,R),le=[];for(y=0;y<G.length;y+=1)le[y]=G.charCodeAt(y)^ce.charCodeAt(y);le[0]&=~re;var T=V-L-h-2;for(y=0;y<T;y+=1)if(le[y]!==0)throw new Error("leftmost octets not zero");if(le[T]!==1)throw new Error("0x01 marker not found");return Z===rr(R(br("\0\0\0\0\0\0\0\0"+B+String.fromCharCode.apply(String,le.slice(-h)))))},Se.SALT_LEN_HLEN=-1,Se.SALT_LEN_MAX=-2,Se.SALT_LEN_RECOVER=-2,St.hex2dn=function(s,o){o===void 0&&(o=0);var c=new St;return X.getTLV(s,o),c.getX500Name(s).str},St.hex2rdn=function(s,o){if(o===void 0&&(o=0),s.substr(o,2)!=="31")throw new Error("malformed RDN");for(var c=new Array,h=X.getChildIdx(s,o),y=0;y<h.length;y++)c.push(St.hex2attrTypeValue(s,h[y]));return(c=c.map(function(b){return b.replace("+","\\+")})).join("+")},St.hex2attrTypeValue=function(s,o){var c=X,h=c.getV;if(o===void 0&&(o=0),s.substr(o,2)!=="30")throw new Error("malformed attribute type and value");var y=c.getChildIdx(s,o);y.length!==2||s.substr(y[0],2);var b=h(s,y[0]),R=p.asn1.ASN1Util.oidHexToInt(b);return p.asn1.x509.OID.oid2atype(R)+"="+rr(h(s,y[1]))},St.getPublicKeyFromCertHex=function(s){var o=new St;return o.readCertHex(s),o.getPublicKey()},St.getPublicKeyFromCertPEM=function(s){var o=new St;return o.readCertPEM(s),o.getPublicKey()},St.getPublicKeyInfoPropOfCertPEM=function(s){var o,c,h=X.getVbyList,y={};return y.algparam=null,(o=new St).readCertPEM(s),c=o.getPublicKeyHex(),y.keyhex=h(c,0,[1],"03").substr(2),y.algoid=h(c,0,[0,0],"06"),y.algoid==="2a8648ce3d0201"&&(y.algparam=h(c,0,[0,1],"06")),y},St.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],p!==void 0&&p||(e.KJUR=p={}),p.jws!==void 0&&p.jws||(p.jws={}),p.jws.JWS=function(){var s=p.jws.JWS.isSafeJSONString;this.parseJWS=function(o,c){if(this.parsedJWS===void 0||!c&&this.parsedJWS.sigvalH===void 0){var h=o.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(h==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var y=h[1],b=h[2],R=h[3],B=y+"."+b;if(this.parsedJWS={},this.parsedJWS.headB64U=y,this.parsedJWS.payloadB64U=b,this.parsedJWS.sigvalB64U=R,this.parsedJWS.si=B,!c){var L=Ze(R),j=Xe(L,16);this.parsedJWS.sigvalH=L,this.parsedJWS.sigvalBI=j}var V=ee(y),q=ee(b);if(this.parsedJWS.headS=V,this.parsedJWS.payloadS=q,!s(V,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+V}}},p.jws.JWS.sign=function(s,o,c,h,y){var b,R,B,L=p,j=L.jws.JWS,V=j.readSafeJSONString,q=j.isSafeJSONString,G=L.crypto,Z=(G.ECDSA,G.Mac),re=G.Signature,ce=JSON;if(typeof o!="string"&&(o===void 0?"undefined":A(o))!="object")throw"spHeader must be JSON string or object: "+o;if((o===void 0?"undefined":A(o))=="object"&&(R=o,b=ce.stringify(R)),typeof o=="string"){if(!q(b=o))throw"JWS Head is not safe JSON string: "+b;R=V(b)}if(B=c,(c===void 0?"undefined":A(c))=="object"&&(B=ce.stringify(c)),s!=""&&s!=null||R.alg===void 0||(s=R.alg),s!=""&&s!=null&&R.alg===void 0&&(R.alg=s,b=ce.stringify(R)),s!==R.alg)throw"alg and sHeader.alg doesn't match: "+s+"!="+R.alg;var le=null;if(j.jwsalg2sigalg[s]===void 0)throw"unsupported alg name: "+s;le=j.jwsalg2sigalg[s];var T=H(b)+"."+H(B),K="";if(le.substr(0,4)=="Hmac"){if(h===void 0)throw"mac key shall be specified for HS* alg";var W=new Z({alg:le,prov:"cryptojs",pass:h});W.updateString(T),K=W.doFinal()}else if(le.indexOf("withECDSA")!=-1){(se=new re({alg:le})).init(h,y),se.updateString(T);var J=se.sign();K=p.crypto.ECDSA.asn1SigToConcatSig(J)}else{var se;le!="none"&&((se=new re({alg:le})).init(h,y),se.updateString(T),K=se.sign())}return T+"."+bt(K)},p.jws.JWS.verify=function(s,o,c){var h,y=p,b=y.jws.JWS,R=b.readSafeJSONString,B=y.crypto,L=B.ECDSA,j=B.Mac,V=B.Signature;A(Se)!==void 0&&(h=Se);var q=s.split(".");if(q.length!==3)return!1;var G=q[0]+"."+q[1],Z=Ze(q[2]),re=R(ee(q[0])),ce=null,le=null;if(re.alg===void 0)throw"algorithm not specified in header";if(le=(ce=re.alg).substr(0,2),c!=null&&Object.prototype.toString.call(c)==="[object Array]"&&c.length>0&&(":"+c.join(":")+":").indexOf(":"+ce+":")==-1)throw"algorithm '"+ce+"' not accepted in the list";if(ce!="none"&&o===null)throw"key shall be specified to verify.";if(typeof o=="string"&&o.indexOf("-----BEGIN ")!=-1&&(o=yt.getKey(o)),!(le!="RS"&&le!="PS"||o instanceof h))throw"key shall be a RSAKey obj for RS* and PS* algs";if(le=="ES"&&!(o instanceof L))throw"key shall be a ECDSA obj for ES* algs";var T=null;if(b.jwsalg2sigalg[re.alg]===void 0)throw"unsupported alg name: "+ce;if((T=b.jwsalg2sigalg[ce])=="none")throw"not supported";if(T.substr(0,4)=="Hmac"){if(o===void 0)throw"hexadecimal key shall be specified for HMAC";var K=new j({alg:T,pass:o});return K.updateString(G),Z==K.doFinal()}if(T.indexOf("withECDSA")!=-1){var W,J=null;try{J=L.concatSigToASN1Sig(Z)}catch{return!1}return(W=new V({alg:T})).init(o),W.updateString(G),W.verify(J)}return(W=new V({alg:T})).init(o),W.updateString(G),W.verify(Z)},p.jws.JWS.parse=function(s){var o,c,h,y=s.split("."),b={};if(y.length!=2&&y.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return o=y[0],c=y[1],y.length==3&&(h=y[2]),b.headerObj=p.jws.JWS.readSafeJSONString(ee(o)),b.payloadObj=p.jws.JWS.readSafeJSONString(ee(c)),b.headerPP=JSON.stringify(b.headerObj,null,"  "),b.payloadObj==null?b.payloadPP=ee(c):b.payloadPP=JSON.stringify(b.payloadObj,null,"  "),h!==void 0&&(b.sigHex=Ze(h)),b},p.jws.JWS.verifyJWT=function(s,o,c){var h=p.jws,y=h.JWS,b=y.readSafeJSONString,R=y.inArray,B=y.includedArray,L=s.split("."),j=L[0],V=L[1],q=(Ze(L[2]),b(ee(j))),G=b(ee(V));if(q.alg===void 0)return!1;if(c.alg===void 0)throw"acceptField.alg shall be specified";if(!R(q.alg,c.alg)||G.iss!==void 0&&A(c.iss)==="object"&&!R(G.iss,c.iss)||G.sub!==void 0&&A(c.sub)==="object"&&!R(G.sub,c.sub))return!1;if(G.aud!==void 0&&A(c.aud)==="object"){if(typeof G.aud=="string"){if(!R(G.aud,c.aud))return!1}else if(A(G.aud)=="object"&&!B(G.aud,c.aud))return!1}var Z=h.IntDate.getNow();return c.verifyAt!==void 0&&typeof c.verifyAt=="number"&&(Z=c.verifyAt),c.gracePeriod!==void 0&&typeof c.gracePeriod=="number"||(c.gracePeriod=0),!(G.exp!==void 0&&typeof G.exp=="number"&&G.exp+c.gracePeriod<Z)&&!(G.nbf!==void 0&&typeof G.nbf=="number"&&Z<G.nbf-c.gracePeriod)&&!(G.iat!==void 0&&typeof G.iat=="number"&&Z<G.iat-c.gracePeriod)&&(G.jti===void 0||c.jti===void 0||G.jti===c.jti)&&!!y.verify(s,o,c.alg)},p.jws.JWS.includedArray=function(s,o){var c=p.jws.JWS.inArray;if(s===null||(s===void 0?"undefined":A(s))!=="object"||typeof s.length!="number")return!1;for(var h=0;h<s.length;h++)if(!c(s[h],o))return!1;return!0},p.jws.JWS.inArray=function(s,o){if(o===null||(o===void 0?"undefined":A(o))!=="object"||typeof o.length!="number")return!1;for(var c=0;c<o.length;c++)if(o[c]==s)return!0;return!1},p.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},p.jws.JWS.isSafeJSONString=function(s,o,c){var h=null;try{return((h=m(s))===void 0?"undefined":A(h))!="object"||h.constructor===Array?0:(o&&(o[c]=h),1)}catch{return 0}},p.jws.JWS.readSafeJSONString=function(s){var o=null;try{return((o=m(s))===void 0?"undefined":A(o))!="object"||o.constructor===Array?null:o}catch{return null}},p.jws.JWS.getEncodedSignatureValueFromJWS=function(s){var o=s.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(o==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return o[1]},p.jws.JWS.getJWKthumbprint=function(s){if(s.kty!=="RSA"&&s.kty!=="EC"&&s.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var o="{";if(s.kty==="RSA"){if(typeof s.n!="string"||typeof s.e!="string")throw"wrong n and e value for RSA key";o+='"e":"'+s.e+'",',o+='"kty":"'+s.kty+'",',o+='"n":"'+s.n+'"}'}else if(s.kty==="EC"){if(typeof s.crv!="string"||typeof s.x!="string"||typeof s.y!="string")throw"wrong crv, x and y value for EC key";o+='"crv":"'+s.crv+'",',o+='"kty":"'+s.kty+'",',o+='"x":"'+s.x+'",',o+='"y":"'+s.y+'"}'}else if(s.kty==="oct"){if(typeof s.k!="string")throw"wrong k value for oct(symmetric) key";o+='"kty":"'+s.kty+'",',o+='"k":"'+s.k+'"}'}var c=br(o);return bt(p.crypto.Util.hashHex(c,"sha256"))},p.jws.IntDate={},p.jws.IntDate.get=function(s){var o=p.jws.IntDate,c=o.getNow,h=o.getZulu;if(s=="now")return c();if(s=="now + 1hour")return c()+3600;if(s=="now + 1day")return c()+86400;if(s=="now + 1month")return c()+2592e3;if(s=="now + 1year")return c()+31536e3;if(s.match(/Z$/))return h(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},p.jws.IntDate.getZulu=function(s){return _f(s)},p.jws.IntDate.getNow=function(){return~~(new Date/1e3)},p.jws.IntDate.intDate2UTCString=function(s){return new Date(1e3*s).toUTCString()},p.jws.IntDate.intDate2Zulu=function(s){var o=new Date(1e3*s);return("0000"+o.getUTCFullYear()).slice(-4)+("00"+(o.getUTCMonth()+1)).slice(-2)+("00"+o.getUTCDate()).slice(-2)+("00"+o.getUTCHours()).slice(-2)+("00"+o.getUTCMinutes()).slice(-2)+("00"+o.getUTCSeconds()).slice(-2)+"Z"},e.SecureRandom=Me,e.rng_seed_time=ue,e.BigInteger=M,e.RSAKey=Se;var Fm=p.crypto.EDSA;e.EDSA=Fm;var Pm=p.crypto.DSA;e.DSA=Pm;var Nm=p.crypto.Signature;e.Signature=Nm;var km=p.crypto.MessageDigest;e.MessageDigest=km;var Om=p.crypto.Mac;e.Mac=Om;var Dm=p.crypto.Cipher;e.Cipher=Dm,e.KEYUTIL=yt,e.ASN1HEX=X,e.X509=St,e.CryptoJS=U,e.b64tohex=te,e.b64toBA=oe,e.stoBA=pe,e.BAtos=Ce,e.BAtohex=Je,e.stohex=Be,e.stob64=function(o){return F(Be(o))},e.stob64u=function(o){return Ge(F(Be(o)))},e.b64utos=function(o){return Ce(oe(He(o)))},e.b64tob64u=Ge,e.b64utob64=He,e.hex2b64=F,e.hextob64u=bt,e.b64utohex=Ze,e.utf8tob64u=H,e.b64utoutf8=ee,e.utf8tob64=function(o){return F(Co(Po(o)))},e.b64toutf8=function(o){return decodeURIComponent(Fo(te(o)))},e.utf8tohex=Qa,e.hextoutf8=vt,e.hextorstr=rr,e.rstrtohex=br,e.hextob64=gf,e.hextob64nl=yf,e.b64nltohex=mf,e.hextopem=Wt,e.pemtohex=vr,e.hextoArrayBuffer=function(o){if(o.length%2!=0)throw"input is not even length";if(o.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var c=new ArrayBuffer(o.length/2),h=new DataView(c),y=0;y<o.length/2;y++)h.setUint8(y,parseInt(o.substr(2*y,2),16));return c},e.ArrayBuffertohex=function(o){for(var c="",h=new DataView(o),y=0;y<o.byteLength;y++)c+=("00"+h.getUint8(y).toString(16)).slice(-2);return c},e.zulutomsec=Xa,e.zulutosec=_f,e.zulutodate=function(o){return new Date(Xa(o))},e.datetozulu=function(o,c,h){var y,b=o.getUTCFullYear();if(c){if(b<1950||2049<b)throw"not proper year for UTCTime: "+b;y=(""+b).slice(-2)}else y=("000"+b).slice(-4);if(y+=("0"+(o.getUTCMonth()+1)).slice(-2),y+=("0"+o.getUTCDate()).slice(-2),y+=("0"+o.getUTCHours()).slice(-2),y+=("0"+o.getUTCMinutes()).slice(-2),y+=("0"+o.getUTCSeconds()).slice(-2),h){var R=o.getUTCMilliseconds();R!==0&&(y+="."+(R=(R=("00"+R).slice(-3)).replace(/0+$/g,"")))}return y+="Z"},e.uricmptohex=Co,e.hextouricmp=Fo,e.ipv6tohex=wf,e.hextoipv6=bf,e.hextoip=Za,e.iptohex=function(o){var c="malformed IP address";if(!(o=o.toLowerCase(o)).match(/^[0-9.]+$/)){if(o.match(/^[0-9a-f:]+$/)&&o.indexOf(":")!==-1)return wf(o);throw c}var h=o.split(".");if(h.length!==4)throw c;var y="";try{for(var b=0;b<4;b++)y+=("0"+parseInt(h[b]).toString(16)).slice(-2);return y}catch{throw c}},e.encodeURIComponentAll=Po,e.newline_toUnix=function(o){return o=o.replace(/\r\n/gm,`
`)},e.newline_toDos=function(o){return o=(o=o.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},e.hextoposhex=eu,e.intarystrtohex=function(o){o=(o=(o=o.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return o.split(/,/).map(function(c,h,y){var b=parseInt(c);if(b<0||255<b)throw"integer not in range 0-255";return("00"+b.toString(16)).slice(-2)}).join("")}catch(c){throw"malformed integer array string: "+c}},e.strdiffidx=function(o,c){var h=o.length;o.length>c.length&&(h=c.length);for(var y=0;y<h;y++)if(o.charCodeAt(y)!=c.charCodeAt(y))return y;return o.length!=c.length?h:-1},e.KJUR=p;var Lm=p.crypto;e.crypto=Lm;var Um=p.asn1;e.asn1=Um;var jm=p.jws;e.jws=jm;var Bm=p.lang;e.lang=Bm}).call(this,r(28).Buffer)},function(t,e,r){"use strict";(function(n){var i=r(30),a=r(31),u=r(32);function l(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(Q,v){if(l()<v)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(Q=new Uint8Array(v)).__proto__=f.prototype:(Q===null&&(Q=new f(v)),Q.length=v),Q}function f(Q,v,S){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(Q,v,S);if(typeof Q=="number"){if(typeof v=="string")throw new Error("If encoding is specified then the first argument must be a string");return w(this,Q)}return g(this,Q,v,S)}function g(Q,v,S,$){if(typeof v=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&v instanceof ArrayBuffer?function(ue,de,ve,Ie){if(de.byteLength,ve<0||de.byteLength<ve)throw new RangeError("'offset' is out of bounds");if(de.byteLength<ve+(Ie||0))throw new RangeError("'length' is out of bounds");return de=ve===void 0&&Ie===void 0?new Uint8Array(de):Ie===void 0?new Uint8Array(de,ve):new Uint8Array(de,ve,Ie),f.TYPED_ARRAY_SUPPORT?(ue=de).__proto__=f.prototype:ue=E(ue,de),ue}(Q,v,S,$):typeof v=="string"?function(ue,de,ve){if(typeof ve=="string"&&ve!==""||(ve="utf8"),!f.isEncoding(ve))throw new TypeError('"encoding" must be a valid string encoding');var Ie=0|A(de,ve),Ve=(ue=d(ue,Ie)).write(de,ve);return Ve!==Ie&&(ue=ue.slice(0,Ve)),ue}(Q,v,S):function(ue,de){if(f.isBuffer(de)){var ve=0|x(de.length);return(ue=d(ue,ve)).length===0||de.copy(ue,0,0,ve),ue}if(de){if(typeof ArrayBuffer<"u"&&de.buffer instanceof ArrayBuffer||"length"in de)return typeof de.length!="number"||function(Ve){return Ve!=Ve}(de.length)?d(ue,0):E(ue,de);if(de.type==="Buffer"&&u(de.data))return E(ue,de.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(Q,v)}function _(Q){if(typeof Q!="number")throw new TypeError('"size" argument must be a number');if(Q<0)throw new RangeError('"size" argument must not be negative')}function w(Q,v){if(_(v),Q=d(Q,v<0?0:0|x(v)),!f.TYPED_ARRAY_SUPPORT)for(var S=0;S<v;++S)Q[S]=0;return Q}function E(Q,v){var S=v.length<0?0:0|x(v.length);Q=d(Q,S);for(var $=0;$<S;$+=1)Q[$]=255&v[$];return Q}function x(Q){if(Q>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|Q}function A(Q,v){if(f.isBuffer(Q))return Q.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(Q)||Q instanceof ArrayBuffer))return Q.byteLength;typeof Q!="string"&&(Q=""+Q);var S=Q.length;if(S===0)return 0;for(var $=!1;;)switch(v){case"ascii":case"latin1":case"binary":return S;case"utf8":case"utf-8":case void 0:return Pt(Q).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*S;case"hex":return S>>>1;case"base64":return Qe(Q).length;default:if($)return Pt(Q).length;v=(""+v).toLowerCase(),$=!0}}function I(Q,v,S){var $=!1;if((v===void 0||v<0)&&(v=0),v>this.length||((S===void 0||S>this.length)&&(S=this.length),S<=0)||(S>>>=0)<=(v>>>=0))return"";for(Q||(Q="utf8");;)switch(Q){case"hex":return lt(this,v,S);case"utf8":case"utf-8":return xe(this,v,S);case"ascii":return Le(this,v,S);case"latin1":case"binary":return ct(this,v,S);case"base64":return me(this,v,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Rt(this,v,S);default:if($)throw new TypeError("Unknown encoding: "+Q);Q=(Q+"").toLowerCase(),$=!0}}function D(Q,v,S){var $=Q[v];Q[v]=Q[S],Q[S]=$}function U(Q,v,S,$,Y){if(Q.length===0)return-1;if(typeof S=="string"?($=S,S=0):S>2147483647?S=2147483647:S<-2147483648&&(S=-2147483648),S=+S,isNaN(S)&&(S=Y?0:Q.length-1),S<0&&(S=Q.length+S),S>=Q.length){if(Y)return-1;S=Q.length-1}else if(S<0){if(!Y)return-1;S=0}if(typeof v=="string"&&(v=f.from(v,$)),f.isBuffer(v))return v.length===0?-1:z(Q,v,S,$,Y);if(typeof v=="number")return v&=255,f.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Y?Uint8Array.prototype.indexOf.call(Q,v,S):Uint8Array.prototype.lastIndexOf.call(Q,v,S):z(Q,[v],S,$,Y);throw new TypeError("val must be string, number or Buffer")}function z(Q,v,S,$,Y){var ue,de=1,ve=Q.length,Ie=v.length;if($!==void 0&&(($=String($).toLowerCase())==="ucs2"||$==="ucs-2"||$==="utf16le"||$==="utf-16le")){if(Q.length<2||v.length<2)return-1;de=2,ve/=2,Ie/=2,S/=2}function Ve(Ht,Se){return de===1?Ht[Se]:Ht.readUInt16BE(Se*de)}if(Y){var De=-1;for(ue=S;ue<ve;ue++)if(Ve(Q,ue)===Ve(v,De===-1?0:ue-De)){if(De===-1&&(De=ue),ue-De+1===Ie)return De*de}else De!==-1&&(ue-=ue-De),De=-1}else for(S+Ie>ve&&(S=ve-Ie),ue=S;ue>=0;ue--){for(var Me=!0,Xe=0;Xe<Ie;Xe++)if(Ve(Q,ue+Xe)!==Ve(v,Xe)){Me=!1;break}if(Me)return ue}return-1}function P(Q,v,S,$){S=Number(S)||0;var Y=Q.length-S;$?($=Number($))>Y&&($=Y):$=Y;var ue=v.length;if(ue%2!=0)throw new TypeError("Invalid hex string");$>ue/2&&($=ue/2);for(var de=0;de<$;++de){var ve=parseInt(v.substr(2*de,2),16);if(isNaN(ve))return de;Q[S+de]=ve}return de}function F(Q,v,S,$){return $e(Pt(v,Q.length-S),Q,S,$)}function te(Q,v,S,$){return $e(function(ue){for(var de=[],ve=0;ve<ue.length;++ve)de.push(255&ue.charCodeAt(ve));return de}(v),Q,S,$)}function oe(Q,v,S,$){return te(Q,v,S,$)}function M(Q,v,S,$){return $e(Qe(v),Q,S,$)}function he(Q,v,S,$){return $e(function(ue,de){for(var ve,Ie,Ve,De=[],Me=0;Me<ue.length&&!((de-=2)<0);++Me)Ie=(ve=ue.charCodeAt(Me))>>8,Ve=ve%256,De.push(Ve),De.push(Ie);return De}(v,Q.length-S),Q,S,$)}function me(Q,v,S){return v===0&&S===Q.length?i.fromByteArray(Q):i.fromByteArray(Q.slice(v,S))}function xe(Q,v,S){S=Math.min(Q.length,S);for(var $=[],Y=v;Y<S;){var ue,de,ve,Ie,Ve=Q[Y],De=null,Me=Ve>239?4:Ve>223?3:Ve>191?2:1;if(Y+Me<=S)switch(Me){case 1:Ve<128&&(De=Ve);break;case 2:(192&(ue=Q[Y+1]))==128&&(Ie=(31&Ve)<<6|63&ue)>127&&(De=Ie);break;case 3:ue=Q[Y+1],de=Q[Y+2],(192&ue)==128&&(192&de)==128&&(Ie=(15&Ve)<<12|(63&ue)<<6|63&de)>2047&&(Ie<55296||Ie>57343)&&(De=Ie);break;case 4:ue=Q[Y+1],de=Q[Y+2],ve=Q[Y+3],(192&ue)==128&&(192&de)==128&&(192&ve)==128&&(Ie=(15&Ve)<<18|(63&ue)<<12|(63&de)<<6|63&ve)>65535&&Ie<1114112&&(De=Ie)}De===null?(De=65533,Me=1):De>65535&&(De-=65536,$.push(De>>>10&1023|55296),De=56320|1023&De),$.push(De),Y+=Me}return function(Ht){var Se=Ht.length;if(Se<=ze)return String.fromCharCode.apply(String,Ht);for(var Ke="",Pe=0;Pe<Se;)Ke+=String.fromCharCode.apply(String,Ht.slice(Pe,Pe+=ze));return Ke}($)}e.Buffer=f,e.SlowBuffer=function(v){return+v!=v&&(v=0),f.alloc(+v)},e.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=n.TYPED_ARRAY_SUPPORT!==void 0?n.TYPED_ARRAY_SUPPORT:function(){try{var v=new Uint8Array(1);return v.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},v.foo()===42&&typeof v.subarray=="function"&&v.subarray(1,1).byteLength===0}catch{return!1}}(),e.kMaxLength=l(),f.poolSize=8192,f._augment=function(Q){return Q.__proto__=f.prototype,Q},f.from=function(Q,v,S){return g(null,Q,v,S)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(Q,v,S){return function(Y,ue,de,ve){return _(ue),ue<=0?d(Y,ue):de!==void 0?typeof ve=="string"?d(Y,ue).fill(de,ve):d(Y,ue).fill(de):d(Y,ue)}(null,Q,v,S)},f.allocUnsafe=function(Q){return w(null,Q)},f.allocUnsafeSlow=function(Q){return w(null,Q)},f.isBuffer=function(v){return!(v==null||!v._isBuffer)},f.compare=function(v,S){if(!f.isBuffer(v)||!f.isBuffer(S))throw new TypeError("Arguments must be Buffers");if(v===S)return 0;for(var $=v.length,Y=S.length,ue=0,de=Math.min($,Y);ue<de;++ue)if(v[ue]!==S[ue]){$=v[ue],Y=S[ue];break}return $<Y?-1:Y<$?1:0},f.isEncoding=function(v){switch(String(v).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(v,S){if(!u(v))throw new TypeError('"list" argument must be an Array of Buffers');if(v.length===0)return f.alloc(0);var $;if(S===void 0)for(S=0,$=0;$<v.length;++$)S+=v[$].length;var Y=f.allocUnsafe(S),ue=0;for($=0;$<v.length;++$){var de=v[$];if(!f.isBuffer(de))throw new TypeError('"list" argument must be an Array of Buffers');de.copy(Y,ue),ue+=de.length}return Y},f.byteLength=A,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var v=this.length;if(v%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var S=0;S<v;S+=2)D(this,S,S+1);return this},f.prototype.swap32=function(){var v=this.length;if(v%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var S=0;S<v;S+=4)D(this,S,S+3),D(this,S+1,S+2);return this},f.prototype.swap64=function(){var v=this.length;if(v%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var S=0;S<v;S+=8)D(this,S,S+7),D(this,S+1,S+6),D(this,S+2,S+5),D(this,S+3,S+4);return this},f.prototype.toString=function(){var v=0|this.length;return v===0?"":arguments.length===0?xe(this,0,v):I.apply(this,arguments)},f.prototype.equals=function(v){if(!f.isBuffer(v))throw new TypeError("Argument must be a Buffer");return this===v||f.compare(this,v)===0},f.prototype.inspect=function(){var v="",S=e.INSPECT_MAX_BYTES;return this.length>0&&(v=this.toString("hex",0,S).match(/.{2}/g).join(" "),this.length>S&&(v+=" ... ")),"<Buffer "+v+">"},f.prototype.compare=function(v,S,$,Y,ue){if(!f.isBuffer(v))throw new TypeError("Argument must be a Buffer");if(S===void 0&&(S=0),$===void 0&&($=v?v.length:0),Y===void 0&&(Y=0),ue===void 0&&(ue=this.length),S<0||$>v.length||Y<0||ue>this.length)throw new RangeError("out of range index");if(Y>=ue&&S>=$)return 0;if(Y>=ue)return-1;if(S>=$)return 1;if(this===v)return 0;for(var de=(ue>>>=0)-(Y>>>=0),ve=($>>>=0)-(S>>>=0),Ie=Math.min(de,ve),Ve=this.slice(Y,ue),De=v.slice(S,$),Me=0;Me<Ie;++Me)if(Ve[Me]!==De[Me]){de=Ve[Me],ve=De[Me];break}return de<ve?-1:ve<de?1:0},f.prototype.includes=function(v,S,$){return this.indexOf(v,S,$)!==-1},f.prototype.indexOf=function(v,S,$){return U(this,v,S,$,!0)},f.prototype.lastIndexOf=function(v,S,$){return U(this,v,S,$,!1)},f.prototype.write=function(v,S,$,Y){if(S===void 0)Y="utf8",$=this.length,S=0;else if($===void 0&&typeof S=="string")Y=S,$=this.length,S=0;else{if(!isFinite(S))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");S|=0,isFinite($)?($|=0,Y===void 0&&(Y="utf8")):(Y=$,$=void 0)}var ue=this.length-S;if(($===void 0||$>ue)&&($=ue),v.length>0&&($<0||S<0)||S>this.length)throw new RangeError("Attempt to write outside buffer bounds");Y||(Y="utf8");for(var de=!1;;)switch(Y){case"hex":return P(this,v,S,$);case"utf8":case"utf-8":return F(this,v,S,$);case"ascii":return te(this,v,S,$);case"latin1":case"binary":return oe(this,v,S,$);case"base64":return M(this,v,S,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,v,S,$);default:if(de)throw new TypeError("Unknown encoding: "+Y);Y=(""+Y).toLowerCase(),de=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ze=4096;function Le(Q,v,S){var $="";S=Math.min(Q.length,S);for(var Y=v;Y<S;++Y)$+=String.fromCharCode(127&Q[Y]);return $}function ct(Q,v,S){var $="";S=Math.min(Q.length,S);for(var Y=v;Y<S;++Y)$+=String.fromCharCode(Q[Y]);return $}function lt(Q,v,S){var $=Q.length;(!v||v<0)&&(v=0),(!S||S<0||S>$)&&(S=$);for(var Y="",ue=v;ue<S;++ue)Y+=wt(Q[ue]);return Y}function Rt(Q,v,S){for(var $=Q.slice(v,S),Y="",ue=0;ue<$.length;ue+=2)Y+=String.fromCharCode($[ue]+256*$[ue+1]);return Y}function Re(Q,v,S){if(Q%1!=0||Q<0)throw new RangeError("offset is not uint");if(Q+v>S)throw new RangeError("Trying to access beyond buffer length")}function Oe(Q,v,S,$,Y,ue){if(!f.isBuffer(Q))throw new TypeError('"buffer" argument must be a Buffer instance');if(v>Y||v<ue)throw new RangeError('"value" argument is out of bounds');if(S+$>Q.length)throw new RangeError("Index out of range")}function _t(Q,v,S,$){v<0&&(v=65535+v+1);for(var Y=0,ue=Math.min(Q.length-S,2);Y<ue;++Y)Q[S+Y]=(v&255<<8*($?Y:1-Y))>>>8*($?Y:1-Y)}function je(Q,v,S,$){v<0&&(v=4294967295+v+1);for(var Y=0,ue=Math.min(Q.length-S,4);Y<ue;++Y)Q[S+Y]=v>>>8*($?Y:3-Y)&255}function qe(Q,v,S,$,Y,ue){if(S+$>Q.length)throw new RangeError("Index out of range");if(S<0)throw new RangeError("Index out of range")}function Ft(Q,v,S,$,Y){return Y||qe(Q,0,S,4),a.write(Q,v,S,$,23,4),S+4}function Mt(Q,v,S,$,Y){return Y||qe(Q,0,S,8),a.write(Q,v,S,$,52,8),S+8}f.prototype.slice=function(v,S){var $,Y=this.length;if((v=~~v)<0?(v+=Y)<0&&(v=0):v>Y&&(v=Y),(S=S===void 0?Y:~~S)<0?(S+=Y)<0&&(S=0):S>Y&&(S=Y),S<v&&(S=v),f.TYPED_ARRAY_SUPPORT)($=this.subarray(v,S)).__proto__=f.prototype;else{var ue=S-v;$=new f(ue,void 0);for(var de=0;de<ue;++de)$[de]=this[de+v]}return $},f.prototype.readUIntLE=function(v,S,$){v|=0,S|=0,$||Re(v,S,this.length);for(var Y=this[v],ue=1,de=0;++de<S&&(ue*=256);)Y+=this[v+de]*ue;return Y},f.prototype.readUIntBE=function(v,S,$){v|=0,S|=0,$||Re(v,S,this.length);for(var Y=this[v+--S],ue=1;S>0&&(ue*=256);)Y+=this[v+--S]*ue;return Y},f.prototype.readUInt8=function(v,S){return S||Re(v,1,this.length),this[v]},f.prototype.readUInt16LE=function(v,S){return S||Re(v,2,this.length),this[v]|this[v+1]<<8},f.prototype.readUInt16BE=function(v,S){return S||Re(v,2,this.length),this[v]<<8|this[v+1]},f.prototype.readUInt32LE=function(v,S){return S||Re(v,4,this.length),(this[v]|this[v+1]<<8|this[v+2]<<16)+16777216*this[v+3]},f.prototype.readUInt32BE=function(v,S){return S||Re(v,4,this.length),16777216*this[v]+(this[v+1]<<16|this[v+2]<<8|this[v+3])},f.prototype.readIntLE=function(v,S,$){v|=0,S|=0,$||Re(v,S,this.length);for(var Y=this[v],ue=1,de=0;++de<S&&(ue*=256);)Y+=this[v+de]*ue;return Y>=(ue*=128)&&(Y-=Math.pow(2,8*S)),Y},f.prototype.readIntBE=function(v,S,$){v|=0,S|=0,$||Re(v,S,this.length);for(var Y=S,ue=1,de=this[v+--Y];Y>0&&(ue*=256);)de+=this[v+--Y]*ue;return de>=(ue*=128)&&(de-=Math.pow(2,8*S)),de},f.prototype.readInt8=function(v,S){return S||Re(v,1,this.length),128&this[v]?-1*(255-this[v]+1):this[v]},f.prototype.readInt16LE=function(v,S){S||Re(v,2,this.length);var $=this[v]|this[v+1]<<8;return 32768&$?4294901760|$:$},f.prototype.readInt16BE=function(v,S){S||Re(v,2,this.length);var $=this[v+1]|this[v]<<8;return 32768&$?4294901760|$:$},f.prototype.readInt32LE=function(v,S){return S||Re(v,4,this.length),this[v]|this[v+1]<<8|this[v+2]<<16|this[v+3]<<24},f.prototype.readInt32BE=function(v,S){return S||Re(v,4,this.length),this[v]<<24|this[v+1]<<16|this[v+2]<<8|this[v+3]},f.prototype.readFloatLE=function(v,S){return S||Re(v,4,this.length),a.read(this,v,!0,23,4)},f.prototype.readFloatBE=function(v,S){return S||Re(v,4,this.length),a.read(this,v,!1,23,4)},f.prototype.readDoubleLE=function(v,S){return S||Re(v,8,this.length),a.read(this,v,!0,52,8)},f.prototype.readDoubleBE=function(v,S){return S||Re(v,8,this.length),a.read(this,v,!1,52,8)},f.prototype.writeUIntLE=function(v,S,$,Y){v=+v,S|=0,$|=0,Y||Oe(this,v,S,$,Math.pow(2,8*$)-1,0);var ue=1,de=0;for(this[S]=255&v;++de<$&&(ue*=256);)this[S+de]=v/ue&255;return S+$},f.prototype.writeUIntBE=function(v,S,$,Y){v=+v,S|=0,$|=0,Y||Oe(this,v,S,$,Math.pow(2,8*$)-1,0);var ue=$-1,de=1;for(this[S+ue]=255&v;--ue>=0&&(de*=256);)this[S+ue]=v/de&255;return S+$},f.prototype.writeUInt8=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,1,255,0),f.TYPED_ARRAY_SUPPORT||(v=Math.floor(v)),this[S]=255&v,S+1},f.prototype.writeUInt16LE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[S]=255&v,this[S+1]=v>>>8):_t(this,v,S,!0),S+2},f.prototype.writeUInt16BE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[S]=v>>>8,this[S+1]=255&v):_t(this,v,S,!1),S+2},f.prototype.writeUInt32LE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[S+3]=v>>>24,this[S+2]=v>>>16,this[S+1]=v>>>8,this[S]=255&v):je(this,v,S,!0),S+4},f.prototype.writeUInt32BE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[S]=v>>>24,this[S+1]=v>>>16,this[S+2]=v>>>8,this[S+3]=255&v):je(this,v,S,!1),S+4},f.prototype.writeIntLE=function(v,S,$,Y){if(v=+v,S|=0,!Y){var ue=Math.pow(2,8*$-1);Oe(this,v,S,$,ue-1,-ue)}var de=0,ve=1,Ie=0;for(this[S]=255&v;++de<$&&(ve*=256);)v<0&&Ie===0&&this[S+de-1]!==0&&(Ie=1),this[S+de]=(v/ve>>0)-Ie&255;return S+$},f.prototype.writeIntBE=function(v,S,$,Y){if(v=+v,S|=0,!Y){var ue=Math.pow(2,8*$-1);Oe(this,v,S,$,ue-1,-ue)}var de=$-1,ve=1,Ie=0;for(this[S+de]=255&v;--de>=0&&(ve*=256);)v<0&&Ie===0&&this[S+de+1]!==0&&(Ie=1),this[S+de]=(v/ve>>0)-Ie&255;return S+$},f.prototype.writeInt8=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,1,127,-128),f.TYPED_ARRAY_SUPPORT||(v=Math.floor(v)),v<0&&(v=255+v+1),this[S]=255&v,S+1},f.prototype.writeInt16LE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[S]=255&v,this[S+1]=v>>>8):_t(this,v,S,!0),S+2},f.prototype.writeInt16BE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[S]=v>>>8,this[S+1]=255&v):_t(this,v,S,!1),S+2},f.prototype.writeInt32LE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[S]=255&v,this[S+1]=v>>>8,this[S+2]=v>>>16,this[S+3]=v>>>24):je(this,v,S,!0),S+4},f.prototype.writeInt32BE=function(v,S,$){return v=+v,S|=0,$||Oe(this,v,S,4,2147483647,-2147483648),v<0&&(v=4294967295+v+1),f.TYPED_ARRAY_SUPPORT?(this[S]=v>>>24,this[S+1]=v>>>16,this[S+2]=v>>>8,this[S+3]=255&v):je(this,v,S,!1),S+4},f.prototype.writeFloatLE=function(v,S,$){return Ft(this,v,S,!0,$)},f.prototype.writeFloatBE=function(v,S,$){return Ft(this,v,S,!1,$)},f.prototype.writeDoubleLE=function(v,S,$){return Mt(this,v,S,!0,$)},f.prototype.writeDoubleBE=function(v,S,$){return Mt(this,v,S,!1,$)},f.prototype.copy=function(v,S,$,Y){if($||($=0),Y||Y===0||(Y=this.length),S>=v.length&&(S=v.length),S||(S=0),Y>0&&Y<$&&(Y=$),Y===$||v.length===0||this.length===0)return 0;if(S<0)throw new RangeError("targetStart out of bounds");if($<0||$>=this.length)throw new RangeError("sourceStart out of bounds");if(Y<0)throw new RangeError("sourceEnd out of bounds");Y>this.length&&(Y=this.length),v.length-S<Y-$&&(Y=v.length-S+$);var ue,de=Y-$;if(this===v&&$<S&&S<Y)for(ue=de-1;ue>=0;--ue)v[ue+S]=this[ue+$];else if(de<1e3||!f.TYPED_ARRAY_SUPPORT)for(ue=0;ue<de;++ue)v[ue+S]=this[ue+$];else Uint8Array.prototype.set.call(v,this.subarray($,$+de),S);return de},f.prototype.fill=function(v,S,$,Y){if(typeof v=="string"){if(typeof S=="string"?(Y=S,S=0,$=this.length):typeof $=="string"&&(Y=$,$=this.length),v.length===1){var ue=v.charCodeAt(0);ue<256&&(v=ue)}if(Y!==void 0&&typeof Y!="string")throw new TypeError("encoding must be a string");if(typeof Y=="string"&&!f.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y)}else typeof v=="number"&&(v&=255);if(S<0||this.length<S||this.length<$)throw new RangeError("Out of range index");if($<=S)return this;var de;if(S>>>=0,$=$===void 0?this.length:$>>>0,v||(v=0),typeof v=="number")for(de=S;de<$;++de)this[de]=v;else{var ve=f.isBuffer(v)?v:Pt(new f(v,Y).toString()),Ie=ve.length;for(de=0;de<$-S;++de)this[de+S]=ve[de%Ie]}return this};var tr=/[^+\/0-9A-Za-z-_]/g;function wt(Q){return Q<16?"0"+Q.toString(16):Q.toString(16)}function Pt(Q,v){var S;v=v||1/0;for(var $=Q.length,Y=null,ue=[],de=0;de<$;++de){if((S=Q.charCodeAt(de))>55295&&S<57344){if(!Y){if(S>56319){(v-=3)>-1&&ue.push(239,191,189);continue}if(de+1===$){(v-=3)>-1&&ue.push(239,191,189);continue}Y=S;continue}if(S<56320){(v-=3)>-1&&ue.push(239,191,189),Y=S;continue}S=65536+(Y-55296<<10|S-56320)}else Y&&(v-=3)>-1&&ue.push(239,191,189);if(Y=null,S<128){if((v-=1)<0)break;ue.push(S)}else if(S<2048){if((v-=2)<0)break;ue.push(S>>6|192,63&S|128)}else if(S<65536){if((v-=3)<0)break;ue.push(S>>12|224,S>>6&63|128,63&S|128)}else{if(!(S<1114112))throw new Error("Invalid code point");if((v-=4)<0)break;ue.push(S>>18|240,S>>12&63|128,S>>6&63|128,63&S|128)}}return ue}function Qe(Q){return i.toByteArray(function(S){if((S=function(Y){return Y.trim?Y.trim():Y.replace(/^\s+|\s+$/g,"")}(S).replace(tr,"")).length<2)return"";for(;S.length%4!=0;)S+="=";return S}(Q))}function $e(Q,v,S,$){for(var Y=0;Y<$&&!(Y+S>=v.length||Y>=Q.length);++Y)v[Y+S]=Q[Y];return Y}}).call(this,r(29))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch{typeof window=="object"&&(r=window)}t.exports=r},function(t,e,r){"use strict";e.byteLength=function(w){var E=f(w),x=E[0],A=E[1];return 3*(x+A)/4-A},e.toByteArray=function(w){var E,x,A=f(w),I=A[0],D=A[1],U=new a(function(te,oe,M){return 3*(oe+M)/4-M}(0,I,D)),z=0,P=D>0?I-4:I;for(x=0;x<P;x+=4)E=i[w.charCodeAt(x)]<<18|i[w.charCodeAt(x+1)]<<12|i[w.charCodeAt(x+2)]<<6|i[w.charCodeAt(x+3)],U[z++]=E>>16&255,U[z++]=E>>8&255,U[z++]=255&E;return D===2&&(E=i[w.charCodeAt(x)]<<2|i[w.charCodeAt(x+1)]>>4,U[z++]=255&E),D===1&&(E=i[w.charCodeAt(x)]<<10|i[w.charCodeAt(x+1)]<<4|i[w.charCodeAt(x+2)]>>2,U[z++]=E>>8&255,U[z++]=255&E),U},e.fromByteArray=function(w){for(var E,x=w.length,A=x%3,I=[],D=16383,U=0,z=x-A;U<z;U+=D)I.push(g(w,U,U+D>z?z:U+D));return A===1?(E=w[x-1],I.push(n[E>>2]+n[E<<4&63]+"==")):A===2&&(E=(w[x-2]<<8)+w[x-1],I.push(n[E>>10]+n[E>>4&63]+n[E<<2&63]+"=")),I.join("")};for(var n=[],i=[],a=typeof Uint8Array<"u"?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,d=u.length;l<d;++l)n[l]=u[l],i[u.charCodeAt(l)]=l;function f(_){var w=_.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var E=_.indexOf("=");return E===-1&&(E=w),[E,E===w?0:4-E%4]}function g(_,w,E){for(var x,A,I=[],D=w;D<E;D+=3)x=(_[D]<<16&16711680)+(_[D+1]<<8&65280)+(255&_[D+2]),I.push(n[(A=x)>>18&63]+n[A>>12&63]+n[A>>6&63]+n[63&A]);return I.join("")}i[45]=62,i[95]=63},function(t,e){e.read=function(r,n,i,a,u){var l,d,f=8*u-a-1,g=(1<<f)-1,_=g>>1,w=-7,E=i?u-1:0,x=i?-1:1,A=r[n+E];for(E+=x,l=A&(1<<-w)-1,A>>=-w,w+=f;w>0;l=256*l+r[n+E],E+=x,w-=8);for(d=l&(1<<-w)-1,l>>=-w,w+=a;w>0;d=256*d+r[n+E],E+=x,w-=8);if(l===0)l=1-_;else{if(l===g)return d?NaN:1/0*(A?-1:1);d+=Math.pow(2,a),l-=_}return(A?-1:1)*d*Math.pow(2,l-a)},e.write=function(r,n,i,a,u,l){var d,f,g,_=8*l-u-1,w=(1<<_)-1,E=w>>1,x=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=a?0:l-1,I=a?1:-1,D=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(f=isNaN(n)?1:0,d=w):(d=Math.floor(Math.log(n)/Math.LN2),n*(g=Math.pow(2,-d))<1&&(d--,g*=2),(n+=d+E>=1?x/g:x*Math.pow(2,1-E))*g>=2&&(d++,g/=2),d+E>=w?(f=0,d=w):d+E>=1?(f=(n*g-1)*Math.pow(2,u),d+=E):(f=n*Math.pow(2,E-1)*Math.pow(2,u),d=0));u>=8;r[i+A]=255&f,A+=I,f/=256,u-=8);for(d=d<<u|f,_+=u;_>0;r[i+A]=255&d,A+=I,d/=256,_-=8);r[i+A-I]|=128*D}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(n){return r.call(n)=="[object Array]"}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(a){var u=a.jws,l=a.KeyUtil,d=a.X509,f=a.crypto,g=a.hextob64u,_=a.b64tohex,w=a.AllowedSigningAlgs;return function(){function E(){(function(A,I){if(!(A instanceof I))throw new TypeError("Cannot call a class as a function")})(this,E)}return E.parseJwt=function(A){n.Log.debug("JoseUtil.parseJwt");try{var I=u.JWS.parse(A);return{header:I.headerObj,payload:I.payloadObj}}catch(D){n.Log.error(D)}},E.validateJwt=function(A,I,D,U,z,P,F){n.Log.debug("JoseUtil.validateJwt");try{if(I.kty==="RSA")if(I.e&&I.n)I=l.getKey(I);else{if(!I.x5c||!I.x5c.length)return n.Log.error("JoseUtil.validateJwt: RSA key missing key material",I),Promise.reject(new Error("RSA key missing key material"));var te=_(I.x5c[0]);I=d.getPublicKeyFromCertHex(te)}else{if(I.kty!=="EC")return n.Log.error("JoseUtil.validateJwt: Unsupported key type",I&&I.kty),Promise.reject(new Error(I.kty));if(!(I.crv&&I.x&&I.y))return n.Log.error("JoseUtil.validateJwt: EC key missing key material",I),Promise.reject(new Error("EC key missing key material"));I=l.getKey(I)}return E._validateJwt(A,I,D,U,z,P,F)}catch(oe){return n.Log.error(oe&&oe.message||oe),Promise.reject("JWT validation failed")}},E.validateJwtAttributes=function(A,I,D,U,z,P){U||(U=0),z||(z=parseInt(Date.now()/1e3));var F=E.parseJwt(A).payload;if(!F.iss)return n.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(F.iss!==I)return n.Log.error("JoseUtil._validateJwt: Invalid issuer in token",F.iss),Promise.reject(new Error("Invalid issuer in token: "+F.iss));if(!F.aud)return n.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(F.aud===D||Array.isArray(F.aud)&&F.aud.indexOf(D)>=0))return n.Log.error("JoseUtil._validateJwt: Invalid audience in token",F.aud),Promise.reject(new Error("Invalid audience in token: "+F.aud));if(F.azp&&F.azp!==D)return n.Log.error("JoseUtil._validateJwt: Invalid azp in token",F.azp),Promise.reject(new Error("Invalid azp in token: "+F.azp));if(!P){var te=z+U,oe=z-U;if(!F.iat)return n.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(te<F.iat)return n.Log.error("JoseUtil._validateJwt: iat is in the future",F.iat),Promise.reject(new Error("iat is in the future: "+F.iat));if(F.nbf&&te<F.nbf)return n.Log.error("JoseUtil._validateJwt: nbf is in the future",F.nbf),Promise.reject(new Error("nbf is in the future: "+F.nbf));if(!F.exp)return n.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(F.exp<oe)return n.Log.error("JoseUtil._validateJwt: exp is in the past",F.exp),Promise.reject(new Error("exp is in the past:"+F.exp))}return Promise.resolve(F)},E._validateJwt=function(A,I,D,U,z,P,F){return E.validateJwtAttributes(A,D,U,z,P,F).then(function(te){try{return u.JWS.verify(A,I,w)?te:(n.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(oe){return n.Log.error(oe&&oe.message||oe),Promise.reject(new Error("signature validation failed"))}})},E.hashString=function(A,I){try{return f.Util.hashString(A,I)}catch(D){n.Log.error(D)}},E.hexToBase64Url=function(A){try{return g(A)}catch(I){n.Log.error(I)}},E}()};var n=r(0);t.exports=e.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninResponse=void 0;var n=function(){function u(l,d){for(var f=0;f<d.length;f++){var g=d[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(l,d,f){return d&&u(l.prototype,d),f&&u(l,f),l}}(),i=r(3);function a(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}e.SigninResponse=function(){function u(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";a(this,u);var f=i.UrlUtility.parseUrlFragment(l,d);this.error=f.error,this.error_description=f.error_description,this.error_uri=f.error_uri,this.code=f.code,this.state=f.state,this.id_token=f.id_token,this.session_state=f.session_state,this.access_token=f.access_token,this.token_type=f.token_type,this.scope=f.scope,this.profile=void 0,this.expires_in=f.expires_in}return n(u,[{key:"expires_in",get:function(){if(this.expires_at){var d=parseInt(Date.now()/1e3);return this.expires_at-d}},set:function(d){var f=parseInt(d);if(typeof f=="number"&&f>0){var g=parseInt(Date.now()/1e3);this.expires_at=g+f}}},{key:"expired",get:function(){var d=this.expires_in;if(d!==void 0)return d<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignoutRequest=void 0;var n=r(0),i=r(3),a=r(9);e.SignoutRequest=function u(l){var d=l.url,f=l.id_token_hint,g=l.post_logout_redirect_uri,_=l.data,w=l.extraQueryParams,E=l.request_type;if(function(I,D){if(!(I instanceof D))throw new TypeError("Cannot call a class as a function")}(this,u),!d)throw n.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var x in f&&(d=i.UrlUtility.addQueryParam(d,"id_token_hint",f)),g&&(d=i.UrlUtility.addQueryParam(d,"post_logout_redirect_uri",g),_&&(this.state=new a.State({data:_,request_type:E}),d=i.UrlUtility.addQueryParam(d,"state",this.state.id))),w)d=i.UrlUtility.addQueryParam(d,x,w[x]);this.url=d}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignoutResponse=void 0;var n=r(3);e.SignoutResponse=function i(a){(function(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")})(this,i);var u=n.UrlUtility.parseUrlFragment(a,"?");this.error=u.error,this.error_description=u.error_description,this.error_uri=u.error_uri,this.state=u.state}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InMemoryWebStorage=void 0;var n=function(){function a(u,l){for(var d=0;d<l.length;d++){var f=l[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,l,d){return l&&a(u.prototype,l),d&&a(u,d),u}}(),i=r(0);e.InMemoryWebStorage=function(){function a(){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a),this._data={}}return a.prototype.getItem=function(l){return i.Log.debug("InMemoryWebStorage.getItem",l),this._data[l]},a.prototype.setItem=function(l,d){i.Log.debug("InMemoryWebStorage.setItem",l),this._data[l]=d},a.prototype.removeItem=function(l){i.Log.debug("InMemoryWebStorage.removeItem",l),delete this._data[l]},a.prototype.key=function(l){return Object.getOwnPropertyNames(this._data)[l]},n(a,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManager=void 0;var n=function(){function D(U,z){for(var P=0;P<z.length;P++){var F=z[P];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(U,F.key,F)}}return function(U,z,P){return z&&D(U.prototype,z),P&&D(U,P),U}}(),i=r(0),a=r(10),u=r(39),l=r(15),d=r(45),f=r(47),g=r(18),_=r(8),w=r(20),E=r(11),x=r(4);function A(D,U){if(!(D instanceof U))throw new TypeError("Cannot call a class as a function")}function I(D,U){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!U||typeof U!="object"&&typeof U!="function"?D:U}e.UserManager=function(D){function U(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f.SilentRenewService,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.SessionMonitor,te=arguments.length>3&&arguments[3]!==void 0?arguments[3]:w.TokenRevocationClient,oe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:E.TokenClient,M=arguments.length>5&&arguments[5]!==void 0?arguments[5]:x.JoseUtil;A(this,U),z instanceof u.UserManagerSettings||(z=new u.UserManagerSettings(z));var he=I(this,D.call(this,z));return he._events=new d.UserManagerEvents(z),he._silentRenewService=new P(he),he.settings.automaticSilentRenew&&(i.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),he.startSilentRenew()),he.settings.monitorSession&&(i.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),he._sessionMonitor=new F(he)),he._tokenRevocationClient=new te(he._settings),he._tokenClient=new oe(he._settings),he._joseUtil=M,he}return function(P,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);P.prototype=Object.create(F&&F.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(P,F):P.__proto__=F)}(U,D),U.prototype.getUser=function(){var P=this;return this._loadUser().then(function(F){return F?(i.Log.info("UserManager.getUser: user loaded"),P._events.load(F,!1),F):(i.Log.info("UserManager.getUser: user not found in storage"),null)})},U.prototype.removeUser=function(){var P=this;return this.storeUser(null).then(function(){i.Log.info("UserManager.removeUser: user removed from storage"),P._events.unload()})},U.prototype.signinRedirect=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(P=Object.assign({},P)).request_type="si:r";var F={useReplaceToNavigate:P.useReplaceToNavigate};return this._signinStart(P,this._redirectNavigator,F).then(function(){i.Log.info("UserManager.signinRedirect: successful")})},U.prototype.signinRedirectCallback=function(P){return this._signinEnd(P||this._redirectNavigator.url).then(function(F){return F.profile&&F.profile.sub?i.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",F.profile.sub):i.Log.info("UserManager.signinRedirectCallback: no sub"),F})},U.prototype.signinPopup=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(P=Object.assign({},P)).request_type="si:p";var F=P.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return F?(P.redirect_uri=F,P.display="popup",this._signin(P,this._popupNavigator,{startUrl:F,popupWindowFeatures:P.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:P.popupWindowTarget||this.settings.popupWindowTarget}).then(function(te){return te&&(te.profile&&te.profile.sub?i.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",te.profile.sub):i.Log.info("UserManager.signinPopup: no sub")),te})):(i.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},U.prototype.signinPopupCallback=function(P){return this._signinCallback(P,this._popupNavigator).then(function(F){return F&&(F.profile&&F.profile.sub?i.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",F.profile.sub):i.Log.info("UserManager.signinPopupCallback: no sub")),F}).catch(function(F){i.Log.error(F.message)})},U.prototype.signinSilent=function(){var P=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return F=Object.assign({},F),this._loadUser().then(function(te){return te&&te.refresh_token?(F.refresh_token=te.refresh_token,P._useRefreshToken(F)):(F.request_type="si:s",F.id_token_hint=F.id_token_hint||P.settings.includeIdTokenInSilentRenew&&te&&te.id_token,te&&P._settings.validateSubOnSilentRenew&&(i.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",te.profile.sub),F.current_sub=te.profile.sub),P._signinSilentIframe(F))})},U.prototype._useRefreshToken=function(){var P=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(F).then(function(te){return te?te.access_token?P._loadUser().then(function(oe){if(oe){var M=Promise.resolve();return te.id_token&&(M=P._validateIdTokenFromTokenRefreshToken(oe.profile,te.id_token)),M.then(function(){return i.Log.debug("UserManager._useRefreshToken: refresh token response success"),oe.id_token=te.id_token||oe.id_token,oe.access_token=te.access_token,oe.refresh_token=te.refresh_token||oe.refresh_token,oe.expires_in=te.expires_in,P.storeUser(oe).then(function(){return P._events.load(oe),oe})})}return null}):(i.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(i.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},U.prototype._validateIdTokenFromTokenRefreshToken=function(P,F){var te=this;return this._metadataService.getIssuer().then(function(oe){return te.settings.getEpochTime().then(function(M){return te._joseUtil.validateJwtAttributes(F,oe,te._settings.client_id,te._settings.clockSkew,M).then(function(he){return he?he.sub!==P.sub?(i.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):he.auth_time&&he.auth_time!==P.auth_time?(i.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):he.azp&&he.azp!==P.azp?(i.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!he.azp&&P.azp?(i.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(i.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},U.prototype._signinSilentIframe=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=P.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return F?(P.redirect_uri=F,P.prompt=P.prompt||"none",this._signin(P,this._iframeNavigator,{startUrl:F,silentRequestTimeout:P.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(te){return te&&(te.profile&&te.profile.sub?i.Log.info("UserManager.signinSilent: successful, signed in sub: ",te.profile.sub):i.Log.info("UserManager.signinSilent: no sub")),te})):(i.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},U.prototype.signinSilentCallback=function(P){return this._signinCallback(P,this._iframeNavigator).then(function(F){return F&&(F.profile&&F.profile.sub?i.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",F.profile.sub):i.Log.info("UserManager.signinSilentCallback: no sub")),F})},U.prototype.signinCallback=function(P){var F=this;return this.readSigninResponseState(P).then(function(te){var oe=te.state;return te.response,oe.request_type==="si:r"?F.signinRedirectCallback(P):oe.request_type==="si:p"?F.signinPopupCallback(P):oe.request_type==="si:s"?F.signinSilentCallback(P):Promise.reject(new Error("invalid response_type in state"))})},U.prototype.signoutCallback=function(P,F){var te=this;return this.readSignoutResponseState(P).then(function(oe){var M=oe.state,he=oe.response;return M?M.request_type==="so:r"?te.signoutRedirectCallback(P):M.request_type==="so:p"?te.signoutPopupCallback(P,F):Promise.reject(new Error("invalid response_type in state")):he})},U.prototype.querySessionStatus=function(){var P=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(F=Object.assign({},F)).request_type="si:s";var te=F.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return te?(F.redirect_uri=te,F.prompt="none",F.response_type=F.response_type||this.settings.query_status_response_type,F.scope=F.scope||"openid",F.skipUserInfo=!0,this._signinStart(F,this._iframeNavigator,{startUrl:te,silentRequestTimeout:F.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(oe){return P.processSigninResponse(oe.url).then(function(M){if(i.Log.debug("UserManager.querySessionStatus: got signin response"),M.session_state&&M.profile.sub)return i.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",M.profile.sub),{session_state:M.session_state,sub:M.profile.sub,sid:M.profile.sid};i.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(M){if(M.session_state&&P.settings.monitorAnonymousSession&&(M.message=="login_required"||M.message=="consent_required"||M.message=="interaction_required"||M.message=="account_selection_required"))return i.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:M.session_state};throw M})})):(i.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},U.prototype._signin=function(P,F){var te=this,oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(P,F,oe).then(function(M){return te._signinEnd(M.url,P)})},U.prototype._signinStart=function(P,F){var te=this,oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return F.prepare(oe).then(function(M){return i.Log.debug("UserManager._signinStart: got navigator window handle"),te.createSigninRequest(P).then(function(he){return i.Log.debug("UserManager._signinStart: got signin request"),oe.url=he.url,oe.id=he.state.id,M.navigate(oe)}).catch(function(he){throw M.close&&(i.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),M.close()),he})})},U.prototype._signinEnd=function(P){var F=this,te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(P).then(function(oe){i.Log.debug("UserManager._signinEnd: got signin response");var M=new l.User(oe);if(te.current_sub){if(te.current_sub!==M.profile.sub)return i.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",M.profile.sub),Promise.reject(new Error("login_required"));i.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return F.storeUser(M).then(function(){return i.Log.debug("UserManager._signinEnd: user stored"),F._events.load(M),M})})},U.prototype._signinCallback=function(P,F){i.Log.debug("UserManager._signinCallback");var te=this._settings.response_mode==="query"||!this._settings.response_mode&&_.SigninRequest.isCode(this._settings.response_type)?"?":"#";return F.callback(P,void 0,te)},U.prototype.signoutRedirect=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(P=Object.assign({},P)).request_type="so:r";var F=P.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;F&&(P.post_logout_redirect_uri=F);var te={useReplaceToNavigate:P.useReplaceToNavigate};return this._signoutStart(P,this._redirectNavigator,te).then(function(){i.Log.info("UserManager.signoutRedirect: successful")})},U.prototype.signoutRedirectCallback=function(P){return this._signoutEnd(P||this._redirectNavigator.url).then(function(F){return i.Log.info("UserManager.signoutRedirectCallback: successful"),F})},U.prototype.signoutPopup=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(P=Object.assign({},P)).request_type="so:p";var F=P.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return P.post_logout_redirect_uri=F,P.display="popup",P.post_logout_redirect_uri&&(P.state=P.state||{}),this._signout(P,this._popupNavigator,{startUrl:F,popupWindowFeatures:P.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:P.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){i.Log.info("UserManager.signoutPopup: successful")})},U.prototype.signoutPopupCallback=function(P,F){return F===void 0&&typeof P=="boolean"&&(F=P,P=null),this._popupNavigator.callback(P,F,"?").then(function(){i.Log.info("UserManager.signoutPopupCallback: successful")})},U.prototype._signout=function(P,F){var te=this,oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(P,F,oe).then(function(M){return te._signoutEnd(M.url)})},U.prototype._signoutStart=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=this,te=arguments[1],oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return te.prepare(oe).then(function(M){return i.Log.debug("UserManager._signoutStart: got navigator window handle"),F._loadUser().then(function(he){return i.Log.debug("UserManager._signoutStart: loaded current user from storage"),(F._settings.revokeAccessTokenOnSignout?F._revokeInternal(he):Promise.resolve()).then(function(){var me=P.id_token_hint||he&&he.id_token;return me&&(i.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),P.id_token_hint=me),F.removeUser().then(function(){return i.Log.debug("UserManager._signoutStart: user removed, creating signout request"),F.createSignoutRequest(P).then(function(xe){return i.Log.debug("UserManager._signoutStart: got signout request"),oe.url=xe.url,xe.state&&(oe.id=xe.state.id),M.navigate(oe)})})})}).catch(function(he){throw M.close&&(i.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),M.close()),he})})},U.prototype._signoutEnd=function(P){return this.processSignoutResponse(P).then(function(F){return i.Log.debug("UserManager._signoutEnd: got signout response"),F})},U.prototype.revokeAccessToken=function(){var P=this;return this._loadUser().then(function(F){return P._revokeInternal(F,!0).then(function(te){if(te)return i.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),F.access_token=null,F.refresh_token=null,F.expires_at=null,F.token_type=null,P.storeUser(F).then(function(){i.Log.debug("UserManager.revokeAccessToken: user stored"),P._events.load(F)})})}).then(function(){i.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},U.prototype._revokeInternal=function(P,F){var te=this;if(P){var oe=P.access_token,M=P.refresh_token;return this._revokeAccessTokenInternal(oe,F).then(function(he){return te._revokeRefreshTokenInternal(M,F).then(function(me){return he||me||i.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),he||me})})}return Promise.resolve(!1)},U.prototype._revokeAccessTokenInternal=function(P,F){return!P||P.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(P,F).then(function(){return!0})},U.prototype._revokeRefreshTokenInternal=function(P,F){return P?this._tokenRevocationClient.revoke(P,F,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},U.prototype.startSilentRenew=function(){this._silentRenewService.start()},U.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},U.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(P){return P?(i.Log.debug("UserManager._loadUser: user storageString loaded"),l.User.fromStorageString(P)):(i.Log.debug("UserManager._loadUser: no user storageString"),null)})},U.prototype.storeUser=function(P){if(P){i.Log.debug("UserManager.storeUser: storing user");var F=P.toStorageString();return this._userStore.set(this._userStoreKey,F)}return i.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},n(U,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),U}(a.OidcClient)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManagerSettings=void 0;var n=function(){function E(x,A){for(var I=0;I<A.length;I++){var D=A[I];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(x,D.key,D)}}return function(x,A,I){return A&&E(x.prototype,A),I&&E(x,I),x}}(),i=(r(0),r(5)),a=r(40),u=r(41),l=r(43),d=r(6),f=r(1),g=r(8);function _(E,x){if(!(E instanceof x))throw new TypeError("Cannot call a class as a function")}function w(E,x){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?E:x}e.UserManagerSettings=function(E){function x(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=A.popup_redirect_uri,D=A.popup_post_logout_redirect_uri,U=A.popupWindowFeatures,z=A.popupWindowTarget,P=A.silent_redirect_uri,F=A.silentRequestTimeout,te=A.automaticSilentRenew,oe=te!==void 0&&te,M=A.validateSubOnSilentRenew,he=M!==void 0&&M,me=A.includeIdTokenInSilentRenew,xe=me===void 0||me,ze=A.monitorSession,Le=ze===void 0||ze,ct=A.monitorAnonymousSession,lt=ct!==void 0&&ct,Rt=A.checkSessionInterval,Re=Rt===void 0?2e3:Rt,Oe=A.stopCheckSessionOnError,_t=Oe===void 0||Oe,je=A.query_status_response_type,qe=A.revokeAccessTokenOnSignout,Ft=qe!==void 0&&qe,Mt=A.accessTokenExpiringNotificationTime,tr=Mt===void 0?60:Mt,wt=A.redirectNavigator,Pt=wt===void 0?new a.RedirectNavigator:wt,Qe=A.popupNavigator,$e=Qe===void 0?new u.PopupNavigator:Qe,Q=A.iframeNavigator,v=Q===void 0?new l.IFrameNavigator:Q,S=A.userStore,$=S===void 0?new d.WebStorageStateStore({store:f.Global.sessionStorage}):S;_(this,x);var Y=w(this,E.call(this,arguments[0]));return Y._popup_redirect_uri=I,Y._popup_post_logout_redirect_uri=D,Y._popupWindowFeatures=U,Y._popupWindowTarget=z,Y._silent_redirect_uri=P,Y._silentRequestTimeout=F,Y._automaticSilentRenew=oe,Y._validateSubOnSilentRenew=he,Y._includeIdTokenInSilentRenew=xe,Y._accessTokenExpiringNotificationTime=tr,Y._monitorSession=Le,Y._monitorAnonymousSession=lt,Y._checkSessionInterval=Re,Y._stopCheckSessionOnError=_t,je?Y._query_status_response_type=je:arguments[0]&&arguments[0].response_type?Y._query_status_response_type=g.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":Y._query_status_response_type="id_token",Y._revokeAccessTokenOnSignout=Ft,Y._redirectNavigator=Pt,Y._popupNavigator=$e,Y._iframeNavigator=v,Y._userStore=$,Y}return function(I,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);I.prototype=Object.create(D&&D.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(I,D):I.__proto__=D)}(x,E),n(x,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),x}(i.OidcClientSettings)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RedirectNavigator=void 0;var n=function(){function a(u,l){for(var d=0;d<l.length;d++){var f=l[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,l,d){return l&&a(u.prototype,l),d&&a(u,d),u}}(),i=r(0);e.RedirectNavigator=function(){function a(){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.prototype.prepare=function(){return Promise.resolve(this)},a.prototype.navigate=function(l){return l&&l.url?(l.useReplaceToNavigate?window.location.replace(l.url):window.location=l.url,Promise.resolve()):(i.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},n(a,[{key:"url",get:function(){return window.location.href}}]),a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PopupNavigator=void 0;var n=r(0),i=r(42);e.PopupNavigator=function(){function a(){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.prototype.prepare=function(l){var d=new i.PopupWindow(l);return Promise.resolve(d)},a.prototype.callback=function(l,d,f){n.Log.debug("PopupNavigator.callback");try{return i.PopupWindow.notifyOpener(l,d,f),Promise.resolve()}catch(g){return Promise.reject(g)}},a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PopupWindow=void 0;var n=function(){function u(l,d){for(var f=0;f<d.length;f++){var g=d[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(l,d,f){return d&&u(l.prototype,d),f&&u(l,f),l}}(),i=r(0),a=r(3);e.PopupWindow=function(){function u(l){var d=this;(function(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")})(this,u),this._promise=new Promise(function(_,w){d._resolve=_,d._reject=w});var f=l.popupWindowTarget||"_blank",g=l.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",f,g),this._popup&&(i.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return u.prototype.navigate=function(d){return this._popup?d&&d.url?(i.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=d.id,this._id&&(window["popupCallback_"+d.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=d.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},u.prototype._success=function(d){i.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(d)},u.prototype._error=function(d){i.Log.error("PopupWindow.error: ",d),this._cleanup(),this._reject(new Error(d))},u.prototype.close=function(){this._cleanup(!1)},u.prototype._cleanup=function(d){i.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!d&&this._popup.close(),this._popup=null},u.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},u.prototype._callback=function(d,f){this._cleanup(f),d?(i.Log.debug("PopupWindow.callback success"),this._success({url:d})):(i.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},u.notifyOpener=function(d,f,g){if(window.opener){if(d=d||window.location.href){var _=a.UrlUtility.parseUrlFragment(d,g);if(_.state){var w="popupCallback_"+_.state,E=window.opener[w];E?(i.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),E(d,f)):i.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else i.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else i.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},n(u,[{key:"promise",get:function(){return this._promise}}]),u}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IFrameNavigator=void 0;var n=r(0),i=r(44);e.IFrameNavigator=function(){function a(){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.prototype.prepare=function(l){var d=new i.IFrameWindow(l);return Promise.resolve(d)},a.prototype.callback=function(l){n.Log.debug("IFrameNavigator.callback");try{return i.IFrameWindow.notifyParent(l),Promise.resolve()}catch(d){return Promise.reject(d)}},a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IFrameWindow=void 0;var n=function(){function a(u,l){for(var d=0;d<l.length;d++){var f=l[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,l,d){return l&&a(u.prototype,l),d&&a(u,d),u}}(),i=r(0);e.IFrameWindow=function(){function a(u){var l=this;(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,a),this._promise=new Promise(function(d,f){l._resolve=d,l._reject=f}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return a.prototype.navigate=function(l){if(l&&l.url){var d=l.silentRequestTimeout||1e4;i.Log.debug("IFrameWindow.navigate: Using timeout of:",d),this._timer=window.setTimeout(this._timeout.bind(this),d),this._frame.src=l.url}else this._error("No url provided");return this.promise},a.prototype._success=function(l){this._cleanup(),i.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(l)},a.prototype._error=function(l){this._cleanup(),i.Log.error(l),this._reject(new Error(l))},a.prototype.close=function(){this._cleanup()},a.prototype._cleanup=function(){this._frame&&(i.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},a.prototype._timeout=function(){i.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},a.prototype._message=function(l){if(i.Log.debug("IFrameWindow.message"),this._timer&&l.origin===this._origin&&l.source===this._frame.contentWindow&&typeof l.data=="string"&&(l.data.startsWith("http://")||l.data.startsWith("https://"))){var d=l.data;d?this._success({url:d}):this._error("Invalid response from frame")}},a.notifyParent=function(l){i.Log.debug("IFrameWindow.notifyParent"),(l=l||window.location.href)&&(i.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(l,location.protocol+"//"+location.host))},n(a,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),a}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManagerEvents=void 0;var n=r(0),i=r(16),a=r(17);e.UserManagerEvents=function(u){function l(d){(function(_,w){if(!(_ instanceof w))throw new TypeError("Cannot call a class as a function")})(this,l);var f=function(_,w){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!w||typeof w!="object"&&typeof w!="function"?_:w}(this,u.call(this,d));return f._userLoaded=new a.Event("User loaded"),f._userUnloaded=new a.Event("User unloaded"),f._silentRenewError=new a.Event("Silent renew error"),f._userSignedIn=new a.Event("User signed in"),f._userSignedOut=new a.Event("User signed out"),f._userSessionChanged=new a.Event("User session changed"),f}return function(f,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);f.prototype=Object.create(g&&g.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(f,g):f.__proto__=g)}(l,u),l.prototype.load=function(f){var g=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];n.Log.debug("UserManagerEvents.load"),u.prototype.load.call(this,f),g&&this._userLoaded.raise(f)},l.prototype.unload=function(){n.Log.debug("UserManagerEvents.unload"),u.prototype.unload.call(this),this._userUnloaded.raise()},l.prototype.addUserLoaded=function(f){this._userLoaded.addHandler(f)},l.prototype.removeUserLoaded=function(f){this._userLoaded.removeHandler(f)},l.prototype.addUserUnloaded=function(f){this._userUnloaded.addHandler(f)},l.prototype.removeUserUnloaded=function(f){this._userUnloaded.removeHandler(f)},l.prototype.addSilentRenewError=function(f){this._silentRenewError.addHandler(f)},l.prototype.removeSilentRenewError=function(f){this._silentRenewError.removeHandler(f)},l.prototype._raiseSilentRenewError=function(f){n.Log.debug("UserManagerEvents._raiseSilentRenewError",f.message),this._silentRenewError.raise(f)},l.prototype.addUserSignedIn=function(f){this._userSignedIn.addHandler(f)},l.prototype.removeUserSignedIn=function(f){this._userSignedIn.removeHandler(f)},l.prototype._raiseUserSignedIn=function(){n.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},l.prototype.addUserSignedOut=function(f){this._userSignedOut.addHandler(f)},l.prototype.removeUserSignedOut=function(f){this._userSignedOut.removeHandler(f)},l.prototype._raiseUserSignedOut=function(){n.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},l.prototype.addUserSessionChanged=function(f){this._userSessionChanged.addHandler(f)},l.prototype.removeUserSessionChanged=function(f){this._userSessionChanged.removeHandler(f)},l.prototype._raiseUserSessionChanged=function(){n.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},l}(i.AccessTokenEvents)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0;var n=function(){function f(g,_){for(var w=0;w<_.length;w++){var E=_[w];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}return function(g,_,w){return _&&f(g.prototype,_),w&&f(g,w),g}}(),i=r(0),a=r(1),u=r(17);function l(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}function d(f,g){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!g||typeof g!="object"&&typeof g!="function"?f:g}e.Timer=function(f){function g(_){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.Global.timer,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;l(this,g);var x=d(this,f.call(this,_));return x._timer=w,x._nowFunc=E||function(){return Date.now()/1e3},x}return function(w,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);w.prototype=Object.create(E&&E.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(w,E):w.__proto__=E)}(g,f),g.prototype.init=function(w){w<=0&&(w=1),w=parseInt(w);var E=this.now+w;if(this.expiration===E&&this._timerHandle)i.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),i.Log.debug("Timer.init timer "+this._name+" for duration:",w),this._expiration=E;var x=5;w<x&&(x=w),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*x)}},g.prototype.cancel=function(){this._timerHandle&&(i.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},g.prototype._callback=function(){var w=this._expiration-this.now;i.Log.debug("Timer.callback; "+this._name+" timer expires in:",w),this._expiration<=this.now&&(this.cancel(),f.prototype.raise.call(this))},n(g,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),g}(u.Event)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SilentRenewService=void 0;var n=r(0);e.SilentRenewService=function(){function i(a){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,i),this._userManager=a}return i.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(u){}).catch(function(u){n.Log.error("SilentRenewService.start: Error from getUser:",u.message)}))},i.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},i.prototype._tokenExpiring=function(){var u=this;this._userManager.signinSilent().then(function(l){n.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(l){n.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",l.message),u._userManager.events._raiseSilentRenewError(l)})},i}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaPopupNavigator=void 0;var n=r(21);e.CordovaPopupNavigator=function(){function i(){(function(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")})(this,i)}return i.prototype.prepare=function(u){var l=new n.CordovaPopupWindow(u);return Promise.resolve(l)},i}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaIFrameNavigator=void 0;var n=r(21);e.CordovaIFrameNavigator=function(){function i(){(function(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")})(this,i)}return i.prototype.prepare=function(u){u.popupWindowFeatures="hidden=yes";var l=new n.CordovaPopupWindow(u);return Promise.resolve(l)},i}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Version="1.11.6"}])})});var Nd=_e((DC,Pd)=>{"use strict";N();O();k();var Fd;Pd.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):t=>(Fd||(Fd=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0))});var ot=_e((_F,Wd)=>{"use strict";N();O();k();var nc=class extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);let r="";for(let n=0;n<e.length;n++)r+=`    ${e[n].stack}
`;super(r),this.name="AggregateError",this.errors=e}};Wd.exports={AggregateError:nc,ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,e){return t.includes(e)},ArrayPrototypeIndexOf(t,e){return t.indexOf(e)},ArrayPrototypeJoin(t,e){return t.join(e)},ArrayPrototypeMap(t,e){return t.map(e)},ArrayPrototypePop(t,e){return t.pop(e)},ArrayPrototypePush(t,e){return t.push(e)},ArrayPrototypeSlice(t,e,r){return t.slice(e,r)},Error,FunctionPrototypeCall(t,e,...r){return t.call(e,...r)},FunctionPrototypeSymbolHasInstance(t,e){return Function.prototype[Symbol.hasInstance].call(t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,e){return Object.defineProperties(t,e)},ObjectDefineProperty(t,e,r){return Object.defineProperty(t,e,r)},ObjectGetOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,e){return Object.setPrototypeOf(t,e)},Promise,PromisePrototypeCatch(t,e){return t.catch(e)},PromisePrototypeThen(t,e,r){return t.then(e,r)},PromiseReject(t){return Promise.reject(t)},PromiseResolve(t){return Promise.resolve(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,e){return t.test(e)},SafeSet:Set,String,StringPrototypeSlice(t,e,r){return t.slice(e,r)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(t,e,r){return t.set(e,r)},Boolean,Uint8Array}});var ic=_e((SF,Jd)=>{"use strict";N();O();k();Jd.exports={format(t,...e){return t.replace(/%([sdifj])/g,function(...[r,n]){let i=e.shift();return n==="f"?i.toFixed(6):n==="j"?JSON.stringify(i):n==="s"&&typeof i=="object"?`${i.constructor!==Object?i.constructor.name:""} {}`.trim():i.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}}}});var Ut=_e((IF,Yd)=>{"use strict";N();O();k();var{format:__,inspect:ds}=ic(),{AggregateError:w_}=ot(),b_=globalThis.AggregateError||w_,v_=Symbol("kIsNodeError"),S_=["string","function","number","object","Function","Object","boolean","bigint","symbol"],E_=/^([A-Z][a-z0-9]*)+$/,x_="__node_internal_",hs={};function Rn(t,e){if(!t)throw new hs.ERR_INTERNAL_ASSERTION(e)}function Gd(t){let e="",r=t.length,n=t[0]==="-"?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function A_(t,e,r){if(typeof e=="function")return Rn(e.length<=r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${e.length}).`),e(...r);let n=(e.match(/%[dfijoOs]/g)||[]).length;return Rn(n===r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${n}).`),r.length===0?e:__(e,...r)}function Dt(t,e,r){r||(r=Error);class n extends r{constructor(...a){super(A_(t,e,a))}toString(){return`${this.name} [${t}]: ${this.message}`}}Object.defineProperties(n.prototype,{name:{value:r.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),n.prototype.code=t,n.prototype[v_]=!0,hs[t]=n}function zd(t){let e=x_+t.name;return Object.defineProperty(t,"name",{value:e}),t}function I_(t,e){if(t&&e&&t!==e){if(Array.isArray(e.errors))return e.errors.push(t),e;let r=new b_([e,t],e.message);return r.code=e.code,r}return t||e}var oc=class extends Error{constructor(e="The operation was aborted",r=void 0){if(r!==void 0&&typeof r!="object")throw new hs.ERR_INVALID_ARG_TYPE("options","Object",r);super(e,r),this.code="ABORT_ERR",this.name="AbortError"}};Dt("ERR_ASSERTION","%s",Error);Dt("ERR_INVALID_ARG_TYPE",(t,e,r)=>{Rn(typeof t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let n="The ";t.endsWith(" argument")?n+=`${t} `:n+=`"${t}" ${t.includes(".")?"property":"argument"} `,n+="must be ";let i=[],a=[],u=[];for(let d of e)Rn(typeof d=="string","All expected entries have to be of type string"),S_.includes(d)?i.push(d.toLowerCase()):E_.test(d)?a.push(d):(Rn(d!=="object",'The value "object" should be written as "Object"'),u.push(d));if(a.length>0){let d=i.indexOf("object");d!==-1&&(i.splice(i,d,1),a.push("Object"))}if(i.length>0){switch(i.length){case 1:n+=`of type ${i[0]}`;break;case 2:n+=`one of type ${i[0]} or ${i[1]}`;break;default:{let d=i.pop();n+=`one of type ${i.join(", ")}, or ${d}`}}(a.length>0||u.length>0)&&(n+=" or ")}if(a.length>0){switch(a.length){case 1:n+=`an instance of ${a[0]}`;break;case 2:n+=`an instance of ${a[0]} or ${a[1]}`;break;default:{let d=a.pop();n+=`an instance of ${a.join(", ")}, or ${d}`}}u.length>0&&(n+=" or ")}switch(u.length){case 0:break;case 1:u[0].toLowerCase()!==u[0]&&(n+="an "),n+=`${u[0]}`;break;case 2:n+=`one of ${u[0]} or ${u[1]}`;break;default:{let d=u.pop();n+=`one of ${u.join(", ")}, or ${d}`}}if(r==null)n+=`. Received ${r}`;else if(typeof r=="function"&&r.name)n+=`. Received function ${r.name}`;else if(typeof r=="object"){var l;if((l=r.constructor)!==null&&l!==void 0&&l.name)n+=`. Received an instance of ${r.constructor.name}`;else{let d=ds(r,{depth:-1});n+=`. Received ${d}`}}else{let d=ds(r,{colors:!1});d.length>25&&(d=`${d.slice(0,25)}...`),n+=`. Received type ${typeof r} (${d})`}return n},TypeError);Dt("ERR_INVALID_ARG_VALUE",(t,e,r="is invalid")=>{let n=ds(e);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${t.includes(".")?"property":"argument"} '${t}' ${r}. Received ${n}`},TypeError);Dt("ERR_INVALID_RETURN_VALUE",(t,e,r)=>{var n;let i=r!=null&&(n=r.constructor)!==null&&n!==void 0&&n.name?`instance of ${r.constructor.name}`:`type ${typeof r}`;return`Expected ${t} to be returned from the "${e}" function but got ${i}.`},TypeError);Dt("ERR_MISSING_ARGS",(...t)=>{Rn(t.length>0,"At least one arg needs to be specified");let e,r=t.length;switch(t=(Array.isArray(t)?t:[t]).map(n=>`"${n}"`).join(" or "),r){case 1:e+=`The ${t[0]} argument`;break;case 2:e+=`The ${t[0]} and ${t[1]} arguments`;break;default:{let n=t.pop();e+=`The ${t.join(", ")}, and ${n} arguments`}break}return`${e} must be specified`},TypeError);Dt("ERR_OUT_OF_RANGE",(t,e,r)=>{Rn(e,'Missing "range" argument');let n;if(Number.isInteger(r)&&Math.abs(r)>2**32)n=Gd(String(r));else if(typeof r=="bigint"){n=String(r);let i=BigInt(2)**BigInt(32);(r>i||r<-i)&&(n=Gd(n)),n+="n"}else n=ds(r);return`The value of "${t}" is out of range. It must be ${e}. Received ${n}`},RangeError);Dt("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);Dt("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);Dt("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);Dt("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);Dt("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);Dt("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Dt("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);Dt("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);Dt("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);Dt("ERR_STREAM_WRITE_AFTER_END","write after end",Error);Dt("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);Yd.exports={AbortError:oc,aggregateTwoErrors:zd(I_),hideStackFrames:zd,codes:hs}});var di=_e((FF,ps)=>{"use strict";N();O();k();var{AbortController:Qd,AbortSignal:T_}=typeof self<"u"?self:typeof window<"u"?window:void 0;ps.exports=Qd;ps.exports.AbortSignal=T_;ps.exports.default=Qd});var qt=_e((OF,ac)=>{"use strict";N();O();k();var R_=(ir(),Yt(Sr)),{format:C_,inspect:F_}=ic(),{codes:{ERR_INVALID_ARG_TYPE:sc}}=Ut(),{kResistStopPropagation:P_,AggregateError:N_,SymbolDispose:k_}=ot(),O_=globalThis.AbortSignal||di().AbortSignal,D_=globalThis.AbortController||di().AbortController,L_=Object.getPrototypeOf(async function(){}).constructor,Xd=globalThis.Blob||R_.Blob,U_=typeof Xd<"u"?function(e){return e instanceof Xd}:function(e){return!1},Zd=(t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new sc(e,"AbortSignal",t)},j_=(t,e)=>{if(typeof t!="function")throw new sc(e,"Function",t)};ac.exports={AggregateError:N_,kEmptyObject:Object.freeze({}),once(t){let e=!1;return function(...r){e||(e=!0,t.apply(this,r))}},createDeferredPromise:function(){let t,e;return{promise:new Promise((n,i)=>{t=n,e=i}),resolve:t,reject:e}},promisify(t){return new Promise((e,r)=>{t((n,...i)=>n?r(n):e(...i))})},debuglog(){return function(){}},format:C_,inspect:F_,types:{isAsyncFunction(t){return t instanceof L_},isArrayBufferView(t){return ArrayBuffer.isView(t)}},isBlob:U_,deprecate(t,e){return t},addAbortListener:(ai(),Yt(Yi)).addAbortListener||function(e,r){if(e===void 0)throw new sc("signal","AbortSignal",e);Zd(e,"signal"),j_(r,"listener");let n;return e.aborted?queueMicrotask(()=>r()):(e.addEventListener("abort",r,{__proto__:null,once:!0,[P_]:!0}),n=()=>{e.removeEventListener("abort",r)}),{__proto__:null,[k_](){var i;(i=n)===null||i===void 0||i()}}},AbortSignalAny:O_.any||function(e){if(e.length===1)return e[0];let r=new D_,n=()=>r.abort();return e.forEach(i=>{Zd(i,"signals"),i.addEventListener("abort",n,{once:!0})}),r.signal.addEventListener("abort",()=>{e.forEach(i=>i.removeEventListener("abort",n))},{once:!0}),r.signal}};ac.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")});var pi=_e((jF,ch)=>{"use strict";N();O();k();var{ArrayIsArray:cc,ArrayPrototypeIncludes:nh,ArrayPrototypeJoin:ih,ArrayPrototypeMap:B_,NumberIsInteger:lc,NumberIsNaN:M_,NumberMAX_SAFE_INTEGER:H_,NumberMIN_SAFE_INTEGER:V_,NumberParseInt:K_,ObjectPrototypeHasOwnProperty:q_,RegExpPrototypeExec:oh,String:$_,StringPrototypeToUpperCase:W_,StringPrototypeTrim:J_}=ot(),{hideStackFrames:ur,codes:{ERR_SOCKET_BAD_PORT:G_,ERR_INVALID_ARG_TYPE:jt,ERR_INVALID_ARG_VALUE:hi,ERR_OUT_OF_RANGE:Cn,ERR_UNKNOWN_SIGNAL:eh}}=Ut(),{normalizeEncoding:z_}=qt(),{isAsyncFunction:Y_,isArrayBufferView:Q_}=qt().types,th={};function X_(t){return t===(t|0)}function Z_(t){return t===t>>>0}var ew=/^[0-7]+$/,tw="must be a 32-bit unsigned integer or an octal string";function rw(t,e,r){if(typeof t>"u"&&(t=r),typeof t=="string"){if(oh(ew,t)===null)throw new hi(e,t,tw);t=K_(t,8)}return sh(t,e),t}var nw=ur((t,e,r=V_,n=H_)=>{if(typeof t!="number")throw new jt(e,"number",t);if(!lc(t))throw new Cn(e,"an integer",t);if(t<r||t>n)throw new Cn(e,`>= ${r} && <= ${n}`,t)}),iw=ur((t,e,r=-2147483648,n=2147483647)=>{if(typeof t!="number")throw new jt(e,"number",t);if(!lc(t))throw new Cn(e,"an integer",t);if(t<r||t>n)throw new Cn(e,`>= ${r} && <= ${n}`,t)}),sh=ur((t,e,r=!1)=>{if(typeof t!="number")throw new jt(e,"number",t);if(!lc(t))throw new Cn(e,"an integer",t);let n=r?1:0,i=4294967295;if(t<n||t>i)throw new Cn(e,`>= ${n} && <= ${i}`,t)});function fc(t,e){if(typeof t!="string")throw new jt(e,"string",t)}function ow(t,e,r=void 0,n){if(typeof t!="number")throw new jt(e,"number",t);if(r!=null&&t<r||n!=null&&t>n||(r!=null||n!=null)&&M_(t))throw new Cn(e,`${r!=null?`>= ${r}`:""}${r!=null&&n!=null?" && ":""}${n!=null?`<= ${n}`:""}`,t)}var sw=ur((t,e,r)=>{if(!nh(r,t)){let i="must be one of: "+ih(B_(r,a=>typeof a=="string"?`'${a}'`:$_(a)),", ");throw new hi(e,t,i)}});function ah(t,e){if(typeof t!="boolean")throw new jt(e,"boolean",t)}function uc(t,e,r){return t==null||!q_(t,e)?r:t[e]}var aw=ur((t,e,r=null)=>{let n=uc(r,"allowArray",!1),i=uc(r,"allowFunction",!1);if(!uc(r,"nullable",!1)&&t===null||!n&&cc(t)||typeof t!="object"&&(!i||typeof t!="function"))throw new jt(e,"Object",t)}),uw=ur((t,e)=>{if(t!=null&&typeof t!="object"&&typeof t!="function")throw new jt(e,"a dictionary",t)}),gs=ur((t,e,r=0)=>{if(!cc(t))throw new jt(e,"Array",t);if(t.length<r){let n=`must be longer than ${r}`;throw new hi(e,t,n)}});function cw(t,e){gs(t,e);for(let r=0;r<t.length;r++)fc(t[r],`${e}[${r}]`)}function lw(t,e){gs(t,e);for(let r=0;r<t.length;r++)ah(t[r],`${e}[${r}]`)}function fw(t,e){gs(t,e);for(let r=0;r<t.length;r++){let n=t[r],i=`${e}[${r}]`;if(n==null)throw new jt(i,"AbortSignal",n);uh(n,i)}}function dw(t,e="signal"){if(fc(t,e),th[t]===void 0)throw th[W_(t)]!==void 0?new eh(t+" (signals must use all capital letters)"):new eh(t)}var hw=ur((t,e="buffer")=>{if(!Q_(t))throw new jt(e,["Buffer","TypedArray","DataView"],t)});function pw(t,e){let r=z_(e),n=t.length;if(r==="hex"&&n%2!==0)throw new hi("encoding",e,`is invalid for data of length ${n}`)}function gw(t,e="Port",r=!0){if(typeof t!="number"&&typeof t!="string"||typeof t=="string"&&J_(t).length===0||+t!==+t>>>0||t>65535||t===0&&!r)throw new G_(e,t,r);return t|0}var uh=ur((t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new jt(e,"AbortSignal",t)}),yw=ur((t,e)=>{if(typeof t!="function")throw new jt(e,"Function",t)}),mw=ur((t,e)=>{if(typeof t!="function"||Y_(t))throw new jt(e,"Function",t)}),_w=ur((t,e)=>{if(t!==void 0)throw new jt(e,"undefined",t)});function ww(t,e,r){if(!nh(r,t))throw new jt(e,`('${ih(r,"|")}')`,t)}var bw=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function rh(t,e){if(typeof t>"u"||!oh(bw,t))throw new hi(e,t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function vw(t){if(typeof t=="string")return rh(t,"hints"),t;if(cc(t)){let e=t.length,r="";if(e===0)return r;for(let n=0;n<e;n++){let i=t[n];rh(i,"hints"),r+=i,n!==e-1&&(r+=", ")}return r}throw new hi("hints",t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}ch.exports={isInt32:X_,isUint32:Z_,parseFileMode:rw,validateArray:gs,validateStringArray:cw,validateBooleanArray:lw,validateAbortSignalArray:fw,validateBoolean:ah,validateBuffer:hw,validateDictionary:uw,validateEncoding:pw,validateFunction:yw,validateInt32:iw,validateInteger:nw,validateNumber:ow,validateObject:aw,validateOneOf:sw,validatePlainFunction:mw,validatePort:gw,validateSignalName:dw,validateString:fc,validateUint32:sh,validateUndefined:_w,validateUnion:ww,validateAbortSignal:uh,validateLinkHeaderValue:vw}});var tn=_e((VF,hh)=>{"use strict";N();O();k();var ht=hh.exports={},Ir,Tr;function dc(){throw new Error("setTimeout has not been defined")}function hc(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ir=setTimeout:Ir=dc}catch{Ir=dc}try{typeof clearTimeout=="function"?Tr=clearTimeout:Tr=hc}catch{Tr=hc}})();function lh(t){if(Ir===setTimeout)return setTimeout(t,0);if((Ir===dc||!Ir)&&setTimeout)return Ir=setTimeout,setTimeout(t,0);try{return Ir(t,0)}catch{try{return Ir.call(null,t,0)}catch{return Ir.call(this,t,0)}}}function Sw(t){if(Tr===clearTimeout)return clearTimeout(t);if((Tr===hc||!Tr)&&clearTimeout)return Tr=clearTimeout,clearTimeout(t);try{return Tr(t)}catch{try{return Tr.call(null,t)}catch{return Tr.call(this,t)}}}var Vr=[],gi=!1,Fn,ys=-1;function Ew(){!gi||!Fn||(gi=!1,Fn.length?Vr=Fn.concat(Vr):ys=-1,Vr.length&&fh())}function fh(){if(!gi){var t=lh(Ew);gi=!0;for(var e=Vr.length;e;){for(Fn=Vr,Vr=[];++ys<e;)Fn&&Fn[ys].run();ys=-1,e=Vr.length}Fn=null,gi=!1,Sw(t)}}ht.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];Vr.push(new dh(t,e)),Vr.length===1&&!gi&&lh(fh)};function dh(t,e){this.fun=t,this.array=e}dh.prototype.run=function(){this.fun.apply(null,this.array)};ht.title="browser";ht.browser=!0;ht.env={};ht.argv=[];ht.version="";ht.versions={};function Kr(){}ht.on=Kr;ht.addListener=Kr;ht.once=Kr;ht.off=Kr;ht.removeListener=Kr;ht.removeAllListeners=Kr;ht.emit=Kr;ht.prependListener=Kr;ht.prependOnceListener=Kr;ht.listeners=function(t){return[]};ht.binding=function(t){throw new Error("process.binding is not supported")};ht.cwd=function(){return"/"};ht.chdir=function(t){throw new Error("process.chdir is not supported")};ht.umask=function(){return 0}});var Cr=_e((WF,Rh)=>{"use strict";N();O();k();var{SymbolAsyncIterator:ph,SymbolIterator:gh,SymbolFor:Pn}=ot(),yh=Pn("nodejs.stream.destroyed"),mh=Pn("nodejs.stream.errored"),pc=Pn("nodejs.stream.readable"),gc=Pn("nodejs.stream.writable"),_h=Pn("nodejs.stream.disturbed"),xw=Pn("nodejs.webstream.isClosedPromise"),Aw=Pn("nodejs.webstream.controllerErrorFunction");function ms(t,e=!1){var r;return!!(t&&typeof t.pipe=="function"&&typeof t.on=="function"&&(!e||typeof t.pause=="function"&&typeof t.resume=="function")&&(!t._writableState||((r=t._readableState)===null||r===void 0?void 0:r.readable)!==!1)&&(!t._writableState||t._readableState))}function _s(t){var e;return!!(t&&typeof t.write=="function"&&typeof t.on=="function"&&(!t._readableState||((e=t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function Iw(t){return!!(t&&typeof t.pipe=="function"&&t._readableState&&typeof t.on=="function"&&typeof t.write=="function")}function Rr(t){return t&&(t._readableState||t._writableState||typeof t.write=="function"&&typeof t.on=="function"||typeof t.pipe=="function"&&typeof t.on=="function")}function wh(t){return!!(t&&!Rr(t)&&typeof t.pipeThrough=="function"&&typeof t.getReader=="function"&&typeof t.cancel=="function")}function bh(t){return!!(t&&!Rr(t)&&typeof t.getWriter=="function"&&typeof t.abort=="function")}function vh(t){return!!(t&&!Rr(t)&&typeof t.readable=="object"&&typeof t.writable=="object")}function Tw(t){return wh(t)||bh(t)||vh(t)}function Rw(t,e){return t==null?!1:e===!0?typeof t[ph]=="function":e===!1?typeof t[gh]=="function":typeof t[ph]=="function"||typeof t[gh]=="function"}function ws(t){if(!Rr(t))return null;let e=t._writableState,r=t._readableState,n=e||r;return!!(t.destroyed||t[yh]||n!=null&&n.destroyed)}function Sh(t){if(!_s(t))return null;if(t.writableEnded===!0)return!0;let e=t._writableState;return e!=null&&e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function Cw(t,e){if(!_s(t))return null;if(t.writableFinished===!0)return!0;let r=t._writableState;return r!=null&&r.errored?!1:typeof r?.finished!="boolean"?null:!!(r.finished||e===!1&&r.ended===!0&&r.length===0)}function Fw(t){if(!ms(t))return null;if(t.readableEnded===!0)return!0;let e=t._readableState;return!e||e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function Eh(t,e){if(!ms(t))return null;let r=t._readableState;return r!=null&&r.errored?!1:typeof r?.endEmitted!="boolean"?null:!!(r.endEmitted||e===!1&&r.ended===!0&&r.length===0)}function xh(t){return t&&t[pc]!=null?t[pc]:typeof t?.readable!="boolean"?null:ws(t)?!1:ms(t)&&t.readable&&!Eh(t)}function Ah(t){return t&&t[gc]!=null?t[gc]:typeof t?.writable!="boolean"?null:ws(t)?!1:_s(t)&&t.writable&&!Sh(t)}function Pw(t,e){return Rr(t)?ws(t)?!0:!(e?.readable!==!1&&xh(t)||e?.writable!==!1&&Ah(t)):null}function Nw(t){var e,r;return Rr(t)?t.writableErrored?t.writableErrored:(e=(r=t._writableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function kw(t){var e,r;return Rr(t)?t.readableErrored?t.readableErrored:(e=(r=t._readableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function Ow(t){if(!Rr(t))return null;if(typeof t.closed=="boolean")return t.closed;let e=t._writableState,r=t._readableState;return typeof e?.closed=="boolean"||typeof r?.closed=="boolean"?e?.closed||r?.closed:typeof t._closed=="boolean"&&Ih(t)?t._closed:null}function Ih(t){return typeof t._closed=="boolean"&&typeof t._defaultKeepAlive=="boolean"&&typeof t._removedConnection=="boolean"&&typeof t._removedContLen=="boolean"}function Th(t){return typeof t._sent100=="boolean"&&Ih(t)}function Dw(t){var e;return typeof t._consuming=="boolean"&&typeof t._dumped=="boolean"&&((e=t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function Lw(t){if(!Rr(t))return null;let e=t._writableState,r=t._readableState,n=e||r;return!n&&Th(t)||!!(n&&n.autoDestroy&&n.emitClose&&n.closed===!1)}function Uw(t){var e;return!!(t&&((e=t[_h])!==null&&e!==void 0?e:t.readableDidRead||t.readableAborted))}function jw(t){var e,r,n,i,a,u,l,d,f,g;return!!(t&&((e=(r=(n=(i=(a=(u=t[mh])!==null&&u!==void 0?u:t.readableErrored)!==null&&a!==void 0?a:t.writableErrored)!==null&&i!==void 0?i:(l=t._readableState)===null||l===void 0?void 0:l.errorEmitted)!==null&&n!==void 0?n:(d=t._writableState)===null||d===void 0?void 0:d.errorEmitted)!==null&&r!==void 0?r:(f=t._readableState)===null||f===void 0?void 0:f.errored)!==null&&e!==void 0?e:!((g=t._writableState)===null||g===void 0)&&g.errored))}Rh.exports={isDestroyed:ws,kIsDestroyed:yh,isDisturbed:Uw,kIsDisturbed:_h,isErrored:jw,kIsErrored:mh,isReadable:xh,kIsReadable:pc,kIsClosedPromise:xw,kControllerErrorFunction:Aw,kIsWritable:gc,isClosed:Ow,isDuplexNodeStream:Iw,isFinished:Pw,isIterable:Rw,isReadableNodeStream:ms,isReadableStream:wh,isReadableEnded:Fw,isReadableFinished:Eh,isReadableErrored:kw,isNodeStream:Rr,isWebStream:Tw,isWritable:Ah,isWritableNodeStream:_s,isWritableStream:bh,isWritableEnded:Sh,isWritableFinished:Cw,isWritableErrored:Nw,isServerRequest:Dw,isServerResponse:Th,willEmitClose:Lw,isTransformStream:vh}});var qr=_e((YF,bc)=>{"use strict";N();O();k();var rn=tn(),{AbortError:Uh,codes:Bw}=Ut(),{ERR_INVALID_ARG_TYPE:Mw,ERR_STREAM_PREMATURE_CLOSE:Ch}=Bw,{kEmptyObject:mc,once:_c}=qt(),{validateAbortSignal:Hw,validateFunction:Vw,validateObject:Kw,validateBoolean:qw}=pi(),{Promise:$w,PromisePrototypeThen:Ww,SymbolDispose:jh}=ot(),{isClosed:Jw,isReadable:Fh,isReadableNodeStream:yc,isReadableStream:Gw,isReadableFinished:Ph,isReadableErrored:Nh,isWritable:kh,isWritableNodeStream:Oh,isWritableStream:zw,isWritableFinished:Dh,isWritableErrored:Lh,isNodeStream:Yw,willEmitClose:Qw,kIsClosedPromise:Xw}=Cr(),yi;function Zw(t){return t.setHeader&&typeof t.abort=="function"}var wc=()=>{};function Bh(t,e,r){var n,i;if(arguments.length===2?(r=e,e=mc):e==null?e=mc:Kw(e,"options"),Vw(r,"callback"),Hw(e.signal,"options.signal"),r=_c(r),Gw(t)||zw(t))return eb(t,e,r);if(!Yw(t))throw new Mw("stream",["ReadableStream","WritableStream","Stream"],t);let a=(n=e.readable)!==null&&n!==void 0?n:yc(t),u=(i=e.writable)!==null&&i!==void 0?i:Oh(t),l=t._writableState,d=t._readableState,f=()=>{t.writable||w()},g=Qw(t)&&yc(t)===a&&Oh(t)===u,_=Dh(t,!1),w=()=>{_=!0,t.destroyed&&(g=!1),!(g&&(!t.readable||a))&&(!a||E)&&r.call(t)},E=Ph(t,!1),x=()=>{E=!0,t.destroyed&&(g=!1),!(g&&(!t.writable||u))&&(!u||_)&&r.call(t)},A=F=>{r.call(t,F)},I=Jw(t),D=()=>{I=!0;let F=Lh(t)||Nh(t);if(F&&typeof F!="boolean")return r.call(t,F);if(a&&!E&&yc(t,!0)&&!Ph(t,!1))return r.call(t,new Ch);if(u&&!_&&!Dh(t,!1))return r.call(t,new Ch);r.call(t)},U=()=>{I=!0;let F=Lh(t)||Nh(t);if(F&&typeof F!="boolean")return r.call(t,F);r.call(t)},z=()=>{t.req.on("finish",w)};Zw(t)?(t.on("complete",w),g||t.on("abort",D),t.req?z():t.on("request",z)):u&&!l&&(t.on("end",f),t.on("close",f)),!g&&typeof t.aborted=="boolean"&&t.on("aborted",D),t.on("end",x),t.on("finish",w),e.error!==!1&&t.on("error",A),t.on("close",D),I?rn.nextTick(D):l!=null&&l.errorEmitted||d!=null&&d.errorEmitted?g||rn.nextTick(U):(!a&&(!g||Fh(t))&&(_||kh(t)===!1)||!u&&(!g||kh(t))&&(E||Fh(t)===!1)||d&&t.req&&t.aborted)&&rn.nextTick(U);let P=()=>{r=wc,t.removeListener("aborted",D),t.removeListener("complete",w),t.removeListener("abort",D),t.removeListener("request",z),t.req&&t.req.removeListener("finish",w),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",w),t.removeListener("end",x),t.removeListener("error",A),t.removeListener("close",D)};if(e.signal&&!I){let F=()=>{let te=r;P(),te.call(t,new Uh(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)rn.nextTick(F);else{yi=yi||qt().addAbortListener;let te=yi(e.signal,F),oe=r;r=_c((...M)=>{te[jh](),oe.apply(t,M)})}}return P}function eb(t,e,r){let n=!1,i=wc;if(e.signal)if(i=()=>{n=!0,r.call(t,new Uh(void 0,{cause:e.signal.reason}))},e.signal.aborted)rn.nextTick(i);else{yi=yi||qt().addAbortListener;let u=yi(e.signal,i),l=r;r=_c((...d)=>{u[jh](),l.apply(t,d)})}let a=(...u)=>{n||rn.nextTick(()=>r.apply(t,u))};return Ww(t[Xw].promise,a,a),wc}function tb(t,e){var r;let n=!1;return e===null&&(e=mc),(r=e)!==null&&r!==void 0&&r.cleanup&&(qw(e.cleanup,"cleanup"),n=e.cleanup),new $w((i,a)=>{let u=Bh(t,e,l=>{n&&u(),l?a(l):i()})})}bc.exports=Bh;bc.exports.finished=tb});var Nn=_e((eP,Jh)=>{"use strict";N();O();k();var Fr=tn(),{aggregateTwoErrors:rb,codes:{ERR_MULTIPLE_CALLBACK:nb},AbortError:ib}=Ut(),{Symbol:Vh}=ot(),{kIsDestroyed:ob,isDestroyed:sb,isFinished:ab,isServerRequest:ub}=Cr(),Kh=Vh("kDestroy"),vc=Vh("kConstruct");function qh(t,e,r){t&&(t.stack,e&&!e.errored&&(e.errored=t),r&&!r.errored&&(r.errored=t))}function cb(t,e){let r=this._readableState,n=this._writableState,i=n||r;return n!=null&&n.destroyed||r!=null&&r.destroyed?(typeof e=="function"&&e(),this):(qh(t,n,r),n&&(n.destroyed=!0),r&&(r.destroyed=!0),i.constructed?Mh(this,t,e):this.once(Kh,function(a){Mh(this,rb(a,t),e)}),this)}function Mh(t,e,r){let n=!1;function i(a){if(n)return;n=!0;let u=t._readableState,l=t._writableState;qh(a,l,u),l&&(l.closed=!0),u&&(u.closed=!0),typeof r=="function"&&r(a),a?Fr.nextTick(lb,t,a):Fr.nextTick($h,t)}try{t._destroy(e||null,i)}catch(a){i(a)}}function lb(t,e){Sc(t,e),$h(t)}function $h(t){let e=t._readableState,r=t._writableState;r&&(r.closeEmitted=!0),e&&(e.closeEmitted=!0),(r!=null&&r.emitClose||e!=null&&e.emitClose)&&t.emit("close")}function Sc(t,e){let r=t._readableState,n=t._writableState;n!=null&&n.errorEmitted||r!=null&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),t.emit("error",e))}function fb(){let t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=t.readable===!1,t.endEmitted=t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function Ec(t,e,r){let n=t._readableState,i=t._writableState;if(i!=null&&i.destroyed||n!=null&&n.destroyed)return this;n!=null&&n.autoDestroy||i!=null&&i.autoDestroy?t.destroy(e):e&&(e.stack,i&&!i.errored&&(i.errored=e),n&&!n.errored&&(n.errored=e),r?Fr.nextTick(Sc,t,e):Sc(t,e))}function db(t,e){if(typeof t._construct!="function")return;let r=t._readableState,n=t._writableState;r&&(r.constructed=!1),n&&(n.constructed=!1),t.once(vc,e),!(t.listenerCount(vc)>1)&&Fr.nextTick(hb,t)}function hb(t){let e=!1;function r(n){if(e){Ec(t,n??new nb);return}e=!0;let i=t._readableState,a=t._writableState,u=a||i;i&&(i.constructed=!0),a&&(a.constructed=!0),u.destroyed?t.emit(Kh,n):n?Ec(t,n,!0):Fr.nextTick(pb,t)}try{t._construct(n=>{Fr.nextTick(r,n)})}catch(n){Fr.nextTick(r,n)}}function pb(t){t.emit(vc)}function Hh(t){return t?.setHeader&&typeof t.abort=="function"}function Wh(t){t.emit("close")}function gb(t,e){t.emit("error",e),Fr.nextTick(Wh,t)}function yb(t,e){!t||sb(t)||(!e&&!ab(t)&&(e=new ib),ub(t)?(t.socket=null,t.destroy(e)):Hh(t)?t.abort():Hh(t.req)?t.req.abort():typeof t.destroy=="function"?t.destroy(e):typeof t.close=="function"?t.close():e?Fr.nextTick(gb,t,e):Fr.nextTick(Wh,t),t.destroyed||(t[ob]=!0))}Jh.exports={construct:db,destroyer:yb,destroy:cb,undestroy:fb,errorOrDestroy:Ec}});var Ss=_e((iP,zh)=>{"use strict";N();O();k();var{ArrayIsArray:mb,ObjectSetPrototypeOf:Gh}=ot(),{EventEmitter:bs}=(ai(),Yt(Yi));function vs(t){bs.call(this,t)}Gh(vs.prototype,bs.prototype);Gh(vs,bs);vs.prototype.pipe=function(t,e){let r=this;function n(g){t.writable&&t.write(g)===!1&&r.pause&&r.pause()}r.on("data",n);function i(){r.readable&&r.resume&&r.resume()}t.on("drain",i),!t._isStdio&&(!e||e.end!==!1)&&(r.on("end",u),r.on("close",l));let a=!1;function u(){a||(a=!0,t.end())}function l(){a||(a=!0,typeof t.destroy=="function"&&t.destroy())}function d(g){f(),bs.listenerCount(this,"error")===0&&this.emit("error",g)}xc(r,"error",d),xc(t,"error",d);function f(){r.removeListener("data",n),t.removeListener("drain",i),r.removeListener("end",u),r.removeListener("close",l),r.removeListener("error",d),t.removeListener("error",d),r.removeListener("end",f),r.removeListener("close",f),t.removeListener("close",f)}return r.on("end",f),r.on("close",f),t.on("close",f),t.emit("pipe",r),t};function xc(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):mb(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}zh.exports={Stream:vs,prependListener:xc}});var io=_e((uP,Es)=>{"use strict";N();O();k();var{SymbolDispose:_b}=ot(),{AbortError:Yh,codes:wb}=Ut(),{isNodeStream:Qh,isWebStream:bb,kControllerErrorFunction:vb}=Cr(),Sb=qr(),{ERR_INVALID_ARG_TYPE:Xh}=wb,Ac,Eb=(t,e)=>{if(typeof t!="object"||!("aborted"in t))throw new Xh(e,"AbortSignal",t)};Es.exports.addAbortSignal=function(e,r){if(Eb(e,"signal"),!Qh(r)&&!bb(r))throw new Xh("stream",["ReadableStream","WritableStream","Stream"],r);return Es.exports.addAbortSignalNoValidate(e,r)};Es.exports.addAbortSignalNoValidate=function(t,e){if(typeof t!="object"||!("aborted"in t))return e;let r=Qh(e)?()=>{e.destroy(new Yh(void 0,{cause:t.reason}))}:()=>{e[vb](new Yh(void 0,{cause:t.reason}))};if(t.aborted)r();else{Ac=Ac||qt().addAbortListener;let n=Ac(t,r);Sb(e,n[_b])}return e}});var tp=_e((hP,ep)=>{"use strict";N();O();k();var{StringPrototypeSlice:Zh,SymbolIterator:xb,TypedArrayPrototypeSet:xs,Uint8Array:Ab}=ot(),{Buffer:Ic}=(ir(),Yt(Sr)),{inspect:Ib}=qt();ep.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){let r={data:e,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length}unshift(e){let r={data:e,next:this.head};this.length===0&&(this.tail=r),this.head=r,++this.length}shift(){if(this.length===0)return;let e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let r=this.head,n=""+r.data;for(;(r=r.next)!==null;)n+=e+r.data;return n}concat(e){if(this.length===0)return Ic.alloc(0);let r=Ic.allocUnsafe(e>>>0),n=this.head,i=0;for(;n;)xs(r,n.data,i),i+=n.data.length,n=n.next;return r}consume(e,r){let n=this.head.data;if(e<n.length){let i=n.slice(0,e);return this.head.data=n.slice(e),i}return e===n.length?this.shift():r?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[xb](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let r="",n=this.head,i=0;do{let a=n.data;if(e>a.length)r+=a,e-=a.length;else{e===a.length?(r+=a,++i,n.next?this.head=n.next:this.head=this.tail=null):(r+=Zh(a,0,e),this.head=n,n.data=Zh(a,e));break}++i}while((n=n.next)!==null);return this.length-=i,r}_getBuffer(e){let r=Ic.allocUnsafe(e),n=e,i=this.head,a=0;do{let u=i.data;if(e>u.length)xs(r,u,n-e),e-=u.length;else{e===u.length?(xs(r,u,n-e),++a,i.next?this.head=i.next:this.head=this.tail=null):(xs(r,new Ab(u.buffer,u.byteOffset,e),n-e),this.head=i,i.data=u.slice(e));break}++a}while((i=i.next)!==null);return this.length-=a,r}[Symbol.for("nodejs.util.inspect.custom")](e,r){return Ib(this,{...r,depth:0,customInspect:!1})}}});var oo=_e((mP,op)=>{"use strict";N();O();k();var{MathFloor:Tb,NumberIsInteger:Rb}=ot(),{validateInteger:Cb}=pi(),{ERR_INVALID_ARG_VALUE:Fb}=Ut().codes,rp=16*1024,np=16;function Pb(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function ip(t){return t?np:rp}function Nb(t,e){Cb(e,"value",0),t?np=e:rp=e}function kb(t,e,r,n){let i=Pb(e,n,r);if(i!=null){if(!Rb(i)||i<0){let a=n?`options.${r}`:"options.highWaterMark";throw new Fb(a,i)}return Tb(i)}return ip(t.objectMode)}op.exports={getHighWaterMark:kb,getDefaultHighWaterMark:ip,setDefaultHighWaterMark:Nb}});var up=_e((Tc,ap)=>{"use strict";N();O();k();var As=(ir(),Yt(Sr)),Pr=As.Buffer;function sp(t,e){for(var r in t)e[r]=t[r]}Pr.from&&Pr.alloc&&Pr.allocUnsafe&&Pr.allocUnsafeSlow?ap.exports=As:(sp(As,Tc),Tc.Buffer=kn);function kn(t,e,r){return Pr(t,e,r)}kn.prototype=Object.create(Pr.prototype);sp(Pr,kn);kn.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return Pr(t,e,r)};kn.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var n=Pr(t);return e!==void 0?typeof r=="string"?n.fill(e,r):n.fill(e):n.fill(0),n};kn.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Pr(t)};kn.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return As.SlowBuffer(t)}});var fp=_e(lp=>{"use strict";N();O();k();var Cc=up().Buffer,cp=Cc.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Ob(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function Db(t){var e=Ob(t);if(typeof e!="string"&&(Cc.isEncoding===cp||!cp(t)))throw new Error("Unknown encoding: "+t);return e||t}lp.StringDecoder=so;function so(t){this.encoding=Db(t);var e;switch(this.encoding){case"utf16le":this.text=Hb,this.end=Vb,e=4;break;case"utf8":this.fillLast=jb,e=4;break;case"base64":this.text=Kb,this.end=qb,e=3;break;default:this.write=$b,this.end=Wb;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Cc.allocUnsafe(e)}so.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};so.prototype.end=Mb;so.prototype.text=Bb;so.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function Rc(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function Lb(t,e,r){var n=e.length-1;if(n<r)return 0;var i=Rc(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=Rc(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=Rc(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function Ub(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function jb(t){var e=this.lastTotal-this.lastNeed,r=Ub(this,t,e);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function Bb(t,e){var r=Lb(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function Mb(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function Hb(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function Vb(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function Kb(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function qb(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function $b(t){return t.toString(this.encoding)}function Wb(t){return t&&t.length?this.write(t):""}});var Fc=_e((RP,gp)=>{"use strict";N();O();k();var dp=tn(),{PromisePrototypeThen:Jb,SymbolAsyncIterator:hp,SymbolIterator:pp}=ot(),{Buffer:Gb}=(ir(),Yt(Sr)),{ERR_INVALID_ARG_TYPE:zb,ERR_STREAM_NULL_VALUES:Yb}=Ut().codes;function Qb(t,e,r){let n;if(typeof e=="string"||e instanceof Gb)return new t({objectMode:!0,...r,read(){this.push(e),this.push(null)}});let i;if(e&&e[hp])i=!0,n=e[hp]();else if(e&&e[pp])i=!1,n=e[pp]();else throw new zb("iterable",["Iterable"],e);let a=new t({objectMode:!0,highWaterMark:1,...r}),u=!1;a._read=function(){u||(u=!0,d())},a._destroy=function(f,g){Jb(l(f),()=>dp.nextTick(g,f),_=>dp.nextTick(g,_||f))};async function l(f){let g=f!=null,_=typeof n.throw=="function";if(g&&_){let{value:w,done:E}=await n.throw(f);if(await w,E)return}if(typeof n.return=="function"){let{value:w}=await n.return();await w}}async function d(){for(;;){try{let{value:f,done:g}=i?await n.next():n.next();if(g)a.push(null);else{let _=f&&typeof f.then=="function"?await f:f;if(_===null)throw u=!1,new Yb;if(a.push(_))continue;u=!1}}catch(f){a.destroy(f)}break}}return a}gp.exports=Qb});var uo=_e((NP,kp)=>{"use strict";N();O();k();var pr=tn(),{ArrayPrototypeIndexOf:Xb,NumberIsInteger:Zb,NumberIsNaN:ev,NumberParseInt:tv,ObjectDefineProperties:jc,ObjectKeys:rv,ObjectSetPrototypeOf:_p,Promise:wp,SafeSet:nv,SymbolAsyncDispose:iv,SymbolAsyncIterator:ov,Symbol:sv}=ot();kp.exports=Fe;Fe.ReadableState=Cs;var{EventEmitter:av}=(ai(),Yt(Yi)),{Stream:nn,prependListener:uv}=Ss(),{Buffer:Pc}=(ir(),Yt(Sr)),{addAbortSignal:cv}=io(),bp=qr(),Ue=qt().debuglog("stream",t=>{Ue=t}),lv=tp(),wi=Nn(),{getHighWaterMark:fv,getDefaultHighWaterMark:dv}=oo(),{aggregateTwoErrors:yp,codes:{ERR_INVALID_ARG_TYPE:hv,ERR_METHOD_NOT_IMPLEMENTED:pv,ERR_OUT_OF_RANGE:gv,ERR_STREAM_PUSH_AFTER_EOF:yv,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:mv},AbortError:_v}=Ut(),{validateObject:wv}=pi(),On=sv("kPaused"),{StringDecoder:vp}=fp(),bv=Fc();_p(Fe.prototype,nn.prototype);_p(Fe,nn);var Nc=()=>{},{errorOrDestroy:mi}=wi,_i=1,vv=2,Sp=4,ao=8,Ep=16,Is=32,Ts=64,xp=128,Sv=256,Ev=512,xv=1024,Lc=2048,Uc=4096,Av=8192,Iv=16384,Tv=32768,Ap=65536,Rv=1<<17,Cv=1<<18;function At(t){return{enumerable:!1,get(){return(this.state&t)!==0},set(e){e?this.state|=t:this.state&=~t}}}jc(Cs.prototype,{objectMode:At(_i),ended:At(vv),endEmitted:At(Sp),reading:At(ao),constructed:At(Ep),sync:At(Is),needReadable:At(Ts),emittedReadable:At(xp),readableListening:At(Sv),resumeScheduled:At(Ev),errorEmitted:At(xv),emitClose:At(Lc),autoDestroy:At(Uc),destroyed:At(Av),closed:At(Iv),closeEmitted:At(Tv),multiAwaitDrain:At(Ap),readingMore:At(Rv),dataEmitted:At(Cv)});function Cs(t,e,r){typeof r!="boolean"&&(r=e instanceof Nr()),this.state=Lc|Uc|Ep|Is,t&&t.objectMode&&(this.state|=_i),r&&t&&t.readableObjectMode&&(this.state|=_i),this.highWaterMark=t?fv(this,t,"readableHighWaterMark",r):dv(!1),this.buffer=new lv,this.length=0,this.pipes=[],this.flowing=null,this[On]=null,t&&t.emitClose===!1&&(this.state&=~Lc),t&&t.autoDestroy===!1&&(this.state&=~Uc),this.errored=null,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,t&&t.encoding&&(this.decoder=new vp(t.encoding),this.encoding=t.encoding)}function Fe(t){if(!(this instanceof Fe))return new Fe(t);let e=this instanceof Nr();this._readableState=new Cs(t,this,e),t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.construct=="function"&&(this._construct=t.construct),t.signal&&!e&&cv(t.signal,this)),nn.call(this,t),wi.construct(this,()=>{this._readableState.needReadable&&Rs(this,this._readableState)})}Fe.prototype.destroy=wi.destroy;Fe.prototype._undestroy=wi.undestroy;Fe.prototype._destroy=function(t,e){e(t)};Fe.prototype[av.captureRejectionSymbol]=function(t){this.destroy(t)};Fe.prototype[iv]=function(){let t;return this.destroyed||(t=this.readableEnded?null:new _v,this.destroy(t)),new wp((e,r)=>bp(this,n=>n&&n!==t?r(n):e(null)))};Fe.prototype.push=function(t,e){return Ip(this,t,e,!1)};Fe.prototype.unshift=function(t,e){return Ip(this,t,e,!0)};function Ip(t,e,r,n){Ue("readableAddChunk",e);let i=t._readableState,a;if(i.state&_i||(typeof e=="string"?(r=r||i.defaultEncoding,i.encoding!==r&&(n&&i.encoding?e=Pc.from(e,r).toString(i.encoding):(e=Pc.from(e,r),r=""))):e instanceof Pc?r="":nn._isUint8Array(e)?(e=nn._uint8ArrayToBuffer(e),r=""):e!=null&&(a=new hv("chunk",["string","Buffer","Uint8Array"],e))),a)mi(t,a);else if(e===null)i.state&=~ao,Nv(t,i);else if(i.state&_i||e&&e.length>0)if(n)if(i.state&Sp)mi(t,new mv);else{if(i.destroyed||i.errored)return!1;kc(t,i,e,!0)}else if(i.ended)mi(t,new yv);else{if(i.destroyed||i.errored)return!1;i.state&=~ao,i.decoder&&!r?(e=i.decoder.write(e),i.objectMode||e.length!==0?kc(t,i,e,!1):Rs(t,i)):kc(t,i,e,!1)}else n||(i.state&=~ao,Rs(t,i));return!i.ended&&(i.length<i.highWaterMark||i.length===0)}function kc(t,e,r,n){e.flowing&&e.length===0&&!e.sync&&t.listenerCount("data")>0?(e.state&Ap?e.awaitDrainWriters.clear():e.awaitDrainWriters=null,e.dataEmitted=!0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.state&Ts&&Fs(t)),Rs(t,e)}Fe.prototype.isPaused=function(){let t=this._readableState;return t[On]===!0||t.flowing===!1};Fe.prototype.setEncoding=function(t){let e=new vp(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;let r=this._readableState.buffer,n="";for(let i of r)n+=e.write(i);return r.clear(),n!==""&&r.push(n),this._readableState.length=n.length,this};var Fv=1073741824;function Pv(t){if(t>Fv)throw new gv("size","<= 1GiB",t);return t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++,t}function mp(t,e){return t<=0||e.length===0&&e.ended?0:e.state&_i?1:ev(t)?e.flowing&&e.length?e.buffer.first().length:e.length:t<=e.length?t:e.ended?e.length:0}Fe.prototype.read=function(t){Ue("read",t),t===void 0?t=NaN:Zb(t)||(t=tv(t,10));let e=this._readableState,r=t;if(t>e.highWaterMark&&(e.highWaterMark=Pv(t)),t!==0&&(e.state&=~xp),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return Ue("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Oc(this):Fs(this),null;if(t=mp(t,e),t===0&&e.ended)return e.length===0&&Oc(this),null;let n=(e.state&Ts)!==0;if(Ue("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,Ue("length less than watermark",n)),e.ended||e.reading||e.destroyed||e.errored||!e.constructed)n=!1,Ue("reading, ended or constructing",n);else if(n){Ue("do read"),e.state|=ao|Is,e.length===0&&(e.state|=Ts);try{this._read(e.highWaterMark)}catch(a){mi(this,a)}e.state&=~Is,e.reading||(t=mp(r,e))}let i;return t>0?i=Pp(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.multiAwaitDrain?e.awaitDrainWriters.clear():e.awaitDrainWriters=null),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&Oc(this)),i!==null&&!e.errorEmitted&&!e.closeEmitted&&(e.dataEmitted=!0,this.emit("data",i)),i};function Nv(t,e){if(Ue("onEofChunk"),!e.ended){if(e.decoder){let r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Fs(t):(e.needReadable=!1,e.emittedReadable=!0,Tp(t))}}function Fs(t){let e=t._readableState;Ue("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(Ue("emitReadable",e.flowing),e.emittedReadable=!0,pr.nextTick(Tp,t))}function Tp(t){let e=t._readableState;Ue("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&!e.errored&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Cp(t)}function Rs(t,e){!e.readingMore&&e.constructed&&(e.readingMore=!0,pr.nextTick(kv,t,e))}function kv(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){let r=e.length;if(Ue("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}Fe.prototype._read=function(t){throw new pv("_read()")};Fe.prototype.pipe=function(t,e){let r=this,n=this._readableState;n.pipes.length===1&&(n.multiAwaitDrain||(n.multiAwaitDrain=!0,n.awaitDrainWriters=new nv(n.awaitDrainWriters?[n.awaitDrainWriters]:[]))),n.pipes.push(t),Ue("pipe count=%d opts=%j",n.pipes.length,e);let a=(!e||e.end!==!1)&&t!==pr.stdout&&t!==pr.stderr?l:I;n.endEmitted?pr.nextTick(a):r.once("end",a),t.on("unpipe",u);function u(D,U){Ue("onunpipe"),D===r&&U&&U.hasUnpiped===!1&&(U.hasUnpiped=!0,g())}function l(){Ue("onend"),t.end()}let d,f=!1;function g(){Ue("cleanup"),t.removeListener("close",x),t.removeListener("finish",A),d&&t.removeListener("drain",d),t.removeListener("error",E),t.removeListener("unpipe",u),r.removeListener("end",l),r.removeListener("end",I),r.removeListener("data",w),f=!0,d&&n.awaitDrainWriters&&(!t._writableState||t._writableState.needDrain)&&d()}function _(){f||(n.pipes.length===1&&n.pipes[0]===t?(Ue("false write response, pause",0),n.awaitDrainWriters=t,n.multiAwaitDrain=!1):n.pipes.length>1&&n.pipes.includes(t)&&(Ue("false write response, pause",n.awaitDrainWriters.size),n.awaitDrainWriters.add(t)),r.pause()),d||(d=Ov(r,t),t.on("drain",d))}r.on("data",w);function w(D){Ue("ondata");let U=t.write(D);Ue("dest.write",U),U===!1&&_()}function E(D){if(Ue("onerror",D),I(),t.removeListener("error",E),t.listenerCount("error")===0){let U=t._writableState||t._readableState;U&&!U.errorEmitted?mi(t,D):t.emit("error",D)}}uv(t,"error",E);function x(){t.removeListener("finish",A),I()}t.once("close",x);function A(){Ue("onfinish"),t.removeListener("close",x),I()}t.once("finish",A);function I(){Ue("unpipe"),r.unpipe(t)}return t.emit("pipe",r),t.writableNeedDrain===!0?_():n.flowing||(Ue("pipe resume"),r.resume()),t};function Ov(t,e){return function(){let n=t._readableState;n.awaitDrainWriters===e?(Ue("pipeOnDrain",1),n.awaitDrainWriters=null):n.multiAwaitDrain&&(Ue("pipeOnDrain",n.awaitDrainWriters.size),n.awaitDrainWriters.delete(e)),(!n.awaitDrainWriters||n.awaitDrainWriters.size===0)&&t.listenerCount("data")&&t.resume()}}Fe.prototype.unpipe=function(t){let e=this._readableState,r={hasUnpiped:!1};if(e.pipes.length===0)return this;if(!t){let i=e.pipes;e.pipes=[],this.pause();for(let a=0;a<i.length;a++)i[a].emit("unpipe",this,{hasUnpiped:!1});return this}let n=Xb(e.pipes,t);return n===-1?this:(e.pipes.splice(n,1),e.pipes.length===0&&this.pause(),t.emit("unpipe",this,r),this)};Fe.prototype.on=function(t,e){let r=nn.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,Ue("on readable",n.length,n.reading),n.length?Fs(this):n.reading||pr.nextTick(Dv,this)),r};Fe.prototype.addListener=Fe.prototype.on;Fe.prototype.removeListener=function(t,e){let r=nn.prototype.removeListener.call(this,t,e);return t==="readable"&&pr.nextTick(Rp,this),r};Fe.prototype.off=Fe.prototype.removeListener;Fe.prototype.removeAllListeners=function(t){let e=nn.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&pr.nextTick(Rp,this),e};function Rp(t){let e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&e[On]===!1?e.flowing=!0:t.listenerCount("data")>0?t.resume():e.readableListening||(e.flowing=null)}function Dv(t){Ue("readable nexttick read 0"),t.read(0)}Fe.prototype.resume=function(){let t=this._readableState;return t.flowing||(Ue("resume"),t.flowing=!t.readableListening,Lv(this,t)),t[On]=!1,this};function Lv(t,e){e.resumeScheduled||(e.resumeScheduled=!0,pr.nextTick(Uv,t,e))}function Uv(t,e){Ue("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Cp(t),e.flowing&&!e.reading&&t.read(0)}Fe.prototype.pause=function(){return Ue("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Ue("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[On]=!0,this};function Cp(t){let e=t._readableState;for(Ue("flow",e.flowing);e.flowing&&t.read()!==null;);}Fe.prototype.wrap=function(t){let e=!1;t.on("data",n=>{!this.push(n)&&t.pause&&(e=!0,t.pause())}),t.on("end",()=>{this.push(null)}),t.on("error",n=>{mi(this,n)}),t.on("close",()=>{this.destroy()}),t.on("destroy",()=>{this.destroy()}),this._read=()=>{e&&t.resume&&(e=!1,t.resume())};let r=rv(t);for(let n=1;n<r.length;n++){let i=r[n];this[i]===void 0&&typeof t[i]=="function"&&(this[i]=t[i].bind(t))}return this};Fe.prototype[ov]=function(){return Fp(this)};Fe.prototype.iterator=function(t){return t!==void 0&&wv(t,"options"),Fp(this,t)};function Fp(t,e){typeof t.read!="function"&&(t=Fe.wrap(t,{objectMode:!0}));let r=jv(t,e);return r.stream=t,r}async function*jv(t,e){let r=Nc;function n(u){this===t?(r(),r=Nc):r=u}t.on("readable",n);let i,a=bp(t,{writable:!1},u=>{i=u?yp(i,u):null,r(),r=Nc});try{for(;;){let u=t.destroyed?null:t.read();if(u!==null)yield u;else{if(i)throw i;if(i===null)return;await new wp(n)}}}catch(u){throw i=yp(i,u),i}finally{(i||e?.destroyOnReturn!==!1)&&(i===void 0||t._readableState.autoDestroy)?wi.destroyer(t,null):(t.off("readable",n),a())}}jc(Fe.prototype,{readable:{__proto__:null,get(){let t=this._readableState;return!!t&&t.readable!==!1&&!t.destroyed&&!t.errorEmitted&&!t.endEmitted},set(t){this._readableState&&(this._readableState.readable=!!t)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(t){this._readableState&&(this._readableState.destroyed=t)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}});jc(Cs.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[On]!==!1},set(t){this[On]=!!t}}});Fe._fromList=Pp;function Pp(t,e){if(e.length===0)return null;let r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function Oc(t){let e=t._readableState;Ue("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,pr.nextTick(Bv,e,t))}function Bv(t,e){if(Ue("endReadableNT",t.endEmitted,t.length),!t.errored&&!t.closeEmitted&&!t.endEmitted&&t.length===0){if(t.endEmitted=!0,e.emit("end"),e.writable&&e.allowHalfOpen===!1)pr.nextTick(Mv,e);else if(t.autoDestroy){let r=e._writableState;(!r||r.autoDestroy&&(r.finished||r.writable===!1))&&e.destroy()}}}function Mv(t){t.writable&&!t.writableEnded&&!t.destroyed&&t.end()}Fe.from=function(t,e){return bv(Fe,t,e)};var Dc;function Np(){return Dc===void 0&&(Dc={}),Dc}Fe.fromWeb=function(t,e){return Np().newStreamReadableFromReadableStream(t,e)};Fe.toWeb=function(t,e){return Np().newReadableStreamFromStreamReadable(t,e)};Fe.wrap=function(t,e){var r,n;return new Fe({objectMode:(r=(n=t.readableObjectMode)!==null&&n!==void 0?n:t.objectMode)!==null&&r!==void 0?r:!0,...e,destroy(i,a){wi.destroyer(t,i),a(i)}}).wrap(t)}});var Ds=_e((LP,$p)=>{"use strict";N();O();k();var Dn=tn(),{ArrayPrototypeSlice:Lp,Error:Hv,FunctionPrototypeSymbolHasInstance:Up,ObjectDefineProperty:jp,ObjectDefineProperties:Vv,ObjectSetPrototypeOf:Bp,StringPrototypeToLowerCase:Kv,Symbol:qv,SymbolHasInstance:$v}=ot();$p.exports=st;st.WritableState=fo;var{EventEmitter:Wv}=(ai(),Yt(Yi)),co=Ss().Stream,{Buffer:Ps}=(ir(),Yt(Sr)),Os=Nn(),{addAbortSignal:Jv}=io(),{getHighWaterMark:Gv,getDefaultHighWaterMark:zv}=oo(),{ERR_INVALID_ARG_TYPE:Yv,ERR_METHOD_NOT_IMPLEMENTED:Qv,ERR_MULTIPLE_CALLBACK:Mp,ERR_STREAM_CANNOT_PIPE:Xv,ERR_STREAM_DESTROYED:lo,ERR_STREAM_ALREADY_FINISHED:Zv,ERR_STREAM_NULL_VALUES:eS,ERR_STREAM_WRITE_AFTER_END:tS,ERR_UNKNOWN_ENCODING:Hp}=Ut().codes,{errorOrDestroy:bi}=Os;Bp(st.prototype,co.prototype);Bp(st,co);function Hc(){}var vi=qv("kOnFinished");function fo(t,e,r){typeof r!="boolean"&&(r=e instanceof Nr()),this.objectMode=!!(t&&t.objectMode),r&&(this.objectMode=this.objectMode||!!(t&&t.writableObjectMode)),this.highWaterMark=t?Gv(this,t,"writableHighWaterMark",r):zv(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let n=!!(t&&t.decodeStrings===!1);this.decodeStrings=!n,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=nS.bind(void 0,e),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,ks(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!t||t.emitClose!==!1,this.autoDestroy=!t||t.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[vi]=[]}function ks(t){t.buffered=[],t.bufferedIndex=0,t.allBuffers=!0,t.allNoop=!0}fo.prototype.getBuffer=function(){return Lp(this.buffered,this.bufferedIndex)};jp(fo.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function st(t){let e=this instanceof Nr();if(!e&&!Up(st,this))return new st(t);this._writableState=new fo(t,this,e),t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final),typeof t.construct=="function"&&(this._construct=t.construct),t.signal&&Jv(t.signal,this)),co.call(this,t),Os.construct(this,()=>{let r=this._writableState;r.writing||Kc(this,r),qc(this,r)})}jp(st,$v,{__proto__:null,value:function(t){return Up(this,t)?!0:this!==st?!1:t&&t._writableState instanceof fo}});st.prototype.pipe=function(){bi(this,new Xv)};function Vp(t,e,r,n){let i=t._writableState;if(typeof r=="function")n=r,r=i.defaultEncoding;else{if(!r)r=i.defaultEncoding;else if(r!=="buffer"&&!Ps.isEncoding(r))throw new Hp(r);typeof n!="function"&&(n=Hc)}if(e===null)throw new eS;if(!i.objectMode)if(typeof e=="string")i.decodeStrings!==!1&&(e=Ps.from(e,r),r="buffer");else if(e instanceof Ps)r="buffer";else if(co._isUint8Array(e))e=co._uint8ArrayToBuffer(e),r="buffer";else throw new Yv("chunk",["string","Buffer","Uint8Array"],e);let a;return i.ending?a=new tS:i.destroyed&&(a=new lo("write")),a?(Dn.nextTick(n,a),bi(t,a,!0),a):(i.pendingcb++,rS(t,i,e,r,n))}st.prototype.write=function(t,e,r){return Vp(this,t,e,r)===!0};st.prototype.cork=function(){this._writableState.corked++};st.prototype.uncork=function(){let t=this._writableState;t.corked&&(t.corked--,t.writing||Kc(this,t))};st.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=Kv(e)),!Ps.isEncoding(e))throw new Hp(e);return this._writableState.defaultEncoding=e,this};function rS(t,e,r,n,i){let a=e.objectMode?1:r.length;e.length+=a;let u=e.length<e.highWaterMark;return u||(e.needDrain=!0),e.writing||e.corked||e.errored||!e.constructed?(e.buffered.push({chunk:r,encoding:n,callback:i}),e.allBuffers&&n!=="buffer"&&(e.allBuffers=!1),e.allNoop&&i!==Hc&&(e.allNoop=!1)):(e.writelen=a,e.writecb=i,e.writing=!0,e.sync=!0,t._write(r,n,e.onwrite),e.sync=!1),u&&!e.errored&&!e.destroyed}function Op(t,e,r,n,i,a,u){e.writelen=n,e.writecb=u,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new lo("write")):r?t._writev(i,e.onwrite):t._write(i,a,e.onwrite),e.sync=!1}function Dp(t,e,r,n){--e.pendingcb,n(r),Vc(e),bi(t,r)}function nS(t,e){let r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function"){bi(t,new Mp);return}r.writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,e?(e.stack,r.errored||(r.errored=e),t._readableState&&!t._readableState.errored&&(t._readableState.errored=e),n?Dn.nextTick(Dp,t,r,e,i):Dp(t,r,e,i)):(r.buffered.length>r.bufferedIndex&&Kc(t,r),n?r.afterWriteTickInfo!==null&&r.afterWriteTickInfo.cb===i?r.afterWriteTickInfo.count++:(r.afterWriteTickInfo={count:1,cb:i,stream:t,state:r},Dn.nextTick(iS,r.afterWriteTickInfo)):Kp(t,r,1,i))}function iS({stream:t,state:e,count:r,cb:n}){return e.afterWriteTickInfo=null,Kp(t,e,r,n)}function Kp(t,e,r,n){for(!e.ending&&!t.destroyed&&e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"));r-- >0;)e.pendingcb--,n();e.destroyed&&Vc(e),qc(t,e)}function Vc(t){if(t.writing)return;for(let i=t.bufferedIndex;i<t.buffered.length;++i){var e;let{chunk:a,callback:u}=t.buffered[i],l=t.objectMode?1:a.length;t.length-=l,u((e=t.errored)!==null&&e!==void 0?e:new lo("write"))}let r=t[vi].splice(0);for(let i=0;i<r.length;i++){var n;r[i]((n=t.errored)!==null&&n!==void 0?n:new lo("end"))}ks(t)}function Kc(t,e){if(e.corked||e.bufferProcessing||e.destroyed||!e.constructed)return;let{buffered:r,bufferedIndex:n,objectMode:i}=e,a=r.length-n;if(!a)return;let u=n;if(e.bufferProcessing=!0,a>1&&t._writev){e.pendingcb-=a-1;let l=e.allNoop?Hc:f=>{for(let g=u;g<r.length;++g)r[g].callback(f)},d=e.allNoop&&u===0?r:Lp(r,u);d.allBuffers=e.allBuffers,Op(t,e,!0,e.length,d,"",l),ks(e)}else{do{let{chunk:l,encoding:d,callback:f}=r[u];r[u++]=null;let g=i?1:l.length;Op(t,e,!1,g,l,d,f)}while(u<r.length&&!e.writing);u===r.length?ks(e):u>256?(r.splice(0,u),e.bufferedIndex=0):e.bufferedIndex=u}e.bufferProcessing=!1}st.prototype._write=function(t,e,r){if(this._writev)this._writev([{chunk:t,encoding:e}],r);else throw new Qv("_write()")};st.prototype._writev=null;st.prototype.end=function(t,e,r){let n=this._writableState;typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null);let i;if(t!=null){let a=Vp(this,t,e);a instanceof Hv&&(i=a)}return n.corked&&(n.corked=1,this.uncork()),i||(!n.errored&&!n.ending?(n.ending=!0,qc(this,n,!0),n.ended=!0):n.finished?i=new Zv("end"):n.destroyed&&(i=new lo("end"))),typeof r=="function"&&(i||n.finished?Dn.nextTick(r,i):n[vi].push(r)),this};function Ns(t){return t.ending&&!t.destroyed&&t.constructed&&t.length===0&&!t.errored&&t.buffered.length===0&&!t.finished&&!t.writing&&!t.errorEmitted&&!t.closeEmitted}function oS(t,e){let r=!1;function n(i){if(r){bi(t,i??Mp());return}if(r=!0,e.pendingcb--,i){let a=e[vi].splice(0);for(let u=0;u<a.length;u++)a[u](i);bi(t,i,e.sync)}else Ns(e)&&(e.prefinished=!0,t.emit("prefinish"),e.pendingcb++,Dn.nextTick(Mc,t,e))}e.sync=!0,e.pendingcb++;try{t._final(n)}catch(i){n(i)}e.sync=!1}function sS(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.finalCalled=!0,oS(t,e)):(e.prefinished=!0,t.emit("prefinish")))}function qc(t,e,r){Ns(e)&&(sS(t,e),e.pendingcb===0&&(r?(e.pendingcb++,Dn.nextTick((n,i)=>{Ns(i)?Mc(n,i):i.pendingcb--},t,e)):Ns(e)&&(e.pendingcb++,Mc(t,e))))}function Mc(t,e){e.pendingcb--,e.finished=!0;let r=e[vi].splice(0);for(let n=0;n<r.length;n++)r[n]();if(t.emit("finish"),e.autoDestroy){let n=t._readableState;(!n||n.autoDestroy&&(n.endEmitted||n.readable===!1))&&t.destroy()}}Vv(st.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(t){this._writableState&&(this._writableState.destroyed=t)}},writable:{__proto__:null,get(){let t=this._writableState;return!!t&&t.writable!==!1&&!t.destroyed&&!t.errored&&!t.ending&&!t.ended},set(t){this._writableState&&(this._writableState.writable=!!t)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let t=this._writableState;return t?!t.destroyed&&!t.ending&&t.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var aS=Os.destroy;st.prototype.destroy=function(t,e){let r=this._writableState;return!r.destroyed&&(r.bufferedIndex<r.buffered.length||r[vi].length)&&Dn.nextTick(Vc,r),aS.call(this,t,e),this};st.prototype._undestroy=Os.undestroy;st.prototype._destroy=function(t,e){e(t)};st.prototype[Wv.captureRejectionSymbol]=function(t){this.destroy(t)};var Bc;function qp(){return Bc===void 0&&(Bc={}),Bc}st.fromWeb=function(t,e){return qp().newStreamWritableFromWritableStream(t,e)};st.toWeb=function(t){return qp().newWritableStreamFromStreamWritable(t)}});var sg=_e((MP,og)=>{"use strict";N();O();k();var $c=tn(),uS=(ir(),Yt(Sr)),{isReadable:cS,isWritable:lS,isIterable:Wp,isNodeStream:fS,isReadableNodeStream:Jp,isWritableNodeStream:Gp,isDuplexNodeStream:dS,isReadableStream:zp,isWritableStream:Yp}=Cr(),Qp=qr(),{AbortError:ng,codes:{ERR_INVALID_ARG_TYPE:hS,ERR_INVALID_RETURN_VALUE:Xp}}=Ut(),{destroyer:Ei}=Nn(),pS=Nr(),ig=uo(),gS=Ds(),{createDeferredPromise:Zp}=qt(),eg=Fc(),tg=globalThis.Blob||uS.Blob,yS=typeof tg<"u"?function(e){return e instanceof tg}:function(e){return!1},mS=globalThis.AbortController||di().AbortController,{FunctionPrototypeCall:rg}=ot(),on=class extends pS{constructor(e){super(e),e?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),e?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};og.exports=function t(e,r){if(dS(e))return e;if(Jp(e))return Si({readable:e});if(Gp(e))return Si({writable:e});if(fS(e))return Si({writable:!1,readable:!1});if(zp(e))return Si({readable:ig.fromWeb(e)});if(Yp(e))return Si({writable:gS.fromWeb(e)});if(typeof e=="function"){let{value:i,write:a,final:u,destroy:l}=_S(e);if(Wp(i))return eg(on,i,{objectMode:!0,write:a,final:u,destroy:l});let d=i?.then;if(typeof d=="function"){let f,g=rg(d,i,_=>{if(_!=null)throw new Xp("nully","body",_)},_=>{Ei(f,_)});return f=new on({objectMode:!0,readable:!1,write:a,final(_){u(async()=>{try{await g,$c.nextTick(_,null)}catch(w){$c.nextTick(_,w)}})},destroy:l})}throw new Xp("Iterable, AsyncIterable or AsyncFunction",r,i)}if(yS(e))return t(e.arrayBuffer());if(Wp(e))return eg(on,e,{objectMode:!0,writable:!1});if(zp(e?.readable)&&Yp(e?.writable))return on.fromWeb(e);if(typeof e?.writable=="object"||typeof e?.readable=="object"){let i=e!=null&&e.readable?Jp(e?.readable)?e?.readable:t(e.readable):void 0,a=e!=null&&e.writable?Gp(e?.writable)?e?.writable:t(e.writable):void 0;return Si({readable:i,writable:a})}let n=e?.then;if(typeof n=="function"){let i;return rg(n,e,a=>{a!=null&&i.push(a),i.push(null)},a=>{Ei(i,a)}),i=new on({objectMode:!0,writable:!1,read(){}})}throw new hS(r,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],e)};function _S(t){let{promise:e,resolve:r}=Zp(),n=new mS,i=n.signal;return{value:t(async function*(){for(;;){let u=e;e=null;let{chunk:l,done:d,cb:f}=await u;if($c.nextTick(f),d)return;if(i.aborted)throw new ng(void 0,{cause:i.reason});({promise:e,resolve:r}=Zp()),yield l}}(),{signal:i}),write(u,l,d){let f=r;r=null,f({chunk:u,done:!1,cb:d})},final(u){let l=r;r=null,l({done:!0,cb:u})},destroy(u,l){n.abort(),l(u)}}}function Si(t){let e=t.readable&&typeof t.readable.read!="function"?ig.wrap(t.readable):t.readable,r=t.writable,n=!!cS(e),i=!!lS(r),a,u,l,d,f;function g(_){let w=d;d=null,w?w(_):_&&f.destroy(_)}return f=new on({readableObjectMode:!!(e!=null&&e.readableObjectMode),writableObjectMode:!!(r!=null&&r.writableObjectMode),readable:n,writable:i}),i&&(Qp(r,_=>{i=!1,_&&Ei(e,_),g(_)}),f._write=function(_,w,E){r.write(_,w)?E():a=E},f._final=function(_){r.end(),u=_},r.on("drain",function(){if(a){let _=a;a=null,_()}}),r.on("finish",function(){if(u){let _=u;u=null,_()}})),n&&(Qp(e,_=>{n=!1,_&&Ei(e,_),g(_)}),e.on("readable",function(){if(l){let _=l;l=null,_()}}),e.on("end",function(){f.push(null)}),f._read=function(){for(;;){let _=e.read();if(_===null){l=f._read;return}if(!f.push(_))return}}),f._destroy=function(_,w){!_&&d!==null&&(_=new ng),l=null,a=null,u=null,d===null?w(_):(d=w,Ei(r,_),Ei(e,_))},f}});var Nr=_e((qP,cg)=>{"use strict";N();O();k();var{ObjectDefineProperties:wS,ObjectGetOwnPropertyDescriptor:$r,ObjectKeys:bS,ObjectSetPrototypeOf:ag}=ot();cg.exports=gr;var Gc=uo(),cr=Ds();ag(gr.prototype,Gc.prototype);ag(gr,Gc);{let t=bS(cr.prototype);for(let e=0;e<t.length;e++){let r=t[e];gr.prototype[r]||(gr.prototype[r]=cr.prototype[r])}}function gr(t){if(!(this instanceof gr))return new gr(t);Gc.call(this,t),cr.call(this,t),t?(this.allowHalfOpen=t.allowHalfOpen!==!1,t.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),t.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}wS(gr.prototype,{writable:{__proto__:null,...$r(cr.prototype,"writable")},writableHighWaterMark:{__proto__:null,...$r(cr.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...$r(cr.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...$r(cr.prototype,"writableBuffer")},writableLength:{__proto__:null,...$r(cr.prototype,"writableLength")},writableFinished:{__proto__:null,...$r(cr.prototype,"writableFinished")},writableCorked:{__proto__:null,...$r(cr.prototype,"writableCorked")},writableEnded:{__proto__:null,...$r(cr.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...$r(cr.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(t){this._readableState&&this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}});var Wc;function ug(){return Wc===void 0&&(Wc={}),Wc}gr.fromWeb=function(t,e){return ug().newStreamDuplexFromReadableWritablePair(t,e)};gr.toWeb=function(t){return ug().newReadableWritablePairFromDuplex(t)};var Jc;gr.from=function(t){return Jc||(Jc=sg()),Jc(t,"body")}});var Qc=_e((GP,fg)=>{"use strict";N();O();k();var{ObjectSetPrototypeOf:lg,Symbol:vS}=ot();fg.exports=Wr;var{ERR_METHOD_NOT_IMPLEMENTED:SS}=Ut().codes,Yc=Nr(),{getHighWaterMark:ES}=oo();lg(Wr.prototype,Yc.prototype);lg(Wr,Yc);var ho=vS("kCallback");function Wr(t){if(!(this instanceof Wr))return new Wr(t);let e=t?ES(this,t,"readableHighWaterMark",!0):null;e===0&&(t={...t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:t.writableHighWaterMark||0}),Yc.call(this,t),this._readableState.sync=!1,this[ho]=null,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",xS)}function zc(t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,r)=>{if(e){t?t(e):this.destroy(e);return}r!=null&&this.push(r),this.push(null),t&&t()}):(this.push(null),t&&t())}function xS(){this._final!==zc&&zc.call(this)}Wr.prototype._final=zc;Wr.prototype._transform=function(t,e,r){throw new SS("_transform()")};Wr.prototype._write=function(t,e,r){let n=this._readableState,i=this._writableState,a=n.length;this._transform(t,e,(u,l)=>{if(u){r(u);return}l!=null&&this.push(l),i.ended||a===n.length||n.length<n.highWaterMark?r():this[ho]=r})};Wr.prototype._read=function(){if(this[ho]){let t=this[ho];this[ho]=null,t()}}});var Zc=_e((XP,hg)=>{"use strict";N();O();k();var{ObjectSetPrototypeOf:dg}=ot();hg.exports=xi;var Xc=Qc();dg(xi.prototype,Xc.prototype);dg(xi,Xc);function xi(t){if(!(this instanceof xi))return new xi(t);Xc.call(this,t)}xi.prototype._transform=function(t,e,r){r(null,t)}});var Bs=_e((rN,_g)=>{"use strict";N();O();k();var po=tn(),{ArrayIsArray:AS,Promise:IS,SymbolAsyncIterator:TS,SymbolDispose:RS}=ot(),js=qr(),{once:CS}=qt(),FS=Nn(),pg=Nr(),{aggregateTwoErrors:PS,codes:{ERR_INVALID_ARG_TYPE:ul,ERR_INVALID_RETURN_VALUE:el,ERR_MISSING_ARGS:NS,ERR_STREAM_DESTROYED:kS,ERR_STREAM_PREMATURE_CLOSE:OS},AbortError:DS}=Ut(),{validateFunction:LS,validateAbortSignal:US}=pi(),{isIterable:Ln,isReadable:tl,isReadableNodeStream:Us,isNodeStream:gg,isTransformStream:Ai,isWebStream:jS,isReadableStream:rl,isReadableFinished:BS}=Cr(),MS=globalThis.AbortController||di().AbortController,nl,il,ol;function yg(t,e,r){let n=!1;t.on("close",()=>{n=!0});let i=js(t,{readable:e,writable:r},a=>{n=!a});return{destroy:a=>{n||(n=!0,FS.destroyer(t,a||new kS("pipe")))},cleanup:i}}function HS(t){return LS(t[t.length-1],"streams[stream.length - 1]"),t.pop()}function sl(t){if(Ln(t))return t;if(Us(t))return VS(t);throw new ul("val",["Readable","Iterable","AsyncIterable"],t)}async function*VS(t){il||(il=uo()),yield*il.prototype[TS].call(t)}async function Ls(t,e,r,{end:n}){let i,a=null,u=f=>{if(f&&(i=f),a){let g=a;a=null,g()}},l=()=>new IS((f,g)=>{i?g(i):a=()=>{i?g(i):f()}});e.on("drain",u);let d=js(e,{readable:!1},u);try{e.writableNeedDrain&&await l();for await(let f of t)e.write(f)||await l();n&&(e.end(),await l()),r()}catch(f){r(i!==f?PS(i,f):f)}finally{d(),e.off("drain",u)}}async function al(t,e,r,{end:n}){Ai(e)&&(e=e.writable);let i=e.getWriter();try{for await(let a of t)await i.ready,i.write(a).catch(()=>{});await i.ready,n&&await i.close(),r()}catch(a){try{await i.abort(a),r(a)}catch(u){r(u)}}}function KS(...t){return mg(t,CS(HS(t)))}function mg(t,e,r){if(t.length===1&&AS(t[0])&&(t=t[0]),t.length<2)throw new NS("streams");let n=new MS,i=n.signal,a=r?.signal,u=[];US(a,"options.signal");function l(){x(new DS)}ol=ol||qt().addAbortListener;let d;a&&(d=ol(a,l));let f,g,_=[],w=0;function E(z){x(z,--w===0)}function x(z,P){var F;if(z&&(!f||f.code==="ERR_STREAM_PREMATURE_CLOSE")&&(f=z),!(!f&&!P)){for(;_.length;)_.shift()(f);(F=d)===null||F===void 0||F[RS](),n.abort(),P&&(f||u.forEach(te=>te()),po.nextTick(e,f,g))}}let A;for(let z=0;z<t.length;z++){let P=t[z],F=z<t.length-1,te=z>0,oe=F||r?.end!==!1,M=z===t.length-1;if(gg(P)){let he=function(me){me&&me.name!=="AbortError"&&me.code!=="ERR_STREAM_PREMATURE_CLOSE"&&E(me)};var U=he;if(oe){let{destroy:me,cleanup:xe}=yg(P,F,te);_.push(me),tl(P)&&M&&u.push(xe)}P.on("error",he),tl(P)&&M&&u.push(()=>{P.removeListener("error",he)})}if(z===0)if(typeof P=="function"){if(A=P({signal:i}),!Ln(A))throw new el("Iterable, AsyncIterable or Stream","source",A)}else Ln(P)||Us(P)||Ai(P)?A=P:A=pg.from(P);else if(typeof P=="function"){if(Ai(A)){var I;A=sl((I=A)===null||I===void 0?void 0:I.readable)}else A=sl(A);if(A=P(A,{signal:i}),F){if(!Ln(A,!0))throw new el("AsyncIterable",`transform[${z-1}]`,A)}else{var D;nl||(nl=Zc());let he=new nl({objectMode:!0}),me=(D=A)===null||D===void 0?void 0:D.then;if(typeof me=="function")w++,me.call(A,Le=>{g=Le,Le!=null&&he.write(Le),oe&&he.end(),po.nextTick(E)},Le=>{he.destroy(Le),po.nextTick(E,Le)});else if(Ln(A,!0))w++,Ls(A,he,E,{end:oe});else if(rl(A)||Ai(A)){let Le=A.readable||A;w++,Ls(Le,he,E,{end:oe})}else throw new el("AsyncIterable or Promise","destination",A);A=he;let{destroy:xe,cleanup:ze}=yg(A,!1,!0);_.push(xe),M&&u.push(ze)}}else if(gg(P)){if(Us(A)){w+=2;let he=qS(A,P,E,{end:oe});tl(P)&&M&&u.push(he)}else if(Ai(A)||rl(A)){let he=A.readable||A;w++,Ls(he,P,E,{end:oe})}else if(Ln(A))w++,Ls(A,P,E,{end:oe});else throw new ul("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],A);A=P}else if(jS(P)){if(Us(A))w++,al(sl(A),P,E,{end:oe});else if(rl(A)||Ln(A))w++,al(A,P,E,{end:oe});else if(Ai(A))w++,al(A.readable,P,E,{end:oe});else throw new ul("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],A);A=P}else A=pg.from(P)}return(i!=null&&i.aborted||a!=null&&a.aborted)&&po.nextTick(l),A}function qS(t,e,r,{end:n}){let i=!1;if(e.on("close",()=>{i||r(new OS)}),t.pipe(e,{end:!1}),n){let u=function(){i=!0,e.end()};var a=u;BS(t)?po.nextTick(u):t.once("end",u)}else r();return js(t,{readable:!0,writable:!1},u=>{let l=t._readableState;u&&u.code==="ERR_STREAM_PREMATURE_CLOSE"&&l&&l.ended&&!l.errored&&!l.errorEmitted?t.once("end",r).once("error",r):r(u)}),js(e,{readable:!1,writable:!0},r)}_g.exports={pipelineImpl:mg,pipeline:KS}});var ll=_e((sN,xg)=>{"use strict";N();O();k();var{pipeline:$S}=Bs(),Ms=Nr(),{destroyer:WS}=Nn(),{isNodeStream:Hs,isReadable:wg,isWritable:bg,isWebStream:cl,isTransformStream:Un,isWritableStream:vg,isReadableStream:Sg}=Cr(),{AbortError:JS,codes:{ERR_INVALID_ARG_VALUE:Eg,ERR_MISSING_ARGS:GS}}=Ut(),zS=qr();xg.exports=function(...e){if(e.length===0)throw new GS("streams");if(e.length===1)return Ms.from(e[0]);let r=[...e];if(typeof e[0]=="function"&&(e[0]=Ms.from(e[0])),typeof e[e.length-1]=="function"){let E=e.length-1;e[E]=Ms.from(e[E])}for(let E=0;E<e.length;++E)if(!(!Hs(e[E])&&!cl(e[E]))){if(E<e.length-1&&!(wg(e[E])||Sg(e[E])||Un(e[E])))throw new Eg(`streams[${E}]`,r[E],"must be readable");if(E>0&&!(bg(e[E])||vg(e[E])||Un(e[E])))throw new Eg(`streams[${E}]`,r[E],"must be writable")}let n,i,a,u,l;function d(E){let x=u;u=null,x?x(E):E?l.destroy(E):!w&&!_&&l.destroy()}let f=e[0],g=$S(e,d),_=!!(bg(f)||vg(f)||Un(f)),w=!!(wg(g)||Sg(g)||Un(g));if(l=new Ms({writableObjectMode:!!(f!=null&&f.writableObjectMode),readableObjectMode:!!(g!=null&&g.readableObjectMode),writable:_,readable:w}),_){if(Hs(f))l._write=function(x,A,I){f.write(x,A)?I():n=I},l._final=function(x){f.end(),i=x},f.on("drain",function(){if(n){let x=n;n=null,x()}});else if(cl(f)){let A=(Un(f)?f.writable:f).getWriter();l._write=async function(I,D,U){try{await A.ready,A.write(I).catch(()=>{}),U()}catch(z){U(z)}},l._final=async function(I){try{await A.ready,A.close().catch(()=>{}),i=I}catch(D){I(D)}}}let E=Un(g)?g.readable:g;zS(E,()=>{if(i){let x=i;i=null,x()}})}if(w){if(Hs(g))g.on("readable",function(){if(a){let E=a;a=null,E()}}),g.on("end",function(){l.push(null)}),l._read=function(){for(;;){let E=g.read();if(E===null){a=l._read;return}if(!l.push(E))return}};else if(cl(g)){let x=(Un(g)?g.readable:g).getReader();l._read=async function(){for(;;)try{let{value:A,done:I}=await x.read();if(!l.push(A))return;if(I){l.push(null);return}}catch{return}}}}return l._destroy=function(E,x){!E&&u!==null&&(E=new JS),a=null,n=null,i=null,u===null?x(E):(u=x,Hs(g)&&WS(g,E))},l}});var Og=_e((lN,hl)=>{"use strict";N();O();k();var YS=globalThis.AbortController||di().AbortController,{codes:{ERR_INVALID_ARG_VALUE:QS,ERR_INVALID_ARG_TYPE:go,ERR_MISSING_ARGS:XS,ERR_OUT_OF_RANGE:ZS},AbortError:kr}=Ut(),{validateAbortSignal:jn,validateInteger:Ag,validateObject:Bn}=pi(),eE=ot().Symbol("kWeak"),tE=ot().Symbol("kResistStopPropagation"),{finished:rE}=qr(),nE=ll(),{addAbortSignalNoValidate:iE}=io(),{isWritable:oE,isNodeStream:sE}=Cr(),{deprecate:aE}=qt(),{ArrayPrototypePush:uE,Boolean:cE,MathFloor:Ig,Number:lE,NumberIsNaN:fE,Promise:Tg,PromiseReject:Rg,PromiseResolve:dE,PromisePrototypeThen:Cg,Symbol:Pg}=ot(),Vs=Pg("kEmpty"),Fg=Pg("kEof");function hE(t,e){if(e!=null&&Bn(e,"options"),e?.signal!=null&&jn(e.signal,"options.signal"),sE(t)&&!oE(t))throw new QS("stream",t,"must be writable");let r=nE(this,t);return e!=null&&e.signal&&iE(e.signal,r),r}function Ks(t,e){if(typeof t!="function")throw new go("fn",["Function","AsyncFunction"],t);e!=null&&Bn(e,"options"),e?.signal!=null&&jn(e.signal,"options.signal");let r=1;e?.concurrency!=null&&(r=Ig(e.concurrency));let n=r-1;return e?.highWaterMark!=null&&(n=Ig(e.highWaterMark)),Ag(r,"options.concurrency",1),Ag(n,"options.highWaterMark",0),n+=r,async function*(){let a=qt().AbortSignalAny([e?.signal].filter(cE)),u=this,l=[],d={signal:a},f,g,_=!1,w=0;function E(){_=!0,x()}function x(){w-=1,A()}function A(){g&&!_&&w<r&&l.length<n&&(g(),g=null)}async function I(){try{for await(let D of u){if(_)return;if(a.aborted)throw new kr;try{if(D=t(D,d),D===Vs)continue;D=dE(D)}catch(U){D=Rg(U)}w+=1,Cg(D,x,E),l.push(D),f&&(f(),f=null),!_&&(l.length>=n||w>=r)&&await new Tg(U=>{g=U})}l.push(Fg)}catch(D){let U=Rg(D);Cg(U,x,E),l.push(U)}finally{_=!0,f&&(f(),f=null)}}I();try{for(;;){for(;l.length>0;){let D=await l[0];if(D===Fg)return;if(a.aborted)throw new kr;D!==Vs&&(yield D),l.shift(),A()}await new Tg(D=>{f=D})}}finally{_=!0,g&&(g(),g=null)}}.call(this)}function pE(t=void 0){return t!=null&&Bn(t,"options"),t?.signal!=null&&jn(t.signal,"options.signal"),async function*(){let r=0;for await(let i of this){var n;if(t!=null&&(n=t.signal)!==null&&n!==void 0&&n.aborted)throw new kr({cause:t.signal.reason});yield[r++,i]}}.call(this)}async function Ng(t,e=void 0){for await(let r of dl.call(this,t,e))return!0;return!1}async function gE(t,e=void 0){if(typeof t!="function")throw new go("fn",["Function","AsyncFunction"],t);return!await Ng.call(this,async(...r)=>!await t(...r),e)}async function yE(t,e){for await(let r of dl.call(this,t,e))return r}async function mE(t,e){if(typeof t!="function")throw new go("fn",["Function","AsyncFunction"],t);async function r(n,i){return await t(n,i),Vs}for await(let n of Ks.call(this,r,e));}function dl(t,e){if(typeof t!="function")throw new go("fn",["Function","AsyncFunction"],t);async function r(n,i){return await t(n,i)?n:Vs}return Ks.call(this,r,e)}var fl=class extends XS{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function _E(t,e,r){var n;if(typeof t!="function")throw new go("reducer",["Function","AsyncFunction"],t);r!=null&&Bn(r,"options"),r?.signal!=null&&jn(r.signal,"options.signal");let i=arguments.length>1;if(r!=null&&(n=r.signal)!==null&&n!==void 0&&n.aborted){let f=new kr(void 0,{cause:r.signal.reason});throw this.once("error",()=>{}),await rE(this.destroy(f)),f}let a=new YS,u=a.signal;if(r!=null&&r.signal){let f={once:!0,[eE]:this,[tE]:!0};r.signal.addEventListener("abort",()=>a.abort(),f)}let l=!1;try{for await(let f of this){var d;if(l=!0,r!=null&&(d=r.signal)!==null&&d!==void 0&&d.aborted)throw new kr;i?e=await t(e,f,{signal:u}):(e=f,i=!0)}if(!l&&!i)throw new fl}finally{a.abort()}return e}async function wE(t){t!=null&&Bn(t,"options"),t?.signal!=null&&jn(t.signal,"options.signal");let e=[];for await(let n of this){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new kr(void 0,{cause:t.signal.reason});uE(e,n)}return e}function bE(t,e){let r=Ks.call(this,t,e);return async function*(){for await(let i of r)yield*i}.call(this)}function kg(t){if(t=lE(t),fE(t))return 0;if(t<0)throw new ZS("number",">= 0",t);return t}function vE(t,e=void 0){return e!=null&&Bn(e,"options"),e?.signal!=null&&jn(e.signal,"options.signal"),t=kg(t),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new kr;for await(let a of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new kr;t--<=0&&(yield a)}}.call(this)}function SE(t,e=void 0){return e!=null&&Bn(e,"options"),e?.signal!=null&&jn(e.signal,"options.signal"),t=kg(t),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new kr;for await(let a of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new kr;if(t-- >0&&(yield a),t<=0)return}}.call(this)}hl.exports.streamReturningOperators={asIndexedPairs:aE(pE,"readable.asIndexedPairs will be removed in a future version."),drop:vE,filter:dl,flatMap:bE,map:Ks,take:SE,compose:hE};hl.exports.promiseReturningOperators={every:gE,forEach:mE,reduce:_E,toArray:wE,some:Ng,find:yE}});var pl=_e((pN,Dg)=>{"use strict";N();O();k();var{ArrayPrototypePop:EE,Promise:xE}=ot(),{isIterable:AE,isNodeStream:IE,isWebStream:TE}=Cr(),{pipelineImpl:RE}=Bs(),{finished:CE}=qr();gl();function FE(...t){return new xE((e,r)=>{let n,i,a=t[t.length-1];if(a&&typeof a=="object"&&!IE(a)&&!AE(a)&&!TE(a)){let u=EE(t);n=u.signal,i=u.end}RE(t,(u,l)=>{u?r(u):e(l)},{signal:n,end:i})})}Dg.exports={finished:CE,pipeline:FE}});var gl=_e((_N,qg)=>{"use strict";N();O();k();var{Buffer:PE}=(ir(),Yt(Sr)),{ObjectDefineProperty:Jr,ObjectKeys:jg,ReflectApply:Bg}=ot(),{promisify:{custom:Mg}}=qt(),{streamReturningOperators:Lg,promiseReturningOperators:Ug}=Og(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:Hg}}=Ut(),NE=ll(),{setDefaultHighWaterMark:kE,getDefaultHighWaterMark:OE}=oo(),{pipeline:Vg}=Bs(),{destroyer:DE}=Nn(),Kg=qr(),yl=pl(),yo=Cr(),tt=qg.exports=Ss().Stream;tt.isDestroyed=yo.isDestroyed;tt.isDisturbed=yo.isDisturbed;tt.isErrored=yo.isErrored;tt.isReadable=yo.isReadable;tt.isWritable=yo.isWritable;tt.Readable=uo();for(let t of jg(Lg)){let r=function(...n){if(new.target)throw Hg();return tt.Readable.from(Bg(e,this,n))},e=Lg[t];Jr(r,"name",{__proto__:null,value:e.name}),Jr(r,"length",{__proto__:null,value:e.length}),Jr(tt.Readable.prototype,t,{__proto__:null,value:r,enumerable:!1,configurable:!0,writable:!0})}for(let t of jg(Ug)){let r=function(...n){if(new.target)throw Hg();return Bg(e,this,n)},e=Ug[t];Jr(r,"name",{__proto__:null,value:e.name}),Jr(r,"length",{__proto__:null,value:e.length}),Jr(tt.Readable.prototype,t,{__proto__:null,value:r,enumerable:!1,configurable:!0,writable:!0})}tt.Writable=Ds();tt.Duplex=Nr();tt.Transform=Qc();tt.PassThrough=Zc();tt.pipeline=Vg;var{addAbortSignal:LE}=io();tt.addAbortSignal=LE;tt.finished=Kg;tt.destroy=DE;tt.compose=NE;tt.setDefaultHighWaterMark=kE;tt.getDefaultHighWaterMark=OE;Jr(tt,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return yl}});Jr(Vg,Mg,{__proto__:null,enumerable:!0,get(){return yl.pipeline}});Jr(Kg,Mg,{__proto__:null,enumerable:!0,get(){return yl.finished}});tt.Stream=tt;tt._isUint8Array=function(e){return e instanceof Uint8Array};tt._uint8ArrayToBuffer=function(e){return PE.from(e.buffer,e.byteOffset,e.byteLength)}});var ml=_e((SN,pt)=>{"use strict";N();O();k();var It=gl(),UE=pl(),jE=It.Readable.destroy;pt.exports=It.Readable;pt.exports._uint8ArrayToBuffer=It._uint8ArrayToBuffer;pt.exports._isUint8Array=It._isUint8Array;pt.exports.isDisturbed=It.isDisturbed;pt.exports.isErrored=It.isErrored;pt.exports.isReadable=It.isReadable;pt.exports.Readable=It.Readable;pt.exports.Writable=It.Writable;pt.exports.Duplex=It.Duplex;pt.exports.Transform=It.Transform;pt.exports.PassThrough=It.PassThrough;pt.exports.addAbortSignal=It.addAbortSignal;pt.exports.finished=It.finished;pt.exports.destroy=It.destroy;pt.exports.destroy=jE;pt.exports.pipeline=It.pipeline;pt.exports.compose=It.compose;Object.defineProperty(It,"promises",{configurable:!0,enumerable:!0,get(){return UE}});pt.exports.Stream=It.Stream;pt.exports.default=pt.exports});var gy=_e((WN,py)=>{"use strict";N();O();k();var{Buffer:an}=(ir(),Yt(Sr)),ke={},ay=ke.LEFT_BRACE=1,Ys=ke.RIGHT_BRACE=2,uy=ke.LEFT_BRACKET=3,El=ke.RIGHT_BRACKET=4,Qs=ke.COLON=5,Xs=ke.COMMA=6,cy=ke.TRUE=7,ly=ke.FALSE=8,fy=ke.NULL=9,Zs=ke.STRING=10,dy=ke.NUMBER=11,Hn=ke.START=17,hy=ke.STOP=18,Jg=ke.TRUE1=33,Gg=ke.TRUE2=34,zg=ke.TRUE3=35,Yg=ke.FALSE1=49,Qg=ke.FALSE2=50,Xg=ke.FALSE3=51,Zg=ke.FALSE4=52,ey=ke.NULL1=65,ty=ke.NULL2=66,ry=ke.NULL3=67,ny=ke.NUMBER1=81,vl=ke.NUMBER3=83,yr=ke.STRING1=97,iy=ke.STRING2=98,oy=ke.STRING3=99,BE=ke.STRING4=100,ME=ke.STRING5=101,sy=ke.STRING6=102,Ii=ke.VALUE=113,Sl=ke.KEY=114,Js=ke.OBJECT=129,Gs=ke.ARRAY=130,HE=92,VE=47,KE=8,qE=12,$E=10,WE=13,JE=9,xl=64*1024;function zs(t){return an.alloc?an.alloc(t):new an(t)}function un(){this.tState=Hn,this.value=void 0,this.string=void 0,this.stringBuffer=zs(xl),this.stringBufferOffset=0,this.unicode=void 0,this.highSurrogate=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=Ii,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:zs(2),3:zs(3),4:zs(4)},this.offset=-1}un.toknam=function(t){for(var e=Object.keys(ke),r=0,n=e.length;r<n;r++){var i=e[r];if(ke[i]===t)return i}return t&&"0x"+t.toString(16)};var Xt=un.prototype;Xt.onError=function(t){throw t};Xt.charError=function(t,e){this.tState=hy,this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(t[e]))+" at position "+e+" in state "+un.toknam(this.tState)))};Xt.appendStringChar=function(t){this.stringBufferOffset>=xl&&(this.string+=this.stringBuffer.toString("utf8"),this.stringBufferOffset=0),this.stringBuffer[this.stringBufferOffset++]=t};Xt.appendStringBuf=function(t,e,r){var n=t.length;typeof e=="number"&&(typeof r=="number"?r<0?n=t.length-e+r:n=r-e:n=t.length-e),n<0&&(n=0),this.stringBufferOffset+n>xl&&(this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0),t.copy(this.stringBuffer,this.stringBufferOffset,e,r),this.stringBufferOffset+=n};Xt.write=function(t){typeof t=="string"&&(t=new an(t));for(var e,r=0,n=t.length;r<n;r++)if(this.tState===Hn){if(e=t[r],this.offset++,e===123)this.onToken(ay,"{");else if(e===125)this.onToken(Ys,"}");else if(e===91)this.onToken(uy,"[");else if(e===93)this.onToken(El,"]");else if(e===58)this.onToken(Qs,":");else if(e===44)this.onToken(Xs,",");else if(e===116)this.tState=Jg;else if(e===102)this.tState=Yg;else if(e===110)this.tState=ey;else if(e===34)this.string="",this.stringBufferOffset=0,this.tState=yr;else if(e===45)this.string="-",this.tState=ny;else if(e>=48&&e<64)this.string=String.fromCharCode(e),this.tState=vl;else if(!(e===32||e===9||e===10||e===13))return this.charError(t,r)}else if(this.tState===yr)if(e=t[r],this.bytes_remaining>0){for(var i=0;i<this.bytes_remaining;i++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+i]=t[i];this.appendStringBuf(this.temp_buffs[this.bytes_in_sequence]),this.bytes_in_sequence=this.bytes_remaining=0,r=r+i-1}else if(this.bytes_remaining===0&&e>=128){if(e<=193||e>244)return this.onError(new Error("Invalid UTF-8 character at position "+r+" in state "+un.toknam(this.tState)));if(e>=194&&e<=223&&(this.bytes_in_sequence=2),e>=224&&e<=239&&(this.bytes_in_sequence=3),e>=240&&e<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+r>t.length){for(var a=0;a<=t.length-1-r;a++)this.temp_buffs[this.bytes_in_sequence][a]=t[r+a];this.bytes_remaining=r+this.bytes_in_sequence-t.length,r=t.length-1}else this.appendStringBuf(t,r,r+this.bytes_in_sequence),r=r+this.bytes_in_sequence-1}else if(e===34)this.tState=Hn,this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0,this.onToken(Zs,this.string),this.offset+=an.byteLength(this.string,"utf8")+1,this.string=void 0;else if(e===92)this.tState=iy;else if(e>=32)this.appendStringChar(e);else return this.charError(t,r);else if(this.tState===iy)if(e=t[r],e===34)this.appendStringChar(e),this.tState=yr;else if(e===92)this.appendStringChar(HE),this.tState=yr;else if(e===47)this.appendStringChar(VE),this.tState=yr;else if(e===98)this.appendStringChar(KE),this.tState=yr;else if(e===102)this.appendStringChar(qE),this.tState=yr;else if(e===110)this.appendStringChar($E),this.tState=yr;else if(e===114)this.appendStringChar(WE),this.tState=yr;else if(e===116)this.appendStringChar(JE),this.tState=yr;else if(e===117)this.unicode="",this.tState=oy;else return this.charError(t,r);else if(this.tState===oy||this.tState===BE||this.tState===ME||this.tState===sy)if(e=t[r],e>=48&&e<64||e>64&&e<=70||e>96&&e<=102){if(this.unicode+=String.fromCharCode(e),this.tState++===sy){var u=parseInt(this.unicode,16);this.unicode=void 0,this.highSurrogate!==void 0&&u>=56320&&u<57344?(this.appendStringBuf(new an(String.fromCharCode(this.highSurrogate,u))),this.highSurrogate=void 0):this.highSurrogate===void 0&&u>=55296&&u<56320?this.highSurrogate=u:(this.highSurrogate!==void 0&&(this.appendStringBuf(new an(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.appendStringBuf(new an(String.fromCharCode(u)))),this.tState=yr}}else return this.charError(t,r);else if(this.tState===ny||this.tState===vl)switch(e=t[r],e){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 46:case 101:case 69:case 43:case 45:this.string+=String.fromCharCode(e),this.tState=vl;break;default:this.tState=Hn;var l=this.numberReviver(this.string,t,r);if(l)return l;this.offset+=this.string.length-1,this.string=void 0,r--;break}else if(this.tState===Jg)if(t[r]===114)this.tState=Gg;else return this.charError(t,r);else if(this.tState===Gg)if(t[r]===117)this.tState=zg;else return this.charError(t,r);else if(this.tState===zg)if(t[r]===101)this.tState=Hn,this.onToken(cy,!0),this.offset+=3;else return this.charError(t,r);else if(this.tState===Yg)if(t[r]===97)this.tState=Qg;else return this.charError(t,r);else if(this.tState===Qg)if(t[r]===108)this.tState=Xg;else return this.charError(t,r);else if(this.tState===Xg)if(t[r]===115)this.tState=Zg;else return this.charError(t,r);else if(this.tState===Zg)if(t[r]===101)this.tState=Hn,this.onToken(ly,!1),this.offset+=4;else return this.charError(t,r);else if(this.tState===ey)if(t[r]===117)this.tState=ty;else return this.charError(t,r);else if(this.tState===ty)if(t[r]===108)this.tState=ry;else return this.charError(t,r);else if(this.tState===ry)if(t[r]===108)this.tState=Hn,this.onToken(fy,null),this.offset+=3;else return this.charError(t,r)};Xt.onToken=function(t,e){};Xt.parseError=function(t,e){this.tState=hy,this.onError(new Error("Unexpected "+un.toknam(t)+(e?"("+JSON.stringify(e)+")":"")+" in state "+un.toknam(this.state)))};Xt.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})};Xt.pop=function(){var t=this.value,e=this.stack.pop();this.value=e.value,this.key=e.key,this.mode=e.mode,this.emit(t),this.mode||(this.state=Ii)};Xt.emit=function(t){this.mode&&(this.state=Xs),this.onValue(t)};Xt.onValue=function(t){};Xt.onToken=function(t,e){if(this.state===Ii)if(t===Zs||t===dy||t===cy||t===ly||t===fy)this.value&&(this.value[this.key]=e),this.emit(e);else if(t===ay)this.push(),this.value?this.value=this.value[this.key]={}:this.value={},this.key=void 0,this.state=Sl,this.mode=Js;else if(t===uy)this.push(),this.value?this.value=this.value[this.key]=[]:this.value=[],this.key=0,this.mode=Gs,this.state=Ii;else if(t===Ys)if(this.mode===Js)this.pop();else return this.parseError(t,e);else if(t===El)if(this.mode===Gs)this.pop();else return this.parseError(t,e);else return this.parseError(t,e);else if(this.state===Sl)if(t===Zs)this.key=e,this.state=Qs;else if(t===Ys)this.pop();else return this.parseError(t,e);else if(this.state===Qs)if(t===Qs)this.state=Ii;else return this.parseError(t,e);else if(this.state===Xs)if(t===Xs)this.mode===Gs?(this.key++,this.state=Ii):this.mode===Js&&(this.state=Sl);else if(t===El&&this.mode===Gs||t===Ys&&this.mode===Js)this.pop();else return this.parseError(t,e);else return this.parseError(t,e)};Xt.numberReviver=function(t,e,r){var n=Number(t);if(isNaN(n))return this.charError(e,r);t.match(/[0-9]+/)==t&&n.toString()!=t?this.onToken(Zs,t):this.onToken(dy,n)};un.C=ke;py.exports=un});var my=_e(cn=>{"use strict";N();O();k();Object.defineProperty(cn,"__esModule",{value:!0});cn.removeDotSegmentsOfPath=cn.removeDotSegments=cn.resolve=void 0;function GE(t,e){e=e||"";let r=e.indexOf("#");if(r>0&&(e=e.substr(0,r)),!t.length){if(e.indexOf(":")<0)throw new Error(`Found invalid baseIRI '${e}' for value '${t}'`);return e}if(t.startsWith("?")){let f=e.indexOf("?");return f>0&&(e=e.substr(0,f)),e+t}if(t.startsWith("#"))return e+t;if(!e.length){let f=t.indexOf(":");if(f<0)throw new Error(`Found invalid relative IRI '${t}' for a missing baseIRI`);return Vn(t,f)}let n=t.indexOf(":");if(n>=0)return Vn(t,n);let i=e.indexOf(":");if(i<0)throw new Error(`Found invalid baseIRI '${e}' for value '${t}'`);let a=e.substr(0,i+1);if(t.indexOf("//")===0)return a+Vn(t,n);let u;if(e.indexOf("//",i)===i+1){if(u=e.indexOf("/",i+3),u<0)return e.length>i+3?e+"/"+Vn(t,n):a+Vn(t,n)}else if(u=e.indexOf("/",i+1),u<0)return a+Vn(t,n);if(t.indexOf("/")===0)return e.substr(0,u)+ea(t);let l=e.substr(u),d=l.lastIndexOf("/");return d>=0&&d<l.length-1&&(l=l.substr(0,d+1),t[0]==="."&&t[1]!=="."&&t[1]!=="/"&&t[2]&&(t=t.substr(1))),t=l+t,t=ea(t),e.substr(0,u)+t}cn.resolve=GE;function ea(t){let e=[],r=0;for(;r<t.length;)switch(t[r]){case"/":if(t[r+1]===".")if(t[r+2]==="."){if(!yy(t[r+3])){e.push([]),r++;break}e.pop(),t[r+3]||e.push([]),r+=3}else{if(!yy(t[r+2])){e.push([]),r++;break}t[r+2]||e.push([]),r+=2}else e.push([]),r++;break;case"#":case"?":e.length||e.push([]),e[e.length-1].push(t.substr(r)),r=t.length;break;default:e.length||e.push([]),e[e.length-1].push(t[r]),r++;break}return"/"+e.map(n=>n.join("")).join("/")}cn.removeDotSegments=ea;function Vn(t,e){let r=e+1;e>=0?t[e+1]==="/"&&t[e+2]==="/"&&(r=e+3):t[0]==="/"&&t[1]==="/"&&(r=2);let n=t.indexOf("/",r);if(n<0)return t;let i=t.substr(0,n),a=t.substr(n);return i+ea(a)}cn.removeDotSegmentsOfPath=Vn;function yy(t){return!t||t==="#"||t==="?"||t==="/"}});var ta=_e(Kn=>{"use strict";N();O();k();var zE=Kn&&Kn.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),YE=Kn&&Kn.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&zE(e,t,r)};Object.defineProperty(Kn,"__esModule",{value:!0});YE(my(),Kn)});var Ti=_e(qn=>{"use strict";N();O();k();Object.defineProperty(qn,"__esModule",{value:!0});qn.ERROR_CODES=qn.ErrorCoded=void 0;var Al=class extends Error{constructor(e,r){super(e),this.code=r}};qn.ErrorCoded=Al;var QE;(function(t){t.COLLIDING_KEYWORDS="colliding keywords",t.CONFLICTING_INDEXES="conflicting indexes",t.CYCLIC_IRI_MAPPING="cyclic IRI mapping",t.INVALID_ID_VALUE="invalid @id value",t.INVALID_INDEX_VALUE="invalid @index value",t.INVALID_NEST_VALUE="invalid @nest value",t.INVALID_PREFIX_VALUE="invalid @prefix value",t.INVALID_PROPAGATE_VALUE="invalid @propagate value",t.INVALID_REVERSE_VALUE="invalid @reverse value",t.INVALID_IMPORT_VALUE="invalid @import value",t.INVALID_VERSION_VALUE="invalid @version value",t.INVALID_BASE_IRI="invalid base IRI",t.INVALID_CONTAINER_MAPPING="invalid container mapping",t.INVALID_CONTEXT_ENTRY="invalid context entry",t.INVALID_CONTEXT_NULLIFICATION="invalid context nullification",t.INVALID_DEFAULT_LANGUAGE="invalid default language",t.INVALID_INCLUDED_VALUE="invalid @included value",t.INVALID_IRI_MAPPING="invalid IRI mapping",t.INVALID_JSON_LITERAL="invalid JSON literal",t.INVALID_KEYWORD_ALIAS="invalid keyword alias",t.INVALID_LANGUAGE_MAP_VALUE="invalid language map value",t.INVALID_LANGUAGE_MAPPING="invalid language mapping",t.INVALID_LANGUAGE_TAGGED_STRING="invalid language-tagged string",t.INVALID_LANGUAGE_TAGGED_VALUE="invalid language-tagged value",t.INVALID_LOCAL_CONTEXT="invalid local context",t.INVALID_REMOTE_CONTEXT="invalid remote context",t.INVALID_REVERSE_PROPERTY="invalid reverse property",t.INVALID_REVERSE_PROPERTY_MAP="invalid reverse property map",t.INVALID_REVERSE_PROPERTY_VALUE="invalid reverse property value",t.INVALID_SCOPED_CONTEXT="invalid scoped context",t.INVALID_SCRIPT_ELEMENT="invalid script element",t.INVALID_SET_OR_LIST_OBJECT="invalid set or list object",t.INVALID_TERM_DEFINITION="invalid term definition",t.INVALID_TYPE_MAPPING="invalid type mapping",t.INVALID_TYPE_VALUE="invalid type value",t.INVALID_TYPED_VALUE="invalid typed value",t.INVALID_VALUE_OBJECT="invalid value object",t.INVALID_VALUE_OBJECT_VALUE="invalid value object value",t.INVALID_VOCAB_MAPPING="invalid vocab mapping",t.IRI_CONFUSED_WITH_PREFIX="IRI confused with prefix",t.KEYWORD_REDEFINITION="keyword redefinition",t.LOADING_DOCUMENT_FAILED="loading document failed",t.LOADING_REMOTE_CONTEXT_FAILED="loading remote context failed",t.MULTIPLE_CONTEXT_LINK_HEADERS="multiple context link headers",t.PROCESSING_MODE_CONFLICT="processing mode conflict",t.PROTECTED_TERM_REDEFINITION="protected term redefinition",t.CONTEXT_OVERFLOW="context overflow",t.INVALID_BASE_DIRECTION="invalid base direction",t.RECURSIVE_CONTEXT_INCLUSION="recursive context inclusion",t.INVALID_STREAMING_KEY_ORDER="invalid streaming key order",t.INVALID_EMBEDDED_NODE="invalid embedded node",t.INVALID_ANNOTATION="invalid annotation"})(QE=qn.ERROR_CODES||(qn.ERROR_CODES={}))});var na=_e((uk,by)=>{"use strict";N();O();k();var XE=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,ZE=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,e1=/\s|\uFEFF|\xA0/,t1=/\r?\n[\x20\x09]+/g,r1=/[;,"]/,n1=/[;,"]|\s/,i1=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,Gr={IDLE:1,URI:2,ATTR:4};function _y(t){return t.replace(ZE,"")}function ra(t){return e1.test(t)}function o1(t,e){for(;ra(t[e]);)e++;return e}function wy(t){return n1.test(t)||!i1.test(t)}function s1(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(r=>r in e&&t[r]===e[r])}var gt=class t{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){for(var r=[],n=e.toLowerCase(),i=0;i<this.refs.length;i++)typeof this.refs[i].rel=="string"&&this.refs[i].rel.toLowerCase()===n&&r.push(this.refs[i]);return r}get(e,r){e=e.toLowerCase(),r=r.toLowerCase();for(var n=[],i=0;i<this.refs.length;i++)typeof this.refs[i][e]=="string"&&this.refs[i][e].toLowerCase()===r&&n.push(this.refs[i]);return n}set(e){return this.refs.push(e),this}setUnique(e){return this.refs.some(r=>s1(r,e))||this.refs.push(e),this}has(e,r){e=e.toLowerCase(),r=r.toLowerCase();for(var n=0;n<this.refs.length;n++)if(typeof this.refs[n][e]=="string"&&this.refs[n][e].toLowerCase()===r)return!0;return!1}parse(e,a){a=a||0,e=a?e.slice(a):e,e=_y(e).replace(t1,"");for(var n=Gr.IDLE,i=e.length,a=0,u=null;a<i;)if(n===Gr.IDLE){if(ra(e[a])){a++;continue}else if(e[a]==="<"){u!=null&&(u.rel!=null?this.refs.push(...t.expandRelations(u)):this.refs.push(u));var l=e.indexOf(">",a);if(l===-1)throw new Error("Expected end of URI delimiter at offset "+a);u={uri:e.slice(a+1,l)},a=l,n=Gr.URI}else throw new Error('Unexpected character "'+e[a]+'" at offset '+a);a++}else if(n===Gr.URI)if(ra(e[a])){a++;continue}else if(e[a]===";")n=Gr.ATTR,a++;else if(e[a]===",")n=Gr.IDLE,a++;else throw new Error('Unexpected character "'+e[a]+'" at offset '+a);else if(n===Gr.ATTR){if(e[a]===";"||ra(e[a])){a++;continue}var l=e.indexOf("=",a);l===-1&&(l=e.indexOf(";",a)),l===-1&&(l=e.length);var d=_y(e.slice(a,l)).toLowerCase(),f="";if(a=l+1,a=o1(e,a),e[a]==='"')for(a++;a<i;){if(e[a]==='"'){a++;break}e[a]==="\\"&&a++,f+=e[a],a++}else{for(var l=a+1;!r1.test(e[l])&&l<i;)l++;f=e.slice(a,l),a=l}switch(u[d]&&t.isSingleOccurenceAttr(d)||(d[d.length-1]==="*"?u[d]=t.parseExtendedValue(f):(f=d==="type"?f.toLowerCase():f,u[d]!=null?Array.isArray(u[d])?u[d].push(f):u[d]=[u[d],f]:u[d]=f)),e[a]){case",":n=Gr.IDLE;break;case";":n=Gr.ATTR;break}a++}else throw new Error('Unknown parser state "'+n+'"');return u!=null&&(u.rel!=null?this.refs.push(...t.expandRelations(u)):this.refs.push(u)),u=null,this}toString(){for(var e=[],r="",n=null,i=0;i<this.refs.length;i++)n=this.refs[i],r=Object.keys(this.refs[i]).reduce(function(a,u){return u==="uri"?a:a+"; "+t.formatAttribute(u,n[u])},"<"+n.uri+">"),e.push(r);return e.join(", ")}};gt.isCompatibleEncoding=function(t){return XE.test(t)};gt.parse=function(t,e){return new gt().parse(t,e)};gt.isSingleOccurenceAttr=function(t){return t==="rel"||t==="type"||t==="media"||t==="title"||t==="title*"};gt.isTokenAttr=function(t){return t==="rel"||t==="type"||t==="anchor"};gt.escapeQuotes=function(t){return t.replace(/"/g,'\\"')};gt.expandRelations=function(t){var e=t.rel.split(" ");return e.map(function(r){var n=Object.assign({},t);return n.rel=r,n})};gt.parseExtendedValue=function(t){var e=/([^']+)?(?:'([^']*)')?(.+)/.exec(t);return{language:e[2].toLowerCase(),encoding:gt.isCompatibleEncoding(e[1])?null:e[1].toLowerCase(),value:gt.isCompatibleEncoding(e[1])?decodeURIComponent(e[3]):e[3]}};gt.formatExtendedAttribute=function(t,e){var r=(e.encoding||"utf-8").toUpperCase(),n=e.language||"en",i="";return ie.isBuffer(e.value)&&gt.isCompatibleEncoding(r)?i=e.value.toString(r):ie.isBuffer(e.value)?i=e.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):i=encodeURIComponent(e.value),t+"="+r+"'"+n+"'"+i};gt.formatAttribute=function(t,e){return Array.isArray(e)?e.map(r=>gt.formatAttribute(t,r)).join("; "):t[t.length-1]==="*"||typeof e!="string"?gt.formatExtendedAttribute(t,e):(gt.isTokenAttr(t)?e=wy(e)?'"'+gt.escapeQuotes(e)+'"':gt.escapeQuotes(e):wy(e)&&(e=encodeURIComponent(e),e=e.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),e='"'+e+'"'),t+"="+e)};by.exports=gt});var Tl=_e(ia=>{"use strict";N();O();k();Object.defineProperty(ia,"__esModule",{value:!0});ia.FetchDocumentLoader=void 0;var vy=Ti(),a1=na(),u1=ta(),Il=class{constructor(e){this.fetcher=e}async load(e){let r=await(this.fetcher||fetch)(e,{headers:new Headers({accept:"application/ld+json"})});if(r.ok&&r.headers){let n=r.headers.get("Content-Type");if(n){let i=n.indexOf(";");i>0&&(n=n.substr(0,i))}if(n==="application/ld+json")return await r.json();if(r.headers.has("Link")){let i;if(r.headers.forEach((a,u)=>{if(u==="link"){let l=(0,a1.parse)(a);for(let d of l.get("type","application/ld+json"))if(d.rel==="alternate"){if(i)throw new Error("Multiple JSON-LD alternate links were found on "+e);i=(0,u1.resolve)(d.uri,e)}}}),i)return this.load(i)}throw new vy.ErrorCoded(`Unsupported JSON-LD media type ${n}`,vy.ERROR_CODES.LOADING_DOCUMENT_FAILED)}else throw new Error(r.statusText||`Status code: ${r.status}`)}};ia.FetchDocumentLoader=Il});var sa=_e(oa=>{"use strict";N();O();k();Object.defineProperty(oa,"__esModule",{value:!0});oa.Util=void 0;var $t=class t{static isCompactIri(e){return e.indexOf(":")>0&&!(e&&e[0]==="#")}static getPrefix(e,r){if(e&&e[0]==="#")return null;let n=e.indexOf(":");if(n>=0){if(e.length>n+1&&e.charAt(n+1)==="/"&&e.charAt(n+2)==="/")return null;let i=e.substr(0,n);if(i==="_")return null;if(r[i])return i}return null}static getContextValueId(e){if(e===null||typeof e=="string")return e;let r=e["@id"];return r||null}static isSimpleTermDefinitionPrefix(e,r){return!t.isPotentialKeyword(e)&&(r.allowPrefixNonGenDelims||typeof e=="string"&&(e[0]==="_"||t.isPrefixIriEndingWithGenDelim(e)))}static isPotentialKeyword(e){return typeof e=="string"&&t.KEYWORD_REGEX.test(e)}static isPrefixIriEndingWithGenDelim(e){return t.ENDS_WITH_GEN_DELIM.test(e)}static isPrefixValue(e){return e&&(typeof e=="string"||e&&typeof e=="object")}static isValidIri(e){return!!(e&&t.IRI_REGEX.test(e))}static isValidIriWeak(e){return!!e&&e[0]!==":"&&t.IRI_REGEX_WEAK.test(e)}static isValidKeyword(e){return t.VALID_KEYWORDS[e]}static isTermProtected(e,r){let n=e[r];return typeof n!="string"&&n&&n["@protected"]}static hasProtectedTerms(e){for(let r of Object.keys(e))if(t.isTermProtected(e,r))return!0;return!1}static isReservedInternalKeyword(e){return e.startsWith("@__")}static deepEqual(e,r){let n=Object.keys(e),i=Object.keys(r);return n.length!==i.length?!1:n.every(a=>{let u=e[a],l=r[a];return u===l||u!==null&&l!==null&&typeof u=="object"&&typeof l=="object"&&this.deepEqual(u,l)})}};$t.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`#]*(#[^#]*)?$/;$t.IRI_REGEX_WEAK=/(?::[^:])|\//;$t.KEYWORD_REGEX=/^@[a-z]+$/i;$t.ENDS_WITH_GEN_DELIM=/[:/?#\[\]@]$/;$t.REGEX_LANGUAGE_TAG=/^[a-zA-Z]+(-[a-zA-Z0-9]+)*$/;$t.REGEX_DIRECTION_TAG=/^(ltr)|(rtl)$/;$t.VALID_KEYWORDS={"@annotation":!0,"@base":!0,"@container":!0,"@context":!0,"@direction":!0,"@graph":!0,"@id":!0,"@import":!0,"@included":!0,"@index":!0,"@json":!0,"@language":!0,"@list":!0,"@nest":!0,"@none":!0,"@prefix":!0,"@propagate":!0,"@protected":!0,"@reverse":!0,"@set":!0,"@type":!0,"@value":!0,"@version":!0,"@vocab":!0};$t.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language","@version","@direction"];$t.ALIAS_DOMAIN_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value","@version"];$t.ALIAS_RANGE_BLACKLIST=["@context","@preserve"];$t.CONTAINERS=["@list","@set","@index","@language","@graph","@id","@type"];$t.CONTAINERS_1_0=["@list","@set","@index"];oa.Util=$t});var Cl=_e($n=>{"use strict";N();O();k();Object.defineProperty($n,"__esModule",{value:!0});$n.defaultExpandOptions=$n.JsonLdContextNormalized=void 0;var Sy=ta(),aa=Ti(),lr=sa(),Rl=class{constructor(e){this.contextRaw=e}getContextRaw(){return this.contextRaw}expandTerm(e,r,n=$n.defaultExpandOptions){let i=this.contextRaw[e];if(i===null||i&&i["@id"]===null)return null;let a=!0;if(i&&r){let _=lr.Util.getContextValueId(i);if(_&&_!==e)if(typeof _!="string"||!lr.Util.isValidIri(_)&&!lr.Util.isValidKeyword(_))lr.Util.isPotentialKeyword(_)||(a=!1);else return _}let u=lr.Util.getPrefix(e,this.contextRaw),l=this.contextRaw["@vocab"],d=(!!l||l==="")&&l.indexOf(":")<0,f=this.contextRaw["@base"],g=lr.Util.isPotentialKeyword(e);if(u){let _=this.contextRaw[u],w=lr.Util.getContextValueId(_);if(w){if(typeof _=="string"||!n.allowPrefixForcing){if(!lr.Util.isSimpleTermDefinitionPrefix(w,n))return e}else if(w[0]!=="_"&&!g&&!_["@prefix"]&&!(e in this.contextRaw))return e;return w+e.substr(u.length+1)}}else if(r&&(l||l===""||n.allowVocabRelativeToBase&&f&&d)&&!g&&!lr.Util.isCompactIri(e))if(d){if(n.allowVocabRelativeToBase)return(l||f?(0,Sy.resolve)(l,f):"")+e;throw new aa.ErrorCoded(`Relative vocab expansion for term '${e}' with vocab '${l}' is not allowed.`,aa.ERROR_CODES.INVALID_VOCAB_MAPPING)}else return l+e;else if(!r&&f&&!g&&!lr.Util.isCompactIri(e))return(0,Sy.resolve)(e,f);if(a)return e;throw new aa.ErrorCoded(`Invalid IRI mapping found for context entry '${e}': '${JSON.stringify(i)}'`,aa.ERROR_CODES.INVALID_IRI_MAPPING)}compactIri(e,r){if(r&&this.contextRaw["@vocab"]&&e.startsWith(this.contextRaw["@vocab"]))return e.substr(this.contextRaw["@vocab"].length);if(!r&&this.contextRaw["@base"]&&e.startsWith(this.contextRaw["@base"]))return e.substr(this.contextRaw["@base"].length);let n={prefix:"",suffix:e};for(let i in this.contextRaw){let a=this.contextRaw[i];if(a&&!lr.Util.isPotentialKeyword(i)){let u=lr.Util.getContextValueId(a);if(e.startsWith(u)){let l=e.substr(u.length);if(l)l.length<n.suffix.length&&(n.prefix=i,n.suffix=l);else if(r)return i}}}return n.prefix?n.prefix+":"+n.suffix:e}};$n.JsonLdContextNormalized=Rl;$n.defaultExpandOptions={allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}});var xy=_e(ca=>{"use strict";N();O();k();Object.defineProperty(ca,"__esModule",{value:!0});ca.ContextParser=void 0;var Ey=ta(),ye=Ti(),c1=Tl(),mr=Cl(),Ae=sa(),ua=class t{constructor(e){e=e||{},this.documentLoader=e.documentLoader||new c1.FetchDocumentLoader,this.documentCache={},this.validateContext=!e.skipValidation,this.expandContentTypeToBase=!!e.expandContentTypeToBase,this.remoteContextsDepthLimit=e.remoteContextsDepthLimit||32,this.redirectSchemaOrgHttps="redirectSchemaOrgHttps"in e?!!e.redirectSchemaOrgHttps:!0}static validateLanguage(e,r,n){if(typeof e!="string")throw new ye.ErrorCoded(`The value of an '@language' must be a string, got '${JSON.stringify(e)}'`,n);if(!Ae.Util.REGEX_LANGUAGE_TAG.test(e)){if(r)throw new ye.ErrorCoded(`The value of an '@language' must be a valid language tag, got '${JSON.stringify(e)}'`,n);return!1}return!0}static validateDirection(e,r){if(typeof e!="string")throw new ye.ErrorCoded(`The value of an '@direction' must be a string, got '${JSON.stringify(e)}'`,ye.ERROR_CODES.INVALID_BASE_DIRECTION);if(!Ae.Util.REGEX_DIRECTION_TAG.test(e)){if(r)throw new ye.ErrorCoded(`The value of an '@direction' must be 'ltr' or 'rtl', got '${JSON.stringify(e)}'`,ye.ERROR_CODES.INVALID_BASE_DIRECTION);return!1}return!0}idifyReverseTerms(e){for(let r of Object.keys(e)){let n=e[r];if(n&&typeof n=="object"&&n["@reverse"]&&!n["@id"]){if(typeof n["@reverse"]!="string"||Ae.Util.isValidKeyword(n["@reverse"]))throw new ye.ErrorCoded(`Invalid @reverse value, must be absolute IRI or blank node: '${n["@reverse"]}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);n=e[r]=Object.assign(Object.assign({},n),{"@id":n["@reverse"]}),n["@id"]=n["@reverse"],Ae.Util.isPotentialKeyword(n["@reverse"])?delete n["@reverse"]:n["@reverse"]=!0}}return e}expandPrefixedTerms(e,r,n){let i=e.getContextRaw();for(let a of n||Object.keys(i))if(Ae.Util.EXPAND_KEYS_BLACKLIST.indexOf(a)<0&&!Ae.Util.isReservedInternalKeyword(a)){let u=i[a];if(Ae.Util.isPotentialKeyword(a)&&Ae.Util.ALIAS_DOMAIN_BLACKLIST.indexOf(a)>=0&&(a!=="@type"||typeof i[a]=="object"&&!(i[a]["@protected"]||i[a]["@container"]==="@set")))throw new ye.ErrorCoded(`Keywords can not be aliased to something else.
Tried mapping ${a} to ${JSON.stringify(u)}`,ye.ERROR_CODES.KEYWORD_REDEFINITION);if(Ae.Util.ALIAS_RANGE_BLACKLIST.indexOf(Ae.Util.getContextValueId(u))>=0)throw new ye.ErrorCoded(`Aliasing to certain keywords is not allowed.
Tried mapping ${a} to ${JSON.stringify(u)}`,ye.ERROR_CODES.INVALID_KEYWORD_ALIAS);if(u&&Ae.Util.isPotentialKeyword(Ae.Util.getContextValueId(u))&&u["@prefix"]===!0)throw new ye.ErrorCoded(`Tried to use keyword aliases as prefix: '${a}': '${JSON.stringify(u)}'`,ye.ERROR_CODES.INVALID_TERM_DEFINITION);for(;Ae.Util.isPrefixValue(i[a]);){let l=i[a],d=!1;if(typeof l=="string")i[a]=e.expandTerm(l,!0),d=d||l!==i[a];else{let f=l["@id"],g=l["@type"],_=!("@prefix"in l)||Ae.Util.isValidIri(a);if("@id"in l)f!=null&&typeof f=="string"&&(i[a]=Object.assign(Object.assign({},i[a]),{"@id":e.expandTerm(f,!0)}),d=d||f!==i[a]["@id"]);else if(!Ae.Util.isPotentialKeyword(a)&&_){let w=e.expandTerm(a,!0);w!==a&&(i[a]=Object.assign(Object.assign({},i[a]),{"@id":w}),d=!0)}if(g&&typeof g=="string"&&g!=="@vocab"&&(!l["@container"]||!l["@container"]["@type"])&&_){let w=e.expandTerm(g,!0);r&&g===w&&(w=e.expandTerm(g,!1)),w!==g&&(d=!0,i[a]=Object.assign(Object.assign({},i[a]),{"@type":w}))}}if(!d)break}}}normalize(e,{processingMode:r,normalizeLanguageTags:n}){if(n||r===1)for(let i of Object.keys(e))if(i==="@language"&&typeof e[i]=="string")e[i]=e[i].toLowerCase();else{let a=e[i];if(a&&typeof a=="object"&&typeof a["@language"]=="string"){let u=a["@language"].toLowerCase();u!==a["@language"]&&(e[i]=Object.assign(Object.assign({},a),{"@language":u}))}}}containersToHash(e){for(let r of Object.keys(e)){let n=e[r];if(n&&typeof n=="object"){if(typeof n["@container"]=="string")e[r]=Object.assign(Object.assign({},n),{"@container":{[n["@container"]]:!0}});else if(Array.isArray(n["@container"])){let i={};for(let a of n["@container"])i[a]=!0;e[r]=Object.assign(Object.assign({},n),{"@container":i})}}}}applyScopedProtected(e,{processingMode:r},n){if(r&&r>=1.1&&e["@protected"]){for(let i of Object.keys(e))if(!Ae.Util.isReservedInternalKeyword(i)&&!Ae.Util.isPotentialKeyword(i)&&!Ae.Util.isTermProtected(e,i)){let a=e[i];a&&typeof a=="object"?"@protected"in e[i]||(e[i]=Object.assign(Object.assign({},e[i]),{"@protected":!0})):(e[i]={"@id":a,"@protected":!0},Ae.Util.isSimpleTermDefinitionPrefix(a,n)&&(e[i]=Object.assign(Object.assign({},e[i]),{"@prefix":!0})))}delete e["@protected"]}}validateKeywordRedefinitions(e,r,n,i){for(let a of i??Object.keys(r))if(Ae.Util.isTermProtected(e,a)&&(typeof r[a]=="string"?r[a]={"@id":r[a],"@protected":!0}:r[a]=Object.assign(Object.assign({},r[a]),{"@protected":!0}),!Ae.Util.deepEqual(e[a],r[a])))throw new ye.ErrorCoded(`Attempted to override the protected keyword ${a} from ${JSON.stringify(Ae.Util.getContextValueId(e[a]))} to ${JSON.stringify(Ae.Util.getContextValueId(r[a]))}`,ye.ERROR_CODES.PROTECTED_TERM_REDEFINITION)}validate(e,{processingMode:r}){for(let n of Object.keys(e)){if(Ae.Util.isReservedInternalKeyword(n))continue;if(n==="")throw new ye.ErrorCoded(`The empty term is not allowed, got: '${n}': '${JSON.stringify(e[n])}'`,ye.ERROR_CODES.INVALID_TERM_DEFINITION);let i=e[n],a=typeof i;if(Ae.Util.isPotentialKeyword(n)){switch(n.substr(1)){case"vocab":if(i!==null&&a!=="string")throw new ye.ErrorCoded(`Found an invalid @vocab IRI: ${i}`,ye.ERROR_CODES.INVALID_VOCAB_MAPPING);break;case"base":if(i!==null&&a!=="string")throw new ye.ErrorCoded(`Found an invalid @base IRI: ${e[n]}`,ye.ERROR_CODES.INVALID_BASE_IRI);break;case"language":i!==null&&t.validateLanguage(i,!0,ye.ERROR_CODES.INVALID_DEFAULT_LANGUAGE);break;case"version":if(i!==null&&a!=="number")throw new ye.ErrorCoded(`Found an invalid @version number: ${i}`,ye.ERROR_CODES.INVALID_VERSION_VALUE);break;case"direction":i!==null&&t.validateDirection(i,!0);break;case"propagate":if(r===1)throw new ye.ErrorCoded(`Found an illegal @propagate keyword: ${i}`,ye.ERROR_CODES.INVALID_CONTEXT_ENTRY);if(i!==null&&a!=="boolean")throw new ye.ErrorCoded(`Found an invalid @propagate value: ${i}`,ye.ERROR_CODES.INVALID_PROPAGATE_VALUE);break}if(Ae.Util.isValidKeyword(n)&&Ae.Util.isValidKeyword(Ae.Util.getContextValueId(i)))throw new ye.ErrorCoded(`Illegal keyword alias in term value, found: '${n}': '${Ae.Util.getContextValueId(i)}'`,ye.ERROR_CODES.KEYWORD_REDEFINITION);continue}if(i!==null)switch(a){case"string":if(Ae.Util.getPrefix(i,e)===n)throw new ye.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.CYCLIC_IRI_MAPPING);if(Ae.Util.isValidIriWeak(n)){if(i==="@type")throw new ye.ErrorCoded(`IRIs can not be mapped to @type, found: '${n}': '${i}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);if(Ae.Util.isValidIri(i)&&i!==new mr.JsonLdContextNormalized(e).expandTerm(n))throw new ye.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${n}': '${i}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING)}break;case"object":if(!Ae.Util.isCompactIri(n)&&!("@id"in i)&&(i["@type"]==="@id"?!e["@base"]:!e["@vocab"]))throw new ye.ErrorCoded(`Missing @id in context entry: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);for(let u of Object.keys(i)){let l=i[u];if(l)switch(u){case"@id":if(Ae.Util.isValidKeyword(l)&&l!=="@type"&&l!=="@id"&&l!=="@graph"&&l!=="@nest")throw new ye.ErrorCoded(`Illegal keyword alias in term value, found: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);if(Ae.Util.isValidIriWeak(n)){if(l==="@type")throw new ye.ErrorCoded(`IRIs can not be mapped to @type, found: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);if(Ae.Util.isValidIri(l)&&l!==new mr.JsonLdContextNormalized(e).expandTerm(n))throw new ye.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING)}if(typeof l!="string")throw new ye.ErrorCoded(`Detected non-string @id in context entry: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_IRI_MAPPING);if(Ae.Util.getPrefix(l,e)===n)throw new ye.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.CYCLIC_IRI_MAPPING);break;case"@type":if(i["@container"]==="@type"&&l!=="@id"&&l!=="@vocab")throw new ye.ErrorCoded(`@container: @type only allows @type: @id or @vocab, but got: '${n}': '${l}'`,ye.ERROR_CODES.INVALID_TYPE_MAPPING);if(typeof l!="string")throw new ye.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(a)}'`,ye.ERROR_CODES.INVALID_TYPE_MAPPING);if(l!=="@id"&&l!=="@vocab"&&(r===1||l!=="@json")&&(r===1||l!=="@none")&&(l[0]==="_"||!Ae.Util.isValidIri(l)))throw new ye.ErrorCoded(`A context @type must be an absolute IRI, found: '${n}': '${l}'`,ye.ERROR_CODES.INVALID_TYPE_MAPPING);break;case"@reverse":if(typeof l=="string"&&i["@id"]&&i["@id"]!==l)throw new ye.ErrorCoded(`Found non-matching @id and @reverse term values in '${n}':'${l}' and '${i["@id"]}'`,ye.ERROR_CODES.INVALID_REVERSE_PROPERTY);if("@nest"in i)throw new ye.ErrorCoded(`@nest is not allowed in the reverse property '${n}'`,ye.ERROR_CODES.INVALID_REVERSE_PROPERTY);break;case"@container":if(r===1&&(Object.keys(l).length>1||Ae.Util.CONTAINERS_1_0.indexOf(Object.keys(l)[0])<0))throw new ye.ErrorCoded(`Invalid term @container for '${n}' ('${Object.keys(l)}') in 1.0, must be only one of ${Ae.Util.CONTAINERS_1_0.join(", ")}`,ye.ERROR_CODES.INVALID_CONTAINER_MAPPING);for(let d of Object.keys(l)){if(d==="@list"&&i["@reverse"])throw new ye.ErrorCoded(`Term value can not be @container: @list and @reverse at the same time on '${n}'`,ye.ERROR_CODES.INVALID_REVERSE_PROPERTY);if(Ae.Util.CONTAINERS.indexOf(d)<0)throw new ye.ErrorCoded(`Invalid term @container for '${n}' ('${d}'), must be one of ${Ae.Util.CONTAINERS.join(", ")}`,ye.ERROR_CODES.INVALID_CONTAINER_MAPPING)}break;case"@language":t.validateLanguage(l,!0,ye.ERROR_CODES.INVALID_LANGUAGE_MAPPING);break;case"@direction":t.validateDirection(l,!0);break;case"@prefix":if(l!==null&&typeof l!="boolean")throw new ye.ErrorCoded(`Found an invalid term @prefix boolean in: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_PREFIX_VALUE);if(!("@id"in i)&&!Ae.Util.isValidIri(n))throw new ye.ErrorCoded(`Invalid @prefix definition for '${n}' ('${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@index":if(r===1||!i["@container"]||!i["@container"]["@index"])throw new ye.ErrorCoded(`Attempt to add illegal key to value object: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@nest":if(Ae.Util.isPotentialKeyword(l)&&l!=="@nest")throw new ye.ErrorCoded(`Found an invalid term @nest value in: '${n}': '${JSON.stringify(i)}'`,ye.ERROR_CODES.INVALID_NEST_VALUE)}}break;default:throw new ye.ErrorCoded(`Found an invalid term value: '${n}': '${i}'`,ye.ERROR_CODES.INVALID_TERM_DEFINITION)}}}applyBaseEntry(e,r,n){return typeof e=="string"||(n&&!("@base"in e)&&r.parentContext&&typeof r.parentContext=="object"&&"@base"in r.parentContext&&(e["@base"]=r.parentContext["@base"],r.parentContext["@__baseDocument"]&&(e["@__baseDocument"]=!0)),r.baseIRI&&!r.external&&("@base"in e?e["@base"]!==null&&typeof e["@base"]=="string"&&!Ae.Util.isValidIri(e["@base"])&&(e["@base"]=(0,Ey.resolve)(e["@base"],r.parentContext&&r.parentContext["@base"]||r.baseIRI)):(e["@base"]=r.baseIRI,e["@__baseDocument"]=!0))),e}normalizeContextIri(e,r){if(!Ae.Util.isValidIri(e))try{e=(0,Ey.resolve)(e,r)}catch{throw new Error(`Invalid context IRI: ${e}`)}return this.redirectSchemaOrgHttps&&e.startsWith("http://schema.org")&&(e="https://schema.org/"),e}async parseInnerContexts(e,r,n){for(let i of n??Object.keys(e)){let a=e[i];if(a&&typeof a=="object"&&"@context"in a&&a["@context"]!==null&&!r.ignoreScopedContexts){if(this.validateContext)try{let u=Object.assign(Object.assign({},e),{[i]:Object.assign({},e[i])});delete u[i]["@context"],await this.parse(a["@context"],Object.assign(Object.assign({},r),{external:!1,parentContext:u,ignoreProtection:!0,ignoreRemoteScopedContexts:!0,ignoreScopedContexts:!0}))}catch(u){throw new ye.ErrorCoded(u.message,ye.ERROR_CODES.INVALID_SCOPED_CONTEXT)}e[i]=Object.assign(Object.assign({},a),{"@context":(await this.parse(a["@context"],Object.assign(Object.assign({},r),{external:!1,minimalProcessing:!0,ignoreRemoteScopedContexts:!0,parentContext:e}))).getContextRaw()})}}return e}async parse(e,r={},n={}){let{baseIRI:i,parentContext:a,external:u,processingMode:l=t.DEFAULT_PROCESSING_MODE,normalizeLanguageTags:d,ignoreProtection:f,minimalProcessing:g}=r,_=r.remoteContexts||{};if(Object.keys(_).length>=this.remoteContextsDepthLimit)throw new ye.ErrorCoded("Detected an overflow in remote context inclusions: "+Object.keys(_),ye.ERROR_CODES.CONTEXT_OVERFLOW);if(e==null){if(!f&&a&&Ae.Util.hasProtectedTerms(a))throw new ye.ErrorCoded("Illegal context nullification when terms are protected",ye.ERROR_CODES.INVALID_CONTEXT_NULLIFICATION);return new mr.JsonLdContextNormalized(this.applyBaseEntry({},r,!1))}else if(typeof e=="string"){let w=this.normalizeContextIri(e,i),E=this.getOverriddenLoad(w,r);if(E)return new mr.JsonLdContextNormalized(E);let x=await this.parse(await this.load(w),Object.assign(Object.assign({},r),{baseIRI:w,external:!0,remoteContexts:Object.assign(Object.assign({},_),{[w]:!0})}));return this.applyBaseEntry(x.getContextRaw(),r,!0),x}else if(Array.isArray(e)){let w=[],E=await Promise.all(e.map((A,I)=>{if(typeof A=="string"){let D=this.normalizeContextIri(A,i);w[I]=D;let U=this.getOverriddenLoad(D,r);return U||this.load(D)}else return A}));if(g)return new mr.JsonLdContextNormalized(E);let x=await E.reduce((A,I,D)=>A.then(U=>this.parse(I,Object.assign(Object.assign({},r),{baseIRI:w[D]||r.baseIRI,external:!!w[D]||r.external,parentContext:U.getContextRaw(),remoteContexts:w[D]?Object.assign(Object.assign({},_),{[w[D]]:!0}):_}),{skipValidation:D<E.length-1})),Promise.resolve(new mr.JsonLdContextNormalized(a||{})));return this.applyBaseEntry(x.getContextRaw(),r,!0),x}else if(typeof e=="object"){if("@context"in e)return await this.parse(e["@context"],r);if(e=Object.assign({},e),u&&delete e["@base"],this.applyBaseEntry(e,r,!0),this.containersToHash(e),g)return new mr.JsonLdContextNormalized(e);let w={};if("@import"in e)if(l>=1.1){if(typeof e["@import"]!="string")throw new ye.ErrorCoded("An @import value must be a string, but got "+typeof e["@import"],ye.ERROR_CODES.INVALID_IMPORT_VALUE);w=await this.loadImportContext(this.normalizeContextIri(e["@import"],i)),delete e["@import"]}else throw new ye.ErrorCoded("Context importing is not supported in JSON-LD 1.0",ye.ERROR_CODES.INVALID_CONTEXT_ENTRY);this.applyScopedProtected(w,{processingMode:l},mr.defaultExpandOptions);let E=Object.assign(w,e);this.idifyReverseTerms(E),this.normalize(E,{processingMode:l,normalizeLanguageTags:d}),this.applyScopedProtected(E,{processingMode:l},mr.defaultExpandOptions);let x=Object.keys(E),A=[];if(typeof a=="object")for(let D in a)D in E?A.push(D):E[D]=a[D];await this.parseInnerContexts(E,r,x);let I=new mr.JsonLdContextNormalized(E);return(E&&E["@version"]||t.DEFAULT_PROCESSING_MODE)>=1.1&&(e["@vocab"]&&typeof e["@vocab"]=="string"||e["@vocab"]==="")&&(a&&"@vocab"in a&&e["@vocab"].indexOf(":")<0?E["@vocab"]=a["@vocab"]+e["@vocab"]:(Ae.Util.isCompactIri(e["@vocab"])||e["@vocab"]in E)&&(E["@vocab"]=I.expandTerm(e["@vocab"],!0))),this.expandPrefixedTerms(I,this.expandContentTypeToBase,x),!f&&a&&l>=1.1&&this.validateKeywordRedefinitions(a,E,mr.defaultExpandOptions,A),this.validateContext&&!n.skipValidation&&this.validate(E,{processingMode:l}),I}else throw new ye.ErrorCoded(`Tried parsing a context that is not a string, array or object, but got ${e}`,ye.ERROR_CODES.INVALID_LOCAL_CONTEXT)}async load(e){let r=this.documentCache[e];if(r)return r;let n;try{n=await this.documentLoader.load(e)}catch(i){throw new ye.ErrorCoded(`Failed to load remote context ${e}: ${i.message}`,ye.ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED)}if(!("@context"in n))throw new ye.ErrorCoded(`Missing @context in remote context at ${e}`,ye.ERROR_CODES.INVALID_REMOTE_CONTEXT);return this.documentCache[e]=n["@context"]}getOverriddenLoad(e,r){if(e in(r.remoteContexts||{})){if(r.ignoreRemoteScopedContexts)return e;throw new ye.ErrorCoded("Detected a cyclic context inclusion of "+e,ye.ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION)}return null}async loadImportContext(e){let r=await this.load(e);if(typeof r!="object"||Array.isArray(r))throw new ye.ErrorCoded("An imported context must be a single object: "+e,ye.ERROR_CODES.INVALID_REMOTE_CONTEXT);if("@import"in r)throw new ye.ErrorCoded("An imported context can not import another context: "+e,ye.ERROR_CODES.INVALID_CONTEXT_ENTRY);return r=Object.assign({},r),this.containersToHash(r),r}};ua.DEFAULT_PROCESSING_MODE=1.1;ca.ContextParser=ua});var Iy=_e(Ay=>{"use strict";N();O();k();Object.defineProperty(Ay,"__esModule",{value:!0})});var Ry=_e(Ty=>{"use strict";N();O();k();Object.defineProperty(Ty,"__esModule",{value:!0})});var Bt=_e(Zt=>{"use strict";N();O();k();var l1=Zt&&Zt.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Wn=Zt&&Zt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&l1(e,t,r)};Object.defineProperty(Zt,"__esModule",{value:!0});Wn(xy(),Zt);Wn(Ti(),Zt);Wn(Tl(),Zt);Wn(Iy(),Zt);Wn(Ry(),Zt);Wn(Cl(),Zt);Wn(sa(),Zt)});var Pl=_e(la=>{"use strict";N();O();k();Object.defineProperty(la,"__esModule",{value:!0});la.BlankNode=void 0;var Fl=class{constructor(e){this.termType="BlankNode",this.value=e}equals(e){return!!e&&e.termType==="BlankNode"&&e.value===this.value}};la.BlankNode=Fl});var Nl=_e(fa=>{"use strict";N();O();k();Object.defineProperty(fa,"__esModule",{value:!0});fa.DefaultGraph=void 0;var _o=class{constructor(){this.termType="DefaultGraph",this.value=""}equals(e){return!!e&&e.termType==="DefaultGraph"}};fa.DefaultGraph=_o;_o.INSTANCE=new _o});var ha=_e(da=>{"use strict";N();O();k();Object.defineProperty(da,"__esModule",{value:!0});da.NamedNode=void 0;var kl=class{constructor(e){this.termType="NamedNode",this.value=e}equals(e){return!!e&&e.termType==="NamedNode"&&e.value===this.value}};da.NamedNode=kl});var Ol=_e(pa=>{"use strict";N();O();k();Object.defineProperty(pa,"__esModule",{value:!0});pa.Literal=void 0;var Cy=ha(),wo=class t{constructor(e,r){this.termType="Literal",this.value=e,typeof r=="string"?(this.language=r,this.datatype=t.RDF_LANGUAGE_STRING):r?(this.language="",this.datatype=r):(this.language="",this.datatype=t.XSD_STRING)}equals(e){return!!e&&e.termType==="Literal"&&e.value===this.value&&e.language===this.language&&this.datatype.equals(e.datatype)}};pa.Literal=wo;wo.RDF_LANGUAGE_STRING=new Cy.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString");wo.XSD_STRING=new Cy.NamedNode("http://www.w3.org/2001/XMLSchema#string")});var Ll=_e(ga=>{"use strict";N();O();k();Object.defineProperty(ga,"__esModule",{value:!0});ga.Quad=void 0;var Dl=class{constructor(e,r,n,i){this.termType="Quad",this.value="",this.subject=e,this.predicate=r,this.object=n,this.graph=i}equals(e){return!!e&&(e.termType==="Quad"||!e.termType)&&this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)}};ga.Quad=Dl});var jl=_e(ya=>{"use strict";N();O();k();Object.defineProperty(ya,"__esModule",{value:!0});ya.Variable=void 0;var Ul=class{constructor(e){this.termType="Variable",this.value=e}equals(e){return!!e&&e.termType==="Variable"&&e.value===this.value}};ya.Variable=Ul});var Py=_e(ma=>{"use strict";N();O();k();Object.defineProperty(ma,"__esModule",{value:!0});ma.DataFactory=void 0;var f1=Pl(),d1=Nl(),Fy=Ol(),h1=ha(),p1=Ll(),g1=jl(),y1=0,Bl=class{constructor(e){this.blankNodeCounter=0,e=e||{},this.blankNodePrefix=e.blankNodePrefix||`df_${y1++}_`}namedNode(e){return new h1.NamedNode(e)}blankNode(e){return new f1.BlankNode(e||`${this.blankNodePrefix}${this.blankNodeCounter++}`)}literal(e,r){return new Fy.Literal(e,r)}variable(e){return new g1.Variable(e)}defaultGraph(){return d1.DefaultGraph.INSTANCE}quad(e,r,n,i){return new p1.Quad(e,r,n,i||this.defaultGraph())}fromTerm(e){switch(e.termType){case"NamedNode":return this.namedNode(e.value);case"BlankNode":return this.blankNode(e.value);case"Literal":return e.language?this.literal(e.value,e.language):e.datatype.equals(Fy.Literal.XSD_STRING)?this.literal(e.value):this.literal(e.value,this.fromTerm(e.datatype));case"Variable":return this.variable(e.value);case"DefaultGraph":return this.defaultGraph();case"Quad":return this.quad(this.fromTerm(e.subject),this.fromTerm(e.predicate),this.fromTerm(e.object),this.fromTerm(e.graph))}}fromQuad(e){return this.fromTerm(e)}resetBlankNodeCounter(){this.blankNodeCounter=0}};ma.DataFactory=Bl});var Ny=_e(er=>{"use strict";N();O();k();var m1=er&&er.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Jn=er&&er.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&m1(e,t,r)};Object.defineProperty(er,"__esModule",{value:!0});Jn(Pl(),er);Jn(Py(),er);Jn(Nl(),er);Jn(Ol(),er);Jn(ha(),er);Jn(Ll(),er);Jn(jl(),er)});var ky=_e(_a=>{"use strict";N();O();k();Object.defineProperty(_a,"__esModule",{value:!0});_a.ContainerHandlerIdentifier=void 0;var Ml=class{canCombineWithGraph(){return!0}async handle(e,r,n,i,a,u){let l;if(r.emittedStack[u+1]&&r.idStack[u+1])l=r.idStack[u+1][0];else{let g=await n.getContainerKey(i[u],i,u)!==null?await n.resourceToTerm(await r.getContext(i),i[u]):n.dataFactory.blankNode();if(!g){r.emittedStack[u]=!1;return}l=g,r.idStack[u+1]=[l]}let d=r.idStack[u];d||(d=r.idStack[u]=[]),d.some(f=>f.equals(l))||d.push(l),await r.handlePendingContainerFlushBuffers()||(r.emittedStack[u]=!1)}};_a.ContainerHandlerIdentifier=Ml});var vo=_e(wa=>{"use strict";N();O();k();Object.defineProperty(wa,"__esModule",{value:!0});wa.EntryHandlerPredicate=void 0;var Ri=Bt(),bo=ln(),Hl=class t{static async handlePredicateObject(e,r,n,i,a,u,l,d,f){let g=await r.getPropertiesDepth(n,i),_=await r.getDepthOffsetGraph(i,n),w=i-_,E=e.idStack[g];if(E&&!f)for(let x of E)if(_>=0){let I=e.idStack[w-1];if(I)for(let D of I)r.emitQuadChecked(i,x,a,u,D,l,d);else l?(r.validateReverseSubject(u),e.getUnidentifiedGraphBufferSafe(w-1).push({subject:u,predicate:a,object:x,isEmbedded:d})):e.getUnidentifiedGraphBufferSafe(w-1).push({subject:x,predicate:a,object:u,isEmbedded:d})}else{let I=await r.getGraphContainerValue(n,g);r.emitQuadChecked(i,x,a,u,I,l,d)}else if(l&&r.validateReverseSubject(u),f){if(e.rdfstar){e.idStack[i]&&e.emitError(new Ri.ErrorCoded(`Found an illegal @id inside an annotation: ${e.idStack[i][0].value}`,Ri.ERROR_CODES.INVALID_ANNOTATION));for(let I=0;I<i;I++)await r.unaliasKeyword(n[I],n,I)==="@id"&&e.emitError(new Ri.ErrorCoded("Found an illegal annotation inside an embedded node",Ri.ERROR_CODES.INVALID_ANNOTATION));let x=e.getAnnotationsBufferSafe(g),A={predicate:a,object:u,reverse:l,nestedAnnotations:[],depth:g};x.push(A);for(let I=x.length-2;I>=0;I--){let D=x[I];D.depth>g&&(A.nestedAnnotations.push(D),x.splice(I,1))}}}else e.getUnidentifiedValueBufferSafe(g).push({predicate:a,object:u,reverse:l,isEmbedded:d})}isPropertyHandler(){return!0}isStackProcessor(){return!0}async validate(e,r,n,i,a){let u=n[i];if(u){let l=await e.getContext(n);if(!e.jsonLiteralStack[i]&&await r.predicateToTerm(l,n[i]))return bo.Util.getContextValueType(l,u)==="@json"&&(e.jsonLiteralStack[i+1]=!0),!0}return!1}async test(e,r,n,i,a){return i[a]}async handle(e,r,n,i,a,u,l){let d=i[u],f=await e.getContext(i),g=await r.predicateToTerm(f,n);if(g){let _=await r.valueToTerm(f,n,a,u,i);if(_.length)for(let w of _){let E=await r.unaliasKeywordParent(i,u),x=bo.Util.isPropertyReverse(f,d,E),A=0;for(;E==="@reverse"||typeof E=="number";)typeof E=="number"?A++:u--,E=await r.unaliasKeywordParent(i,u-A);let I=bo.Util.isPropertyInEmbeddedNode(E);r.validateReverseInEmbeddedNode(n,x,I);let D=bo.Util.isPropertyInAnnotationObject(E);if(a){let U="@list"in bo.Util.getContextValueContainer(f,n);if(U||a["@list"]){if((U&&!Array.isArray(a)&&!a["@list"]||a["@list"]&&!Array.isArray(a["@list"]))&&w!==r.rdfNil){let z=r.dataFactory.blankNode();e.emitQuad(u,r.dataFactory.quad(z,r.rdfRest,r.rdfNil,r.getDefaultGraph())),e.emitQuad(u,r.dataFactory.quad(z,r.rdfFirst,w,r.getDefaultGraph())),w=z}if(x&&!e.allowSubjectList)throw new Ri.ErrorCoded(`Found illegal list value in subject position at ${n}`,Ri.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}}await t.handlePredicateObject(e,r,i,u,g,w,x,I,D)}}}};wa.EntryHandlerPredicate=Hl});var Dy=_e(ba=>{"use strict";N();O();k();Object.defineProperty(ba,"__esModule",{value:!0});ba.ContainerHandlerIndex=void 0;var Gn=Bt(),_1=vo(),Oy=ln(),Vl=class{canCombineWithGraph(){return!0}async handle(e,r,n,i,a,u){if(!Array.isArray(a)){let l="@graph"in e,d=await r.getContext(i),f=i[u-1],g=Oy.Util.getContextValueIndex(d,f);if(g){if(Gn.Util.isPotentialKeyword(g))throw new Gn.ErrorCoded(`Keywords can not be used as @index value, got: ${g}`,Gn.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof g!="string")throw new Gn.ErrorCoded(`@index values must be strings, got: ${g}`,Gn.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof a!="object"){if(Oy.Util.getContextValueType(d,f)!=="@id")throw new Gn.ErrorCoded(`Property-based index containers require nodes as values or strings with @type: @id, but got: ${a}`,Gn.ERROR_CODES.INVALID_VALUE_OBJECT);let E=n.resourceToTerm(d,a);E&&(r.idStack[u+1]=[E])}let w=n.createVocabOrBaseTerm(d,g);if(w){let E=await n.valueToTerm(d,g,await n.getContainerKey(i[u],i,u),u,i);if(l){let x=await n.getGraphContainerValue(i,u+1);for(let A of E)r.emitQuad(u,n.dataFactory.quad(x,w,A,n.getDefaultGraph()))}else for(let x of E)await _1.EntryHandlerPredicate.handlePredicateObject(r,n,i,u+1,w,x,!1,!1,!1)}}let _=l?2:1;await r.newOnValueJob(i.slice(0,i.length-_),a,u-_,!0),await r.handlePendingContainerFlushBuffers()}r.emittedStack[u]=!1}};ba.ContainerHandlerIndex=Vl});var Uy=_e(va=>{"use strict";N();O();k();Object.defineProperty(va,"__esModule",{value:!0});va.ContainerHandlerLanguage=void 0;var Ly=Bt(),Kl=class{canCombineWithGraph(){return!1}async handle(e,r,n,i,a,u){let l=await n.getContainerKey(i[u],i,u);if(Array.isArray(a))a=a.map(d=>({"@value":d,"@language":l}));else{if(typeof a!="string")throw new Ly.ErrorCoded(`Got invalid language map value, got '${JSON.stringify(a)}', but expected string`,Ly.ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE);a={"@value":a,"@language":l}}await r.newOnValueJob(i.slice(0,i.length-1),a,u-1,!0),r.emittedStack[u]=!1}};va.ContainerHandlerLanguage=Kl});var jy=_e(Sa=>{"use strict";N();O();k();Object.defineProperty(Sa,"__esModule",{value:!0});Sa.ContainerHandlerType=void 0;var w1=vo(),b1=ln(),ql=class{canCombineWithGraph(){return!1}async handle(e,r,n,i,a,u){if(!Array.isArray(a)){if(typeof a=="string"){let f=await r.getContext(i),_=b1.Util.getContextValueType(f,i[u-1])==="@vocab"?await n.createVocabOrBaseTerm(f,a):await n.resourceToTerm(f,a);if(_){let w={"@id":_.termType==="NamedNode"?_.value:a};await r.newOnValueJob(i.slice(0,i.length-1),w,u-1,!0),r.idStack[u+1]=[_]}}else{let f=!!r.idStack[u+1];f||delete r.idStack[u],await r.newOnValueJob(i.slice(0,i.length-1),a,u-1,!0),f||(r.idStack[u+1]=r.idStack[u])}let l=await n.getContainerKey(i[u],i,u),d=l!==null?n.createVocabOrBaseTerm(await r.getContext(i),l):null;d&&await w1.EntryHandlerPredicate.handlePredicateObject(r,n,i,u+1,n.rdfType,d,!1,!1,!1),await r.handlePendingContainerFlushBuffers()}r.emittedStack[u]=!1}};Sa.ContainerHandlerType=ql});var Wl=_e(xa=>{"use strict";N();O();k();Object.defineProperty(xa,"__esModule",{value:!0});xa.EntryHandlerContainer=void 0;var v1=ky(),S1=Dy(),E1=Uy(),x1=jy(),$l=ln(),Ea=class t{static isSimpleGraphContainer(e){return"@graph"in e&&("@set"in e&&Object.keys(e).length===2||Object.keys(e).length===1)}static isComplexGraphContainer(e){return"@graph"in e&&("@set"in e&&Object.keys(e).length>2||!("@set"in e)&&Object.keys(e).length>1)}static getContainerGraphIndex(e,r,n){let i=t.isSimpleGraphContainer(e),a="";for(let u=r;u<n.length;u++)(!i||typeof n[u]=="number")&&(a+=":"+n[u]),!i&&typeof n[u]!="number"&&(i=!0);return a}static async getContainerHandler(e,r,n){let i={containers:{"@set":!0},depth:n,fallback:!0},a=!1,u=await e.getContext(r,2);for(let l=n-1;l>=0;l--)if(typeof r[l]!="number"){let d=$l.Util.getContextValue(u,"@container",r[l],!1);if(d&&t.isSimpleGraphContainer(d))return{containers:d,depth:l+1,fallback:!1};let f=$l.Util.getContextValue(u,"@container",r[l-1],!1);if(f){let g="@graph"in f;for(let _ in t.CONTAINER_HANDLERS)if(f[_])return g?t.CONTAINER_HANDLERS[_].canCombineWithGraph()?{containers:f,depth:l,fallback:!1}:i:a?i:{containers:f,depth:l,fallback:!1};return i}else{if(a)return i;a=!0}}return i}static async isBufferableContainerHandler(e,r,n){let i=await t.getContainerHandler(e,r,n);return!i.fallback&&!("@graph"in i.containers)}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,n,i,a){return!!await this.test(e,r,null,n,i)}async test(e,r,n,i,a){let u=$l.Util.getContextValueContainer(await e.getContext(i,2),i[a-1]);for(let l in t.CONTAINER_HANDLERS)if(u[l])return{containers:u,handler:t.CONTAINER_HANDLERS[l]};return null}async handle(e,r,n,i,a,u,l){return l.handler.handle(l.containers,e,r,i,a,u)}};Ea.CONTAINER_HANDLERS={"@id":new v1.ContainerHandlerIdentifier,"@index":new S1.ContainerHandlerIndex,"@language":new E1.ContainerHandlerLanguage,"@type":new x1.ContainerHandlerType};xa.EntryHandlerContainer=Ea});var My=_e((VO,By)=>{"use strict";N();O();k();By.exports=function t(e){return e===null||typeof e!="object"||e.toJSON!=null?JSON.stringify(e):Array.isArray(e)?"["+e.reduce((r,n,i)=>{let a=i===0?"":",",u=n===void 0||typeof n=="symbol"?null:n;return r+a+t(u)},"")+"]":"{"+Object.keys(e).sort().reduce((r,n,i)=>{if(e[n]===void 0||typeof e[n]=="symbol")return r;let a=r.length===0?"":",";return r+a+t(n)+":"+t(e[n])},"")+"}"}});var ln=_e(Ia=>{"use strict";N();O();k();Object.defineProperty(Ia,"__esModule",{value:!0});Ia.Util=void 0;var Te=Bt(),A1=Ny(),Aa=Wl(),I1=My(),_r=class t{constructor(e){this.parsingContext=e.parsingContext,this.dataFactory=e.dataFactory||new A1.DataFactory,this.rdfFirst=this.dataFactory.namedNode(t.RDF+"first"),this.rdfRest=this.dataFactory.namedNode(t.RDF+"rest"),this.rdfNil=this.dataFactory.namedNode(t.RDF+"nil"),this.rdfType=this.dataFactory.namedNode(t.RDF+"type"),this.rdfJson=this.dataFactory.namedNode(t.RDF+"JSON")}static getContextValue(e,r,n,i){let a=e.getContextRaw()[n];if(!a)return i;let u=a[r];return u===void 0?i:u}static getContextValueContainer(e,r){return t.getContextValue(e,"@container",r,{"@set":!0})}static getContextValueType(e,r){let n=t.getContextValue(e,"@type",r,null);return n==="@none"?null:n}static getContextValueLanguage(e,r){return t.getContextValue(e,"@language",r,e.getContextRaw()["@language"]||null)}static getContextValueDirection(e,r){return t.getContextValue(e,"@direction",r,e.getContextRaw()["@direction"]||null)}static isContextValueReverse(e,r){return!!t.getContextValue(e,"@reverse",r,null)}static getContextValueIndex(e,r){return t.getContextValue(e,"@index",r,e.getContextRaw()["@index"]||null)}static isPropertyReverse(e,r,n){return n==="@reverse"!==t.isContextValueReverse(e,r)}static isPropertyInEmbeddedNode(e){return e==="@id"}static isPropertyInAnnotationObject(e){return e==="@annotation"}static isValidIri(e){return e!==null&&Te.Util.isValidIri(e)}static isPrefixArray(e,r){if(e.length>r.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0}async validateValueIndexes(e){if(this.parsingContext.validateValueIndexes){let r={};for(let n of e)if(n&&typeof n=="object"){let i=n["@id"],a=n["@index"];if(i&&a){let u=r[i];if(u&&u!==a)throw new Te.ErrorCoded(`Conflicting @index value for ${i}`,Te.ERROR_CODES.CONFLICTING_INDEXES);r[i]=a}}}}async valueToTerm(e,r,n,i,a){if(t.getContextValueType(e,r)==="@json")return[this.dataFactory.literal(this.valueToJsonString(n),this.rdfJson)];let u=typeof n;switch(u){case"object":if(n==null)return[];if(Array.isArray(n))return"@list"in t.getContextValueContainer(e,r)?n.length===0?[this.rdfNil]:this.parsingContext.idStack[i+1]||[]:(await this.validateValueIndexes(n),[]);if(e=await this.getContextSelfOrPropertyScoped(e,r),"@context"in n&&(e=await this.parsingContext.parseContext(n["@context"],(await this.parsingContext.getContext(a,0)).getContextRaw())),n=await this.unaliasKeywords(n,a,i,e),"@value"in n){let l,d,f,g,_;for(r in n){let w=n[r];switch(r){case"@value":l=w;break;case"@language":d=w;break;case"@direction":f=w;break;case"@type":g=w;break;case"@index":_=w;break;case"@annotation":break;default:throw new Te.ErrorCoded(`Unknown value entry '${r}' in @value: ${JSON.stringify(n)}`,Te.ERROR_CODES.INVALID_VALUE_OBJECT)}}if(await this.unaliasKeyword(g,a,i,!0,e)==="@json")return[this.dataFactory.literal(this.valueToJsonString(l),this.rdfJson)];if(l===null)return[];if(typeof l=="object")throw new Te.ErrorCoded(`The value of an '@value' can not be an object, got '${JSON.stringify(l)}'`,Te.ERROR_CODES.INVALID_VALUE_OBJECT_VALUE);if(this.parsingContext.validateValueIndexes&&_&&typeof _!="string")throw new Te.ErrorCoded(`The value of an '@index' must be a string, got '${JSON.stringify(_)}'`,Te.ERROR_CODES.INVALID_INDEX_VALUE);if(d){if(typeof l!="string")throw new Te.ErrorCoded(`When an '@language' is set, the value of '@value' must be a string, got '${JSON.stringify(l)}'`,Te.ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE);if(!Te.ContextParser.validateLanguage(d,this.parsingContext.strictValues,Te.ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING))return[];(this.parsingContext.normalizeLanguageTags||this.parsingContext.activeProcessingMode===1)&&(d=d.toLowerCase())}if(f){if(typeof l!="string")throw new Error(`When an '@direction' is set, the value of '@value' must be a string, got '${JSON.stringify(l)}'`);if(!Te.ContextParser.validateDirection(f,this.parsingContext.strictValues))return[]}if(d&&f&&this.parsingContext.rdfDirection){if(g)throw new Te.ErrorCoded(`Can not have '@language', '@direction' and '@type' in a value: '${JSON.stringify(n)}'`,Te.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(i,l,d,f))}else if(d){if(g)throw new Te.ErrorCoded(`Can not have both '@language' and '@type' in a value: '${JSON.stringify(n)}'`,Te.ERROR_CODES.INVALID_VALUE_OBJECT);return[this.dataFactory.literal(l,d)]}else if(f&&this.parsingContext.rdfDirection){if(g)throw new Te.ErrorCoded(`Can not have both '@direction' and '@type' in a value: '${JSON.stringify(n)}'`,Te.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(i,l,d,f))}else if(g){if(typeof g!="string")throw new Te.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(g)}'`,Te.ERROR_CODES.INVALID_TYPED_VALUE);let w=this.createVocabOrBaseTerm(e,g);if(!w)throw new Te.ErrorCoded(`Invalid '@type' value, got '${JSON.stringify(g)}'`,Te.ERROR_CODES.INVALID_TYPED_VALUE);if(w.termType!=="NamedNode")throw new Te.ErrorCoded(`Illegal value type (${w.termType}): ${g}`,Te.ERROR_CODES.INVALID_TYPED_VALUE);return[this.dataFactory.literal(l,w)]}return await this.valueToTerm(new Te.JsonLdContextNormalized({}),r,l,i,a)}else if("@set"in n){if(Object.keys(n).length>1)throw new Te.ErrorCoded(`Found illegal neighbouring entries next to @set for key: '${r}'`,Te.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);return[]}else if("@list"in n){if(Object.keys(n).length>1)throw new Te.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${r}'`,Te.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);let l=n["@list"];return Array.isArray(l)?l.length===0?[this.rdfNil]:this.parsingContext.idStack[i+1]||[]:await this.valueToTerm(await this.parsingContext.getContext(a),r,l,i-1,a.slice(0,-1))}else{if("@reverse"in n&&typeof n["@reverse"]=="boolean")return[];if("@graph"in t.getContextValueContainer(await this.parsingContext.getContext(a),r)){let l=this.parsingContext.graphContainerTermStack[i+1];return l?Object.values(l):[this.dataFactory.blankNode()]}else if("@id"in n){if(Object.keys(n).length>1&&(e=await this.parsingContext.getContext(a,0)),"@context"in n&&(e=await this.parsingContext.parseContext(n["@context"],e.getContextRaw())),n["@type"]==="@vocab")return this.nullableTermToArray(this.createVocabOrBaseTerm(e,n["@id"]));{let l=n["@id"],d;if(typeof l=="object")if(this.parsingContext.rdfstar)d=this.parsingContext.idStack[i+1][0];else throw new Te.ErrorCoded(`Found illegal @id '${n}'`,Te.ERROR_CODES.INVALID_ID_VALUE);else d=this.resourceToTerm(e,l);return this.nullableTermToArray(d)}}else return this.parsingContext.emittedStack[i+1]||n&&typeof n=="object"&&Object.keys(n).length===0?this.parsingContext.idStack[i+1]||(this.parsingContext.idStack[i+1]=[this.dataFactory.blankNode()]):[]}case"string":return this.nullableTermToArray(this.stringValueToTerm(i,await this.getContextSelfOrPropertyScoped(e,r),r,n,null));case"boolean":return this.nullableTermToArray(this.stringValueToTerm(i,await this.getContextSelfOrPropertyScoped(e,r),r,(!!n).toString(),this.dataFactory.namedNode(t.XSD_BOOLEAN)));case"number":return this.nullableTermToArray(this.stringValueToTerm(i,await this.getContextSelfOrPropertyScoped(e,r),r,n,this.dataFactory.namedNode(n%1===0&&n<1e21?t.XSD_INTEGER:t.XSD_DOUBLE)));default:return this.parsingContext.emitError(new Error(`Could not determine the RDF type of a ${u}`)),[]}}async getContextSelfOrPropertyScoped(e,r){let n=e.getContextRaw()[r];return n&&typeof n=="object"&&"@context"in n&&(e=await this.parsingContext.parseContext(n,e.getContextRaw(),!0)),e}nullableTermToArray(e){return e?[e]:[]}predicateToTerm(e,r){let n=e.expandTerm(r,!0,this.parsingContext.getExpandOptions());if(!n)return null;if(n[0]==="_"&&n[1]===":")return this.parsingContext.produceGeneralizedRdf?this.dataFactory.blankNode(n.substr(2)):null;if(t.isValidIri(n))return this.dataFactory.namedNode(n);if(n&&this.parsingContext.strictValues)this.parsingContext.emitError(new Te.ErrorCoded(`Invalid predicate IRI: ${n}`,Te.ERROR_CODES.INVALID_IRI_MAPPING));else return null;return null}resourceToTerm(e,r){if(r.startsWith("_:"))return this.dataFactory.blankNode(r.substr(2));let n=e.expandTerm(r,!1,this.parsingContext.getExpandOptions());if(!t.isValidIri(n))if(n&&this.parsingContext.strictValues)this.parsingContext.emitError(new Error(`Invalid resource IRI: ${n}`));else return null;return this.dataFactory.namedNode(n)}createVocabOrBaseTerm(e,r){if(r.startsWith("_:"))return this.dataFactory.blankNode(r.substr(2));let n=this.parsingContext.getExpandOptions(),i=e.expandTerm(r,!0,n);if(i===r&&(i=e.expandTerm(r,!1,n)),!t.isValidIri(i))if(i&&this.parsingContext.strictValues&&!i.startsWith("@"))this.parsingContext.emitError(new Error(`Invalid term IRI: ${i}`));else return null;return this.dataFactory.namedNode(i)}intToString(e,r){return typeof e=="number"?Number.isFinite(e)?e%1===0&&(!r||r.value!==t.XSD_DOUBLE)?Number(e).toString():e.toExponential(15).replace(/(\d)0*e\+?/,"$1E"):e>0?"INF":"-INF":e}stringValueToTerm(e,r,n,i,a){let u=t.getContextValueType(r,n);if(u)if(u==="@id"){if(!a)return this.resourceToTerm(r,this.intToString(i,a))}else if(u==="@vocab"){if(!a)return this.createVocabOrBaseTerm(r,this.intToString(i,a))}else a=this.dataFactory.namedNode(u);if(!a){let l=t.getContextValueLanguage(r,n),d=t.getContextValueDirection(r,n);return d&&this.parsingContext.rdfDirection?this.createLanguageDirectionLiteral(e,this.intToString(i,a),l,d):this.dataFactory.literal(this.intToString(i,a),l)}return this.dataFactory.literal(this.intToString(i,a),a)}createLanguageDirectionLiteral(e,r,n,i){if(this.parsingContext.rdfDirection==="i18n-datatype")return n||(n=""),this.dataFactory.literal(r,this.dataFactory.namedNode(`https://www.w3.org/ns/i18n#${n}_${i}`));{let a=this.dataFactory.blankNode(),u=this.getDefaultGraph();return this.parsingContext.emitQuad(e,this.dataFactory.quad(a,this.dataFactory.namedNode(t.RDF+"value"),this.dataFactory.literal(r),u)),n&&this.parsingContext.emitQuad(e,this.dataFactory.quad(a,this.dataFactory.namedNode(t.RDF+"language"),this.dataFactory.literal(n),u)),this.parsingContext.emitQuad(e,this.dataFactory.quad(a,this.dataFactory.namedNode(t.RDF+"direction"),this.dataFactory.literal(i),u)),a}}valueToJsonString(e){return I1(e)}async unaliasKeyword(e,r,n,i,a){if(Number.isInteger(e))return e;if(!i){let u=this.parsingContext.unaliasedKeywordCacheStack[n];if(u)return u}if(!Te.Util.isPotentialKeyword(e)){a=a||await this.parsingContext.getContext(r);let u=a.getContextRaw()[e];u&&typeof u=="object"&&(u=u["@id"]),Te.Util.isValidKeyword(u)&&(e=u)}return i?e:this.parsingContext.unaliasedKeywordCacheStack[n]=e}async unaliasKeywordParent(e,r){return await this.unaliasKeyword(r>0&&e[r-1],e,r-1)}async unaliasKeywords(e,r,n,i){let a={};for(let u in e)a[await this.unaliasKeyword(u,r,n+1,!0,i)]=e[u];return a}async isLiteral(e,r){for(let n=r;n>=0;n--){if(await this.unaliasKeyword(e[n],e,n)==="@annotation")return!1;if(this.parsingContext.literalStack[n]||this.parsingContext.jsonLiteralStack[n])return!0}return!1}async getDepthOffsetGraph(e,r){for(let n=e-1;n>0;n--)if(await this.unaliasKeyword(r[n],r,n)==="@graph"){let i=(await Aa.EntryHandlerContainer.getContainerHandler(this.parsingContext,r,n)).containers;return Aa.EntryHandlerContainer.isComplexGraphContainer(i)?-1:e-n-1}return-1}validateReverseSubject(e){if(e.termType==="Literal")throw new Te.ErrorCoded(`Found illegal literal in subject position: ${e.value}`,Te.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}getDefaultGraph(){return this.parsingContext.defaultGraph||this.dataFactory.defaultGraph()}async getGraphContainerValue(e,r){let n=this.getDefaultGraph(),{containers:i,depth:a}=await Aa.EntryHandlerContainer.getContainerHandler(this.parsingContext,e,r);if("@graph"in i){let u=Aa.EntryHandlerContainer.getContainerGraphIndex(i,a,e),l=this.parsingContext.graphContainerTermStack[a];if(n=l?l[u]:null,!n){let d=null;if("@id"in i){let f=await this.getContainerKey(e[a],e,a);f!==null&&(d=await this.resourceToTerm(await this.parsingContext.getContext(e),f))}d||(d=this.dataFactory.blankNode()),this.parsingContext.graphContainerTermStack[a]||(this.parsingContext.graphContainerTermStack[a]={}),n=this.parsingContext.graphContainerTermStack[a][u]=d}}return n}async getPropertiesDepth(e,r){let n=r;for(let i=r-1;i>0;i--)if(typeof e[i]!="number"){let a=await this.unaliasKeyword(e[i],e,i);if(a==="@reverse")return i;if(a==="@nest")n=i;else return n}return n}async getContainerKey(e,r,n){let i=await this.unaliasKeyword(e,r,n);return i==="@none"?null:i}validateReverseInEmbeddedNode(e,r,n){if(n&&r&&!this.parsingContext.rdfstarReverseInEmbedded)throw new Te.ErrorCoded(`Illegal reverse property in embedded node in ${e}`,Te.ERROR_CODES.INVALID_EMBEDDED_NODE)}emitQuadChecked(e,r,n,i,a,u,l){let d;if(u?(this.validateReverseSubject(i),d=this.dataFactory.quad(i,n,r,a)):d=this.dataFactory.quad(r,n,i,a),l){if(d.graph.termType!=="DefaultGraph"&&(d=this.dataFactory.quad(d.subject,d.predicate,d.object)),this.parsingContext.idStack[e-1])throw new Te.ErrorCoded("Illegal multiple properties in an embedded node",Te.ERROR_CODES.INVALID_EMBEDDED_NODE);this.parsingContext.idStack[e-1]=[d]}else this.parsingContext.emitQuad(e,d);let f=this.parsingContext.annotationsBuffer[e];if(f){for(let g of f)this.emitAnnotation(e,d,g);delete this.parsingContext.annotationsBuffer[e]}}emitAnnotation(e,r,n){let i;n.reverse?(this.validateReverseSubject(n.object),i=this.dataFactory.quad(n.object,n.predicate,r)):i=this.dataFactory.quad(r,n.predicate,n.object),this.parsingContext.emitQuad(e,i);for(let a of n.nestedAnnotations)this.emitAnnotation(e,i,a)}};_r.XSD="http://www.w3.org/2001/XMLSchema#";_r.XSD_BOOLEAN=_r.XSD+"boolean";_r.XSD_INTEGER=_r.XSD+"integer";_r.XSD_DOUBLE=_r.XSD+"double";_r.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";Ia.Util=_r});var Vy=_e(Ta=>{"use strict";N();O();k();Object.defineProperty(Ta,"__esModule",{value:!0});Ta.EntryHandlerArrayValue=void 0;var T1=ln(),Hy=Bt(),Jl=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,n,i,a){return this.test(e,r,null,n,i)}async test(e,r,n,i,a){return typeof i[a]=="number"}async handle(e,r,n,i,a,u){let l=await r.unaliasKeywordParent(i,u);if(l==="@list"){let d=null,f=0;for(let g=u-2;g>0;g--){let _=i[g];if(typeof _=="string"||typeof _=="number"){f=g,d=_;break}}if(d!==null){let g=await r.valueToTerm(await e.getContext(i),d,a,u,i);for(let _ of g)await this.handleListElement(e,r,_,a,u,i.slice(0,f),f);g.length===0&&await this.handleListElement(e,r,null,a,u,i.slice(0,f),f)}}else if(l==="@set")await e.newOnValueJob(i.slice(0,-2),a,u-2,!1);else if(l!==void 0&&l!=="@type"){for(let f=u-1;f>0;f--)if(typeof i[f]!="number"){l=await r.unaliasKeyword(i[f],i,f);break}let d=await e.getContext(i.slice(0,-1));if("@list"in T1.Util.getContextValueContainer(d,l)){e.emittedStack[u+1]=!0;let f=await r.valueToTerm(await e.getContext(i),l,a,u,i);for(let g of f)await this.handleListElement(e,r,g,a,u,i.slice(0,-1),u-1);f.length===0&&await this.handleListElement(e,r,null,a,u,i.slice(0,-1),u-1)}else e.shiftStack(u,1),await e.newOnValueJob(i.slice(0,-1),a,u-1,!1),e.contextTree.removeContext(i.slice(0,-1))}}async handleListElement(e,r,n,i,a,u,l){let d=e.listPointerStack[a];if(i!==null&&(await r.unaliasKeywords(i,u,a))["@value"]!==null){if(!d||!d.value){let f=r.dataFactory.blankNode();d={value:f,listRootDepth:l,listId:f}}else{let f=r.dataFactory.blankNode();e.emitQuad(a,r.dataFactory.quad(d.value,r.rdfRest,f,r.getDefaultGraph())),d.value=f}n&&e.emitQuad(a,r.dataFactory.quad(d.value,r.rdfFirst,n,r.getDefaultGraph()))}else d||(d={listRootDepth:l,listId:r.rdfNil});e.listPointerStack[a]=d,e.rdfstar&&e.annotationsBuffer[a]&&e.emitError(new Hy.ErrorCoded("Found an illegal annotation inside a list",Hy.ERROR_CODES.INVALID_ANNOTATION))}};Ta.EntryHandlerArrayValue=Jl});var Ky=_e(Ra=>{"use strict";N();O();k();Object.defineProperty(Ra,"__esModule",{value:!0});Ra.EntryHandlerInvalidFallback=void 0;var Gl=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,n,i,a){return!1}async test(e,r,n,i,a){return!0}async handle(e,r,n,i,a,u){e.emittedStack[u]=!1}};Ra.EntryHandlerInvalidFallback=Gl});var zr=_e(Ca=>{"use strict";N();O();k();Object.defineProperty(Ca,"__esModule",{value:!0});Ca.EntryHandlerKeyword=void 0;var zl=class{constructor(e){this.keyword=e}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,n,i,a){return!1}async test(e,r,n,i,a){return n===this.keyword}};Ca.EntryHandlerKeyword=zl});var $y=_e(Fa=>{"use strict";N();O();k();Object.defineProperty(Fa,"__esModule",{value:!0});Fa.EntryHandlerKeywordContext=void 0;var qy=Bt(),R1=zr(),Yl=class extends R1.EntryHandlerKeyword{constructor(){super("@context")}isStackProcessor(){return!1}async handle(e,r,n,i,a,u){e.streamingProfile&&(e.processingStack[u]||e.processingType[u]||e.idStack[u]!==void 0)&&e.emitError(new qy.ErrorCoded("Found an out-of-order context, while streaming is enabled.(disable `streamingProfile`)",qy.ERROR_CODES.INVALID_STREAMING_KEY_ORDER));let l=e.getContext(i),d=e.parseContext(a,(await l).getContextRaw());e.contextTree.setContext(i.slice(0,-1),d),e.emitContext(a),await e.validateContext(await d)}};Fa.EntryHandlerKeywordContext=Yl});var Wy=_e(Pa=>{"use strict";N();O();k();Object.defineProperty(Pa,"__esModule",{value:!0});Pa.EntryHandlerKeywordGraph=void 0;var C1=zr(),Ql=class extends C1.EntryHandlerKeyword{constructor(){super("@graph")}async handle(e,r,n,i,a,u){e.graphStack[u+1]=!0}};Pa.EntryHandlerKeywordGraph=Ql});var Jy=_e(Na=>{"use strict";N();O();k();Object.defineProperty(Na,"__esModule",{value:!0});Na.EntryHandlerKeywordId=void 0;var Dr=Bt(),F1=zr(),Xl=class extends F1.EntryHandlerKeyword{constructor(){super("@id")}isStackProcessor(){return!1}async handle(e,r,n,i,a,u){if(typeof a!="string"){if(e.rdfstar&&typeof a=="object"){let d=Object.keys(a);d.length===1&&d[0]==="@id"&&e.emitError(new Dr.ErrorCoded(`Invalid embedded node without property with @id ${a["@id"]}`,Dr.ERROR_CODES.INVALID_EMBEDDED_NODE))}else e.emitError(new Dr.ErrorCoded(`Found illegal @id '${a}'`,Dr.ERROR_CODES.INVALID_ID_VALUE));return}let l=await r.getPropertiesDepth(i,u);if(e.idStack[l]!==void 0&&(e.idStack[l][0].listHead?e.emitError(new Dr.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${i[u-1]}'`,Dr.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT)):e.emitError(new Dr.ErrorCoded(`Found duplicate @ids '${e.idStack[l][0].value}' and '${a}'`,Dr.ERROR_CODES.COLLIDING_KEYWORDS))),e.rdfstar&&e.annotationsBuffer[u])for(let d of e.annotationsBuffer[u])d.depth===u&&e.emitError(new Dr.ErrorCoded(`Found an illegal @id inside an annotation: ${a}`,Dr.ERROR_CODES.INVALID_ANNOTATION));e.idStack[l]=r.nullableTermToArray(await r.resourceToTerm(await e.getContext(i),a))}};Na.EntryHandlerKeywordId=Xl});var Gy=_e(ka=>{"use strict";N();O();k();Object.defineProperty(ka,"__esModule",{value:!0});ka.EntryHandlerKeywordIncluded=void 0;var Ci=Bt(),P1=zr(),Zl=class extends P1.EntryHandlerKeyword{constructor(){super("@included")}async handle(e,r,n,i,a,u){typeof a!="object"&&e.emitError(new Ci.ErrorCoded(`Found illegal @included '${a}'`,Ci.ERROR_CODES.INVALID_INCLUDED_VALUE));let l=await r.unaliasKeywords(a,i,u,await e.getContext(i));"@value"in l&&e.emitError(new Ci.ErrorCoded(`Found an illegal @included @value node '${JSON.stringify(a)}'`,Ci.ERROR_CODES.INVALID_INCLUDED_VALUE)),"@list"in l&&e.emitError(new Ci.ErrorCoded(`Found an illegal @included @list node '${JSON.stringify(a)}'`,Ci.ERROR_CODES.INVALID_INCLUDED_VALUE)),e.emittedStack[u]=!1}};ka.EntryHandlerKeywordIncluded=Zl});var zy=_e(Da=>{"use strict";N();O();k();Object.defineProperty(Da,"__esModule",{value:!0});Da.EntryHandlerKeywordNest=void 0;var Oa=Bt(),N1=zr(),ef=class extends N1.EntryHandlerKeyword{constructor(){super("@nest")}async handle(e,r,n,i,a,u){typeof a!="object"&&e.emitError(new Oa.ErrorCoded(`Found invalid @nest entry for '${n}': '${a}'`,Oa.ERROR_CODES.INVALID_NEST_VALUE)),"@value"in await r.unaliasKeywords(a,i,u,await e.getContext(i))&&e.emitError(new Oa.ErrorCoded(`Found an invalid @value node for '${n}'`,Oa.ERROR_CODES.INVALID_NEST_VALUE)),e.emittedStack[u]=!1}};Da.EntryHandlerKeywordNest=ef});var Yy=_e(Ua=>{"use strict";N();O();k();Object.defineProperty(Ua,"__esModule",{value:!0});Ua.EntryHandlerKeywordType=void 0;var So=Bt(),La=ln(),k1=vo(),O1=zr(),tf=class extends O1.EntryHandlerKeyword{constructor(){super("@type")}isStackProcessor(){return!1}async handle(e,r,n,i,a,u){let l=i[u],d=await e.getContext(i),f=r.rdfType,g=await r.unaliasKeywordParent(i,u),_=La.Util.isPropertyReverse(d,l,g),w=La.Util.isPropertyInEmbeddedNode(g);r.validateReverseInEmbeddedNode(n,_,w);let E=La.Util.isPropertyInAnnotationObject(g),x=Array.isArray(a)?a:[a];for(let D of x){typeof D!="string"&&e.emitError(new So.ErrorCoded(`Found illegal @type '${D}'`,So.ERROR_CODES.INVALID_TYPE_VALUE));let U=r.createVocabOrBaseTerm(d,D);U&&await k1.EntryHandlerPredicate.handlePredicateObject(e,r,i,u,f,U,_,w,E)}let A=Promise.resolve(d),I=!1;for(let D of x.sort()){let U=La.Util.getContextValue(d,"@context",D,null);U&&(I=!0,A=A.then(z=>e.parseContext(U,z.getContextRaw())))}e.streamingProfile&&(I||!e.streamingProfileAllowOutOfOrderPlainType)&&(e.processingStack[u]||e.idStack[u])&&e.emitError(new So.ErrorCoded("Found an out-of-order type-scoped context, while streaming is enabled.(disable `streamingProfile`)",So.ERROR_CODES.INVALID_STREAMING_KEY_ORDER)),I&&(A=A.then(D=>D.getContextRaw()["@propagate"]!==!0?new So.JsonLdContextNormalized(Object.assign(Object.assign({},D.getContextRaw()),{"@propagate":!1,"@__propagateFallback":d.getContextRaw()})):D),e.contextTree.setContext(i.slice(0,i.length-1),A)),e.processingType[u]=!0}};Ua.EntryHandlerKeywordType=tf});var Qy=_e(Ba=>{"use strict";N();O();k();Object.defineProperty(Ba,"__esModule",{value:!0});Ba.EntryHandlerKeywordUnknownFallback=void 0;var Eo=Bt(),ja=class t{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,r,n,i,a){let u=await r.unaliasKeyword(n[i],n,i);return Eo.Util.isPotentialKeyword(u)?!(!a&&u==="@list"):!1}async test(e,r,n,i,a){return Eo.Util.isPotentialKeyword(n)}async handle(e,r,n,i,a,u){let l=t.VALID_KEYWORDS_TYPES[n];l!==void 0?l&&typeof a!==l.type&&e.emitError(new Eo.ErrorCoded(`Invalid value type for '${n}' with value '${a}'`,l.errorCode)):e.strictValues&&e.emitError(new Error(`Unknown keyword '${n}' with value '${a}'`)),e.emittedStack[u]=!1}};ja.VALID_KEYWORDS_TYPES={"@index":{type:"string",errorCode:Eo.ERROR_CODES.INVALID_INDEX_VALUE},"@list":null,"@reverse":{type:"object",errorCode:Eo.ERROR_CODES.INVALID_REVERSE_VALUE},"@set":null,"@value":null};Ba.EntryHandlerKeywordUnknownFallback=ja});var Xy=_e(Ma=>{"use strict";N();O();k();Object.defineProperty(Ma,"__esModule",{value:!0});Ma.EntryHandlerKeywordValue=void 0;var D1=zr(),rf=class extends D1.EntryHandlerKeyword{constructor(){super("@value")}async validate(e,r,n,i,a){let u=n[i];return u&&!e.literalStack[i]&&await this.test(e,r,u,n,i)&&(e.literalStack[i]=!0),super.validate(e,r,n,i,a)}async test(e,r,n,i,a){return await r.unaliasKeyword(i[a],i.slice(0,i.length-1),a-1,!0)==="@value"}async handle(e,r,n,i,a,u){e.literalStack[u]=!0,delete e.unidentifiedValuesBuffer[u],delete e.unidentifiedGraphsBuffer[u],e.emittedStack[u]=!1}};Ma.EntryHandlerKeywordValue=rf});var Zy=_e(Ha=>{"use strict";N();O();k();Object.defineProperty(Ha,"__esModule",{value:!0});Ha.ContextTree=void 0;var nf=class t{constructor(){this.subTrees={}}getContext(e){if(e.length>0){let[r,...n]=e,i=this.subTrees[r];if(i){let a=i.getContext(n);if(a)return a.then(({context:u,depth:l})=>({context:u,depth:l+1}))}}return this.context?this.context.then(r=>({context:r,depth:0})):null}setContext(e,r){if(e.length===0)this.context=r;else{let[n,...i]=e,a=this.subTrees[n];a||(a=this.subTrees[n]=new t),a.setContext(i,r)}}removeContext(e){this.setContext(e,null)}};Ha.ContextTree=nf});var em=_e(qa=>{"use strict";N();O();k();Object.defineProperty(qa,"__esModule",{value:!0});qa.ParsingContext=void 0;var Fi=Bt(),Va=Ti(),L1=Zy(),U1=of(),Ka=class t{constructor(e){this.contextParser=new Fi.ContextParser({documentLoader:e.documentLoader,skipValidation:e.skipContextValidation}),this.streamingProfile=!!e.streamingProfile,this.baseIRI=e.baseIRI,this.produceGeneralizedRdf=!!e.produceGeneralizedRdf,this.allowSubjectList=!!e.allowSubjectList,this.processingMode=e.processingMode||U1.JsonLdParser.DEFAULT_PROCESSING_MODE,this.strictValues=!!e.strictValues,this.validateValueIndexes=!!e.validateValueIndexes,this.defaultGraph=e.defaultGraph,this.rdfDirection=e.rdfDirection,this.normalizeLanguageTags=e.normalizeLanguageTags,this.streamingProfileAllowOutOfOrderPlainType=e.streamingProfileAllowOutOfOrderPlainType,this.rdfstar=e.rdfstar!==!1,this.rdfstarReverseInEmbedded=e.rdfstarReverseInEmbedded,this.topLevelProperties=!1,this.activeProcessingMode=parseFloat(this.processingMode),this.processingStack=[],this.processingType=[],this.emittedStack=[],this.idStack=[],this.graphStack=[],this.graphContainerTermStack=[],this.listPointerStack=[],this.contextTree=new L1.ContextTree,this.literalStack=[],this.validationStack=[],this.unaliasedKeywordCacheStack=[],this.jsonLiteralStack=[],this.unidentifiedValuesBuffer=[],this.unidentifiedGraphsBuffer=[],this.annotationsBuffer=[],this.pendingContainerFlushBuffers=[],this.parser=e.parser,e.context?(this.rootContext=this.parseContext(e.context),this.rootContext.then(r=>this.validateContext(r))):this.rootContext=Promise.resolve(new Fi.JsonLdContextNormalized(this.baseIRI?{"@base":this.baseIRI,"@__baseDocument":!0}:{}))}async parseContext(e,r,n){return this.contextParser.parse(e,{baseIRI:this.baseIRI,ignoreProtection:n,normalizeLanguageTags:this.normalizeLanguageTags,parentContext:r,processingMode:this.activeProcessingMode})}validateContext(e){let r=e.getContextRaw()["@version"];if(r){if(this.activeProcessingMode&&r>this.activeProcessingMode)throw new Va.ErrorCoded(`Unsupported JSON-LD version '${r}' under active processing mode ${this.activeProcessingMode}.`,Va.ERROR_CODES.PROCESSING_MODE_CONFLICT);if(this.activeProcessingMode&&r<this.activeProcessingMode)throw new Va.ErrorCoded(`Invalid JSON-LD version ${r} under active processing mode ${this.activeProcessingMode}.`,Va.ERROR_CODES.INVALID_VERSION_VALUE);this.activeProcessingMode=r}}async getContext(e,r=1){let n=e;for(;typeof e[e.length-1]=="number";)e=e.slice(0,e.length-1);r&&(e=e.slice(0,-r));let i=await this.getContextPropagationAware(e),u=i.context.getContextRaw();for(let l=i.depth;l<n.length-r;l++){let d=n[l],f=u[d];if(f&&typeof f=="object"&&"@context"in f){let g=(await this.parseContext(f,u,!0)).getContextRaw(),_=!(d in g)||g[d]["@context"]["@propagate"];(_!==!1||l===n.length-1-r)&&(u=Object.assign({},g),delete u["@propagate"],u[d]=Object.assign({},u[d]),"@id"in f&&(u[d]["@id"]=f["@id"]),delete u[d]["@context"],_!==!1&&this.contextTree.setContext(n.slice(0,l+r),Promise.resolve(new Fi.JsonLdContextNormalized(u))))}}return new Fi.JsonLdContextNormalized(u)}async getContextPropagationAware(e){let r=e.length,n=null,i;do{i=!1,n&&"@__propagateFallback"in n.context.getContextRaw()?n.context=new Fi.JsonLdContextNormalized(n.context.getContextRaw()["@__propagateFallback"]):(n&&(e=e.slice(0,n.depth-1)),n=await this.contextTree.getContext(e)||{context:await this.rootContext,depth:0});let a=e[e.length-1];if(a in n.context.getContextRaw()){let u=n.context.getContextRaw()[a];u&&typeof u=="object"&&"@context"in u&&(i=!0)}}while(n.depth>0&&n.context.getContextRaw()["@propagate"]===!1&&n.depth!==r&&!i);return n.depth===0&&n.context.getContextRaw()["@propagate"]===!1&&n.depth!==r&&(n.context=new Fi.JsonLdContextNormalized({})),n}async newOnValueJob(e,r,n,i){await this.parser.newOnValueJob(e,r,n,i)}async handlePendingContainerFlushBuffers(){if(this.pendingContainerFlushBuffers.length>0){for(let e of this.pendingContainerFlushBuffers)await this.parser.flushBuffer(e.depth,e.keys),this.parser.flushStacks(e.depth);return this.pendingContainerFlushBuffers.splice(0,this.pendingContainerFlushBuffers.length),!0}else return!1}emitQuad(e,r){e===1&&(this.topLevelProperties=!0),this.parser.push(r)}emitError(e){this.parser.emit("error",e)}emitContext(e){this.parser.emit("context",e)}getUnidentifiedValueBufferSafe(e){let r=this.unidentifiedValuesBuffer[e];return r||(r=[],this.unidentifiedValuesBuffer[e]=r),r}getUnidentifiedGraphBufferSafe(e){let r=this.unidentifiedGraphsBuffer[e];return r||(r=[],this.unidentifiedGraphsBuffer[e]=r),r}getAnnotationsBufferSafe(e){let r=this.annotationsBuffer[e];return r||(r=[],this.annotationsBuffer[e]=r),r}getExpandOptions(){return t.EXPAND_OPTIONS[this.activeProcessingMode]}shiftStack(e,r){let n=this.idStack[e+r];if(n&&(this.idStack[e]=n,this.emittedStack[e]=!0,delete this.idStack[e+r]),this.pendingContainerFlushBuffers.length)for(let i of this.pendingContainerFlushBuffers)i.depth>=e+r&&(i.depth-=r,i.keys.splice(e,r));this.unidentifiedValuesBuffer[e+r]&&(this.unidentifiedValuesBuffer[e]=this.unidentifiedValuesBuffer[e+r],delete this.unidentifiedValuesBuffer[e+r]),this.annotationsBuffer[e+r-1]&&(this.annotationsBuffer[e-1]||(this.annotationsBuffer[e-1]=[]),this.annotationsBuffer[e-1]=[...this.annotationsBuffer[e-1],...this.annotationsBuffer[e+r-1]],delete this.annotationsBuffer[e+r-1])}};Ka.EXPAND_OPTIONS={1:{allowPrefixForcing:!1,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!1},1.1:{allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}};qa.ParsingContext=Ka});var rm=_e($a=>{"use strict";N();O();k();Object.defineProperty($a,"__esModule",{value:!0});$a.EntryHandlerKeywordAnnotation=void 0;var j1=zr(),tm=Bt(),sf=class extends j1.EntryHandlerKeyword{constructor(){super("@annotation")}async handle(e,r,n,i,a,u){(typeof a=="string"||typeof a=="object"&&a["@value"])&&e.emitError(new tm.ErrorCoded(`Found illegal annotation value: ${JSON.stringify(a)}`,tm.ERROR_CODES.INVALID_ANNOTATION))}};$a.EntryHandlerKeywordAnnotation=sf});var of=_e(Wa=>{"use strict";N();O();k();Object.defineProperty(Wa,"__esModule",{value:!0});Wa.JsonLdParser=void 0;var B1=gy(),wr=Bt(),nm=ml(),M1=Vy(),om=Wl(),H1=Ky(),V1=vo(),K1=$y(),q1=Wy(),$1=Jy(),W1=Gy(),J1=zy(),G1=Yy(),z1=Qy(),Y1=Xy(),Q1=em(),im=ln(),X1=na(),Z1=rm(),xo=class t extends nm.Transform{constructor(e){super({readableObjectMode:!0}),e=e||{},this.options=e,this.parsingContext=new Q1.ParsingContext(Object.assign({parser:this},e)),this.util=new im.Util({dataFactory:e.dataFactory,parsingContext:this.parsingContext}),this.jsonParser=new B1,this.contextJobs=[],this.typeJobs=[],this.contextAwaitingJobs=[],this.lastDepth=0,this.lastKeys=[],this.lastOnValueJob=Promise.resolve(),this.attachJsonParserListeners(),this.on("end",()=>{typeof this.jsonParser.mode<"u"&&this.emit("error",new Error("Unclosed document"))})}static fromHttpResponse(e,r,n,i){let a,u=["application/activity+json"];if(i&&i.wellKnownMediaTypes&&(u=i.wellKnownMediaTypes),r!=="application/ld+json"&&!u.includes(r)){if(r!=="application/json"&&!r.endsWith("+json"))throw new wr.ErrorCoded(`Unsupported JSON-LD media type ${r}`,wr.ERROR_CODES.LOADING_DOCUMENT_FAILED);if(n&&n.has("Link")&&n.forEach((d,f)=>{if(f==="link"){let g=(0,X1.parse)(d);for(let _ of g.get("rel","http://www.w3.org/ns/json-ld#context")){if(a)throw new wr.ErrorCoded("Multiple JSON-LD context link headers were found on "+e,wr.ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS);a=_.uri}}}),!a&&!i?.ignoreMissingContextLinkHeader)throw new wr.ErrorCoded(`Missing context link header for media type ${r} on ${e}`,wr.ERROR_CODES.LOADING_DOCUMENT_FAILED)}let l;if(n&&n.has("Content-Type")){let d=n.get("Content-Type"),f=/; *profile=([^"]*)/.exec(d);f&&f[1]==="http://www.w3.org/ns/json-ld#streaming"&&(l=!0)}return new t(Object.assign({baseIRI:e,context:a,streamingProfile:l},i||{}))}import(e){if("pipe"in e){e.on("error",n=>r.emit("error",n));let r=e.pipe(new t(this.options));return r}else{let r=new nm.PassThrough({readableObjectMode:!0});e.on("error",i=>n.emit("error",i)),e.on("data",i=>r.push(i)),e.on("end",()=>r.push(null));let n=r.pipe(new t(this.options));return n}}_transform(e,r,n){this.jsonParser.write(e),this.lastOnValueJob.then(()=>n(),i=>n(i))}async newOnValueJob(e,r,n,i){let a=!0;if(i&&n<this.lastDepth){let g=this.parsingContext.listPointerStack[this.lastDepth];g&&(g.value&&this.push(this.util.dataFactory.quad(g.value,this.util.rdfRest,this.util.rdfNil,this.util.getDefaultGraph())),g.listId.listHead=!0,this.parsingContext.idStack[g.listRootDepth+1]=[g.listId],this.parsingContext.listPointerStack.splice(this.lastDepth,1)),await om.EntryHandlerContainer.isBufferableContainerHandler(this.parsingContext,this.lastKeys,this.lastDepth)?(this.parsingContext.pendingContainerFlushBuffers.push({depth:this.lastDepth,keys:this.lastKeys.slice(0,this.lastKeys.length)}),a=!1):await this.flushBuffer(this.lastDepth,this.lastKeys)}let u=await this.util.unaliasKeyword(e[n],e,n),l=await this.util.unaliasKeywordParent(e,n);this.parsingContext.emittedStack[n]=!0;let d=!0;wr.Util.isValidKeyword(u)&&l==="@reverse"&&u!=="@context"&&this.emit("error",new wr.ErrorCoded(`Found the @id '${r}' inside an @reverse property`,wr.ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP));let f=!1;this.parsingContext.validationStack.length>1&&(f=this.parsingContext.validationStack[this.parsingContext.validationStack.length-1].property);for(let g=Math.max(1,this.parsingContext.validationStack.length-1);g<e.length-1;g++){let _=this.parsingContext.validationStack[g]||(this.parsingContext.validationStack[g]=await this.validateKey(e.slice(0,g+1),g,f));if(_.valid)!f&&_.property&&(f=!0);else{this.parsingContext.emittedStack[n]=!1,d=!1;break}}if(await this.util.isLiteral(e,n)&&(d=!1),d)for(let g of t.ENTRY_HANDLERS){let _=await g.test(this.parsingContext,this.util,u,e,n);if(_){await g.handle(this.parsingContext,this.util,u,e,r,n,_),g.isStackProcessor()&&(this.parsingContext.processingStack[n]=!0);break}}n===0&&Array.isArray(r)&&await this.util.validateValueIndexes(r),a&&n<this.lastDepth&&this.flushStacks(this.lastDepth),this.lastDepth=n,this.lastKeys=e,this.parsingContext.unaliasedKeywordCacheStack.splice(n-1)}flushStacks(e){this.parsingContext.processingStack.splice(e,1),this.parsingContext.processingType.splice(e,1),this.parsingContext.emittedStack.splice(e,1),this.parsingContext.idStack.splice(e,1),this.parsingContext.graphStack.splice(e+1,1),this.parsingContext.graphContainerTermStack.splice(e,1),this.parsingContext.jsonLiteralStack.splice(e,1),this.parsingContext.validationStack.splice(e-1,2),this.parsingContext.literalStack.splice(e,this.parsingContext.literalStack.length-e),this.parsingContext.annotationsBuffer.splice(e,1)}async flushBuffer(e,r){let n=this.parsingContext.idStack[e];!!n||(n=this.parsingContext.idStack[e]=[this.util.dataFactory.blankNode()]);let a=this.parsingContext.unidentifiedValuesBuffer[e];if(a){for(let d of n){let f=await this.util.getDepthOffsetGraph(e,r),g=this.parsingContext.graphStack[e]||f>=0?this.parsingContext.idStack[e-f-1]:[await this.util.getGraphContainerValue(r,e)];if(g)for(let _ of g){this.parsingContext.emittedStack[e]=!0;for(let w of a)this.util.emitQuadChecked(e,d,w.predicate,w.object,_,w.reverse,w.isEmbedded)}else{let _=this.parsingContext.getUnidentifiedGraphBufferSafe(e-await this.util.getDepthOffsetGraph(e,r)-1);for(let w of a)w.reverse?_.push({object:d,predicate:w.predicate,subject:w.object,isEmbedded:w.isEmbedded}):_.push({object:w.object,predicate:w.predicate,subject:d,isEmbedded:w.isEmbedded})}}this.parsingContext.unidentifiedValuesBuffer.splice(e,1),this.parsingContext.literalStack.splice(e,1),this.parsingContext.jsonLiteralStack.splice(e,1)}let u=this.parsingContext.unidentifiedGraphsBuffer[e];if(u){for(let d of n){let f=e===1&&d.termType==="BlankNode"&&!this.parsingContext.topLevelProperties?this.util.getDefaultGraph():d;this.parsingContext.emittedStack[e]=!0;for(let g of u)this.parsingContext.emitQuad(e,this.util.dataFactory.quad(g.subject,g.predicate,g.object,f))}this.parsingContext.unidentifiedGraphsBuffer.splice(e,1)}let l=this.parsingContext.annotationsBuffer[e];if(l){l.length>0&&e===1&&this.parsingContext.emitError(new wr.ErrorCoded("Annotations can not be made on top-level nodes",wr.ERROR_CODES.INVALID_ANNOTATION));let d=this.parsingContext.getAnnotationsBufferSafe(e-1);for(let f of l)d.push(f);delete this.parsingContext.annotationsBuffer[e]}}async validateKey(e,r,n){for(let i of t.ENTRY_HANDLERS)if(await i.validate(this.parsingContext,this.util,e,r,n))return{valid:!0,property:n||i.isPropertyHandler()};return{valid:!1,property:!1}}attachJsonParserListeners(){this.jsonParser.onValue=e=>{let r=this.jsonParser.stack.length,n=new Array(r+1).fill(0).map((i,a)=>a===r?this.jsonParser.key:this.jsonParser.stack[a].key);if(!this.isParsingContextInner(r)){let i=()=>this.newOnValueJob(n,e,r,!0);if(!this.parsingContext.streamingProfile&&!this.parsingContext.contextTree.getContext(n.slice(0,-1)))if(n[r]==="@context"){let a=this.contextJobs[r];a||(a=this.contextJobs[r]=[]),a.push(i)}else this.contextAwaitingJobs.push({job:i,keys:n,depth:r});else this.lastOnValueJob=this.lastOnValueJob.then(i);!this.parsingContext.streamingProfile&&r===0&&(this.lastOnValueJob=this.lastOnValueJob.then(()=>this.executeBufferedJobs()))}},this.jsonParser.onError=e=>{this.emit("error",e)}}isParsingContextInner(e){for(let r=e;r>0;r--)if(this.jsonParser.stack[r-1].key==="@context")return!0;return!1}async executeBufferedJobs(){for(let r of this.contextJobs)if(r)for(let n of r)await n();this.parsingContext.unaliasedKeywordCacheStack.splice(0);let e=[];for(let r of this.contextAwaitingJobs)await this.util.unaliasKeyword(r.keys[r.depth],r.keys,r.depth,!0)==="@type"||typeof r.keys[r.depth]=="number"&&await this.util.unaliasKeyword(r.keys[r.depth-1],r.keys,r.depth-1,!0)==="@type"?this.typeJobs.push({job:r.job,keys:r.keys.slice(0,r.keys.length-1)}):e.push(r);for(let r of e){if(this.typeJobs.length>0){let n=[],i=[];for(let l=0;l<this.typeJobs.length;l++){let d=this.typeJobs[l];im.Util.isPrefixArray(d.keys,r.keys)&&(n.push(d),i.push(l))}let a=n.sort((l,d)=>l.keys.length-d.keys.length);for(let l of a)await l.job();let u=i.sort().reverse();for(let l of u)this.typeJobs.splice(l,1)}await r.job()}}};xo.DEFAULT_PROCESSING_MODE="1.1";xo.ENTRY_HANDLERS=[new M1.EntryHandlerArrayValue,new K1.EntryHandlerKeywordContext,new $1.EntryHandlerKeywordId,new W1.EntryHandlerKeywordIncluded,new q1.EntryHandlerKeywordGraph,new J1.EntryHandlerKeywordNest,new G1.EntryHandlerKeywordType,new Y1.EntryHandlerKeywordValue,new Z1.EntryHandlerKeywordAnnotation,new om.EntryHandlerContainer,new z1.EntryHandlerKeywordUnknownFallback,new V1.EntryHandlerPredicate,new H1.EntryHandlerInvalidFallback];Wa.JsonLdParser=xo});var sm=_e(zn=>{"use strict";N();O();k();var ex=zn&&zn.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),tx=zn&&zn.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ex(e,t,r)};Object.defineProperty(zn,"__esModule",{value:!0});tx(of(),zn)});N();O();k();var pf={};Do(pf,{deleteFromPod:()=>Cm,getFromPod:()=>Hx,getUser:()=>Ro,initAuthentication:()=>Ux,logIn:()=>Bx,logOut:()=>Mx,postToPod:()=>Vx});N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();var or=crypto,Zn=t=>t instanceof CryptoKey;var Gt=new TextEncoder,hr=new TextDecoder,fA=2**32;function Uo(...t){let e=t.reduce((i,{length:a})=>i+a,0),r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var Xm=t=>{let e=t;typeof e=="string"&&(e=Gt.encode(e));let r=32768,n=[];for(let i=0;i<e.length;i+=r)n.push(String.fromCharCode.apply(null,e.subarray(i,i+r)));return btoa(n.join(""))},ei=t=>Xm(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Zm=t=>{let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r},Er=t=>{let e=t;e instanceof Uint8Array&&(e=hr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Zm(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};N();O();k();var mt=class extends Error{constructor(e,r){super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}};mt.code="ERR_JOSE_GENERIC";var zt=class extends mt{constructor(e,r,n="unspecified",i="unspecified"){super(e,{cause:{claim:n,reason:i,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=i,this.payload=r}};zt.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var ti=class extends mt{constructor(e,r,n="unspecified",i="unspecified"){super(e,{cause:{claim:n,reason:i,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=i,this.payload=r}};ti.code="ERR_JWT_EXPIRED";var ji=class extends mt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}};ji.code="ERR_JOSE_ALG_NOT_ALLOWED";var ut=class extends mt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}};ut.code="ERR_JOSE_NOT_SUPPORTED";var su=class extends mt{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}};su.code="ERR_JWE_DECRYPTION_FAILED";var au=class extends mt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}};au.code="ERR_JWE_INVALID";var We=class extends mt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}};We.code="ERR_JWS_INVALID";var jr=class extends mt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}};jr.code="ERR_JWT_INVALID";var uu=class extends mt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}};uu.code="ERR_JWK_INVALID";var ri=class extends mt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}};ri.code="ERR_JWKS_INVALID";var _n=class extends mt{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}};_n.code="ERR_JWKS_NO_MATCHING_KEY";var Bi=class extends mt{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}};Bi.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var Mi=class extends mt{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}};Mi.code="ERR_JWKS_TIMEOUT";var Hi=class extends mt{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};Hi.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";N();O();k();function Br(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function jo(t,e){return t.name===e}function cu(t){return parseInt(t.name.slice(4),10)}function t0(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function r0(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Lf(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!jo(t.algorithm,"HMAC"))throw Br("HMAC");let n=parseInt(e.slice(2),10);if(cu(t.algorithm.hash)!==n)throw Br(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!jo(t.algorithm,"RSASSA-PKCS1-v1_5"))throw Br("RSASSA-PKCS1-v1_5");let n=parseInt(e.slice(2),10);if(cu(t.algorithm.hash)!==n)throw Br(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!jo(t.algorithm,"RSA-PSS"))throw Br("RSA-PSS");let n=parseInt(e.slice(2),10);if(cu(t.algorithm.hash)!==n)throw Br(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw Br("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!jo(t.algorithm,"ECDSA"))throw Br("ECDSA");let n=t0(e);if(t.algorithm.namedCurve!==n)throw Br(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}r0(t,r)}N();O();k();function Uf(t,e,...r){if(r=r.filter(Boolean),r.length>2){let n=r.pop();t+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor?.name&&(t+=` Received an instance of ${e.constructor.name}`),t}var Vi=(t,...e)=>Uf("Key must be ",t,...e);function lu(t,e,...r){return Uf(`Key for the ${t} algorithm must be `,e,...r)}N();O();k();var fu=t=>Zn(t)?!0:t?.[Symbol.toStringTag]==="KeyObject",Qr=["CryptoKey"];N();O();k();var n0=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let i=Object.keys(n);if(!r||r.size===0){r=new Set(i);continue}for(let a of i){if(r.has(a))return!1;r.add(a)}}return!0},Bo=n0;N();O();k();function i0(t){return typeof t=="object"&&t!==null}function kt(t){if(!i0(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}N();O();k();var Mo=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};N();O();k();N();O();k();function Mr(t){return kt(t)&&typeof t.kty=="string"}function jf(t){return t.kty!=="oct"&&typeof t.d=="string"}function Bf(t){return t.kty!=="oct"&&typeof t.d>"u"}function Mf(t){return Mr(t)&&t.kty==="oct"&&typeof t.k=="string"}N();O();k();function s0(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new ut('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}var a0=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:e,keyUsages:r}=s0(t),n=[e,t.ext??!1,t.key_ops??r],i={...t};return delete i.alg,delete i.use,or.subtle.importKey("jwk",i,...n)},Ho=a0;var Hf=t=>Er(t),ni,ii,Vf=t=>t?.[Symbol.toStringTag]==="KeyObject",Vo=async(t,e,r,n,i=!1)=>{let a=t.get(e);if(a?.[n])return a[n];let u=await Ho({...r,alg:n});return i&&Object.freeze(e),a?a[n]=u:t.set(e,{[n]:u}),u},u0=(t,e)=>{if(Vf(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?Hf(r.k):(ii||(ii=new WeakMap),Vo(ii,t,r,e))}return Mr(t)?t.k?Er(t.k):(ii||(ii=new WeakMap),Vo(ii,t,t,e,!0)):t},c0=(t,e)=>{if(Vf(t)){let r=t.export({format:"jwk"});return r.k?Hf(r.k):(ni||(ni=new WeakMap),Vo(ni,t,r,e))}return Mr(t)?t.k?Er(t.k):(ni||(ni=new WeakMap),Vo(ni,t,t,e,!0)):t},du={normalizePublicKey:u0,normalizePrivateKey:c0};N();O();k();async function Ko(t,e){if(!kt(t))throw new TypeError("JWK must be an object");switch(e||(e=t.alg),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Er(t.k);case"RSA":if(t.oth!==void 0)throw new ut('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Ho({...t,alg:e});default:throw new ut('Unsupported "kty" (Key Type) Parameter value')}}N();O();k();var oi=t=>t?.[Symbol.toStringTag],hu=(t,e,r)=>{if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&e.key_ops.includes?.(r)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},l0=(t,e,r,n)=>{if(!(e instanceof Uint8Array)){if(n&&Mr(e)){if(Mf(e)&&hu(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!fu(e))throw new TypeError(lu(t,e,...Qr,"Uint8Array",n?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${oi(e)} instances for symmetric algorithms must be of type "secret"`)}},f0=(t,e,r,n)=>{if(n&&Mr(e))switch(r){case"sign":if(jf(e)&&hu(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Bf(e)&&hu(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!fu(e))throw new TypeError(lu(t,e,...Qr,n?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${oi(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${oi(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${oi(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${oi(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${oi(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Kf(t,e,r,n){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?l0(e,r,n,t):f0(e,r,n,t)}var SI=Kf.bind(void 0,!1),Ki=Kf.bind(void 0,!0);N();O();k();function d0(t,e,r,n,i){if(i.crit!==void 0&&n?.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(u=>typeof u!="string"||u.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let a;r!==void 0?a=new Map([...Object.entries(r),...e.entries()]):a=e;for(let u of n.crit){if(!a.has(u))throw new ut(`Extension Header Parameter "${u}" is not recognized`);if(i[u]===void 0)throw new t(`Extension Header Parameter "${u}" is missing`);if(a.get(u)&&n[u]===void 0)throw new t(`Extension Header Parameter "${u}" MUST be integrity protected`)}return new Set(n.crit)}var qo=d0;N();O();k();var h0=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(e)return new Set(e)},qf=h0;N();O();k();N();O();k();var p0=async t=>{if(t instanceof Uint8Array)return{kty:"oct",k:ei(t)};if(!Zn(t))throw new TypeError(Vi(t,...Qr,"Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:e,key_ops:r,alg:n,use:i,...a}=await or.subtle.exportKey("jwk",t);return a},$f=p0;async function $o(t){return $f(t)}N();O();k();N();O();k();N();O();k();N();O();k();function qi(t,e){let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new ut(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}N();O();k();async function $i(t,e,r){if(r==="sign"&&(e=await du.normalizePrivateKey(e,t)),r==="verify"&&(e=await du.normalizePublicKey(e,t)),Zn(e))return Lf(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Vi(e,...Qr));return or.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(Vi(e,...Qr,"Uint8Array","JSON Web Key"))}var g0=async(t,e,r,n)=>{let i=await $i(t,e,"verify");Mo(t,i);let a=qi(t,i.algorithm);try{return await or.subtle.verify(a,i,r,n)}catch{return!1}},Wf=g0;async function Jf(t,e,r){if(!kt(t))throw new We("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new We('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new We("JWS Protected Header incorrect type");if(t.payload===void 0)throw new We("JWS Payload missing");if(typeof t.signature!="string")throw new We("JWS Signature missing or incorrect type");if(t.header!==void 0&&!kt(t.header))throw new We("JWS Unprotected Header incorrect type");let n={};if(t.protected)try{let A=Er(t.protected);n=JSON.parse(hr.decode(A))}catch{throw new We("JWS Protected Header is invalid")}if(!Bo(n,t.header))throw new We("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...n,...t.header},a=qo(We,new Map([["b64",!0]]),r?.crit,n,i),u=!0;if(a.has("b64")&&(u=n.b64,typeof u!="boolean"))throw new We('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=i;if(typeof l!="string"||!l)throw new We('JWS "alg" (Algorithm) Header Parameter missing or invalid');let d=r&&qf("algorithms",r.algorithms);if(d&&!d.has(l))throw new ji('"alg" (Algorithm) Header Parameter value not allowed');if(u){if(typeof t.payload!="string")throw new We("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new We("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof e=="function"?(e=await e(n,t),f=!0,Ki(l,e,"verify"),Mr(e)&&(e=await Ko(e,l))):Ki(l,e,"verify");let g=Uo(Gt.encode(t.protected??""),Gt.encode("."),typeof t.payload=="string"?Gt.encode(t.payload):t.payload),_;try{_=Er(t.signature)}catch{throw new We("Failed to base64url decode the signature")}if(!await Wf(l,e,_,g))throw new Hi;let E;if(u)try{E=Er(t.payload)}catch{throw new We("Failed to base64url decode the payload")}else typeof t.payload=="string"?E=Gt.encode(t.payload):E=t.payload;let x={payload:E};return t.protected!==void 0&&(x.protectedHeader=n),t.header!==void 0&&(x.unprotectedHeader=t.header),f?{...x,key:e}:x}async function Gf(t,e,r){if(t instanceof Uint8Array&&(t=hr.decode(t)),typeof t!="string")throw new We("Compact JWS must be a string or Uint8Array");let{0:n,1:i,2:a,length:u}=t.split(".");if(u!==3)throw new We("Invalid Compact JWS");let l=await Jf({payload:i,protected:n,signature:a},e,r),d={payload:l.payload,protectedHeader:l.protectedHeader};return typeof e=="function"?{...d,key:l.key}:d}N();O();k();N();O();k();N();O();k();var xr=t=>Math.floor(t.getTime()/1e3);N();O();k();var y0=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,wn=t=>{let e=y0.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let r=parseFloat(e[2]),n=e[3].toLowerCase(),i;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(r*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(r*3600);break;case"day":case"days":case"d":i=Math.round(r*86400);break;case"week":case"weeks":case"w":i=Math.round(r*604800);break;default:i=Math.round(r*31557600);break}return e[1]==="-"||e[4]==="ago"?-i:i};var zf=t=>t.toLowerCase().replace(/^application\//,""),m0=(t,e)=>typeof t=="string"?e.includes(t):Array.isArray(t)?e.some(Set.prototype.has.bind(new Set(t))):!1,Yf=(t,e,r={})=>{let n;try{n=JSON.parse(hr.decode(e))}catch{}if(!kt(n))throw new jr("JWT Claims Set must be a top-level JSON object");let{typ:i}=r;if(i&&(typeof t.typ!="string"||zf(t.typ)!==zf(i)))throw new zt('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:a=[],issuer:u,subject:l,audience:d,maxTokenAge:f}=r,g=[...a];f!==void 0&&g.push("iat"),d!==void 0&&g.push("aud"),l!==void 0&&g.push("sub"),u!==void 0&&g.push("iss");for(let x of new Set(g.reverse()))if(!(x in n))throw new zt(`missing required "${x}" claim`,n,x,"missing");if(u&&!(Array.isArray(u)?u:[u]).includes(n.iss))throw new zt('unexpected "iss" claim value',n,"iss","check_failed");if(l&&n.sub!==l)throw new zt('unexpected "sub" claim value',n,"sub","check_failed");if(d&&!m0(n.aud,typeof d=="string"?[d]:d))throw new zt('unexpected "aud" claim value',n,"aud","check_failed");let _;switch(typeof r.clockTolerance){case"string":_=wn(r.clockTolerance);break;case"number":_=r.clockTolerance;break;case"undefined":_=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:w}=r,E=xr(w||new Date);if((n.iat!==void 0||f)&&typeof n.iat!="number")throw new zt('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new zt('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>E+_)throw new zt('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new zt('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=E-_)throw new ti('"exp" claim timestamp check failed',n,"exp","check_failed")}if(f){let x=E-n.iat,A=typeof f=="number"?f:wn(f);if(x-_>A)throw new ti('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(x<0-_)throw new zt('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function pu(t,e,r){let n=await Gf(t,e,r);if(n.protectedHeader.crit?.includes("b64")&&n.protectedHeader.b64===!1)throw new jr("JWTs MUST NOT use unencoded payload");let a={payload:Yf(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof e=="function"?{...a,key:n.key}:a}N();O();k();N();O();k();N();O();k();var _0=async(t,e,r)=>{let n=await $i(t,e,"sign");Mo(t,n);let i=await or.subtle.sign(qi(t,n.algorithm),n,r);return new Uint8Array(i)},Qf=_0;var Wo=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new We("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Bo(this._protectedHeader,this._unprotectedHeader))throw new We("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},i=qo(We,new Map([["b64",!0]]),r?.crit,this._protectedHeader,n),a=!0;if(i.has("b64")&&(a=this._protectedHeader.b64,typeof a!="boolean"))throw new We('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=n;if(typeof u!="string"||!u)throw new We('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ki(u,e,"sign");let l=this._payload;a&&(l=Gt.encode(ei(l)));let d;this._protectedHeader?d=Gt.encode(ei(JSON.stringify(this._protectedHeader))):d=Gt.encode("");let f=Uo(d,Gt.encode("."),l),g=await Qf(u,e,f),_={signature:ei(g),payload:""};return a&&(_.payload=hr.decode(l)),this._unprotectedHeader&&(_.header=this._unprotectedHeader),this._protectedHeader&&(_.protected=hr.decode(d)),_}};var Jo=class{constructor(e){this._flattened=new Wo(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){let n=await this._flattened.sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}};N();O();k();N();O();k();function bn(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}var Go=class{constructor(e={}){if(!kt(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:bn("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:bn("setNotBefore",xr(e))}:this._payload={...this._payload,nbf:xr(new Date)+wn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:bn("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:bn("setExpirationTime",xr(e))}:this._payload={...this._payload,exp:xr(new Date)+wn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:xr(new Date)}:e instanceof Date?this._payload={...this._payload,iat:bn("setIssuedAt",xr(e))}:typeof e=="string"?this._payload={...this._payload,iat:bn("setIssuedAt",xr(new Date)+wn(e))}:this._payload={...this._payload,iat:bn("setIssuedAt",e)},this}};var Wi=class extends Go{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){let n=new Jo(Gt.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new jr("JWTs MUST NOT use unencoded payload");return n.sign(e,r)}};N();O();k();function w0(t){switch(typeof t=="string"&&t.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new ut('Unsupported "alg" value for a JSON Web Key Set')}}function b0(t){return t&&typeof t=="object"&&Array.isArray(t.keys)&&t.keys.every(v0)}function v0(t){return kt(t)}function Zf(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}var gu=class{constructor(e){if(this._cached=new WeakMap,!b0(e))throw new ri("JSON Web Key Set malformed");this._jwks=Zf(e)}async getKey(e,r){let{alg:n,kid:i}={...e,...r?.header},a=w0(n),u=this._jwks.keys.filter(f=>{let g=a===f.kty;if(g&&typeof i=="string"&&(g=i===f.kid),g&&typeof f.alg=="string"&&(g=n===f.alg),g&&typeof f.use=="string"&&(g=f.use==="sig"),g&&Array.isArray(f.key_ops)&&(g=f.key_ops.includes("verify")),g&&n==="EdDSA"&&(g=f.crv==="Ed25519"||f.crv==="Ed448"),g)switch(n){case"ES256":g=f.crv==="P-256";break;case"ES256K":g=f.crv==="secp256k1";break;case"ES384":g=f.crv==="P-384";break;case"ES512":g=f.crv==="P-521";break}return g}),{0:l,length:d}=u;if(d===0)throw new _n;if(d!==1){let f=new Bi,{_cached:g}=this;throw f[Symbol.asyncIterator]=async function*(){for(let _ of u)try{yield await Xf(g,_,n)}catch{}},f}return Xf(this._cached,l,n)}};async function Xf(t,e,r){let n=t.get(e)||t.set(e,{}).get(e);if(n[r]===void 0){let i=await Ko({...e,ext:!0},r);if(i instanceof Uint8Array||i.type!=="public")throw new ri("JSON Web Key Set members must be public keys");n[r]=i}return n[r]}function yu(t){let e=new gu(t),r=async(n,i)=>e.getKey(n,i);return Object.defineProperties(r,{jwks:{value:()=>Zf(e._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}N();O();k();N();O();k();var S0=async(t,e,r)=>{let n,i,a=!1;typeof AbortController=="function"&&(n=new AbortController,i=setTimeout(()=>{a=!0,n.abort()},e));let u=await fetch(t.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(l=>{throw a?new Mi:l});if(i!==void 0&&clearTimeout(i),u.status!==200)throw new mt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await u.json()}catch{throw new mt("Failed to parse the JSON Web Key Set HTTP response as JSON")}},ed=S0;function E0(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}var mu;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(mu="jose/v5.9.6");var zo=Symbol();function x0(t,e){return!(typeof t!="object"||t===null||!("uat"in t)||typeof t.uat!="number"||Date.now()-t.uat>=e||!("jwks"in t)||!kt(t.jwks)||!Array.isArray(t.jwks.keys)||!Array.prototype.every.call(t.jwks.keys,kt))}var _u=class{constructor(e,r){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:r?.agent,headers:r?.headers},this._timeoutDuration=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this._cooldownDuration=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this._cacheMaxAge=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5,r?.[zo]!==void 0&&(this._cache=r?.[zo],x0(r?.[zo],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=yu(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,r){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(e,r)}catch(n){if(n instanceof _n&&this.coolingDown()===!1)return await this.reload(),this._local(e,r);throw n}}async reload(){this._pendingFetch&&E0()&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);mu&&!e.has("User-Agent")&&(e.set("User-Agent",mu),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=ed(this._url,this._timeoutDuration,this._options).then(r=>{this._local=yu(r),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=r),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(r=>{throw this._pendingFetch=void 0,r})),await this._pendingFetch}};function wu(t,e){let r=new _u(t,e),n=async(i,a)=>r.getKey(i,a);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}N();O();k();N();O();k();function bu(t){let e=t?.modulusLength??2048;if(typeof e!="number"||e<2048)throw new ut("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return e}async function td(t,e){let r,n;switch(t){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bu(e)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bu(e)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(t.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bu(e)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"EdDSA":{n=["sign","verify"];let i=e?.crv??"Ed25519";switch(i){case"Ed25519":case"Ed448":r={name:i};break;default:throw new ut("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveKey","deriveBits"];let i=e?.crv??"P-256";switch(i){case"P-256":case"P-384":case"P-521":{r={name:"ECDH",namedCurve:i};break}case"X25519":case"X448":r={name:i};break;default:throw new ut("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return or.subtle.generateKey(r,e?.extractable??!1,n)}async function vu(t,e){return td(t,e)}N();O();k();N();O();k();var Ot=[];for(let t=0;t<256;++t)Ot.push((t+256).toString(16).slice(1));function rd(t,e=0){return(Ot[t[e+0]]+Ot[t[e+1]]+Ot[t[e+2]]+Ot[t[e+3]]+"-"+Ot[t[e+4]]+Ot[t[e+5]]+"-"+Ot[t[e+6]]+Ot[t[e+7]]+"-"+Ot[t[e+8]]+Ot[t[e+9]]+"-"+Ot[t[e+10]]+Ot[t[e+11]]+Ot[t[e+12]]+Ot[t[e+13]]+Ot[t[e+14]]+Ot[t[e+15]]).toLowerCase()}N();O();k();var Su,A0=new Uint8Array(16);function Eu(){if(!Su){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Su=crypto.getRandomValues.bind(crypto)}return Su(A0)}N();O();k();N();O();k();var I0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xu={randomUUID:I0};function T0(t,e,r){if(xu.randomUUID&&!e&&!t)return xu.randomUUID();t=t||{};let n=t.random??t.rng?.()??Eu();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(r=r||0,r<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[r+i]=n[i];return e}return rd(n)}var si=T0;var Ru="solidClientAuthn:",Ji=["ES256","RS256"],it={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},nd=5,R0="openid",C0="offline_access",F0="webid",rs=[R0,C0,F0].join(" "),Yo=class{constructor(e){this.handleables=e,this.handleables=e}async getProperHandler(e){let r=await Promise.all(this.handleables.map(n=>n.canHandle(...e)));for(let n=0;n<r.length;n+=1)if(r[n])return this.handleables[n];return null}async canHandle(...e){return await this.getProperHandler(e)!==null}async handle(...e){let r=await this.getProperHandler(e);if(r)return r.handle(...e);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map(n=>{try{return JSON.stringify(n)}catch{return n.toString()}}).join(", ")}`)}};async function Cu(t,e,r,n){let i,a;try{let{payload:u}=await pu(t,wu(new URL(e)),{issuer:r,audience:n});i=u}catch(u){throw new Error(`Token verification failed: ${u.stack}`)}if(typeof i.azp=="string"&&(a=i.azp),typeof i.webid=="string")return{webId:i.webid,clientId:a};if(typeof i.sub!="string")throw new Error(`The token ${JSON.stringify(i)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(i.sub),{webId:i.sub,clientId:a}}catch(u){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${i.sub}] is invalid as a URL - error [${u}].`)}}function Fu(t){try{let e=new URL(t),r=!e.searchParams.has("code")&&!e.searchParams.has("state"),n=e.hash==="";return r&&n}catch{return!1}}function ns(t){let e=new URL(t);return e.searchParams.delete("state"),e.searchParams.delete("code"),e.searchParams.delete("error"),e.searchParams.delete("error_description"),e.searchParams.delete("iss"),e}function P0(t,e){return typeof t=="boolean"?!!t:!!e}var Qo=class{constructor(e,r){this.storageUtility=e,this.redirector=r,this.parametersGuard=n=>n.issuerConfiguration.grantTypesSupported!==void 0&&n.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&n.redirectUrl!==void 0,this.storageUtility=e,this.redirector=r}async canHandle(e){return this.parametersGuard(e)}async handleRedirect({oidcLoginOptions:e,state:r,codeVerifier:n,targetUrl:i}){if(!this.parametersGuard(e))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(r,{sessionId:e.sessionId}),this.storageUtility.setForUser(e.sessionId,{codeVerifier:n,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:(!!e.dpop).toString(),keepAlive:P0(e.keepAlive,!0).toString()})]),this.redirector.redirect(i,{handleRedirect:e.handleRedirect})}},Iu=class{constructor(e){this.sessionInfoManager=e,this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}},Tu=class{constructor(e){this.redirector=e,this.redirector=e}async canHandle(e,r){return r?.logoutType==="idp"}async handle(e,r){if(r?.logoutType!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(r.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(r.toLogoutUrl(r),{handleRedirect:r.handleRedirect})}},Xo=class{constructor(e,r){this.handlers=[new Iu(e),new Tu(r)]}async canHandle(){return!0}async handle(e,r){for(let n of this.handlers)await n.canHandle(e,r)&&await n.handle(e,r)}};function Pu(){return{isLoggedIn:!1,sessionId:si(),fetch:(...t)=>fetch(...t)}}async function Nu(t,e){await Promise.all([e.deleteAllUserData(t,{secure:!1}),e.deleteAllUserData(t,{secure:!0})])}var Zo=class{constructor(e){this.storageUtility=e,this.storageUtility=e}update(e,r){throw new Error("Not Implemented")}get(e){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(e){return Nu(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}};function N0({endSessionEndpoint:t,idTokenHint:e,postLogoutRedirectUri:r,state:n}){let i=new URL(t);return e!==void 0&&i.searchParams.append("id_token_hint",e),r!==void 0&&(i.searchParams.append("post_logout_redirect_uri",r),n!==void 0&&i.searchParams.append("state",n)),i.toString()}function sd({endSessionEndpoint:t,idTokenHint:e}){if(t!==void 0)return function({state:n,postLogoutUrl:i}){return N0({endSessionEndpoint:t,idTokenHint:e,state:n,postLogoutRedirectUri:i})}}function ad(t){return typeof t=="string"&&["DPoP","Bearer"].includes(t)}function ud(t){try{return new URL(t),!0}catch{return!1}}function cd(t,e){var r;return(r=e.find(n=>t.includes(n)))!==null&&r!==void 0?r:null}function k0(t){return t.clientId!==void 0&&!ud(t.clientId)}function O0(t,e){return e.scopesSupported.includes("webid")&&t.clientId!==void 0&&ud(t.clientId)}function ld(t){return typeof t=="string"&&["dynamic","static","solid-oidc"].includes(t)}async function fd(t,e,r,n){let i;if(O0(t,e))i={clientId:t.clientId,clientName:t.clientName,clientType:"solid-oidc"};else if(k0(t))i={clientId:t.clientId,clientSecret:t.clientSecret,clientName:t.clientName,clientType:"static"};else return n.getClient({sessionId:t.sessionId,clientName:t.clientName,redirectUrl:t.redirectUrl},e);let a={clientId:i.clientId,clientType:i.clientType};return i.clientType==="static"&&(a.clientSecret=i.clientSecret),i.clientName&&(a.clientName=i.clientName),await r.setForUser(t.sessionId,a),i}var id=(t,e)=>fetch(t,e),es=class{constructor(e,r,n,i,a){this.loginHandler=e,this.redirectHandler=r,this.logoutHandler=n,this.sessionInfoManager=i,this.issuerConfigFetcher=a,this.fetch=id,this.logout=async(u,l)=>{await this.logoutHandler.handle(u,l?.logoutType==="idp"?{...l,toLogoutUrl:this.boundLogout}:l),this.fetch=id,delete this.boundLogout},this.getSessionInfo=async u=>this.sessionInfoManager.get(u),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.loginHandler=e,this.redirectHandler=r,this.logoutHandler=n,this.sessionInfoManager=i,this.issuerConfigFetcher=a}};async function ku(t,e,r){try{let[n,i,a,u,l]=await Promise.all([e.getForUser(t,"issuer",{errorIfNull:!0}),e.getForUser(t,"codeVerifier"),e.getForUser(t,"redirectUrl"),e.getForUser(t,"dpop",{errorIfNull:!0}),e.getForUser(t,"keepAlive")]);await e.deleteForUser(t,"codeVerifier");let d=await r.fetchConfig(n);return{codeVerifier:i,redirectUrl:a,issuerConfig:d,dpop:u==="true",keepAlive:typeof l=="string"?l==="true":!0}}catch(n){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${t}]: ${n}`)}}async function dd(t,e,r,n,i,a,u,l){a!==void 0&&await t.setForUser(e,{refreshToken:a},{secure:u}),r!==void 0&&await t.setForUser(e,{webId:r},{secure:u}),n!==void 0&&await t.setForUser(e,{clientId:n},{secure:u}),i!==void 0&&await t.setForUser(e,{isLoggedIn:i},{secure:u}),l!==void 0&&await t.setForUser(e,{publicKey:JSON.stringify(l.publicKey),privateKey:JSON.stringify(await $o(l.privateKey))},{secure:u})}var ts=class{constructor(e,r){this.secureStorage=e,this.insecureStorage=r,this.secureStorage=e,this.insecureStorage=r}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,r){let n=await(r?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(n===void 0)return{};try{return JSON.parse(n)}catch{throw new Error(`Data for user [${e}] in [${r?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${n}`)}}async setUserData(e,r,n){await(n?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(r))}async get(e,r){let n=await(r?.secure?this.secureStorage:this.insecureStorage).get(e);if(n===void 0&&r?.errorIfNull)throw new Error(`[${e}] is not stored`);return n}async set(e,r,n){return(n?.secure?this.secureStorage:this.insecureStorage).set(e,r)}async delete(e,r){return(r?.secure?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,r,n){let i=await this.getUserData(e,n?.secure),a;if((!i||!i[r])&&(a=void 0),a=i[r],a===void 0&&n?.errorIfNull)throw new Error(`Field [${r}] for user [${e}] is not stored`);return a||void 0}async setForUser(e,r,n){let i;try{i=await this.getUserData(e,n?.secure)}catch{i={}}await this.setUserData(e,{...i,...r},n?.secure)}async deleteForUser(e,r,n){let i=await this.getUserData(e,n?.secure);delete i[r],await this.setUserData(e,i,n?.secure)}async deleteAllUserData(e,r){await(r?.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}},Gi=class{constructor(){this.map={}}async get(e){return this.map[e]||void 0}async set(e,r){this.map[e]=r}async delete(e){delete this.map[e]}},vn=class extends Error{constructor(e){super(e)}};var Xr=class extends Error{constructor(e){super(`Invalid response from OIDC provider: missing fields ${e}`),this.missingFields=e}},zi=class extends Error{constructor(e,r,n){super(e),this.error=r,this.errorDescription=n}};function D0(t){let e=new URL(t);return new URL(e.pathname,e.origin).toString()}async function is(t,e,r){return new Wi({htu:D0(t),htm:e.toUpperCase(),jti:si()}).setProtectedHeader({alg:Ji[0],jwk:r.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(r.privateKey,{})}async function hd(){let{privateKey:t,publicKey:e}=await vu(Ji[0]),r={privateKey:t,publicKey:await $o(e)};return[r.publicKey.alg]=Ji,r}var pd=600;function L0(t){return[401,403].includes(t)}async function U0(t,e,r,n){var i;let a=new Headers(n?.headers);return a.set("Authorization",`DPoP ${e}`),a.set("DPoP",await is(t,(i=n?.method)!==null&&i!==void 0?i:"get",r)),{...n,headers:a}}async function j0(t,e,r,n){if(r!==void 0)return U0(t,e,r,n);let i=new Headers(n?.headers);return i.set("Authorization",`Bearer ${e}`),{...n,headers:i}}async function od(t,e,r,n){return fetch(e,await j0(e.toString(),t,n,r))}async function B0(t,e,r){var n;let i=await t.tokenRefresher.refresh(t.sessionId,t.refreshToken,e);return r?.emit(it.SESSION_EXTENDED,(n=i.expiresIn)!==null&&n!==void 0?n:pd),typeof i.refreshToken=="string"&&r?.emit(it.NEW_REFRESH_TOKEN,i.refreshToken),{accessToken:i.accessToken,refreshToken:i.refreshToken,expiresIn:i.expiresIn}}var Au=t=>t!==void 0?t-nd>0?t-nd:t:pd;async function gd(t,e){var r;let n=t,i,a=e?.refreshOptions;if(a!==void 0){let u=async()=>{var l,d,f,g;try{let{accessToken:_,refreshToken:w,expiresIn:E}=await B0(a,e.dpopKey,e.eventEmitter);n=_,w!==void 0&&(a.refreshToken=w),clearTimeout(i),i=setTimeout(u,Au(E)*1e3),(l=e.eventEmitter)===null||l===void 0||l.emit(it.TIMEOUT_SET,i)}catch(_){_ instanceof zi&&((d=e?.eventEmitter)===null||d===void 0||d.emit(it.ERROR,_.error,_.errorDescription),(f=e?.eventEmitter)===null||f===void 0||f.emit(it.SESSION_EXPIRED)),_ instanceof Xr&&_.missingFields.includes("access_token")&&((g=e?.eventEmitter)===null||g===void 0||g.emit(it.SESSION_EXPIRED))}};i=setTimeout(u,Au(e.expiresIn)*1e3),(r=e.eventEmitter)===null||r===void 0||r.emit(it.TIMEOUT_SET,i)}else if(e!==void 0&&e.eventEmitter!==void 0){let u=setTimeout(()=>{e.eventEmitter.emit(it.SESSION_EXPIRED)},Au(e.expiresIn)*1e3);e.eventEmitter.emit(it.TIMEOUT_SET,u)}return async(u,l)=>{let d=await od(n,u,l,e?.dpopKey),f=!d.ok&&!L0(d.status);return d.ok||f||d.url!==u&&e?.dpopKey!==void 0&&(d=await od(n,d.url,l,e.dpopKey)),d}}ai();N();O();k();var ss=gn(Du()),sr=gn(Du());function J0(t,e){var r,n,i,a;throw t.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(r=e.redirectUrl)===null||r===void 0?void 0:r.toString()}] is invalid - ${(n=t.error_description)!==null&&n!==void 0?n:""}`):t.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(e)} is invalid - ${(i=t.error_description)!==null&&i!==void 0?i:""}`):new Error(`Dynamic client registration failed: ${t.error} - ${(a=t.error_description)!==null&&a!==void 0?a:""}`)}function G0(t,e){if(t.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(t)}`);if(e.redirectUrl&&(t.redirect_uris===void 0||t.redirect_uris[0]!==e.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(t.redirect_uris)} don't match the provided ${JSON.stringify([e.redirectUrl.toString()])}`)}async function _d(t,e){var r;if(!e.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(e.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");let n=cd(e.idTokenSigningAlgValuesSupported,Ji),i={client_name:t.clientName,application_type:"web",redirect_uris:[(r=t.redirectUrl)===null||r===void 0?void 0:r.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:n,grant_types:["authorization_code","refresh_token"]},a={"Content-Type":"application/json"},u=await fetch(e.registrationEndpoint.toString(),{method:"POST",headers:a,body:JSON.stringify(i)});if(u.ok){let l=await u.json();return G0(l,t),{clientId:l.client_id,clientSecret:l.client_secret,idTokenSignedResponseAlg:l.id_token_signed_response_alg,clientType:"dynamic"}}throw u.status===400&&J0(await u.json(),t),new Error(`Dynamic client registration failed: the server returned ${u.status} ${u.statusText} - ${await u.text()}`)}function z0(t){return t.error!==void 0&&typeof t.error=="string"}function md(t){return t.error_description!==void 0&&typeof t.error_description=="string"}function Y0(t){return t.error_uri!==void 0&&typeof t.error_uri=="string"}function Q0(t){return t.access_token!==void 0&&typeof t.access_token=="string"}function X0(t){return t.id_token!==void 0&&typeof t.id_token=="string"}function Z0(t){return t.refresh_token!==void 0&&typeof t.refresh_token=="string"}function e_(t){return t.token_type!==void 0&&typeof t.token_type=="string"}function t_(t){return t.expires_in===void 0||typeof t.expires_in=="number"}function r_(t,e){if(e.grantType&&(!t.grantTypesSupported||!t.grantTypesSupported.includes(e.grantType)))throw new Error(`The issuer [${t.issuer}] does not support the [${e.grantType}] grant`);if(!t.tokenEndpoint)throw new Error(`This issuer [${t.issuer}] does not have a token endpoint`)}function wd(t,e){if(z0(t))throw new zi(`Token endpoint returned error [${t.error}]${md(t)?`: ${t.error_description}`:""}${Y0(t)?` (see ${t.error_uri})`:""}`,t.error,md(t)?t.error_description:void 0);if(!Q0(t))throw new Xr(["access_token"]);if(!X0(t))throw new Xr(["id_token"]);if(!e_(t))throw new Xr(["token_type"]);if(!t_(t))throw new Xr(["expires_in"]);if(!e&&t.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${t.token_type}].`);return t}async function bd(t,e,r,n){r_(t,r);let i={"content-type":"application/x-www-form-urlencoded"},a;n&&(a=await hd(),i.DPoP=await is(t.tokenEndpoint,"POST",a)),e.clientSecret&&(i.Authorization=`Basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`);let u={grant_type:r.grantType,redirect_uri:r.redirectUrl,code:r.code,code_verifier:r.codeVerifier,client_id:e.clientId},l={method:"POST",headers:i,body:new URLSearchParams(u).toString()},f=await(await fetch(t.tokenEndpoint,l)).json(),g=wd(f,n),{webId:_,clientId:w}=await Cu(g.id_token,t.jwksUri,t.issuer,e.clientId);return{accessToken:g.access_token,idToken:g.id_token,refreshToken:Z0(g)?g.refresh_token:void 0,webId:_,clientId:w,dpopKey:a,expiresIn:g.expires_in}}var n_=t=>{try{return new URL(t),!0}catch{return!1}};async function vd(t,e,r,n){if(r.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");let i={grant_type:"refresh_token",refresh_token:t,scope:rs},a={};n!==void 0&&(a={DPoP:await is(e.tokenEndpoint,"POST",n)});let u={};r.clientSecret!==void 0?u={Authorization:`Basic ${btoa(`${r.clientId}:${r.clientSecret}`)}`}:n_(r.clientId)&&(i.client_id=r.clientId);let l=await fetch(e.tokenEndpoint,{method:"POST",body:new URLSearchParams(i).toString(),headers:{...a,...u,"Content-Type":"application/x-www-form-urlencoded"}}),d;try{d=await l.json()}catch{throw new Error(`The token endpoint of issuer ${e.issuer} returned a malformed response.`)}let f=wd(d,n!==void 0),{webId:g}=await Cu(f.id_token,e.jwksUri,e.issuer,r.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:typeof f.refresh_token=="string"?f.refresh_token:void 0,webId:g,dpopKey:n,expiresIn:f.expires_in}}function Sd(t){let e=ns(t);return e.hash="",t.includes(`${e.origin}/`)?e.href:`${e.origin}${e.href.substring(e.origin.length+1)}`}async function Ed(){await new ss.OidcClient({response_mode:"query"}).clearStaleState(new ss.WebStorageStateStore({}));let e=window.localStorage,r=[];for(let n=0;n<=e.length;n+=1){let i=e.key(n);i&&(i.match(/^oidc\..+$/)||i.match(/^solidClientAuthenticationUser:.+$/))&&r.push(i)}r.forEach(n=>e.removeItem(n))}var ju=class extends ts{constructor(e,r){super(e,r)}},Bu=class extends es{constructor(){super(...arguments),this.login=async(e,r)=>{var n,i;await this.sessionInfoManager.clear(e.sessionId);let a=(n=e.redirectUrl)!==null&&n!==void 0?n:Sd(window.location.href);if(!Fu(a))throw new Error(`${a} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...e,redirectUrl:a,clientName:(i=e.clientName)!==null&&i!==void 0?i:e.clientId,eventEmitter:r})},this.validateCurrentSession=async e=>{let r=await this.sessionInfoManager.get(e);return r===void 0||r.clientAppId===void 0||r.issuer===void 0?null:r},this.handleIncomingRedirect=async(e,r)=>{try{let n=await this.redirectHandler.handle(e,r,void 0);return this.fetch=n.fetch.bind(window),this.boundLogout=n.getLogoutUrl,await this.cleanUrlAfterRedirect(e),{isLoggedIn:n.isLoggedIn,webId:n.webId,sessionId:n.sessionId,expirationDate:n.expirationDate,clientAppId:n.clientAppId}}catch(n){await this.cleanUrlAfterRedirect(e),r.emit(it.ERROR,"redirect",n);return}}}async cleanUrlAfterRedirect(e){let r=ns(e).href;for(window.history.replaceState(null,"",r);window.location.href!==r;)await new Promise(n=>{setTimeout(()=>n(),1)})}};function xd(t){return typeof t.oidcIssuer=="string"}function Ad(t){return typeof t.redirectUrl=="string"}var Mu=class{constructor(e,r,n,i){this.storageUtility=e,this.oidcHandler=r,this.issuerConfigFetcher=n,this.clientRegistrar=i,this.storageUtility=e,this.oidcHandler=r,this.issuerConfigFetcher=n,this.clientRegistrar=i}async canHandle(e){return xd(e)&&Ad(e)}async handle(e){if(!xd(e))throw new vn(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!Ad(e))throw new vn(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);let r=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),n=await fd(e,r,this.storageUtility,this.clientRegistrar),i={issuer:r.issuer,dpop:e.tokenType.toLowerCase()==="dpop",...e,issuerConfiguration:r,client:n};return this.oidcHandler.handle(i)}},Hu=class extends Qo{async handle(e){var r;let n={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl,response_type:"code",scope:rs,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(r=e.prompt)!==null&&r!==void 0?r:"consent"},i=new sr.OidcClient(n);try{let a=await i.createSigninRequest();return await this.handleRedirect({oidcLoginOptions:e,state:a.state._id,codeVerifier:a.state._code_verifier,targetUrl:a.url.toString()})}catch(a){console.error(a)}}},i_=".well-known/openid-configuration",Id={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function o_(t){let e={};return Object.keys(t).forEach(r=>{Id[r]&&(e[Id[r].toKey]=t[r])}),Array.isArray(e.scopesSupported)||(e.scopesSupported=["openid"]),e}var Vu=class t{constructor(e){this.storageUtility=e,this.storageUtility=e}static getLocalStorageKey(e){return`issuerConfig:${e}`}async fetchConfig(e){let r,n=new URL(i_,e.endsWith("/")?e:`${e}/`).href,i=await fetch(n);try{r=o_(await i.json())}catch(a){throw new vn(`[${e.toString()}] has an invalid configuration: ${a.message}`)}return await this.storageUtility.set(t.getLocalStorageKey(e),JSON.stringify(r)),r}};async function s_(t,e){await Nu(t,e),await Ed()}var Ku=class extends Zo{async get(e){let[r,n,i,a,u,l,d,f]=await Promise.all([this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(e,"webId",{secure:!0}),this.storageUtility.getForUser(e,"clientId",{secure:!1}),this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),this.storageUtility.getForUser(e,"issuer",{secure:!1}),this.storageUtility.getForUser(e,"tokenType",{secure:!1})]);if(typeof u=="string"&&!Fu(u)){await Promise.all([this.storageUtility.deleteAllUserData(e,{secure:!1}),this.storageUtility.deleteAllUserData(e,{secure:!0})]);return}if(f!==void 0&&!ad(f))throw new Error(`Tokens of type [${f}] are not supported.`);if(!(i===void 0&&r===void 0&&n===void 0&&l===void 0))return{sessionId:e,webId:n,isLoggedIn:r==="true",redirectUrl:u,refreshToken:l,issuer:d,clientAppId:i,clientAppSecret:a,tokenType:f??"DPoP"}}async clear(e){return s_(e,this.storageUtility)}},qu=class{async canHandle(e){try{return new URL(e),!0}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e){return Pu()}},$u=class{constructor(e,r,n,i,a){this.storageUtility=e,this.sessionInfoManager=r,this.issuerConfigFetcher=n,this.clientRegistrar=i,this.tokerRefresher=a,this.storageUtility=e,this.sessionInfoManager=r,this.issuerConfigFetcher=n,this.clientRegistrar=i,this.tokerRefresher=a}async canHandle(e){try{let r=new URL(e);return r.searchParams.get("code")!==null&&r.searchParams.get("state")!==null}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e,r){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);let n=new URL(e),i=n.searchParams.get("state"),a=await this.storageUtility.getForUser(i,"sessionId",{errorIfNull:!0}),{issuerConfig:u,codeVerifier:l,redirectUrl:d,dpop:f}=await ku(a,this.storageUtility,this.issuerConfigFetcher),g=n.searchParams.get("iss");if(typeof g=="string"&&g!==u.issuer)throw new Error(`The value of the iss parameter (${g}) does not match the issuer identifier of the authorization server (${u.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(l===void 0)throw new Error(`The code verifier for session ${a} is missing from storage.`);if(d===void 0)throw new Error(`The redirect URL for session ${a} is missing from storage.`);let _=await this.clientRegistrar.getClient({sessionId:a},u),w=Date.now(),E=await bd(u,_,{grantType:"authorization_code",code:n.searchParams.get("code"),codeVerifier:l,redirectUrl:d},f);window.localStorage.removeItem(`oidc.${i}`);let x;E.refreshToken!==void 0&&(x={sessionId:a,refreshToken:E.refreshToken,tokenRefresher:this.tokerRefresher});let A=await gd(E.accessToken,{dpopKey:E.dpopKey,refreshOptions:x,eventEmitter:r,expiresIn:E.expiresIn});await dd(this.storageUtility,a,E.webId,E.clientId,"true",void 0,!0);let I=await this.sessionInfoManager.get(a);if(!I)throw new Error(`Could not retrieve session: [${a}].`);return Object.assign(I,{fetch:A,getLogoutUrl:sd({idTokenHint:E.idToken,endSessionEndpoint:u.endSessionEndpoint}),expirationDate:typeof E.expiresIn=="number"?w+E.expiresIn*1e3:void 0})}},Wu=class extends Yo{constructor(e){super(e)}},Ju=class{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,r){this.storage.setItem(e,r)}async delete(e){this.storage.removeItem(e)}},Gu=class{redirect(e,r){r&&r.handleRedirect?r.handleRedirect(e):r&&r.redirectByReplacingState?window.history.replaceState({},"",e):window.location.href=e}},zu=class{constructor(e){this.storageUtility=e,this.storageUtility=e}async getClient(e,r){let[n,i,a,u]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientType",{secure:!1})]);if(n&&ld(u))return{clientId:n,clientSecret:i,clientName:a,clientType:u};try{let l=await _d(e,r),d={clientId:l.clientId,clientType:"dynamic"};return l.clientSecret&&(d.clientSecret=l.clientSecret),l.idTokenSignedResponseAlg&&(d.idTokenSignedResponseAlg=l.idTokenSignedResponseAlg),await this.storageUtility.setForUser(e.sessionId,d,{secure:!1}),l}catch(l){throw new Error(`Client registration failed: [${l}]`)}}},Yu=class{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e,r){if(r!==void 0){let n=new URL(e),i=n.searchParams.get("error"),a=n.searchParams.get("error_description");r.emit(it.ERROR,i,a)}return Pu()}},Qu=class{constructor(e,r,n){this.storageUtility=e,this.issuerConfigFetcher=r,this.clientRegistrar=n,this.storageUtility=e,this.issuerConfigFetcher=r,this.clientRegistrar=n}async refresh(e,r,n,i){let a=await ku(e,this.storageUtility,this.issuerConfigFetcher),u=await this.clientRegistrar.getClient({sessionId:e},a.issuerConfig);if(r===void 0)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(a.dpop&&n===void 0)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);let l=await vd(r,a.issuerConfig,u,n);return l.refreshToken!==void 0&&i?.emit(it.NEW_REFRESH_TOKEN,l.refreshToken),l}};function Td(t){let e=new Gi,r=t.secureStorage||e,n=t.insecureStorage||new Ju,i=new ju(r,n),a=new Vu(i),u=new zu(i),l=new Ku(i),d=new Qu(i,a,u),f=new Gu,g=new Mu(i,new Hu(i,f),a,u),_=new Wu([new Yu,new $u(i,l,a,u,d),new qu]);return new Bu(g,_,new Xo(l,f),l,a)}var Lu=`${Ru}currentSession`,Xu=`${Ru}currentUrl`;async function a_(t,e,r){var n;let i=await e.validateCurrentSession(t);return i!==null?(window.localStorage.setItem(Xu,window.location.href),await e.login({sessionId:t,prompt:"none",oidcIssuer:i.issuer,redirectUrl:i.redirectUrl,clientId:i.clientAppId,clientSecret:i.clientAppSecret,tokenType:(n=i.tokenType)!==null&&n!==void 0?n:"DPoP"},r.events),!0):!1}function u_(t){return!!t?.isLoggedIn}var Zu=class{constructor(e={},r=void 0){this.tokenRequestInProgress=!1,this.login=async n=>{var i;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...n,tokenType:(i=n.tokenType)!==null&&i!==void 0?i:"DPoP"},this.events),new Promise(()=>{})},this.fetch=(n,i)=>this.clientAuthentication.fetch(n,i),this.internalLogout=async(n,i)=>{window.localStorage.removeItem(Lu),await this.clientAuthentication.logout(this.info.sessionId,i),this.info.isLoggedIn=!1,n&&this.events.emit(it.LOGOUT)},this.logout=async n=>this.internalLogout(!0,n),this.handleIncomingRedirect=async(n={})=>{var i;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;let a=typeof n=="string"?{url:n}:n,u=(i=a.url)!==null&&i!==void 0?i:window.location.href;this.tokenRequestInProgress=!0;let l=await this.clientAuthentication.handleIncomingRedirect(u,this.events);if(u_(l)){this.setSessionInfo(l);let d=window.localStorage.getItem(Xu);d===null?this.events.emit(it.LOGIN):(window.localStorage.removeItem(Xu),this.events.emit(it.SESSION_RESTORED,d))}else if(a.restorePreviousSession===!0){let d=window.localStorage.getItem(Lu);if(d!==null&&await a_(d,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,l},this.events=new Sn,e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=Td({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=Td({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId,clientAppId:e.sessionInfo.clientAppId}:this.info={sessionId:r??si(),isLoggedIn:!1},this.events.on(it.LOGIN,()=>window.localStorage.setItem(Lu,this.info.sessionId)),this.events.on(it.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(it.ERROR,()=>this.internalLogout(!1))}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.clientAppId=e.clientAppId,this.info.expirationDate=e.expirationDate,this.events.on(it.SESSION_EXTENDED,r=>{this.info.expirationDate=Date.now()+r*1e3})}},Uu;function Zr(){return typeof Uu>"u"&&(Uu=new Zu),Uu}var ui=(...t)=>Zr().fetch(...t),Rd=(...t)=>Zr().login(...t);var Cd=(...t)=>Zr().handleIncomingRedirect(...t);N();O();k();N();O();k();ir();var Od=gn(Nd());N();O();k();var Xi="http://www.w3.org/1999/02/22-rdf-syntax-ns#",Zi="http://www.w3.org/2001/XMLSchema#",ec="http://www.w3.org/2000/10/swap/",dt={xsd:{decimal:`${Zi}decimal`,boolean:`${Zi}boolean`,double:`${Zi}double`,integer:`${Zi}integer`,string:`${Zi}string`},rdf:{type:`${Xi}type`,nil:`${Xi}nil`,first:`${Xi}first`,rest:`${Xi}rest`,langString:`${Xi}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${ec}reify#forSome`,forAll:`${ec}reify#forAll`},log:{implies:`${ec}log#implies`}};var{xsd:as}=dt,c_=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,kd={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},l_=/[\x00-\x20<>\\"\{\}\|\^\`]/,f_={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},d_=/$0^/,eo=class{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(let r in this)!(r in f_)&&this[r]instanceof RegExp&&(this[r]=d_)}else this._n3Mode=e.n3!==!1;this.comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,r){let n=this._input,i=n.length;for(;;){let l,d;for(;l=this._newline.exec(n);)this.comments&&(d=this._comment.exec(l[0]))&&a("comment",d[1],"",this._line,l[0].length),n=n.substr(l[0].length,n.length),i=n.length,this._line++;if(!l&&(l=this._whitespace.exec(n))&&(n=n.substr(l[0].length,n.length)),this._endOfFile.test(n))return r&&(this.comments&&(d=this._comment.exec(n))&&a("comment",d[1],"",this._line,n.length),n=null,a("eof","","",this._line,0)),this._input=n;let f=this._line,g=n[0],_="",w="",E="",x=null,A=0,I=!1;switch(g){case"^":if(n.length<3)break;if(n[1]==="^"){if(this._previousMarker="^^",n=n.substr(2),n[0]!=="<"){I=!0;break}}else{this._n3Mode&&(A=1,_="^");break}case"<":if(x=this._unescapedIri.exec(n))_="IRI",w=x[1];else if(x=this._iri.exec(n)){if(w=this._unescape(x[1]),w===null||l_.test(w))return u(this);_="IRI"}else n.length>1&&n[1]==="<"?(_="<<",A=2):this._n3Mode&&n.length>1&&n[1]==="="&&(_="inverse",A=2,w=">");break;case">":n.length>1&&n[1]===">"&&(_=">>",A=2);break;case"_":((x=this._blank.exec(n))||r&&(x=this._blank.exec(`${n} `)))&&(_="blank",E="_",w=x[1]);break;case'"':if(x=this._simpleQuotedString.exec(n))w=x[1];else if({value:w,matchLength:A}=this._parseLiteral(n),w===null)return u(this);(x!==null||A!==0)&&(_="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(x=this._simpleApostropheString.exec(n))w=x[1];else if({value:w,matchLength:A}=this._parseLiteral(n),w===null)return u(this);(x!==null||A!==0)&&(_="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(x=this._variable.exec(n))&&(_="var",w=x[0]);break;case"@":this._previousMarker==="literal"&&(x=this._langcode.exec(n))?(_="langcode",w=x[1]):(x=this._keyword.exec(n))&&(_=x[0]);break;case".":if(n.length===1?r:n[1]<"0"||n[1]>"9"){_=".",A=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(x=this._number.exec(n)||r&&(x=this._number.exec(`${n} `)))&&(_="literal",w=x[0],E=typeof x[1]=="string"?as.double:typeof x[2]=="string"?as.decimal:as.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(x=this._sparqlKeyword.exec(n))?_=x[0].toUpperCase():I=!0;break;case"f":case"t":(x=this._boolean.exec(n))?(_="literal",w=x[0],E=as.boolean):I=!0;break;case"a":(x=this._shortPredicates.exec(n))?(_="abbreviation",w="a"):I=!0;break;case"=":this._n3Mode&&n.length>1&&(_="abbreviation",n[1]!==">"?(A=1,w="="):(A=2,w=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(A=1,_=g);break;case"{":!this._lineMode&&n.length>=2&&(n[1]==="|"?(_="{|",A=2):(_=g,A=1));break;case"|":n.length>=2&&n[1]==="}"&&(_="|}",A=2);break;default:I=!0}if(I&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(x=this._prefix.exec(n))?(_="prefix",w=x[1]||""):((x=this._prefixed.exec(n))||r&&(x=this._prefixed.exec(`${n} `)))&&(_="prefixed",E=x[1]||"",w=this._unescape(x[2]))),this._previousMarker==="^^")switch(_){case"prefixed":_="type";break;case"IRI":_="typeIRI";break;default:_=""}if(!_)return r||!/^'''|^"""/.test(n)&&/\n|\r/.test(n)?u(this):this._input=n;let D=A||x[0].length,U=a(_,w,E,f,D);this.previousToken=U,this._previousMarker=_,n=n.substr(D,n.length)}function a(l,d,f,g,_){let w=n?i-n.length:i,E=w+_,x={type:l,value:d,prefix:f,line:g,start:w,end:E};return e(null,x),x}function u(l){e(l._syntaxError(/^\S*/.exec(n)[0]))}}_unescape(e){let r=!1,n=e.replace(c_,(i,a,u,l)=>{if(typeof a=="string")return String.fromCharCode(Number.parseInt(a,16));if(typeof u=="string"){let d=Number.parseInt(u,16);return d<=65535?String.fromCharCode(Number.parseInt(u,16)):String.fromCharCode(55296+((d-=65536)>>10),56320+(d&1023))}return l in kd?kd[l]:(r=!0,"")});return r?null:n}_parseLiteral(e){if(e.length>=3){let r=e.match(/^(?:"""|"|'''|'|)/)[0],n=r.length,i=Math.max(this._literalClosingPos,n);for(;(i=e.indexOf(r,i))>0;){let a=0;for(;e[i-a-1]==="\\";)a++;if(a%2===0){let u=e.substring(n,i),l=u.split(/\r\n|\r|\n/).length-1,d=i+n;if(n===1&&l!==0||n===3&&this._lineMode)break;return this._line+=l,{value:this._unescape(u),matchLength:d}}i++}this._literalClosingPos=e.length-n+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;let r=new Error(`Unexpected "${e}" on line ${this._line}.`);return r.context={token:void 0,line:this._line,previousToken:this.previousToken},r}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,r){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof r=="function")(0,Od.default)(()=>this._tokenizeToEnd(r,!0));else{let n=[],i;if(this._tokenizeToEnd((a,u)=>a?i=a:n.push(u),!0),i)throw i;return n}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",n=>{this._input!==null&&n.length!==0&&(this._pendingBuffer&&(n=ie.concat([this._pendingBuffer,n]),this._pendingBuffer=null),n[n.length-1]&128?this._pendingBuffer=n:(typeof this._input>"u"?this._input=this._readStartingBom(typeof n=="string"?n:n.toString()):this._input+=n,this._tokenizeToEnd(r,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(r,!0)}),e.on("error",r)}};N();O();k();N();O();k();var{rdf:h_,xsd:En}=dt,li,p_=0;var tc={namedNode:Dd,blankNode:Ld,variable:jd,literal:Ud,defaultGraph:g_,quad:rc,triple:rc,fromTerm:to,fromQuad:Bd},ar=tc,Qt=class t{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof t?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}},In=class extends Qt{get termType(){return"NamedNode"}},An=class t extends Qt{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){let e=this.id,r=e.lastIndexOf('"')+1;return r<e.length&&e[r++]==="@"?e.substr(r).toLowerCase():""}get datatype(){return new In(this.datatypeString)}get datatypeString(){let e=this.id,r=e.lastIndexOf('"')+1,n=r<e.length?e[r]:"";return n==="^"?e.substr(r+2):n!=="@"?En.string:h_.langString}equals(e){return e instanceof t?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}},us=class extends Qt{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}},cs=class extends Qt{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}},ls=class extends Qt{constructor(){return super(""),li||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}};li=new ls;function xn(t,e,r){if(e=e||tc,!t)return e.defaultGraph();switch(t[0]){case"?":return e.variable(t.substr(1));case"_":return e.blankNode(t.substr(2));case'"':if(e===tc)return new An(t);if(t[t.length-1]==='"')return e.literal(t.substr(1,t.length-2));let n=t.lastIndexOf('"',t.length-1);return e.literal(t.substr(1,n-1),t[n+1]==="@"?t.substr(n+2):e.namedNode(t.substr(n+3)));case"[":t=JSON.parse(t);break;default:if(!r||!Array.isArray(t))return e.namedNode(t)}return e.quad(xn(t[0],e,!0),xn(t[1],e,!0),xn(t[2],e,!0),t[3]&&xn(t[3],e,!0))}function en(t,e){if(typeof t=="string")return t;if(t instanceof Qt&&t.termType!=="Quad")return t.id;if(!t)return li.id;switch(t.termType){case"NamedNode":return t.value;case"BlankNode":return`_:${t.value}`;case"Variable":return`?${t.value}`;case"DefaultGraph":return"";case"Literal":return`"${t.value}"${t.language?`@${t.language}`:t.datatype&&t.datatype.value!==En.string?`^^${t.datatype.value}`:""}`;case"Quad":let r=[en(t.subject,!0),en(t.predicate,!0),en(t.object,!0)];return t.graph&&t.graph.termType!=="DefaultGraph"&&r.push(en(t.graph,!0)),e?r:JSON.stringify(r);default:throw new Error(`Unexpected termType: ${t.termType}`)}}var ci=class extends Qt{constructor(e,r,n,i){super(""),this._subject=e,this._predicate=r,this._object=n,this._graph=i||li}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}};function Dd(t){return new In(t)}function Ld(t){return new us(t||`n3-${p_++}`)}function Ud(t,e){if(typeof e=="string")return new An(`"${t}"@${e.toLowerCase()}`);let r=e?e.value:"";return r===""&&(typeof t=="boolean"?r=En.boolean:typeof t=="number"&&(Number.isFinite(t)?r=Number.isInteger(t)?En.integer:En.double:(r=En.double,Number.isNaN(t)||(t=t>0?"INF":"-INF")))),r===""||r===En.string?new An(`"${t}"`):new An(`"${t}"^^${r}`)}function jd(t){return new cs(t)}function g_(){return li}function rc(t,e,r,n){return new ci(t,e,r,n)}function to(t){if(t instanceof Qt)return t;switch(t.termType){case"NamedNode":return Dd(t.value);case"BlankNode":return Ld(t.value);case"Variable":return jd(t.value);case"DefaultGraph":return li;case"Literal":return Ud(t.value,t.language||t.datatype);case"Quad":return Bd(t);default:throw new Error(`Unexpected termType: ${t.termType}`)}}function Bd(t){if(t instanceof ci)return t;if(t.termType!=="Quad")throw new Error(`Unexpected termType: ${t.termType}`);return rc(to(t.subject),to(t.predicate),to(t.object),to(t.graph))}var Md=0,Hr=class{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&Hd(this,e.factory);let r=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",n=/turtle/.test(r),i=/trig/.test(r),a=/triple/.test(r),u=/quad/.test(r),l=this._n3Mode=/n3/.test(r),d=a||u;(this._supportsNamedGraphs=!(n||l))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(n||i||a||l),this._supportsRDFStar=r===""||/star|\*$/.test(r),d&&(this._resolveRelativeIRI=f=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new eo({lineMode:d,n3:l}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){Md=0}_setBase(e){if(!e)this._base="",this._basePath="";else{let r=e.indexOf("#");r>=0&&(e=e.substr(0,r)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,r,n,i,a){let u=this._n3Mode;this._contextStack.push({type:e,subject:n,predicate:i,object:a,graph:r,inverse:u?this._inversePredicate:!1,blankPrefix:u?this._prefixes._:"",quantified:u?this._quantified:null}),u&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,r){let n=this._contextStack.pop();if(!n||n.type!==e)return this._error(`Unexpected ${r.type}`,r);this._subject=n.subject,this._predicate=n.predicate,this._object=n.object,this._graph=n.graph,this._n3Mode&&(this._inversePredicate=n.inverse,this._prefixes._=n.blankPrefix,this._quantified=n.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,r){let n;switch(e.type){case"IRI":case"typeIRI":let i=this._resolveIRI(e.value);if(i===null)return this._error("Invalid IRI",e);n=this._factory.namedNode(i);break;case"type":case"prefixed":let a=this._prefixes[e.prefix];if(a===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);n=this._factory.namedNode(a+e.value);break;case"blank":n=this._factory.blankNode(this._prefixes[e.prefix]+e.value);break;case"var":n=this._factory.variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!r&&this._n3Mode&&n.id in this._quantified&&(n=this._quantified[n.id]),n}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._factory.blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._factory.blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier="blankNode",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier="variable",this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){let r=e.type;switch(r){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${r}`,e):(this._subject=null,r==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._factory.blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._factory.blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);let r=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:r?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let r=null,n=null,i=this._readListItem,a=this._subject,u=this._contextStack,l=u[u.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,n=this._factory.blankNode(),this.RDF_FIRST,this._subject=r=this._factory.blankNode()),i=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,n=this._factory.blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),u.length!==0&&u[u.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(i=this._readPredicate,this._subject===this.RDF_NIL)return i}else if(i=this._getContextEndReader(),this._object===this.RDF_NIL)return i;n=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,i=this._readListItemDataTypeOrLang):(r=this._factory.literal(e.value,this._factory.namedNode(e.prefix)),i=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((r=this._readEntity(e))===void 0)return}if(n===null&&(this._subject=n=this._factory.blankNode()),a===null?l.predicate===null?l.subject=n:l.object=n:this._emit(a,this.RDF_REST,n,this._graph),r!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,n,this.RDF_FIRST,r),this._subject=r,this._predicate=null,this._getPathReader(this._readListItem);this._emit(n,this.RDF_FIRST,r,this._graph)}return i}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let r=this._factory.literal(this._literalValue);switch(e.type){case"type":case"typeIRI":let n=this._readEntity(e);if(n===void 0)return;r=this._factory.literal(this._literalValue,n),e=null;break;case"langcode":r=this._factory.literal(this._literalValue,e.value),e=null;break}return{token:e,literal:r}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,r){let n=this._completeLiteral(e);if(n)return this._object=n.literal,r&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),n.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(n.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let r,n=this._graph,i=this._subject,a=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,r=this._contextStack.length?this._readSubject:this._readInTopContext,a&&(this._inversePredicate=!1);break;case";":r=this._readPredicate;break;case",":r=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF-star syntax",e);let u=this._predicate,l=this._object;this._subject=this._factory.quad(i,u,l,this.DEFAULTGRAPH),r=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,r=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(n=this._readEntity(e))!==void 0){r=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(i!==null){let u=this._predicate,l=this._object;a?this._emit(l,u,i,n):this._emit(i,u,l,n)}return r}_readBlankNodePunctuation(e){let r;switch(e.type){case";":r=this._readPredicate;break;case",":r=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),r}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);let r=this._readEntity(e);return this._prefixes[this._prefix]=r.value,this._prefixCallback(this._prefix,r),this._readDeclarationPunctuation}_readBaseIRI(e){let r=e.type==="IRI"&&this._resolveIRI(e.value);return r?(this._setBase(r),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._factory.blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let r;switch(e.type){case"IRI":case"prefixed":if((r=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,r,this.QUANTIFIERS_GRAPH)):this._quantified[r.id]=this._factory[this._quantifier](this._factory.blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:let r=this._contextStack,n=r.length&&r[r.length-1];if(n&&n.type==="item"){let i=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,i,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let r,n,i=this._factory.blankNode();if((n=this._readEntity(e))!==void 0)return this._predicate===null?(r=this._subject,this._subject=i):(r=this._object,this._object=i),this._emit(r,n,i,this._graph),this._readPath}_readBackwardPath(e){let r=this._factory.blankNode(),n,i;if((n=this._readEntity(e))!==void 0)return this._predicate===null?(i=this._subject,this._subject=r):(i=this._object,this._object=r),this._emit(r,n,i,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);let r=this._factory.quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=r,this._readPredicate):(this._object=r,this._getContextEndReader())}_getContextEndReader(){let e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,r,n,i){this._callback(null,this._factory.quad(e,r,n,i||this.DEFAULTGRAPH))}_error(e,r){let n=new Error(`${e} on line ${r.line}.`);n.context={token:r,line:r.line,previousToken:this._lexer.previousToken},this._callback(n),this._callback=fs}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;let r=e.length,n="",i=-1,a=-1,u=0,l="/";for(;i<r;){switch(l){case":":if(a<0&&e[++i]==="/"&&e[++i]==="/")for(;(a=i+1)<r&&e[a]!=="/";)i=a;break;case"?":case"#":i=r;break;case"/":if(e[i+1]===".")switch(l=e[++i+1],l){case"/":n+=e.substring(u,i-1),u=i+1;break;case void 0:case"?":case"#":return n+e.substring(u,i)+e.substr(i+1);case".":if(l=e[++i+1],l===void 0||l==="/"||l==="?"||l==="#"){if(n+=e.substring(u,i-2),(u=n.lastIndexOf("/"))>=a&&(n=n.substr(0,u)),l!=="/")return`${n}/${e.substr(i+1)}`;u=i+1}}}l=e[++i]}return n+e.substring(u)}parse(e,r,n){let i,a,u;if(r&&(r.onQuad||r.onPrefix||r.onComment)?(i=r.onQuad,a=r.onPrefix,u=r.onComment):(i=r,a=n),this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${Md++}_`,this._prefixCallback=a||fs,this._inversePredicate=!1,this._quantified=Object.create(null),!i){let d=[],f;if(this._callback=(g,_)=>{g?f=g:_&&d.push(_)},this._lexer.tokenize(e).every(g=>this._readCallback=this._readCallback(g)),f)throw f;return d}let l=(d,f)=>{d!==null?(this._callback(d),this._callback=fs):this._readCallback&&(this._readCallback=this._readCallback(f))};u&&(this._lexer.comments=!0,l=(d,f)=>{d!==null?(this._callback(d),this._callback=fs):this._readCallback&&(f.type==="comment"?u(f.value):this._readCallback=this._readCallback(f))}),this._callback=i,this._lexer.tokenize(e,l)}};function fs(){}function Hd(t,e){t._factory=e,t.DEFAULTGRAPH=e.defaultGraph(),t.RDF_FIRST=e.namedNode(dt.rdf.first),t.RDF_REST=e.namedNode(dt.rdf.rest),t.RDF_NIL=e.namedNode(dt.rdf.nil),t.N3_FORALL=e.namedNode(dt.r.forAll),t.N3_FORSOME=e.namedNode(dt.r.forSome),t.ABBREVIATIONS={a:e.namedNode(dt.rdf.type),"=":e.namedNode(dt.owl.sameAs),">":e.namedNode(dt.log.implies)},t.QUANTIFIERS_GRAPH=e.namedNode("urn:n3:quantifiers")}Hd(Hr.prototype,ar);N();O();k();N();O();k();function ro(t){return!!t&&t.termType==="DefaultGraph"}var no=ar.defaultGraph(),{rdf:y_,xsd:fi}=dt,Vd=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,Kd=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,m_={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"},Tn=class extends Qt{equals(e){return e===this}},Ar=class{constructor(e,r){if(this._prefixRegex=/$0^/,e&&typeof e.write!="function"&&(r=e,e=null),r=r||{},this._lists=r.lists,e)this._outputStream=e,this._endStream=r.end===void 0?!0:!!r.end;else{let n="";this._outputStream={write(i,a,u){n+=i,u&&u()},end:i=>{i&&i(null,n)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(r.format)?(this._lineMode=!0,this._writeQuad=this._writeQuadLine):(this._lineMode=!1,this._graph=no,this._prefixIRIs=Object.create(null),r.prefixes&&this.addPrefixes(r.prefixes),r.baseIRI&&(this._baseMatcher=new RegExp(`^${$d(r.baseIRI)}${r.baseIRI.endsWith("/")?"":"[#?]"}`),this._baseLength=r.baseIRI.length))}get _inDefaultGraph(){return no.equals(this._graph)}_write(e,r){this._outputStream.write(e,"utf8",r)}_writeQuad(e,r,n,i,a){try{i.equals(this._graph)||(this._write((this._subject===null?"":this._inDefaultGraph?`.
`:`
}
`)+(no.equals(i)?"":`${this._encodeIriOrBlank(i)} {
`)),this._graph=i,this._subject=null),e.equals(this._subject)?r.equals(this._predicate)?this._write(`, ${this._encodeObject(n)}`,a):this._write(`;
    ${this._encodePredicate(this._predicate=r)} ${this._encodeObject(n)}`,a):this._write(`${(this._subject===null?"":`.
`)+this._encodeSubject(this._subject=e)} ${this._encodePredicate(this._predicate=r)} ${this._encodeObject(n)}`,a)}catch(u){a&&a(u)}}_writeQuadLine(e,r,n,i,a){delete this._prefixMatch,this._write(this.quadToString(e,r,n,i),a)}quadToString(e,r,n,i){return`${this._encodeSubject(e)} ${this._encodeIriOrBlank(r)} ${this._encodeObject(n)}${i&&i.value?` ${this._encodeIriOrBlank(i)} .
`:` .
`}`}quadsToString(e){let r="";for(let n of e)r+=this.quadToString(n.subject,n.predicate,n.object,n.graph);return r}_encodeSubject(e){return e.termType==="Quad"?this._encodeQuad(e):this._encodeIriOrBlank(e)}_encodeIriOrBlank(e){if(e.termType!=="NamedNode")return this._lists&&e.value in this._lists&&(e=this.list(this._lists[e.value])),"id"in e?e.id:`_:${e.value}`;let r=e.value;this._baseMatcher&&this._baseMatcher.test(r)&&(r=r.substr(this._baseLength)),Vd.test(r)&&(r=r.replace(Kd,qd));let n=this._prefixRegex.exec(r);return n?n[1]?this._prefixIRIs[n[1]]+n[2]:r:`<${r}>`}_encodeLiteral(e){let r=e.value;if(Vd.test(r)&&(r=r.replace(Kd,qd)),e.language)return`"${r}"@${e.language}`;if(this._lineMode){if(e.datatype.value===fi.string)return`"${r}"`}else switch(e.datatype.value){case fi.string:return`"${r}"`;case fi.boolean:if(r==="true"||r==="false")return r;break;case fi.integer:if(/^[+-]?\d+$/.test(r))return r;break;case fi.decimal:if(/^[+-]?\d*\.\d+$/.test(r))return r;break;case fi.double:if(/^[+-]?(?:\d+\.\d*|\.?\d+)[eE][+-]?\d+$/.test(r))return r;break}return`"${r}"^^${this._encodeIriOrBlank(e.datatype)}`}_encodePredicate(e){return e.value===y_.type?"a":this._encodeIriOrBlank(e)}_encodeObject(e){switch(e.termType){case"Quad":return this._encodeQuad(e);case"Literal":return this._encodeLiteral(e);default:return this._encodeIriOrBlank(e)}}_encodeQuad({subject:e,predicate:r,object:n,graph:i}){return`<<${this._encodeSubject(e)} ${this._encodePredicate(r)} ${this._encodeObject(n)}${ro(i)?"":` ${this._encodeIriOrBlank(i)}`}>>`}_blockedWrite(){throw new Error("Cannot write because the writer has been closed.")}addQuad(e,r,n,i,a){n===void 0?this._writeQuad(e.subject,e.predicate,e.object,e.graph,r):typeof i=="function"?this._writeQuad(e,r,n,no,i):this._writeQuad(e,r,n,i||no,a)}addQuads(e){for(let r=0;r<e.length;r++)this.addQuad(e[r])}addPrefix(e,r,n){let i={};i[e]=r,this.addPrefixes(i,n)}addPrefixes(e,r){if(!this._prefixIRIs)return r&&r();let n=!1;for(let i in e){let a=e[i];typeof a!="string"&&(a=a.value),n=!0,this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null,this._graph=""),this._prefixIRIs[a]=i+=":",this._write(`@prefix ${i} <${a}>.
`)}if(n){let i="",a="";for(let u in this._prefixIRIs)i+=i?`|${u}`:u,a+=(a?"|":"")+this._prefixIRIs[u];i=$d(i,/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp(`^(?:${a})[^/]*$|^(${i})([_a-zA-Z0-9][\\-_a-zA-Z0-9]*)$`)}this._write(n?`
`:"",r)}blank(e,r){let n=e,i,a;switch(e===void 0?n=[]:e.termType?n=[{predicate:e,object:r}]:"length"in e||(n=[e]),a=n.length){case 0:return new Tn("[]");case 1:if(i=n[0],!(i.object instanceof Tn))return new Tn(`[ ${this._encodePredicate(i.predicate)} ${this._encodeObject(i.object)} ]`);default:let u="[";for(let l=0;l<a;l++)i=n[l],i.predicate.equals(e)?u+=`, ${this._encodeObject(i.object)}`:(u+=`${(l?`;
  `:`
  `)+this._encodePredicate(i.predicate)} ${this._encodeObject(i.object)}`,e=i.predicate);return new Tn(`${u}
]`)}}list(e){let r=e&&e.length||0,n=new Array(r);for(let i=0;i<r;i++)n[i]=this._encodeObject(e[i]);return new Tn(`(${n.join(" ")})`)}end(e){this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null),this._write=this._blockedWrite;let r=e&&((n,i)=>{r=null,e(n,i)});if(this._endStream)try{return this._outputStream.end(r)}catch{}r&&r()}};function qd(t){let e=m_[t];return e===void 0&&(t.length===1?(e=t.charCodeAt(0).toString(16),e="\\u0000".substr(0,6-e.length)+e):(e=((t.charCodeAt(0)-55296)*1024+t.charCodeAt(1)+9216).toString(16),e="\\U00000000".substr(0,10-e.length)+e)),e}function $d(t){return t.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&")}N();O();k();var wl=gn(ml());var _l=Symbol("iter");function mo(t,e,r=4){if(r===0)return Object.assign(t,e);for(let n in e)t[n]=mo(t[n]||Object.create(null),e[n],r-1);return t}function $g(t,e,r=4){let n=!1;for(let i in t)if(i in e){let a=r===0?null:$g(t[i],e[i],r-1);if(a!==!1)n=n||Object.create(null),n[i]=a;else if(r===3)return!1}return n}function Wg(t,e,r=4){let n=!1;for(let i in t)if(!(i in e))n=n||Object.create(null),n[i]=r===0?null:mo({},t[i],r-1);else if(r!==0){let a=Wg(t[i],e[i],r-1);if(a!==!1)n=n||Object.create(null),n[i]=a;else if(r===3)return!1}return n}var qs=class{constructor(e={}){this._id=1,this._ids=Object.create(null),this._ids[""]=1,this._entities=Object.create(null),this._entities[1]="",this._blankNodeIndex=0,this._factory=e.factory||ar}_termFromId(e){if(e[0]==="."){let r=this._entities,n=e.split(".");return this._factory.quad(this._termFromId(r[n[1]]),this._termFromId(r[n[2]]),this._termFromId(r[n[3]]),n[4]&&this._termFromId(r[n[4]]))}return xn(e,this._factory)}_termToNumericId(e){if(e.termType==="Quad"){let r=this._termToNumericId(e.subject),n=this._termToNumericId(e.predicate),i=this._termToNumericId(e.object),a;return r&&n&&i&&(ro(e.graph)||(a=this._termToNumericId(e.graph)))&&this._ids[a?`.${r}.${n}.${i}.${a}`:`.${r}.${n}.${i}`]}return this._ids[en(e)]}_termToNewNumericId(e){let r=e&&e.termType==="Quad"?`.${this._termToNewNumericId(e.subject)}.${this._termToNewNumericId(e.predicate)}.${this._termToNewNumericId(e.object)}${ro(e.graph)?"":`.${this._termToNewNumericId(e.graph)}`}`:en(e);return this._ids[r]||(this._ids[this._entities[++this._id]=r]=this._id)}createBlankNode(e){let r,n;if(e)for(r=e=`_:${e}`,n=1;this._ids[r];)r=e+n++;else do r=`_:b${this._blankNodeIndex++}`;while(this._ids[r]);return this._ids[r]=++this._id,this._entities[this._id]=r,this._factory.blankNode(r.substr(2))}},Mn=class t{constructor(e,r){this._size=0,this._graphs=Object.create(null),!r&&e&&!e[0]&&(r=e,e=null),r=r||{},this._factory=r.factory||ar,this._entityIndex=r.entityIndex||new qs({factory:this._factory}),this._entities=this._entityIndex._entities,this._termFromId=this._entityIndex._termFromId.bind(this._entityIndex),this._termToNumericId=this._entityIndex._termToNumericId.bind(this._entityIndex),this._termToNewNumericId=this._entityIndex._termToNewNumericId.bind(this._entityIndex),e&&this.addQuads(e)}get size(){let e=this._size;if(e!==null)return e;e=0;let r=this._graphs,n,i;for(let a in r)for(let u in n=r[a].subjects)for(let l in i=n[u])e+=Object.keys(i[l]).length;return this._size=e}_addToIndex(e,r,n,i){let a=e[r]||(e[r]={}),u=a[n]||(a[n]={}),l=i in u;return l||(u[i]=null),!l}_removeFromIndex(e,r,n,i){let a=e[r],u=a[n];delete u[i];for(let l in u)return;delete a[n];for(let l in a)return;delete e[r]}*_findInIndex(e,r,n,i,a,u,l,d){let f,g,_,w=this._entities,E=this._termFromId(w[d]),x={subject:null,predicate:null,object:null};r&&((f=e,e={})[r]=f[r]);for(let A in e)if(g=e[A]){x[a]=this._termFromId(w[A]),n&&((f=g,g={})[n]=f[n]);for(let I in g)if(_=g[I]){x[u]=this._termFromId(w[I]);let D=i?i in _?[i]:[]:Object.keys(_);for(let U=0;U<D.length;U++)x[l]=this._termFromId(w[D[U]]),yield this._factory.quad(x.subject,x.predicate,x.object,E)}}}_loop(e,r){for(let n in e)r(n)}_loopByKey0(e,r,n){let i,a;if(i=e[r])for(a in i)n(a)}_loopByKey1(e,r,n){let i,a;for(i in e)a=e[i],a[r]&&n(i)}_loopBy2Keys(e,r,n,i){let a,u,l;if((a=e[r])&&(u=a[n]))for(l in u)i(l)}_countInIndex(e,r,n,i){let a=0,u,l,d;r&&((u=e,e={})[r]=u[r]);for(let f in e)if(l=e[f]){n&&((u=l,l={})[n]=u[n]);for(let g in l)(d=l[g])&&(i?i in d&&a++:a+=Object.keys(d).length)}return a}_getGraphs(e){return e=e===""?1:e&&(this._termToNumericId(e)||-1),typeof e!="number"?this._graphs:{[e]:this._graphs[e]}}_uniqueEntities(e){let r=Object.create(null);return n=>{n in r||(r[n]=!0,e(this._termFromId(this._entities[n],this._factory)))}}add(e){return this.addQuad(e),this}addQuad(e,r,n,i){r||(i=e.graph,n=e.object,r=e.predicate,e=e.subject),i=i?this._termToNewNumericId(i):1;let a=this._graphs[i];return a||(a=this._graphs[i]={subjects:{},predicates:{},objects:{}},Object.freeze(a)),e=this._termToNewNumericId(e),r=this._termToNewNumericId(r),n=this._termToNewNumericId(n),this._addToIndex(a.subjects,e,r,n)?(this._addToIndex(a.predicates,r,n,e),this._addToIndex(a.objects,n,e,r),this._size=null,!0):!1}addQuads(e){for(let r=0;r<e.length;r++)this.addQuad(e[r])}delete(e){return this.removeQuad(e),this}has(e,r,n,i){return e&&e.subject&&({subject:e,predicate:r,object:n,graph:i}=e),!this.readQuads(e,r,n,i).next().done}import(e){return e.on("data",r=>{this.addQuad(r)}),e}removeQuad(e,r,n,i){r||({subject:e,predicate:r,object:n,graph:i}=e),i=i?this._termToNumericId(i):1;let a=this._graphs,u,l,d;if(!(e=e&&this._termToNumericId(e))||!(r=r&&this._termToNumericId(r))||!(n=n&&this._termToNumericId(n))||!(u=a[i])||!(l=u.subjects[e])||!(d=l[r])||!(n in d))return!1;this._removeFromIndex(u.subjects,e,r,n),this._removeFromIndex(u.predicates,r,n,e),this._removeFromIndex(u.objects,n,e,r),this._size!==null&&this._size--;for(e in u.subjects)return!0;return delete a[i],!0}removeQuads(e){for(let r=0;r<e.length;r++)this.removeQuad(e[r])}remove(e){return e.on("data",r=>{this.removeQuad(r)}),e}removeMatches(e,r,n,i){let a=new wl.Readable({objectMode:!0}),u=this.readQuads(e,r,n,i);return a._read=l=>{for(;--l>=0;){let{done:d,value:f}=u.next();if(d){a.push(null);return}a.push(f)}},this.remove(a)}deleteGraph(e){return this.removeMatches(null,null,null,e)}getQuads(e,r,n,i){return[...this.readQuads(e,r,n,i)]}*readQuads(e,r,n,i){let a=this._getGraphs(i),u,l,d,f;if(!(e&&!(l=this._termToNumericId(e))||r&&!(d=this._termToNumericId(r))||n&&!(f=this._termToNumericId(n))))for(let g in a)(u=a[g])&&(l?f?yield*this._findInIndex(u.objects,f,l,d,"object","subject","predicate",g):yield*this._findInIndex(u.subjects,l,d,null,"subject","predicate","object",g):d?yield*this._findInIndex(u.predicates,d,f,null,"predicate","object","subject",g):f?yield*this._findInIndex(u.objects,f,null,null,"object","subject","predicate",g):yield*this._findInIndex(u.subjects,null,null,null,"subject","predicate","object",g))}match(e,r,n,i){return new sn(this,e,r,n,i,{entityIndex:this._entityIndex})}countQuads(e,r,n,i){let a=this._getGraphs(i),u=0,l,d,f,g;if(e&&!(d=this._termToNumericId(e))||r&&!(f=this._termToNumericId(r))||n&&!(g=this._termToNumericId(n)))return 0;for(let _ in a)(l=a[_])&&(e?n?u+=this._countInIndex(l.objects,g,d,f):u+=this._countInIndex(l.subjects,d,f,g):r?u+=this._countInIndex(l.predicates,f,g,d):u+=this._countInIndex(l.objects,g,d,f));return u}forEach(e,r,n,i,a){this.some(u=>(e(u,this),!1),r,n,i,a)}every(e,r,n,i,a){return!this.some(u=>!e(u,this),r,n,i,a)}some(e,r,n,i,a){for(let u of this.readQuads(r,n,i,a))if(e(u))return!0;return!1}getSubjects(e,r,n){let i=[];return this.forSubjects(a=>{i.push(a)},e,r,n),i}forSubjects(e,r,n,i){let a=this._getGraphs(i),u,l,d;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(d=this._termToNumericId(n))))for(i in a)(u=a[i])&&(l?d?this._loopBy2Keys(u.predicates,l,d,e):this._loopByKey1(u.subjects,l,e):d?this._loopByKey0(u.objects,d,e):this._loop(u.subjects,e))}getPredicates(e,r,n){let i=[];return this.forPredicates(a=>{i.push(a)},e,r,n),i}forPredicates(e,r,n,i){let a=this._getGraphs(i),u,l,d;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(d=this._termToNumericId(n))))for(i in a)(u=a[i])&&(l?d?this._loopBy2Keys(u.objects,d,l,e):this._loopByKey0(u.subjects,l,e):d?this._loopByKey1(u.predicates,d,e):this._loop(u.predicates,e))}getObjects(e,r,n){let i=[];return this.forObjects(a=>{i.push(a)},e,r,n),i}forObjects(e,r,n,i){let a=this._getGraphs(i),u,l,d;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(d=this._termToNumericId(n))))for(i in a)(u=a[i])&&(l?d?this._loopBy2Keys(u.subjects,l,d,e):this._loopByKey1(u.objects,l,e):d?this._loopByKey0(u.predicates,d,e):this._loop(u.objects,e))}getGraphs(e,r,n){let i=[];return this.forGraphs(a=>{i.push(a)},e,r,n),i}forGraphs(e,r,n,i){for(let a in this._graphs)this.some(u=>(e(u.graph),!0),r,n,i,this._termFromId(this._entities[a]))}createBlankNode(e){return this._entityIndex.createBlankNode(e)}extractLists({remove:e=!1,ignoreErrors:r=!1}={}){let n={},i=r?()=>!0:(l,d)=>{throw new Error(`${l.value} ${d}`)},a=this.getQuads(null,dt.rdf.rest,dt.rdf.nil,null),u=e?[...a]:[];return a.forEach(l=>{let d=[],f=!1,g,_,w=l.graph,E=l.subject;for(;E&&!f;){let x=this.getQuads(null,null,E,null),A=this.getQuads(E,null,null,null),I,D=null,U=null,z=null;for(let P=0;P<A.length&&!f;P++)I=A[P],I.graph.equals(w)?g?f=i(E,"has non-list arcs out"):I.predicate.value===dt.rdf.first?D?f=i(E,"has multiple rdf:first arcs"):u.push(D=I):I.predicate.value===dt.rdf.rest?U?f=i(E,"has multiple rdf:rest arcs"):u.push(U=I):x.length?f=i(E,"can't be subject and object"):(g=I,_="subject"):f=i(E,"not confined to single graph");for(let P=0;P<x.length&&!f;++P)I=x[P],g?f=i(E,"can't have coreferences"):I.predicate.value===dt.rdf.rest?z?f=i(E,"has incoming rdf:rest arcs"):z=I:(g=I,_="object");D?d.unshift(D.object):f=i(E,"has no list head"),E=z&&z.subject}f?e=!1:g&&(n[g[_].value]=d)}),e&&this.removeQuads(u),n}addAll(e){if(e instanceof sn&&(e=e.filtered),Array.isArray(e))this.addQuads(e);else if(e instanceof t&&e._entityIndex===this._entityIndex)e._size!==0&&(this._graphs=mo(this._graphs,e._graphs),this._size=null);else for(let r of e)this.add(r);return this}contains(e){if(e instanceof sn&&(e=e.filtered),e===this)return!0;if(!(e instanceof t)||this._entityIndex!==e._entityIndex)return e.every(f=>this.has(f));let r=this._graphs,n=e._graphs,i,a,u,l,d;for(let f in n){if(!(i=r[f]))return!1;i=i.subjects;for(let g in a=n[f].subjects){if(!(u=i[g]))return!1;for(let _ in l=a[g]){if(!(d=u[_]))return!1;for(let w in l[_])if(!(w in d))return!1}}}return!0}deleteMatches(e,r,n,i){for(let a of this.match(e,r,n,i))this.removeQuad(a);return this}difference(e){if(e&&e instanceof sn&&(e=e.filtered),e===this)return new t({entityIndex:this._entityIndex});if(e instanceof t&&e._entityIndex===this._entityIndex){let r=new t({entityIndex:this._entityIndex}),n=Wg(this._graphs,e._graphs);return n&&(r._graphs=n,r._size=null),r}return this.filter(r=>!e.has(r))}equals(e){return e instanceof sn&&(e=e.filtered),e===this||this.size===e.size&&this.contains(e)}filter(e){let r=new t({entityIndex:this._entityIndex});for(let n of this)e(n,this)&&r.add(n);return r}intersection(e){if(e instanceof sn&&(e=e.filtered),e===this){let r=new t({entityIndex:this._entityIndex});return r._graphs=mo(Object.create(null),this._graphs),r._size=this._size,r}else if(e instanceof t&&this._entityIndex===e._entityIndex){let r=new t({entityIndex:this._entityIndex}),n=$g(e._graphs,this._graphs);return n&&(r._graphs=n,r._size=null),r}return this.filter(r=>e.has(r))}map(e){let r=new t({entityIndex:this._entityIndex});for(let n of this)r.add(e(n,this));return r}reduce(e,r){let n=this.readQuads(),i=r===void 0?n.next().value:r;for(let a of n)i=e(i,a,this);return i}toArray(){return this.getQuads()}toCanonical(){throw new Error("not implemented")}toStream(){return this.match()}toString(){return new Ar().quadsToString(this)}union(e){let r=new t({entityIndex:this._entityIndex});return r._graphs=mo(Object.create(null),this._graphs),r._size=this._size,r.addAll(e),r}*[Symbol.iterator](){yield*this.readQuads()}};function Or(t,e,r=0){let n=e[r];if(n&&!(n in t))return!1;let i=!1;for(let a in n?{[n]:t[n]}:t){let u=r===2?null:Or(t[a],e,r+1);u!==!1&&(i=i||Object.create(null),i[a]=u)}return i}var sn=class t extends wl.Readable{constructor(e,r,n,i,a,u){super({objectMode:!0}),Object.assign(this,{n3Store:e,subject:r,predicate:n,object:i,graph:a,options:u})}get filtered(){if(!this._filtered){let{n3Store:e,graph:r,object:n,predicate:i,subject:a}=this,u=this._filtered=new Mn({factory:e._factory,entityIndex:this.options.entityIndex}),l,d,f;if(a&&!(l=u._termToNumericId(a))||i&&!(d=u._termToNumericId(i))||n&&!(f=u._termToNumericId(n)))return u;let g=e._getGraphs(r);for(let _ in g){let w,E,x;!l&&d?(E=Or(g[_].predicates,[d,f,l]))&&(w=Or(g[_].subjects,[l,d,f]),x=Or(g[_].objects,[f,l,d])):f?(x=Or(g[_].objects,[f,l,d]))&&(w=Or(g[_].subjects,[l,d,f]),E=Or(g[_].predicates,[d,f,l])):(w=Or(g[_].subjects,[l,d,f]))&&(E=Or(g[_].predicates,[d,f,l]),x=Or(g[_].objects,[f,l,d])),w&&(u._graphs[_]={subjects:w,predicates:E,objects:x})}u._size=null}return this._filtered}get size(){return this.filtered.size}_read(e){e>0&&!this[_l]&&(this[_l]=this[Symbol.iterator]());let r=this[_l];for(;--e>=0;){let{done:n,value:i}=r.next();if(n){this.push(null);return}this.push(i)}}addAll(e){return this.filtered.addAll(e)}contains(e){return this.filtered.contains(e)}deleteMatches(e,r,n,i){return this.filtered.deleteMatches(e,r,n,i)}difference(e){return this.filtered.difference(e)}equals(e){return this.filtered.equals(e)}every(e,r,n,i,a){return this.filtered.every(e,r,n,i,a)}filter(e){return this.filtered.filter(e)}forEach(e,r,n,i,a){return this.filtered.forEach(e,r,n,i,a)}import(e){return this.filtered.import(e)}intersection(e){return this.filtered.intersection(e)}map(e){return this.filtered.map(e)}some(e,r,n,i,a){return this.filtered.some(e,r,n,i,a)}toCanonical(){return this.filtered.toCanonical()}toStream(){return this._filtered?this._filtered.toStream():this.n3Store.match(this.subject,this.predicate,this.object,this.graph)}union(e){return this._filtered?this._filtered.union(e):this.n3Store.match(this.subject,this.predicate,this.object,this.graph).addAll(e)}toArray(){return this._filtered?this._filtered.toArray():this.n3Store.getQuads(this.subject,this.predicate,this.object,this.graph)}reduce(e,r){return this.filtered.reduce(e,r)}toString(){return new Ar().quadsToString(this)}add(e){return this.filtered.add(e)}delete(e){return this.filtered.delete(e)}has(e){return this.filtered.has(e)}match(e,r,n,i){return new t(this.filtered,e,r,n,i,this.options)}*[Symbol.iterator](){yield*this._filtered||this.n3Store.readQuads(this.subject,this.predicate,this.object,this.graph)}};N();O();k();var bl="jouw-id:",$s={get(t,e){try{let r=sessionStorage.getItem(bl+t);return r===null?e:JSON.parse(r)}catch(r){return console.warn("Reading from sessionStorage failed",r),e}},set(t,e){try{sessionStorage.setItem(bl+t,JSON.stringify(e))}catch(r){console.warn("Saving to sessionStorage failed",r)}},remove(t){try{sessionStorage.removeItem(bl+t)}catch(e){console.warn("Removing from sessionStorage failed",e)}},isAvailable(){let t="has-sessionStorage";$s.set(t,!0);let e=$s.get(t,null);return $s.remove(t),!!e}},Ws=$s;N();O();k();N();O();k();var lf={};Do(lf,{getJsonLdParser:()=>_m,getTurtleParser:()=>wm,solidDatasetAsTurtle:()=>Am});N();O();k();N();O();k();var ym=gn(sm(),1),mm=gn(Bt(),1);N();O();k();N();O();k();N();O();k();var Ct=class extends Error{};N();O();k();N();O();k();var um="application/problem+json",cm=new URL("about:blank");function am(t,e){if(t!==void 0)try{return new URL(t,e)}catch{}}function lm(t){let e,r,n,i,a;if(t.headers.get("Content-Type")===um)try{let u=JSON.parse(t.body),l=am(u.type,t.url);l!==void 0&&(e=l),typeof u.title=="string"&&(r=u.title),typeof u.status=="number"&&(n=u.status),typeof u.detail=="string"&&(i=u.detail);let d=am(u.instance,t.url);d!==void 0&&(a=d)}catch{}return Object.freeze({type:e??cm,title:r??t.statusText,status:n??t.status,detail:i,instance:a})}var Tt=class extends Ct{constructor(e,r,n,i){if(super(n,i),e.status>=200&&e.status<400)throw new Ct(`A ClientHttpError cannot be built from a success response, got ${e.status} ${e.statusText}`);this.errorResponse=Object.freeze({status:e.status,statusText:e.statusText,headers:e.headers,url:e.url,body:r,ok:!1}),this.details=lm(this.errorResponse)}get response(){return this.errorResponse}get problemDetails(){return this.details}};N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();N();O();k();function Ga(t){let e=t;return typeof e=="object"&&typeof e.internal_resourceInfo=="object"}var Ja=class extends Error{};N();O();k();function za(t){return typeof t=="string"?t:t.value}function fm(t,e={}){let r=new URL(t);return r.pathname=r.pathname.replace(/\/\/+/g,"/"),e.trailingSlash===!1&&r.pathname.slice(-1)==="/"&&(r.pathname=r.pathname.slice(0,r.pathname.length-1)),e.trailingSlash===!0&&r.pathname.slice(-1)!=="/"&&(r.pathname=`${r.pathname}/`),r.href}N();O();k();var dm=gn(na(),1);function hm(t){var e,r,n,i,a;let u=(r=(e=t.headers.get("Content-Type"))===null||e===void 0?void 0:e.split(";"))!==null&&r!==void 0?r:[],l=u.length>0&&["text/turtle","application/ld+json"].includes(u[0]),d={sourceIri:t.url,isRawData:!l,contentLocation:(n=t.headers.get("Content-Location"))!==null&&n!==void 0?n:void 0,contentType:(i=t.headers.get("Content-Type"))!==null&&i!==void 0?i:void 0,linkedResources:{},location:(a=t.headers.get("Location"))!==null&&a!==void 0?a:void 0},f=t.headers.get("Link");if(f){let _=dm.default.parse(f),w=_.get("rel","acl");w.length===1&&(d.aclUrl=new URL(w[0].uri,d.sourceIri).href),d.linkedResources=_.refs.reduce((E,x)=>{var A,I;return(A=E[I=x.rel])!==null&&A!==void 0||(E[I]=[]),E[x.rel].push(new URL(x.uri,d.sourceIri).href),E},d.linkedResources)}let g=t.headers.get("WAC-Allow");return g&&(d.permissions=Ix(g)),d}function Ix(t){function e(n){let i=n.split(" ");return i.includes("write")?{read:i.includes("read"),append:!0,write:!0,control:i.includes("control")}:{read:i.includes("read"),append:i.includes("append"),write:!1,control:i.includes("control")}}function r(n,i){let a=n.split(",").map(l=>l.split("=")).filter(l=>l.length===2&&l[0].trim()===i);if(a.length!==1)return"";let u=a[0][1].trim();return u.charAt(0)!=='"'||u.charAt(u.length-1)!=='"'?"":u.substring(1,u.length-1)}return{user:e(r(t,"user")),public:e(r(t,"public"))}}function pm(t){let e;return typeof t.slice=="function"?e=Object.assign(t.slice(),{...t}):e={...t},e}function af(t){return!t.ok}function Io(t){return Ga(t)?t.internal_resourceInfo.sourceIri:null}var gm=Io;var Ao=class extends Ja{constructor(e,r,n){super(e),this.response=r,typeof n=="string"?this.httpError=new Tt(r,n,e):this.httpError=new Tt(r,"",e)}get statusCode(){return this.response.status}get statusText(){return this.response.statusText}get problemDetails(){return this.httpError.problemDetails}};var _m=()=>{let t=[],e=[],r=[];return{onQuad:n=>{t.push(n)},onError:n=>{r.push(n)},onComplete:n=>{e.push(n)},parse:(n,i)=>new Promise(a=>{let u=new ym.JsonLdParser({baseIRI:Io(i),documentLoader:new mm.FetchDocumentLoader((...f)=>fetch(...f))}),l=!1;function d(){l||(l=!0,e.forEach(f=>f()),a())}u.on("end",d),u.on("error",f=>{r.forEach(g=>g(f)),d()}),t.forEach(f=>u.on("data",f)),u.write(n),u.end()})}};N();O();k();var wm=()=>{let t=[],e=[],r=[];return{onQuad:n=>{t.push(n)},onError:n=>{r.push(n)},onComplete:n=>{e.push(n)},parse:(n,i)=>{Tx(Io(i)).parse(n,(a,u)=>{a?r.forEach(l=>l(a)):u?t.forEach(l=>l(u)):e.forEach(l=>l())})}}};function Tx(t){return new Hr({format:"text/turtle",baseIRI:t})}N();O();k();N();O();k();var bm={acl:"http://www.w3.org/ns/auth/acl#",acp:"http://www.w3.org/ns/solid/acp#",cc:"http://creativecommons.org/ns#",cert:"http://www.w3.org/ns/auth/cert#",csvw:"http://www.w3.org/ns/csvw#",current:"#",dc:"http://purl.org/dc/terms/",dcam:"http://purl.org/dc/dcam/",dcat:"http://www.w3.org/ns/dcat#",dctype:"http://purl.org/dc/dcmitype/",foaf:"http://xmlns.com/foaf/0.1/",ldp:"http://www.w3.org/ns/ldp#",owl:"http://www.w3.org/2002/07/owl#",posixstat:"http://www.w3.org/ns/posix/stat#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",schema:"https://schema.org/",shacl:"http://www.w3.org/ns/shacl#",skos:"http://www.w3.org/2004/02/skos/core#",skosxl:"http://www.w3.org/2008/05/skos-xl#",solid:"http://www.w3.org/ns/solid/terms#",swapdoc:"http://www.w3.org/2000/10/swap/pim/doc#",ui:"http://www.w3.org/ns/ui#",vann:"http://purl.org/vocab/vann/",vcard:"http://www.w3.org/2006/vcard/ns#",ws:"http://www.w3.org/ns/pim/space#",xsd:"http://www.w3.org/2001/XMLSchema#"};N();O();k();N();O();k();var vm=t=>new Mn(t);var{freeze:Rx}=Object;function uf(t){return typeof t=="string"&&t.substring(0,2)==="_:"}function cf(t){return t.substring(2)}N();O();k();function Sm(t,e={}){var r;let n=[],i=(r=e.dataFactory)!==null&&r!==void 0?r:ar;return Object.keys(t.graphs).forEach(a=>{let u=t.graphs[a],l=a==="default"?i.defaultGraph():i.namedNode(a);Object.keys(u).forEach(d=>{let{predicates:f}=u[d],g=uf(d)?i.blankNode(cf(d)):i.namedNode(d);n.push(...Em(f,g,l,e))})}),n}function Em(t,e,r,n={}){var i;let a=[],u=(i=n.dataFactory)!==null&&i!==void 0?i:ar;return Object.keys(t).forEach(l=>{var d,f,g,_;let w=u.namedNode(l),E=(d=t[l].langStrings)!==null&&d!==void 0?d:{},x=(f=t[l].namedNodes)!==null&&f!==void 0?f:[],A=(g=t[l].literals)!==null&&g!==void 0?g:{},I=(_=t[l].blankNodes)!==null&&_!==void 0?_:[];Object.keys(A).forEach(z=>{let P=u.namedNode(z);A[z].forEach(te=>{let oe=u.literal(te,P);a.push(u.quad(e,w,oe,r))})}),Object.keys(E).forEach(z=>{E[z].forEach(F=>{let te=u.literal(F,z);a.push(u.quad(e,w,te,r))})}),x.forEach(z=>{let P=u.namedNode(z);a.push(u.quad(e,w,P,r))}),I.forEach(z=>{if(uf(z)){let P=u.blankNode(cf(z));a.push(u.quad(e,w,P,r))}else{let P=u.blankNode(),F=u.quad(e,w,P,r),te=Em(z,P,r);a.push(F),a.push(...te)}})}),a}function xm(t,e={}){var r,n;return((n=(r=e.datasetFactory)===null||r===void 0?void 0:r.dataset)!==null&&n!==void 0?n:vm)(Sm(t,e))}async function Am(t,e){let{prefixes:r=bm,thing:n}={...e},i=new Ar({format:"application/turtle",prefixes:r}),a=n?new In(n):void 0;for(let u of xm(t).match(a))i.addQuad(u);return new Promise((u,l)=>{i.end((d,f)=>{d?l(d):u(f)})})}N();O();k();var Im=["Slug","If-None-Match","Content-Type"];function Cx(t){return Im.some(e=>t[e]!==void 0)}async function ff(t,e){var r;let n=Ga(t)?za(gm(t)):fm(za(t),{trailingSlash:!1}),i=await((r=e?.fetch)!==null&&r!==void 0?r:fetch)(n,{...e?.init,method:"DELETE"});if(af(i)){let a=await i.clone().text();throw new Ao(`Deleting the file at [${n}] failed: [${i.status}] [${i.statusText}] ${a}.`,i,a)}}async function df(t,e,r){let n=za(t),i=await kx(n,e,"PUT",r);if(af(i)){let l=await i.clone().text();throw new Ao(`Overwriting the file at [${n}] failed: [${i.status}] [${i.statusText}] ${l}.`,i,l)}let a=pm(e),u=hm(i);return u.sourceIri=n,u.isRawData=!0,Object.assign(a,{internal_resourceInfo:u})}function Fx(t){return Array.isArray(t)}function Px(t){return typeof t.forEach=="function"}function Nx(t){if(typeof t>"u")return{};let e={};return Fx(t)?t.forEach(([r,n])=>{e[r]=n}):Px(t)?t.forEach((r,n)=>{e[n]=r}):e=t,e}async function kx(t,e,r,n={}){var i,a,u;let l=Nx((a=(i=n.init)===null||i===void 0?void 0:i.headers)!==null&&a!==void 0?a:{});if(Cx(l))throw new Error(`No reserved header (${Im.join(", ")}) should be set in the optional RequestInit.`);return n.slug!==void 0?l.Slug=n.slug:"name"in e&&e.name!==void 0&&(l.Slug=e.name),l["Content-Type"]=Ox(e,n.contentType),((u=n.fetch)!==null&&u!==void 0?u:fetch)(t,{...n.init,headers:l,method:r,body:e})}function Ox(t,e){if(typeof e=="string")return e;let r=typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&t.type.length>0?t.type:void 0;return r??"application/octet-stream"}var{getJsonLdParser:Q6,getTurtleParser:X6,solidDatasetAsTurtle:Z6}=lf;N();O();k();var To="sndk",Dx={profile:`${To}/basicProfile.jsonld`,shows:`${To}/talpa/interest.jsonld`,themes:`${To}/npo/themes.jsonld`,contentConsent:`${To}/consent/personalised-content.json`,adsConsent:`${To}/consent/ads.json`},Ya=Dx;var Tm=async(t,e)=>{if(t){let r=Ya[e],n=new URL(r,t).href,i=await ui(n),a=i.headers.get("content-type")||"";switch(i.status){case 200:return a.match(/^application\/(.*\+)?json/)?i.json():a.match(/^text\//)?i.text():i.blob();case 404:return console.warn("resource not found",r),null;default:console.error("Error reading resource",i.status,i.statusText);break}}return console.error("No pod address found for reading resources",t),null},hf=async(t,e,r,n="text/plain")=>{let i=Ya[e],a=new URL(i,t).href;if(!a.split("/").pop()?.split(".")[0])throw new Error("No filename found in url");let l=new Blob([r],{type:n});return df(a,l,{fetch:ui})},Rm=async(t,e)=>{let r=Ya[e],n=new URL(r,t).href;return await ff(n,{fetch:ui}),!0};async function Lx(t){let e=await(await ui(t)).text(),r=new Hr({baseIRI:t});return new Promise(n=>{r.parse(e,(i,a)=>{a?.predicate?.value=="http://www.w3.org/ns/pim/space#storage"&&n(a.object.value)})})}async function Ux(t,e){e&&(Zr().events.on(it.SESSION_RESTORED,e),Zr().events.on(it.LOGIN,e)),await Cd({restorePreviousSession:!0}).then(async r=>{if(!r)return;let{webId:n="",isLoggedIn:i=!1}=r,a=n?await Lx(n):"",u={webId:n,isLoggedIn:i,pod:a};Ws.set("user",u),t(u)})}var jx=t=>{let{expirationDate:e=0,isLoggedIn:r}=t.info,n=new Date(e)>new Date;return r&&n};function Ro(){let t={webId:"",isLoggedIn:!1,pod:""};t=Ws.get("user",t);let e=Zr();return jx(e)||Ws.remove("user"),t}function Bx(t){Ro().isLoggedIn||Rd(t)}function Mx(t){let e={logoutType:"idp",postLogoutUrl:"https://jouw.id"};return Zr()?.logout(t||e)}async function Hx(t){let{pod:e}=Ro();return e?Tm(e,t):null}var Cm=async t=>{let{pod:e}=Ro();return e?Rm(e,t):!1},Vx=async(t,e,r="application/ld+json")=>{let{pod:n}=Ro();if(!n)return null;try{return await hf(n,t,e,r)}catch(i){let{status:a,response:u}=i;if((a||u?.status)===409)return await Cm(t),await hf(n,t,e,r);throw i}};globalThis.jouwid=pf;
/*! Bundled license information:

@jspm/core/nodelibs/browser/chunk-DtuTasat.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@inrupt/oidc-client/lib/oidc-client.min.js:
  (*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
   *)
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <http://feross.org>
   * @license  MIT
   *)
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
