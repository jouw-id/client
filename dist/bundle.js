(()=>{var Ks=Object.create;var so=Object.defineProperty;var Vs=Object.getOwnPropertyDescriptor;var qs=Object.getOwnPropertyNames;var Ws=Object.getPrototypeOf,Js=Object.prototype.hasOwnProperty;var Zt=(s,e)=>()=>(s&&(e=s(s=0)),e);var ao=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var $s=(s,e,i,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of qs(e))!Js.call(s,c)&&c!==i&&so(s,c,{get:()=>e[c],enumerable:!(a=Vs(e,c))||a.enumerable});return s};var Vn=(s,e,i)=>(i=s!=null?Ks(Ws(s)):{},$s(e||!s||!s.__esModule?so(i,"default",{value:s,enumerable:!0}):i,s));var ae=Zt(()=>{});function Gs(s,e){this.fun=s,this.array=e}function uo(s){var e=Math.floor((Date.now()-er.now())*.001),i=er.now()*.001,a=Math.floor(i)+e,c=Math.floor(i%1*1e9);return s&&(a=a-s[0],c=c-s[1],c<0&&(a--,c+=Wn)),[a,c]}var gu,er,qn,Wn,co=Zt(()=>{ae();ce();ue();Gs.prototype.run=function(){this.fun.apply(null,this.array)};gu={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},er={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0};er.now===void 0&&(qn=Date.now(),er.timing&&er.timing.navigationStart&&(qn=er.timing.navigationStart),er.now=()=>Date.now()-qn);Wn=1e9;uo.bigint=function(s){var e=uo(s);return typeof BigInt>"u"?e[0]*Wn+e[1]:BigInt(e[0]*Wn)+BigInt(e[1])}});var ue=Zt(()=>{co()});function zs(){if(ho)return Rr;ho=!0,Rr.byteLength=f,Rr.toByteArray=d,Rr.fromByteArray=P;for(var s=[],e=[],i=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,y=a.length;c<y;++c)s[c]=a[c],e[a.charCodeAt(c)]=c;e[45]=62,e[95]=63;function l(C){var x=C.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=C.indexOf("=");I===-1&&(I=x);var R=I===x?0:4-I%4;return[I,R]}function f(C){var x=l(C),I=x[0],R=x[1];return(I+R)*3/4-R}function g(C,x,I){return(x+I)*3/4-I}function d(C){var x,I=l(C),R=I[0],K=I[1],V=new i(g(C,R,K)),X=0,k=K>0?R-4:R,A;for(A=0;A<k;A+=4)x=e[C.charCodeAt(A)]<<18|e[C.charCodeAt(A+1)]<<12|e[C.charCodeAt(A+2)]<<6|e[C.charCodeAt(A+3)],V[X++]=x>>16&255,V[X++]=x>>8&255,V[X++]=x&255;return K===2&&(x=e[C.charCodeAt(A)]<<2|e[C.charCodeAt(A+1)]>>4,V[X++]=x&255),K===1&&(x=e[C.charCodeAt(A)]<<10|e[C.charCodeAt(A+1)]<<4|e[C.charCodeAt(A+2)]>>2,V[X++]=x>>8&255,V[X++]=x&255),V}function w(C){return s[C>>18&63]+s[C>>12&63]+s[C>>6&63]+s[C&63]}function F(C,x,I){for(var R,K=[],V=x;V<I;V+=3)R=(C[V]<<16&16711680)+(C[V+1]<<8&65280)+(C[V+2]&255),K.push(w(R));return K.join("")}function P(C){for(var x,I=C.length,R=I%3,K=[],V=16383,X=0,k=I-R;X<k;X+=V)K.push(F(C,X,X+V>k?k:X+V));return R===1?(x=C[I-1],K.push(s[x>>2]+s[x<<4&63]+"==")):R===2&&(x=(C[I-2]<<8)+C[I-1],K.push(s[x>>10]+s[x>>4&63]+s[x<<2&63]+"=")),K.join("")}return Rr}function Ys(){if(lo)return nn;lo=!0;return nn.read=function(s,e,i,a,c){var y,l,f=c*8-a-1,g=(1<<f)-1,d=g>>1,w=-7,F=i?c-1:0,P=i?-1:1,C=s[e+F];for(F+=P,y=C&(1<<-w)-1,C>>=-w,w+=f;w>0;y=y*256+s[e+F],F+=P,w-=8);for(l=y&(1<<-w)-1,y>>=-w,w+=a;w>0;l=l*256+s[e+F],F+=P,w-=8);if(y===0)y=1-d;else{if(y===g)return l?NaN:(C?-1:1)*(1/0);l=l+Math.pow(2,a),y=y-d}return(C?-1:1)*l*Math.pow(2,y-a)},nn.write=function(s,e,i,a,c,y){var l,f,g,d=y*8-c-1,w=(1<<d)-1,F=w>>1,P=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=a?0:y-1,x=a?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,l=w):(l=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-l))<1&&(l--,g*=2),l+F>=1?e+=P/g:e+=P*Math.pow(2,1-F),e*g>=2&&(l++,g/=2),l+F>=w?(f=0,l=w):l+F>=1?(f=(e*g-1)*Math.pow(2,c),l=l+F):(f=e*Math.pow(2,F-1)*Math.pow(2,c),l=0));c>=8;s[i+C]=f&255,C+=x,f/=256,c-=8);for(l=l<<c|f,d+=c;d>0;s[i+C]=l&255,C+=x,l/=256,d-=8);s[i+C-x]|=I*128},nn}function po(){if(fo)return tr;fo=!0;let s=zs(),e=Ys(),i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;tr.Buffer=l,tr.SlowBuffer=K,tr.INSPECT_MAX_BYTES=50;let a=2147483647;tr.kMaxLength=a,l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{let E=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(E,p),E.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function y(E){if(E>a)throw new RangeError('The value "'+E+'" is invalid for option "size"');let p=new Uint8Array(E);return Object.setPrototypeOf(p,l.prototype),p}function l(E,p,u){if(typeof E=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(E)}return f(E,p,u)}l.poolSize=8192;function f(E,p,u){if(typeof E=="string")return F(E,p);if(ArrayBuffer.isView(E))return C(E);if(E==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E);if(qe(E,ArrayBuffer)||E&&qe(E.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(qe(E,SharedArrayBuffer)||E&&qe(E.buffer,SharedArrayBuffer)))return x(E,p,u);if(typeof E=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let L=E.valueOf&&E.valueOf();if(L!=null&&L!==E)return l.from(L,p,u);let Y=I(E);if(Y)return Y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof E[Symbol.toPrimitive]=="function")return l.from(E[Symbol.toPrimitive]("string"),p,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E)}l.from=function(E,p,u){return f(E,p,u)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function g(E){if(typeof E!="number")throw new TypeError('"size" argument must be of type number');if(E<0)throw new RangeError('The value "'+E+'" is invalid for option "size"')}function d(E,p,u){return g(E),E<=0?y(E):p!==void 0?typeof u=="string"?y(E).fill(p,u):y(E).fill(p):y(E)}l.alloc=function(E,p,u){return d(E,p,u)};function w(E){return g(E),y(E<0?0:R(E)|0)}l.allocUnsafe=function(E){return w(E)},l.allocUnsafeSlow=function(E){return w(E)};function F(E,p){if((typeof p!="string"||p==="")&&(p="utf8"),!l.isEncoding(p))throw new TypeError("Unknown encoding: "+p);let u=V(E,p)|0,L=y(u),Y=L.write(E,p);return Y!==u&&(L=L.slice(0,Y)),L}function P(E){let p=E.length<0?0:R(E.length)|0,u=y(p);for(let L=0;L<p;L+=1)u[L]=E[L]&255;return u}function C(E){if(qe(E,Uint8Array)){let p=new Uint8Array(E);return x(p.buffer,p.byteOffset,p.byteLength)}return P(E)}function x(E,p,u){if(p<0||E.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(E.byteLength<p+(u||0))throw new RangeError('"length" is outside of buffer bounds');let L;return p===void 0&&u===void 0?L=new Uint8Array(E):u===void 0?L=new Uint8Array(E,p):L=new Uint8Array(E,p,u),Object.setPrototypeOf(L,l.prototype),L}function I(E){if(l.isBuffer(E)){let p=R(E.length)|0,u=y(p);return u.length===0||E.copy(u,0,0,p),u}if(E.length!==void 0)return typeof E.length!="number"||wt(E.length)?y(0):P(E);if(E.type==="Buffer"&&Array.isArray(E.data))return P(E.data)}function R(E){if(E>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return E|0}function K(E){return+E!=E&&(E=0),l.alloc(+E)}l.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==l.prototype},l.compare=function(p,u){if(qe(p,Uint8Array)&&(p=l.from(p,p.offset,p.byteLength)),qe(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),!l.isBuffer(p)||!l.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===u)return 0;let L=p.length,Y=u.length;for(let G=0,le=Math.min(L,Y);G<le;++G)if(p[G]!==u[G]){L=p[G],Y=u[G];break}return L<Y?-1:Y<L?1:0},l.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(p,u){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return l.alloc(0);let L;if(u===void 0)for(u=0,L=0;L<p.length;++L)u+=p[L].length;let Y=l.allocUnsafe(u),G=0;for(L=0;L<p.length;++L){let le=p[L];if(qe(le,Uint8Array))G+le.length>Y.length?(l.isBuffer(le)||(le=l.from(le)),le.copy(Y,G)):Uint8Array.prototype.set.call(Y,le,G);else if(l.isBuffer(le))le.copy(Y,G);else throw new TypeError('"list" argument must be an Array of Buffers');G+=le.length}return Y};function V(E,p){if(l.isBuffer(E))return E.length;if(ArrayBuffer.isView(E)||qe(E,ArrayBuffer))return E.byteLength;if(typeof E!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof E);let u=E.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&u===0)return 0;let Y=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return me(E).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Te(E).length;default:if(Y)return L?-1:me(E).length;p=(""+p).toLowerCase(),Y=!0}}l.byteLength=V;function X(E,p,u){let L=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,p>>>=0,u<=p))return"";for(E||(E="utf8");;)switch(E){case"hex":return Pe(this,p,u);case"utf8":case"utf-8":return je(this,p,u);case"ascii":return lt(this,p,u);case"latin1":case"binary":return xe(this,p,u);case"base64":return $e(this,p,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return it(this,p,u);default:if(L)throw new TypeError("Unknown encoding: "+E);E=(E+"").toLowerCase(),L=!0}}l.prototype._isBuffer=!0;function k(E,p,u){let L=E[p];E[p]=E[u],E[u]=L}l.prototype.swap16=function(){let p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<p;u+=2)k(this,u,u+1);return this},l.prototype.swap32=function(){let p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<p;u+=4)k(this,u,u+3),k(this,u+1,u+2);return this},l.prototype.swap64=function(){let p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<p;u+=8)k(this,u,u+7),k(this,u+1,u+6),k(this,u+2,u+5),k(this,u+3,u+4);return this},l.prototype.toString=function(){let p=this.length;return p===0?"":arguments.length===0?je(this,0,p):X.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(p){if(!l.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:l.compare(this,p)===0},l.prototype.inspect=function(){let p="",u=tr.INSPECT_MAX_BYTES;return p=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(p+=" ... "),"<Buffer "+p+">"},i&&(l.prototype[i]=l.prototype.inspect),l.prototype.compare=function(p,u,L,Y,G){if(qe(p,Uint8Array)&&(p=l.from(p,p.offset,p.byteLength)),!l.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(u===void 0&&(u=0),L===void 0&&(L=p?p.length:0),Y===void 0&&(Y=0),G===void 0&&(G=this.length),u<0||L>p.length||Y<0||G>this.length)throw new RangeError("out of range index");if(Y>=G&&u>=L)return 0;if(Y>=G)return-1;if(u>=L)return 1;if(u>>>=0,L>>>=0,Y>>>=0,G>>>=0,this===p)return 0;let le=G-Y,Fe=L-u,Me=Math.min(le,Fe),ke=this.slice(Y,G),He=p.slice(u,L);for(let Ue=0;Ue<Me;++Ue)if(ke[Ue]!==He[Ue]){le=ke[Ue],Fe=He[Ue];break}return le<Fe?-1:Fe<le?1:0};function A(E,p,u,L,Y){if(E.length===0)return-1;if(typeof u=="string"?(L=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,wt(u)&&(u=Y?0:E.length-1),u<0&&(u=E.length+u),u>=E.length){if(Y)return-1;u=E.length-1}else if(u<0)if(Y)u=0;else return-1;if(typeof p=="string"&&(p=l.from(p,L)),l.isBuffer(p))return p.length===0?-1:Q(E,p,u,L,Y);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?Y?Uint8Array.prototype.indexOf.call(E,p,u):Uint8Array.prototype.lastIndexOf.call(E,p,u):Q(E,[p],u,L,Y);throw new TypeError("val must be string, number or Buffer")}function Q(E,p,u,L,Y){let G=1,le=E.length,Fe=p.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(E.length<2||p.length<2)return-1;G=2,le/=2,Fe/=2,u/=2}function Me(He,Ue){return G===1?He[Ue]:He.readUInt16BE(Ue*G)}let ke;if(Y){let He=-1;for(ke=u;ke<le;ke++)if(Me(E,ke)===Me(p,He===-1?0:ke-He)){if(He===-1&&(He=ke),ke-He+1===Fe)return He*G}else He!==-1&&(ke-=ke-He),He=-1}else for(u+Fe>le&&(u=le-Fe),ke=u;ke>=0;ke--){let He=!0;for(let Ue=0;Ue<Fe;Ue++)if(Me(E,ke+Ue)!==Me(p,Ue)){He=!1;break}if(He)return ke}return-1}l.prototype.includes=function(p,u,L){return this.indexOf(p,u,L)!==-1},l.prototype.indexOf=function(p,u,L){return A(this,p,u,L,!0)},l.prototype.lastIndexOf=function(p,u,L){return A(this,p,u,L,!1)};function re(E,p,u,L){u=Number(u)||0;let Y=E.length-u;L?(L=Number(L),L>Y&&(L=Y)):L=Y;let G=p.length;L>G/2&&(L=G/2);let le;for(le=0;le<L;++le){let Fe=parseInt(p.substr(le*2,2),16);if(wt(Fe))return le;E[u+le]=Fe}return le}function D(E,p,u,L){return Ce(me(p,E.length-u),E,u,L)}function he(E,p,u,L){return Ce(be(p),E,u,L)}function pe(E,p,u,L){return Ce(Te(p),E,u,L)}function Ee(E,p,u,L){return Ce(Ne(p,E.length-u),E,u,L)}l.prototype.write=function(p,u,L,Y){if(u===void 0)Y="utf8",L=this.length,u=0;else if(L===void 0&&typeof u=="string")Y=u,L=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(L)?(L=L>>>0,Y===void 0&&(Y="utf8")):(Y=L,L=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let G=this.length-u;if((L===void 0||L>G)&&(L=G),p.length>0&&(L<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");Y||(Y="utf8");let le=!1;for(;;)switch(Y){case"hex":return re(this,p,u,L);case"utf8":case"utf-8":return D(this,p,u,L);case"ascii":case"latin1":case"binary":return he(this,p,u,L);case"base64":return pe(this,p,u,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ee(this,p,u,L);default:if(le)throw new TypeError("Unknown encoding: "+Y);Y=(""+Y).toLowerCase(),le=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function $e(E,p,u){return p===0&&u===E.length?s.fromByteArray(E):s.fromByteArray(E.slice(p,u))}function je(E,p,u){u=Math.min(E.length,u);let L=[],Y=p;for(;Y<u;){let G=E[Y],le=null,Fe=G>239?4:G>223?3:G>191?2:1;if(Y+Fe<=u){let Me,ke,He,Ue;switch(Fe){case 1:G<128&&(le=G);break;case 2:Me=E[Y+1],(Me&192)===128&&(Ue=(G&31)<<6|Me&63,Ue>127&&(le=Ue));break;case 3:Me=E[Y+1],ke=E[Y+2],(Me&192)===128&&(ke&192)===128&&(Ue=(G&15)<<12|(Me&63)<<6|ke&63,Ue>2047&&(Ue<55296||Ue>57343)&&(le=Ue));break;case 4:Me=E[Y+1],ke=E[Y+2],He=E[Y+3],(Me&192)===128&&(ke&192)===128&&(He&192)===128&&(Ue=(G&15)<<18|(Me&63)<<12|(ke&63)<<6|He&63,Ue>65535&&Ue<1114112&&(le=Ue))}}le===null?(le=65533,Fe=1):le>65535&&(le-=65536,L.push(le>>>10&1023|55296),le=56320|le&1023),L.push(le),Y+=Fe}return Ze(L)}let Qe=4096;function Ze(E){let p=E.length;if(p<=Qe)return String.fromCharCode.apply(String,E);let u="",L=0;for(;L<p;)u+=String.fromCharCode.apply(String,E.slice(L,L+=Qe));return u}function lt(E,p,u){let L="";u=Math.min(E.length,u);for(let Y=p;Y<u;++Y)L+=String.fromCharCode(E[Y]&127);return L}function xe(E,p,u){let L="";u=Math.min(E.length,u);for(let Y=p;Y<u;++Y)L+=String.fromCharCode(E[Y]);return L}function Pe(E,p,u){let L=E.length;(!p||p<0)&&(p=0),(!u||u<0||u>L)&&(u=L);let Y="";for(let G=p;G<u;++G)Y+=we[E[G]];return Y}function it(E,p,u){let L=E.slice(p,u),Y="";for(let G=0;G<L.length-1;G+=2)Y+=String.fromCharCode(L[G]+L[G+1]*256);return Y}l.prototype.slice=function(p,u){let L=this.length;p=~~p,u=u===void 0?L:~~u,p<0?(p+=L,p<0&&(p=0)):p>L&&(p=L),u<0?(u+=L,u<0&&(u=0)):u>L&&(u=L),u<p&&(u=p);let Y=this.subarray(p,u);return Object.setPrototypeOf(Y,l.prototype),Y};function Re(E,p,u){if(E%1!==0||E<0)throw new RangeError("offset is not uint");if(E+p>u)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(p,u,L){p=p>>>0,u=u>>>0,L||Re(p,u,this.length);let Y=this[p],G=1,le=0;for(;++le<u&&(G*=256);)Y+=this[p+le]*G;return Y},l.prototype.readUintBE=l.prototype.readUIntBE=function(p,u,L){p=p>>>0,u=u>>>0,L||Re(p,u,this.length);let Y=this[p+--u],G=1;for(;u>0&&(G*=256);)Y+=this[p+--u]*G;return Y},l.prototype.readUint8=l.prototype.readUInt8=function(p,u){return p=p>>>0,u||Re(p,1,this.length),this[p]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(p,u){return p=p>>>0,u||Re(p,2,this.length),this[p]|this[p+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(p,u){return p=p>>>0,u||Re(p,2,this.length),this[p]<<8|this[p+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},l.prototype.readBigUInt64LE=Le(function(p){p=p>>>0,M(p,"offset");let u=this[p],L=this[p+7];(u===void 0||L===void 0)&&J(p,this.length-8);let Y=u+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,G=this[++p]+this[++p]*2**8+this[++p]*2**16+L*2**24;return BigInt(Y)+(BigInt(G)<<BigInt(32))}),l.prototype.readBigUInt64BE=Le(function(p){p=p>>>0,M(p,"offset");let u=this[p],L=this[p+7];(u===void 0||L===void 0)&&J(p,this.length-8);let Y=u*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],G=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+L;return(BigInt(Y)<<BigInt(32))+BigInt(G)}),l.prototype.readIntLE=function(p,u,L){p=p>>>0,u=u>>>0,L||Re(p,u,this.length);let Y=this[p],G=1,le=0;for(;++le<u&&(G*=256);)Y+=this[p+le]*G;return G*=128,Y>=G&&(Y-=Math.pow(2,8*u)),Y},l.prototype.readIntBE=function(p,u,L){p=p>>>0,u=u>>>0,L||Re(p,u,this.length);let Y=u,G=1,le=this[p+--Y];for(;Y>0&&(G*=256);)le+=this[p+--Y]*G;return G*=128,le>=G&&(le-=Math.pow(2,8*u)),le},l.prototype.readInt8=function(p,u){return p=p>>>0,u||Re(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},l.prototype.readInt16LE=function(p,u){p=p>>>0,u||Re(p,2,this.length);let L=this[p]|this[p+1]<<8;return L&32768?L|4294901760:L},l.prototype.readInt16BE=function(p,u){p=p>>>0,u||Re(p,2,this.length);let L=this[p+1]|this[p]<<8;return L&32768?L|4294901760:L},l.prototype.readInt32LE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},l.prototype.readInt32BE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},l.prototype.readBigInt64LE=Le(function(p){p=p>>>0,M(p,"offset");let u=this[p],L=this[p+7];(u===void 0||L===void 0)&&J(p,this.length-8);let Y=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(L<<24);return(BigInt(Y)<<BigInt(32))+BigInt(u+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),l.prototype.readBigInt64BE=Le(function(p){p=p>>>0,M(p,"offset");let u=this[p],L=this[p+7];(u===void 0||L===void 0)&&J(p,this.length-8);let Y=(u<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(Y)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+L)}),l.prototype.readFloatLE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),e.read(this,p,!0,23,4)},l.prototype.readFloatBE=function(p,u){return p=p>>>0,u||Re(p,4,this.length),e.read(this,p,!1,23,4)},l.prototype.readDoubleLE=function(p,u){return p=p>>>0,u||Re(p,8,this.length),e.read(this,p,!0,52,8)},l.prototype.readDoubleBE=function(p,u){return p=p>>>0,u||Re(p,8,this.length),e.read(this,p,!1,52,8)};function De(E,p,u,L,Y,G){if(!l.isBuffer(E))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>Y||p<G)throw new RangeError('"value" argument is out of bounds');if(u+L>E.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(p,u,L,Y){if(p=+p,u=u>>>0,L=L>>>0,!Y){let Fe=Math.pow(2,8*L)-1;De(this,p,u,L,Fe,0)}let G=1,le=0;for(this[u]=p&255;++le<L&&(G*=256);)this[u+le]=p/G&255;return u+L},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(p,u,L,Y){if(p=+p,u=u>>>0,L=L>>>0,!Y){let Fe=Math.pow(2,8*L)-1;De(this,p,u,L,Fe,0)}let G=L-1,le=1;for(this[u+G]=p&255;--G>=0&&(le*=256);)this[u+G]=p/le&255;return u+L},l.prototype.writeUint8=l.prototype.writeUInt8=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,1,255,0),this[u]=p&255,u+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,2,65535,0),this[u]=p&255,this[u+1]=p>>>8,u+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,2,65535,0),this[u]=p>>>8,this[u+1]=p&255,u+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,4,4294967295,0),this[u+3]=p>>>24,this[u+2]=p>>>16,this[u+1]=p>>>8,this[u]=p&255,u+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,4,4294967295,0),this[u]=p>>>24,this[u+1]=p>>>16,this[u+2]=p>>>8,this[u+3]=p&255,u+4};function ft(E,p,u,L,Y){_(p,L,Y,E,u,7);let G=Number(p&BigInt(4294967295));E[u++]=G,G=G>>8,E[u++]=G,G=G>>8,E[u++]=G,G=G>>8,E[u++]=G;let le=Number(p>>BigInt(32)&BigInt(4294967295));return E[u++]=le,le=le>>8,E[u++]=le,le=le>>8,E[u++]=le,le=le>>8,E[u++]=le,u}function _t(E,p,u,L,Y){_(p,L,Y,E,u,7);let G=Number(p&BigInt(4294967295));E[u+7]=G,G=G>>8,E[u+6]=G,G=G>>8,E[u+5]=G,G=G>>8,E[u+4]=G;let le=Number(p>>BigInt(32)&BigInt(4294967295));return E[u+3]=le,le=le>>8,E[u+2]=le,le=le>>8,E[u+1]=le,le=le>>8,E[u]=le,u+8}l.prototype.writeBigUInt64LE=Le(function(p,u=0){return ft(this,p,u,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Le(function(p,u=0){return _t(this,p,u,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(p,u,L,Y){if(p=+p,u=u>>>0,!Y){let Me=Math.pow(2,8*L-1);De(this,p,u,L,Me-1,-Me)}let G=0,le=1,Fe=0;for(this[u]=p&255;++G<L&&(le*=256);)p<0&&Fe===0&&this[u+G-1]!==0&&(Fe=1),this[u+G]=(p/le>>0)-Fe&255;return u+L},l.prototype.writeIntBE=function(p,u,L,Y){if(p=+p,u=u>>>0,!Y){let Me=Math.pow(2,8*L-1);De(this,p,u,L,Me-1,-Me)}let G=L-1,le=1,Fe=0;for(this[u+G]=p&255;--G>=0&&(le*=256);)p<0&&Fe===0&&this[u+G+1]!==0&&(Fe=1),this[u+G]=(p/le>>0)-Fe&255;return u+L},l.prototype.writeInt8=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,1,127,-128),p<0&&(p=255+p+1),this[u]=p&255,u+1},l.prototype.writeInt16LE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,2,32767,-32768),this[u]=p&255,this[u+1]=p>>>8,u+2},l.prototype.writeInt16BE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,2,32767,-32768),this[u]=p>>>8,this[u+1]=p&255,u+2},l.prototype.writeInt32LE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,4,2147483647,-2147483648),this[u]=p&255,this[u+1]=p>>>8,this[u+2]=p>>>16,this[u+3]=p>>>24,u+4},l.prototype.writeInt32BE=function(p,u,L){return p=+p,u=u>>>0,L||De(this,p,u,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[u]=p>>>24,this[u+1]=p>>>16,this[u+2]=p>>>8,this[u+3]=p&255,u+4},l.prototype.writeBigInt64LE=Le(function(p,u=0){return ft(this,p,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Le(function(p,u=0){return _t(this,p,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Pt(E,p,u,L,Y,G){if(u+L>E.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function ot(E,p,u,L,Y){return p=+p,u=u>>>0,Y||Pt(E,p,u,4),e.write(E,p,u,L,23,4),u+4}l.prototype.writeFloatLE=function(p,u,L){return ot(this,p,u,!0,L)},l.prototype.writeFloatBE=function(p,u,L){return ot(this,p,u,!1,L)};function dt(E,p,u,L,Y){return p=+p,u=u>>>0,Y||Pt(E,p,u,8),e.write(E,p,u,L,52,8),u+8}l.prototype.writeDoubleLE=function(p,u,L){return dt(this,p,u,!0,L)},l.prototype.writeDoubleBE=function(p,u,L){return dt(this,p,u,!1,L)},l.prototype.copy=function(p,u,L,Y){if(!l.isBuffer(p))throw new TypeError("argument should be a Buffer");if(L||(L=0),!Y&&Y!==0&&(Y=this.length),u>=p.length&&(u=p.length),u||(u=0),Y>0&&Y<L&&(Y=L),Y===L||p.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("sourceEnd out of bounds");Y>this.length&&(Y=this.length),p.length-u<Y-L&&(Y=p.length-u+L);let G=Y-L;return this===p&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,L,Y):Uint8Array.prototype.set.call(p,this.subarray(L,Y),u),G},l.prototype.fill=function(p,u,L,Y){if(typeof p=="string"){if(typeof u=="string"?(Y=u,u=0,L=this.length):typeof L=="string"&&(Y=L,L=this.length),Y!==void 0&&typeof Y!="string")throw new TypeError("encoding must be a string");if(typeof Y=="string"&&!l.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y);if(p.length===1){let le=p.charCodeAt(0);(Y==="utf8"&&le<128||Y==="latin1")&&(p=le)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(u<0||this.length<u||this.length<L)throw new RangeError("Out of range index");if(L<=u)return this;u=u>>>0,L=L===void 0?this.length:L>>>0,p||(p=0);let G;if(typeof p=="number")for(G=u;G<L;++G)this[G]=p;else{let le=l.isBuffer(p)?p:l.from(p,Y),Fe=le.length;if(Fe===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(G=0;G<L-u;++G)this[G+u]=le[G%Fe]}return this};let Ve={};function Be(E,p,u){Ve[E]=class extends u{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${E}]`,this.stack,delete this.name}get code(){return E}set code(Y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Y,writable:!0})}toString(){return`${this.name} [${E}]: ${this.message}`}}}Be("ERR_BUFFER_OUT_OF_BOUNDS",function(E){return E?`${E} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Be("ERR_INVALID_ARG_TYPE",function(E,p){return`The "${E}" argument must be of type number. Received type ${typeof p}`},TypeError),Be("ERR_OUT_OF_RANGE",function(E,p,u){let L=`The value of "${E}" is out of range.`,Y=u;return Number.isInteger(u)&&Math.abs(u)>2**32?Y=$(String(u)):typeof u=="bigint"&&(Y=String(u),(u>BigInt(2)**BigInt(32)||u<-(BigInt(2)**BigInt(32)))&&(Y=$(Y)),Y+="n"),L+=` It must be ${p}. Received ${Y}`,L},RangeError);function $(E){let p="",u=E.length,L=E[0]==="-"?1:0;for(;u>=L+4;u-=3)p=`_${E.slice(u-3,u)}${p}`;return`${E.slice(0,u)}${p}`}function v(E,p,u){M(p,"offset"),(E[p]===void 0||E[p+u]===void 0)&&J(p,E.length-(u+1))}function _(E,p,u,L,Y,G){if(E>u||E<p){let le=typeof p=="bigint"?"n":"",Fe;throw p===0||p===BigInt(0)?Fe=`>= 0${le} and < 2${le} ** ${(G+1)*8}${le}`:Fe=`>= -(2${le} ** ${(G+1)*8-1}${le}) and < 2 ** ${(G+1)*8-1}${le}`,new Ve.ERR_OUT_OF_RANGE("value",Fe,E)}v(L,Y,G)}function M(E,p){if(typeof E!="number")throw new Ve.ERR_INVALID_ARG_TYPE(p,"number",E)}function J(E,p,u){throw Math.floor(E)!==E?(M(E,u),new Ve.ERR_OUT_OF_RANGE("offset","an integer",E)):p<0?new Ve.ERR_BUFFER_OUT_OF_BOUNDS:new Ve.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,E)}let te=/[^+/0-9A-Za-z-_]/g;function se(E){if(E=E.split("=")[0],E=E.trim().replace(te,""),E.length<2)return"";for(;E.length%4!==0;)E=E+"=";return E}function me(E,p){p=p||1/0;let u,L=E.length,Y=null,G=[];for(let le=0;le<L;++le){if(u=E.charCodeAt(le),u>55295&&u<57344){if(!Y){if(u>56319){(p-=3)>-1&&G.push(239,191,189);continue}else if(le+1===L){(p-=3)>-1&&G.push(239,191,189);continue}Y=u;continue}if(u<56320){(p-=3)>-1&&G.push(239,191,189),Y=u;continue}u=(Y-55296<<10|u-56320)+65536}else Y&&(p-=3)>-1&&G.push(239,191,189);if(Y=null,u<128){if((p-=1)<0)break;G.push(u)}else if(u<2048){if((p-=2)<0)break;G.push(u>>6|192,u&63|128)}else if(u<65536){if((p-=3)<0)break;G.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((p-=4)<0)break;G.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return G}function be(E){let p=[];for(let u=0;u<E.length;++u)p.push(E.charCodeAt(u)&255);return p}function Ne(E,p){let u,L,Y,G=[];for(let le=0;le<E.length&&!((p-=2)<0);++le)u=E.charCodeAt(le),L=u>>8,Y=u%256,G.push(Y),G.push(L);return G}function Te(E){return s.toByteArray(se(E))}function Ce(E,p,u,L){let Y;for(Y=0;Y<L&&!(Y+u>=p.length||Y>=E.length);++Y)p[Y+u]=E[Y];return Y}function qe(E,p){return E instanceof p||E!=null&&E.constructor!=null&&E.constructor.name!=null&&E.constructor.name===p.name}function wt(E){return E!==E}let we=function(){let E="0123456789abcdef",p=new Array(256);for(let u=0;u<16;++u){let L=u*16;for(let Y=0;Y<16;++Y)p[L+Y]=E[u]+E[Y]}return p}();function Le(E){return typeof BigInt>"u"?Ae:E}function Ae(){throw new Error("BigInt not supported")}return tr}var Rr,ho,nn,lo,tr,fo,go=Zt(()=>{ae();ce();ue();Rr={},ho=!1;nn={},lo=!1;tr={},fo=!1});var rr,ye,Au,Iu,Jn=Zt(()=>{ae();ce();ue();go();rr=po();rr.Buffer;rr.SlowBuffer;rr.INSPECT_MAX_BYTES;rr.kMaxLength;ye=rr.Buffer,Au=rr.INSPECT_MAX_BYTES,Iu=rr.kMaxLength});var ce=Zt(()=>{Jn()});function ja(){if(Qo)return Rn;Qo=!0;var s=typeof Reflect=="object"?Reflect:null,e=s&&typeof s.apply=="function"?s.apply:function(A,Q,re){return Function.prototype.apply.call(A,Q,re)},i;s&&typeof s.ownKeys=="function"?i=s.ownKeys:Object.getOwnPropertySymbols?i=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:i=function(A){return Object.getOwnPropertyNames(A)};function a(k){console&&console.warn&&console.warn(k)}var c=Number.isNaN||function(A){return A!==A};function y(){y.init.call(this)}Rn=y,Rn.once=K,y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var l=10;function f(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(k){if(typeof k!="number"||k<0||c(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");l=k}}),y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||c(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function g(k){return k._maxListeners===void 0?y.defaultMaxListeners:k._maxListeners}y.prototype.getMaxListeners=function(){return g(this)},y.prototype.emit=function(A){for(var Q=[],re=1;re<arguments.length;re++)Q.push(arguments[re]);var D=A==="error",he=this._events;if(he!==void 0)D=D&&he.error===void 0;else if(!D)return!1;if(D){var pe;if(Q.length>0&&(pe=Q[0]),pe instanceof Error)throw pe;var Ee=new Error("Unhandled error."+(pe?" ("+pe.message+")":""));throw Ee.context=pe,Ee}var $e=he[A];if($e===void 0)return!1;if(typeof $e=="function")e($e,this,Q);else for(var je=$e.length,Qe=x($e,je),re=0;re<je;++re)e(Qe[re],this,Q);return!0};function d(k,A,Q,re){var D,he,pe;if(f(Q),he=k._events,he===void 0?(he=k._events=Object.create(null),k._eventsCount=0):(he.newListener!==void 0&&(k.emit("newListener",A,Q.listener?Q.listener:Q),he=k._events),pe=he[A]),pe===void 0)pe=he[A]=Q,++k._eventsCount;else if(typeof pe=="function"?pe=he[A]=re?[Q,pe]:[pe,Q]:re?pe.unshift(Q):pe.push(Q),D=g(k),D>0&&pe.length>D&&!pe.warned){pe.warned=!0;var Ee=new Error("Possible EventEmitter memory leak detected. "+pe.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ee.name="MaxListenersExceededWarning",Ee.emitter=k,Ee.type=A,Ee.count=pe.length,a(Ee)}return k}y.prototype.addListener=function(A,Q){return d(this,A,Q,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(A,Q){return d(this,A,Q,!0)};function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function F(k,A,Q){var re={fired:!1,wrapFn:void 0,target:k,type:A,listener:Q},D=w.bind(re);return D.listener=Q,re.wrapFn=D,D}y.prototype.once=function(A,Q){return f(Q),this.on(A,F(this,A,Q)),this},y.prototype.prependOnceListener=function(A,Q){return f(Q),this.prependListener(A,F(this,A,Q)),this},y.prototype.removeListener=function(A,Q){var re,D,he,pe,Ee;if(f(Q),D=this._events,D===void 0)return this;if(re=D[A],re===void 0)return this;if(re===Q||re.listener===Q)--this._eventsCount===0?this._events=Object.create(null):(delete D[A],D.removeListener&&this.emit("removeListener",A,re.listener||Q));else if(typeof re!="function"){for(he=-1,pe=re.length-1;pe>=0;pe--)if(re[pe]===Q||re[pe].listener===Q){Ee=re[pe].listener,he=pe;break}if(he<0)return this;he===0?re.shift():I(re,he),re.length===1&&(D[A]=re[0]),D.removeListener!==void 0&&this.emit("removeListener",A,Ee||Q)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.removeAllListeners=function(A){var Q,re,D;if(re=this._events,re===void 0)return this;if(re.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):re[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete re[A]),this;if(arguments.length===0){var he=Object.keys(re),pe;for(D=0;D<he.length;++D)pe=he[D],pe!=="removeListener"&&this.removeAllListeners(pe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Q=re[A],typeof Q=="function")this.removeListener(A,Q);else if(Q!==void 0)for(D=Q.length-1;D>=0;D--)this.removeListener(A,Q[D]);return this};function P(k,A,Q){var re=k._events;if(re===void 0)return[];var D=re[A];return D===void 0?[]:typeof D=="function"?Q?[D.listener||D]:[D]:Q?R(D):x(D,D.length)}y.prototype.listeners=function(A){return P(this,A,!0)},y.prototype.rawListeners=function(A){return P(this,A,!1)},y.listenerCount=function(k,A){return typeof k.listenerCount=="function"?k.listenerCount(A):C.call(k,A)},y.prototype.listenerCount=C;function C(k){var A=this._events;if(A!==void 0){var Q=A[k];if(typeof Q=="function")return 1;if(Q!==void 0)return Q.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function x(k,A){for(var Q=new Array(A),re=0;re<A;++re)Q[re]=k[re];return Q}function I(k,A){for(;A+1<k.length;A++)k[A]=k[A+1];k.pop()}function R(k){for(var A=new Array(k.length),Q=0;Q<A.length;++Q)A[Q]=k[Q].listener||k[Q];return A}function K(k,A){return new Promise(function(Q,re){function D(pe){k.removeListener(A,he),re(pe)}function he(){typeof k.removeListener=="function"&&k.removeListener("error",D),Q([].slice.call(arguments))}X(k,A,he,{once:!0}),A!=="error"&&V(k,D,{once:!0})})}function V(k,A,Q){typeof k.on=="function"&&X(k,"error",A,Q)}function X(k,A,Q,re){if(typeof k.on=="function")re.once?k.once(A,Q):k.on(A,Q);else if(typeof k.addEventListener=="function")k.addEventListener(A,function D(he){re.once&&k.removeEventListener(A,D),Q(he)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return Rn}var Rn,Qo,Sr,Jd,$d,Gd,zd,Yd,Xd,Zo=Zt(()=>{ae();ce();ue();Rn={},Qo=!1;Sr=ja();Sr.once;Sr.once=function(s,e){return new Promise((i,a)=>{function c(...l){y!==void 0&&s.removeListener("error",y),i(l)}let y;e!=="error"&&(y=l=>{s.removeListener(name,c),a(l)},s.once("error",y)),s.once(e,c)})};Sr.on=function(s,e){let i=[],a=[],c=null,y=!1,l={async next(){let d=i.shift();if(d)return createIterResult(d,!1);if(c){let w=Promise.reject(c);return c=null,w}return y?createIterResult(void 0,!0):new Promise((w,F)=>a.push({resolve:w,reject:F}))},async return(){s.removeListener(e,f),s.removeListener("error",g),y=!0;for(let d of a)d.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(d){c=d,s.removeListener(e,f),s.removeListener("error",g)},[Symbol.asyncIterator](){return this}};return s.on(e,f),s.on("error",g),l;function f(...d){let w=a.shift();w?w.resolve(createIterResult(d,!1)):i.push(d)}function g(d){y=!0;let w=a.shift();w?w.reject(d):c=d,l.return()}};({EventEmitter:Jd,defaultMaxListeners:$d,init:Gd,listenerCount:zd,on:Yd,once:Xd}=Sr)});var Si=ao((Wr,wi)=>{ae();ce();ue();(function(e,i){if(typeof Wr=="object"&&typeof wi=="object")wi.exports=i();else if(typeof define=="function"&&define.amd)define([],i);else{var a=i();for(var c in a)(typeof Wr=="object"?Wr:e)[c]=a[c]}})(Wr,function(){return function(s){var e={};function i(a){if(e[a])return e[a].exports;var c=e[a]={i:a,l:!1,exports:{}};return s[a].call(c.exports,c,c.exports,i),c.l=!0,c.exports}return i.m=s,i.c=e,i.d=function(a,c,y){i.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:y})},i.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.t=function(a,c){if(1&c&&(a=i(a)),8&c||4&c&&typeof a=="object"&&a&&a.__esModule)return a;var y=Object.create(null);if(i.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:a}),2&c&&typeof a!="string")for(var l in a)i.d(y,l,function(f){return a[f]}.bind(null,l));return y},i.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(c,"a",c),c},i.o=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)},i.p="",i(i.s=22)}([function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function f(g,d){for(var w=0;w<d.length;w++){var F=d[w];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(g,F.key,F)}}return function(g,d,w){return d&&f(g.prototype,d),w&&f(g,w),g}}(),c={debug:function(){},info:function(){},warn:function(){},error:function(){}},y=void 0,l=void 0;(e.Log=function(){function f(){(function(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")})(this,f)}return f.reset=function(){l=3,y=c},f.debug=function(){if(l>=4){for(var d=arguments.length,w=Array(d),F=0;F<d;F++)w[F]=arguments[F];y.debug.apply(y,Array.from(w))}},f.info=function(){if(l>=3){for(var d=arguments.length,w=Array(d),F=0;F<d;F++)w[F]=arguments[F];y.info.apply(y,Array.from(w))}},f.warn=function(){if(l>=2){for(var d=arguments.length,w=Array(d),F=0;F<d;F++)w[F]=arguments[F];y.warn.apply(y,Array.from(w))}},f.error=function(){if(l>=1){for(var d=arguments.length,w=Array(d),F=0;F<d;F++)w[F]=arguments[F];y.error.apply(y,Array.from(w))}},a(f,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return l},set:function(d){if(!(0<=d&&d<=4))throw new Error("Invalid log level");l=d}},{key:"logger",get:function(){return y},set:function(d){if(!d.debug&&d.info&&(d.debug=d.info),!(d.debug&&d.info&&d.warn&&d.error))throw new Error("Invalid logger");y=d}}]),f}()).reset()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function f(g,d){for(var w=0;w<d.length;w++){var F=d[w];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(g,F.key,F)}}return function(g,d,w){return d&&f(g.prototype,d),w&&f(g,w),g}}(),c={setInterval:function(f){function g(d,w){return f.apply(this,arguments)}return g.toString=function(){return f.toString()},g}(function(f,g){return setInterval(f,g)}),clearInterval:function(f){function g(d){return f.apply(this,arguments)}return g.toString=function(){return f.toString()},g}(function(f){return clearInterval(f)})},y=!1,l=null;e.Global=function(){function f(){(function(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")})(this,f)}return f._testing=function(){y=!0},f.setXMLHttpRequest=function(d){l=d},a(f,null,[{key:"location",get:function(){if(!y)return location}},{key:"localStorage",get:function(){if(!y&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!y&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!y&&typeof window<"u")return l||XMLHttpRequest}},{key:"timer",get:function(){if(!y)return c}}]),f}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataService=void 0;var a=function(){function g(d,w){for(var F=0;F<w.length;F++){var P=w[F];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(d,P.key,P)}}return function(d,w,F){return w&&g(d.prototype,w),F&&g(d,F),d}}(),c=i(0),y=i(7);function l(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")}var f=".well-known/openid-configuration";e.MetadataService=function(){function g(d){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y.JsonService;if(l(this,g),!d)throw c.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=d,this._jsonService=new w(["application/jwk-set+json"])}return g.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},g.prototype.getMetadata=function(){var w=this;return this._settings.metadata?(c.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(c.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(F){c.Log.debug("MetadataService.getMetadata: json received");var P=w._settings.metadataSeed||{};return w._settings.metadata=Object.assign({},P,F),w._settings.metadata})):(c.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},g.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},g.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},g.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},g.prototype.getTokenEndpoint=function(){var w=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",w)},g.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},g.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},g.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},g.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},g.prototype._getMetadataProperty=function(w){var F=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return c.Log.debug("MetadataService.getMetadataProperty for: "+w),this.getMetadata().then(function(P){if(c.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),P[w]===void 0){if(F===!0)return void c.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+w);throw c.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+w),new Error("Metadata does not contain property "+w)}return P[w]})},g.prototype.getSigningKeys=function(){var w=this;return this._settings.signingKeys?(c.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(F){return c.Log.debug("MetadataService.getSigningKeys: jwks_uri received",F),w._jsonService.getJson(F).then(function(P){if(c.Log.debug("MetadataService.getSigningKeys: key set received",P),!P.keys)throw c.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return w._settings.signingKeys=P.keys,w._settings.signingKeys})})},a(g,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(f)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=f))),this._metadataUrl}}]),g}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UrlUtility=void 0;var a=i(0),c=i(1);e.UrlUtility=function(){function y(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,y)}return y.addQueryParam=function(f,g,d){return f.indexOf("?")<0&&(f+="?"),f[f.length-1]!=="?"&&(f+="&"),f+=encodeURIComponent(g),f+="=",f+=encodeURIComponent(d)},y.parseUrlFragment=function(f){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.Global;typeof f!="string"&&(f=d.location.href);var w=f.lastIndexOf(g);w>=0&&(f=f.substr(w+1)),g==="?"&&(w=f.indexOf("#"))>=0&&(f=f.substr(0,w));for(var F,P={},C=/([^&=]+)=([^&]*)/g,x=0;F=C.exec(f);)if(P[decodeURIComponent(F[1])]=decodeURIComponent(F[2].replace(/\+/g," ")),x++>50)return a.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",f),{error:"Response exceeded expected number of parameters"};for(var I in P)return P;return{}},y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JoseUtil=void 0;var a=i(26),c=function(l){return l&&l.__esModule?l:{default:l}}(i(33));e.JoseUtil=(0,c.default)({jws:a.jws,KeyUtil:a.KeyUtil,X509:a.X509,crypto:a.crypto,hextob64u:a.hextob64u,b64tohex:a.b64tohex,AllowedSigningAlgs:a.AllowedSigningAlgs})},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OidcClientSettings=void 0;var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c=function(){function I(R,K){for(var V=0;V<K.length;V++){var X=K[V];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(R,X.key,X)}}return function(R,K,V){return K&&I(R.prototype,K),V&&I(R,V),R}}(),y=i(0),l=i(23),f=i(6),g=i(24),d=i(2);function w(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}var F=".well-known/openid-configuration",P="id_token",C="openid",x="client_secret_post";e.OidcClientSettings=function(){function I(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},K=R.authority,V=R.metadataUrl,X=R.metadata,k=R.signingKeys,A=R.metadataSeed,Q=R.client_id,re=R.client_secret,D=R.response_type,he=D===void 0?P:D,pe=R.scope,Ee=pe===void 0?C:pe,$e=R.redirect_uri,je=R.post_logout_redirect_uri,Qe=R.client_authentication,Ze=Qe===void 0?x:Qe,lt=R.prompt,xe=R.display,Pe=R.max_age,it=R.ui_locales,Re=R.acr_values,De=R.resource,ft=R.response_mode,_t=R.filterProtocolClaims,Pt=_t===void 0||_t,ot=R.loadUserInfo,dt=ot===void 0||ot,Ve=R.staleStateAge,Be=Ve===void 0?900:Ve,$=R.clockSkew,v=$===void 0?300:$,_=R.clockService,M=_===void 0?new l.ClockService:_,J=R.userInfoJwtIssuer,te=J===void 0?"OP":J,se=R.mergeClaims,me=se!==void 0&&se,be=R.stateStore,Ne=be===void 0?new f.WebStorageStateStore:be,Te=R.ResponseValidatorCtor,Ce=Te===void 0?g.ResponseValidator:Te,qe=R.MetadataServiceCtor,wt=qe===void 0?d.MetadataService:qe,we=R.extraQueryParams,Le=we===void 0?{}:we,Ae=R.extraTokenParams,E=Ae===void 0?{}:Ae;w(this,I),this._authority=K,this._metadataUrl=V,this._metadata=X,this._metadataSeed=A,this._signingKeys=k,this._client_id=Q,this._client_secret=re,this._response_type=he,this._scope=Ee,this._redirect_uri=$e,this._post_logout_redirect_uri=je,this._client_authentication=Ze,this._prompt=lt,this._display=xe,this._max_age=Pe,this._ui_locales=it,this._acr_values=Re,this._resource=De,this._response_mode=ft,this._filterProtocolClaims=!!Pt,this._loadUserInfo=!!dt,this._staleStateAge=Be,this._clockSkew=v,this._clockService=M,this._userInfoJwtIssuer=te,this._mergeClaims=!!me,this._stateStore=Ne,this._validator=new Ce(this),this._metadataService=new wt(this),this._extraQueryParams=(Le===void 0?"undefined":a(Le))==="object"?Le:{},this._extraTokenParams=(E===void 0?"undefined":a(E))==="object"?E:{}}return I.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},c(I,[{key:"client_id",get:function(){return this._client_id},set:function(K){if(this._client_id)throw y.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=K}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(K){if(this._authority)throw y.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=K}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(F)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=F)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(K){this._metadata=K}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(K){this._metadataSeed=K}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(K){this._signingKeys=K}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(K){(K===void 0?"undefined":a(K))==="object"?this._extraQueryParams=K:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(K){(K===void 0?"undefined":a(K))==="object"?this._extraTokenParams=K:this._extraTokenParams={}}}]),I}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebStorageStateStore=void 0;var a=i(0),c=i(1);function y(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}e.WebStorageStateStore=function(){function l(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=f.prefix,d=g===void 0?"oidc.":g,w=f.store,F=w===void 0?c.Global.localStorage:w;y(this,l),this._store=F,this._prefix=d}return l.prototype.set=function(g,d){return a.Log.debug("WebStorageStateStore.set",g),g=this._prefix+g,this._store.setItem(g,d),Promise.resolve()},l.prototype.get=function(g){a.Log.debug("WebStorageStateStore.get",g),g=this._prefix+g;var d=this._store.getItem(g);return Promise.resolve(d)},l.prototype.remove=function(g){a.Log.debug("WebStorageStateStore.remove",g),g=this._prefix+g;var d=this._store.getItem(g);return this._store.removeItem(g),Promise.resolve(d)},l.prototype.getAllKeys=function(){a.Log.debug("WebStorageStateStore.getAllKeys");for(var g=[],d=0;d<this._store.length;d++){var w=this._store.key(d);w.indexOf(this._prefix)===0&&g.push(w.substr(this._prefix.length))}return Promise.resolve(g)},l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JsonService=void 0;var a=i(0),c=i(1);function y(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}e.JsonService=function(){function l(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.Global.XMLHttpRequest,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;y(this,l),f&&Array.isArray(f)?this._contentTypes=f.slice():this._contentTypes=[],this._contentTypes.push("application/json"),d&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=g,this._jwtHandler=d}return l.prototype.getJson=function(g,d){var w=this;if(!g)throw a.Log.error("JsonService.getJson: No url passed"),new Error("url");return a.Log.debug("JsonService.getJson, url: ",g),new Promise(function(F,P){var C=new w._XMLHttpRequest;C.open("GET",g);var x=w._contentTypes,I=w._jwtHandler;C.onload=function(){if(a.Log.debug("JsonService.getJson: HTTP response received, status",C.status),C.status===200){var R=C.getResponseHeader("Content-Type");if(R){var K=x.find(function(V){if(R.startsWith(V))return!0});if(K=="application/jwt")return void I(C).then(F,P);if(K)try{return void F(JSON.parse(C.responseText))}catch(V){return a.Log.error("JsonService.getJson: Error parsing JSON response",V.message),void P(V)}}P(Error("Invalid response Content-Type: "+R+", from URL: "+g))}else P(Error(C.statusText+" ("+C.status+")"))},C.onerror=function(){a.Log.error("JsonService.getJson: network error"),P(Error("Network Error"))},d&&(a.Log.debug("JsonService.getJson: token passed, setting Authorization header"),C.setRequestHeader("Authorization","Bearer "+d)),C.send()})},l.prototype.postForm=function(g,d,w){var F=this;if(!g)throw a.Log.error("JsonService.postForm: No url passed"),new Error("url");return a.Log.debug("JsonService.postForm, url: ",g),new Promise(function(P,C){var x=new F._XMLHttpRequest;x.open("POST",g);var I=F._contentTypes;x.onload=function(){if(a.Log.debug("JsonService.postForm: HTTP response received, status",x.status),x.status!==200){if(x.status===400&&(k=x.getResponseHeader("Content-Type"))&&I.find(function(A){if(k.startsWith(A))return!0}))try{var X=JSON.parse(x.responseText);if(X&&X.error)return a.Log.error("JsonService.postForm: Error from server: ",X.error),void C(new Error(X.error))}catch(A){return a.Log.error("JsonService.postForm: Error parsing JSON response",A.message),void C(A)}C(Error(x.statusText+" ("+x.status+")"))}else{var k;if((k=x.getResponseHeader("Content-Type"))&&I.find(function(A){if(k.startsWith(A))return!0}))try{return void P(JSON.parse(x.responseText))}catch(A){return a.Log.error("JsonService.postForm: Error parsing JSON response",A.message),void C(A)}C(Error("Invalid response Content-Type: "+k+", from URL: "+g))}},x.onerror=function(){a.Log.error("JsonService.postForm: network error"),C(Error("Network Error"))};var R="";for(var K in d){var V=d[K];V&&(R.length>0&&(R+="&"),R+=encodeURIComponent(K),R+="=",R+=encodeURIComponent(V))}x.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),w!==void 0&&x.setRequestHeader("Authorization","Basic "+btoa(w)),x.send(R)})},l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninRequest=void 0;var a=i(0),c=i(3),y=i(13);e.SigninRequest=function(){function l(f){var g=f.url,d=f.client_id,w=f.redirect_uri,F=f.response_type,P=f.scope,C=f.authority,x=f.data,I=f.prompt,R=f.display,K=f.max_age,V=f.ui_locales,X=f.id_token_hint,k=f.login_hint,A=f.acr_values,Q=f.resource,re=f.response_mode,D=f.request,he=f.request_uri,pe=f.extraQueryParams,Ee=f.request_type,$e=f.client_secret,je=f.extraTokenParams,Qe=f.skipUserInfo;if(function(De,ft){if(!(De instanceof ft))throw new TypeError("Cannot call a class as a function")}(this,l),!g)throw a.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!d)throw a.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!w)throw a.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!F)throw a.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!P)throw a.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!C)throw a.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Ze=l.isOidc(F),lt=l.isCode(F);re||(re=l.isCode(F)?"query":null),this.state=new y.SigninState({nonce:Ze,data:x,client_id:d,authority:C,redirect_uri:w,code_verifier:lt,request_type:Ee,response_mode:re,client_secret:$e,scope:P,extraTokenParams:je,skipUserInfo:Qe}),g=c.UrlUtility.addQueryParam(g,"client_id",d),g=c.UrlUtility.addQueryParam(g,"redirect_uri",w),g=c.UrlUtility.addQueryParam(g,"response_type",F),g=c.UrlUtility.addQueryParam(g,"scope",P),g=c.UrlUtility.addQueryParam(g,"state",this.state.id),Ze&&(g=c.UrlUtility.addQueryParam(g,"nonce",this.state.nonce)),lt&&(g=c.UrlUtility.addQueryParam(g,"code_challenge",this.state.code_challenge),g=c.UrlUtility.addQueryParam(g,"code_challenge_method","S256"));var xe={prompt:I,display:R,max_age:K,ui_locales:V,id_token_hint:X,login_hint:k,acr_values:A,resource:Q,request:D,request_uri:he,response_mode:re};for(var Pe in xe)xe[Pe]&&(g=c.UrlUtility.addQueryParam(g,Pe,xe[Pe]));for(var it in pe)g=c.UrlUtility.addQueryParam(g,it,pe[it]);this.url=g}return l.isOidc=function(g){return!!g.split(/\s+/g).filter(function(d){return d==="id_token"})[0]},l.isOAuth=function(g){return!!g.split(/\s+/g).filter(function(d){return d==="token"})[0]},l.isCode=function(g){return!!g.split(/\s+/g).filter(function(d){return d==="code"})[0]},l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0;var a=function(){function f(g,d){for(var w=0;w<d.length;w++){var F=d[w];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(g,F.key,F)}}return function(g,d,w){return d&&f(g.prototype,d),w&&f(g,w),g}}(),c=i(0),y=function(g){return g&&g.__esModule?g:{default:g}}(i(14));function l(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}e.State=function(){function f(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=g.id,w=g.data,F=g.created,P=g.request_type;l(this,f),this._id=d||(0,y.default)(),this._data=w,this._created=typeof F=="number"&&F>0?F:parseInt(Date.now()/1e3),this._request_type=P}return f.prototype.toStorageString=function(){return c.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},f.fromStorageString=function(d){return c.Log.debug("State.fromStorageString"),new f(JSON.parse(d))},f.clearStaleState=function(d,w){var F=Date.now()/1e3-w;return d.getAllKeys().then(function(P){c.Log.debug("State.clearStaleState: got keys",P);for(var C=[],x=function(V){var X=P[V];R=d.get(X).then(function(k){var A=!1;if(k)try{var Q=f.fromStorageString(k);c.Log.debug("State.clearStaleState: got item from key: ",X,Q.created),Q.created<=F&&(A=!0)}catch(re){c.Log.error("State.clearStaleState: Error parsing state for key",X,re.message),A=!0}else c.Log.debug("State.clearStaleState: no item in storage for key: ",X),A=!0;if(A)return c.Log.debug("State.clearStaleState: removed item for key: ",X),d.remove(X)}),C.push(R)},I=0;I<P.length;I++){var R;x(I)}return c.Log.debug("State.clearStaleState: waiting on promise count:",C.length),Promise.all(C)})},a(f,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),f}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OidcClient=void 0;var a=function(){function x(I,R){for(var K=0;K<R.length;K++){var V=R[K];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(I,V.key,V)}}return function(I,R,K){return R&&x(I.prototype,R),K&&x(I,K),I}}(),c=i(0),y=i(5),l=i(12),f=i(8),g=i(34),d=i(35),w=i(36),F=i(13),P=i(9);function C(x,I){if(!(x instanceof I))throw new TypeError("Cannot call a class as a function")}e.OidcClient=function(){function x(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};C(this,x),I instanceof y.OidcClientSettings?this._settings=I:this._settings=new y.OidcClientSettings(I)}return x.prototype.createSigninRequest=function(){var R=this,K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=K.response_type,X=K.scope,k=K.redirect_uri,A=K.data,Q=K.state,re=K.prompt,D=K.display,he=K.max_age,pe=K.ui_locales,Ee=K.id_token_hint,$e=K.login_hint,je=K.acr_values,Qe=K.resource,Ze=K.request,lt=K.request_uri,xe=K.response_mode,Pe=K.extraQueryParams,it=K.extraTokenParams,Re=K.request_type,De=K.skipUserInfo,ft=arguments[1];c.Log.debug("OidcClient.createSigninRequest");var _t=this._settings.client_id;V=V||this._settings.response_type,X=X||this._settings.scope,k=k||this._settings.redirect_uri,re=re||this._settings.prompt,D=D||this._settings.display,he=he||this._settings.max_age,pe=pe||this._settings.ui_locales,je=je||this._settings.acr_values,Qe=Qe||this._settings.resource,xe=xe||this._settings.response_mode,Pe=Pe||this._settings.extraQueryParams,it=it||this._settings.extraTokenParams;var Pt=this._settings.authority;return f.SigninRequest.isCode(V)&&V!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(ot){c.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",ot);var dt=new f.SigninRequest({url:ot,client_id:_t,redirect_uri:k,response_type:V,scope:X,data:A||Q,authority:Pt,prompt:re,display:D,max_age:he,ui_locales:pe,id_token_hint:Ee,login_hint:$e,acr_values:je,resource:Qe,request:Ze,request_uri:lt,extraQueryParams:Pe,extraTokenParams:it,request_type:Re,response_mode:xe,client_secret:R._settings.client_secret,skipUserInfo:De}),Ve=dt.state;return(ft=ft||R._stateStore).set(Ve.id,Ve.toStorageString()).then(function(){return dt})})},x.prototype.readSigninResponseState=function(R,K){var V=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSigninResponseState");var X=this._settings.response_mode==="query"||!this._settings.response_mode&&f.SigninRequest.isCode(this._settings.response_type),k=X?"?":"#",A=new g.SigninResponse(R,k);if(!A.state)return c.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));K=K||this._stateStore;var Q=V?K.remove.bind(K):K.get.bind(K);return Q(A.state).then(function(re){if(!re)throw c.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:F.SigninState.fromStorageString(re),response:A}})},x.prototype.processSigninResponse=function(R,K){var V=this;return c.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(R,K,!0).then(function(X){var k=X.state,A=X.response;return c.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),V._validator.validateSigninResponse(k,A)})},x.prototype.createSignoutRequest=function(){var R=this,K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=K.id_token_hint,X=K.data,k=K.state,A=K.post_logout_redirect_uri,Q=K.extraQueryParams,re=K.request_type,D=arguments[1];return c.Log.debug("OidcClient.createSignoutRequest"),A=A||this._settings.post_logout_redirect_uri,Q=Q||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(he){if(!he)throw c.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");c.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",he);var pe=new d.SignoutRequest({url:he,id_token_hint:V,post_logout_redirect_uri:A,data:X||k,extraQueryParams:Q,request_type:re}),Ee=pe.state;return Ee&&(c.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(D=D||R._stateStore).set(Ee.id,Ee.toStorageString())),pe})},x.prototype.readSignoutResponseState=function(R,K){var V=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSignoutResponseState");var X=new w.SignoutResponse(R);if(!X.state)return c.Log.debug("OidcClient.readSignoutResponseState: No state in response"),X.error?(c.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",X.error),Promise.reject(new l.ErrorResponse(X))):Promise.resolve({state:void 0,response:X});var k=X.state;K=K||this._stateStore;var A=V?K.remove.bind(K):K.get.bind(K);return A(k).then(function(Q){if(!Q)throw c.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:P.State.fromStorageString(Q),response:X}})},x.prototype.processSignoutResponse=function(R,K){var V=this;return c.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(R,K,!0).then(function(X){var k=X.state,A=X.response;return k?(c.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),V._validator.validateSignoutResponse(k,A)):(c.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),A)})},x.prototype.clearStaleState=function(R){return c.Log.debug("OidcClient.clearStaleState"),R=R||this._stateStore,P.State.clearStaleState(R,this.settings.staleStateAge)},a(x,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),x}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenClient=void 0;var a=i(7),c=i(2),y=i(0);function l(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}e.TokenClient=function(){function f(g){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.JsonService,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(l(this,f),!g)throw y.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=g,this._jsonService=new d,this._metadataService=new w(this._settings)}return f.prototype.exchangeCode=function(){var d=this,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(w=Object.assign({},w)).grant_type=w.grant_type||"authorization_code",w.client_id=w.client_id||this._settings.client_id,w.client_secret=w.client_secret||this._settings.client_secret,w.redirect_uri=w.redirect_uri||this._settings.redirect_uri;var F=void 0,P=w._client_authentication||this._settings._client_authentication;return delete w._client_authentication,w.code?w.redirect_uri?w.code_verifier?w.client_id?w.client_secret||P!="client_secret_basic"?(P=="client_secret_basic"&&(F=w.client_id+":"+w.client_secret,delete w.client_id,delete w.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(C){return y.Log.debug("TokenClient.exchangeCode: Received token endpoint"),d._jsonService.postForm(C,w,F).then(function(x){return y.Log.debug("TokenClient.exchangeCode: response received"),x})})):(y.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(y.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(y.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(y.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(y.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},f.prototype.exchangeRefreshToken=function(){var d=this,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(w=Object.assign({},w)).grant_type=w.grant_type||"refresh_token",w.client_id=w.client_id||this._settings.client_id,w.client_secret=w.client_secret||this._settings.client_secret;var F=void 0,P=w._client_authentication||this._settings._client_authentication;return delete w._client_authentication,w.refresh_token?w.client_id?(P=="client_secret_basic"&&(F=w.client_id+":"+w.client_secret,delete w.client_id,delete w.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(C){return y.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),d._jsonService.postForm(C,w,F).then(function(x){return y.Log.debug("TokenClient.exchangeRefreshToken: response received"),x})})):(y.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(y.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},f}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorResponse=void 0;var a=i(0);function c(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}function y(l,f){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?l:f}e.ErrorResponse=function(l){function f(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=g.error,w=g.error_description,F=g.error_uri,P=g.state,C=g.session_state;if(c(this,f),!d)throw a.Log.error("No error passed to ErrorResponse"),new Error("error");var x=y(this,l.call(this,w||d));return x.name="ErrorResponse",x.error=d,x.error_description=w,x.error_uri=F,x.state=P,x.session_state=C,x}return function(d,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);d.prototype=Object.create(w&&w.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(d,w):d.__proto__=w)}(f,l),f}(Error)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninState=void 0;var a=function(){function w(F,P){for(var C=0;C<P.length;C++){var x=P[C];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(F,x.key,x)}}return function(F,P,C){return P&&w(F.prototype,P),C&&w(F,C),F}}(),c=i(0),y=i(9),l=i(4),f=function(F){return F&&F.__esModule?F:{default:F}}(i(14));function g(w,F){if(!(w instanceof F))throw new TypeError("Cannot call a class as a function")}function d(w,F){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!F||typeof F!="object"&&typeof F!="function"?w:F}e.SigninState=function(w){function F(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},C=P.nonce,x=P.authority,I=P.client_id,R=P.redirect_uri,K=P.code_verifier,V=P.response_mode,X=P.client_secret,k=P.scope,A=P.extraTokenParams,Q=P.skipUserInfo;g(this,F);var re=d(this,w.call(this,arguments[0]));if(C===!0?re._nonce=(0,f.default)():C&&(re._nonce=C),K===!0?re._code_verifier=(0,f.default)()+(0,f.default)()+(0,f.default)():K&&(re._code_verifier=K),re.code_verifier){var D=l.JoseUtil.hashString(re.code_verifier,"SHA256");re._code_challenge=l.JoseUtil.hexToBase64Url(D)}return re._redirect_uri=R,re._authority=x,re._client_id=I,re._response_mode=V,re._client_secret=X,re._scope=k,re._extraTokenParams=A,re._skipUserInfo=Q,re}return function(C,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);C.prototype=Object.create(x&&x.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(C,x):C.__proto__=x)}(F,w),F.prototype.toStorageString=function(){return c.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},F.fromStorageString=function(C){return c.Log.debug("SigninState.fromStorageString"),new F(JSON.parse(C))},a(F,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),F}(y.State)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return(a!="undefined"&&a!==null&&a.getRandomValues!==void 0?c:y)().replace(/-/g,"")};var a=typeof window<"u"?window.crypto||window.msCrypto:null;function c(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(l){return(l^a.getRandomValues(new Uint8Array(1))[0]&15>>l/4).toString(16)})}function y(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(l){return(l^16*Math.random()>>l/4).toString(16)})}s.exports=e.default},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.User=void 0;var a=function(){function y(l,f){for(var g=0;g<f.length;g++){var d=f[g];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,f,g){return f&&y(l.prototype,f),g&&y(l,g),l}}(),c=i(0);e.User=function(){function y(l){var f=l.id_token,g=l.session_state,d=l.access_token,w=l.refresh_token,F=l.token_type,P=l.scope,C=l.profile,x=l.expires_at,I=l.state;(function(K,V){if(!(K instanceof V))throw new TypeError("Cannot call a class as a function")})(this,y),this.id_token=f,this.session_state=g,this.access_token=d,this.refresh_token=w,this.token_type=F,this.scope=P,this.profile=C,this.expires_at=x,this.state=I}return y.prototype.toStorageString=function(){return c.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},y.fromStorageString=function(f){return c.Log.debug("User.fromStorageString"),new y(JSON.parse(f))},a(y,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var g=parseInt(f);if(typeof g=="number"&&g>0){var d=parseInt(Date.now()/1e3);this.expires_at=d+g}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AccessTokenEvents=void 0;var a=i(0),c=i(46);function y(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}e.AccessTokenEvents=function(){function l(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=f.accessTokenExpiringNotificationTime,d=g===void 0?60:g,w=f.accessTokenExpiringTimer,F=w===void 0?new c.Timer("Access token expiring"):w,P=f.accessTokenExpiredTimer,C=P===void 0?new c.Timer("Access token expired"):P;y(this,l),this._accessTokenExpiringNotificationTime=d,this._accessTokenExpiring=F,this._accessTokenExpired=C}return l.prototype.load=function(g){if(g.access_token&&g.expires_in!==void 0){var d=g.expires_in;if(a.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",d),d>0){var w=d-this._accessTokenExpiringNotificationTime;w<=0&&(w=1),a.Log.debug("AccessTokenEvents.load: registering expiring timer in:",w),this._accessTokenExpiring.init(w)}else a.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var F=d+1;a.Log.debug("AccessTokenEvents.load: registering expired timer in:",F),this._accessTokenExpired.init(F)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},l.prototype.unload=function(){a.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},l.prototype.addAccessTokenExpiring=function(g){this._accessTokenExpiring.addHandler(g)},l.prototype.removeAccessTokenExpiring=function(g){this._accessTokenExpiring.removeHandler(g)},l.prototype.addAccessTokenExpired=function(g){this._accessTokenExpired.addHandler(g)},l.prototype.removeAccessTokenExpired=function(g){this._accessTokenExpired.removeHandler(g)},l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Event=void 0;var a=i(0);e.Event=function(){function c(y){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,c),this._name=y,this._callbacks=[]}return c.prototype.addHandler=function(l){this._callbacks.push(l)},c.prototype.removeHandler=function(l){var f=this._callbacks.findIndex(function(g){return g===l});f>=0&&this._callbacks.splice(f,1)},c.prototype.raise=function(){a.Log.debug("Event: Raising event: "+this._name);for(var l=0;l<this._callbacks.length;l++){var f;(f=this._callbacks)[l].apply(f,arguments)}},c}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionMonitor=void 0;var a=function(){function g(d,w){for(var F=0;F<w.length;F++){var P=w[F];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(d,P.key,P)}}return function(d,w,F){return w&&g(d.prototype,w),F&&g(d,F),d}}(),c=i(0),y=i(19),l=i(1);function f(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")}e.SessionMonitor=function(){function g(d){var w=this,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y.CheckSessionIFrame,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.Global.timer;if(f(this,g),!d)throw c.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=d,this._CheckSessionIFrameCtor=F,this._timer=P,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(C){C?w._start(C):w._settings.monitorAnonymousSession&&w._userManager.querySessionStatus().then(function(x){var I={session_state:x.session_state};x.sub&&x.sid&&(I.profile={sub:x.sub,sid:x.sid}),w._start(I)}).catch(function(x){c.Log.error("SessionMonitor ctor: error from querySessionStatus:",x.message)})}).catch(function(C){c.Log.error("SessionMonitor ctor: error from getUser:",C.message)}))}return g.prototype._start=function(w){var F=this,P=w.session_state;P&&(w.profile?(this._sub=w.profile.sub,this._sid=w.profile.sid,c.Log.debug("SessionMonitor._start: session_state:",P,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,c.Log.debug("SessionMonitor._start: session_state:",P,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(P):this._metadataService.getCheckSessionIframe().then(function(C){if(C){c.Log.debug("SessionMonitor._start: Initializing check session iframe");var x=F._client_id,I=F._checkSessionInterval,R=F._stopCheckSessionOnError;F._checkSessionIFrame=new F._CheckSessionIFrameCtor(F._callback.bind(F),x,C,I,R),F._checkSessionIFrame.load().then(function(){F._checkSessionIFrame.start(P)})}else c.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(C){c.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",C.message)}))},g.prototype._stop=function(){var w=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(c.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var F=this._timer.setInterval(function(){w._timer.clearInterval(F),w._userManager.querySessionStatus().then(function(P){var C={session_state:P.session_state};P.sub&&P.sid&&(C.profile={sub:P.sub,sid:P.sid}),w._start(C)}).catch(function(P){c.Log.error("SessionMonitor: error from querySessionStatus:",P.message)})},1e3)},g.prototype._callback=function(){var w=this;this._userManager.querySessionStatus().then(function(F){var P=!0;F?F.sub===w._sub?(P=!1,w._checkSessionIFrame.start(F.session_state),F.sid===w._sid?c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",F.session_state):(c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",F.session_state),w._userManager.events._raiseUserSessionChanged())):c.Log.debug("SessionMonitor._callback: Different subject signed into OP:",F.sub):c.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),P&&(w._sub?(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),w._userManager.events._raiseUserSignedOut()):(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),w._userManager.events._raiseUserSignedIn()))}).catch(function(F){w._sub&&(c.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",F.message),w._userManager.events._raiseUserSignedOut())})},a(g,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),g}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CheckSessionIFrame=void 0;var a=i(0);function c(y,l){if(!(y instanceof l))throw new TypeError("Cannot call a class as a function")}e.CheckSessionIFrame=function(){function y(l,f,g,d){var w=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];c(this,y),this._callback=l,this._client_id=f,this._url=g,this._interval=d||2e3,this._stopOnError=w;var F=g.indexOf("/",g.indexOf("//")+2);this._frame_origin=g.substr(0,F),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=g}return y.prototype.load=function(){var f=this;return new Promise(function(g){f._frame.onload=function(){g()},window.document.body.appendChild(f._frame),f._boundMessageEvent=f._message.bind(f),window.addEventListener("message",f._boundMessageEvent,!1)})},y.prototype._message=function(f){f.origin===this._frame_origin&&f.source===this._frame.contentWindow&&(f.data==="error"?(a.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):f.data==="changed"?(a.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):a.Log.debug("CheckSessionIFrame: "+f.data+" message from check session op iframe"))},y.prototype.start=function(f){var g=this;if(this._session_state!==f){a.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=f;var d=function(){g._frame.contentWindow.postMessage(g._client_id+" "+g._session_state,g._frame_origin)};d(),this._timer=window.setInterval(d,this._interval)}},y.prototype.stop=function(){this._session_state=null,this._timer&&(a.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenRevocationClient=void 0;var a=i(0),c=i(2),y=i(1);function l(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")}var f="access_token",g="refresh_token";e.TokenRevocationClient=function(){function d(w){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y.Global.XMLHttpRequest,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(l(this,d),!w)throw a.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=w,this._XMLHttpRequestCtor=F,this._metadataService=new P(this._settings)}return d.prototype.revoke=function(F,P){var C=this,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!F)throw a.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(x!==f&&x!=g)throw a.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(I){if(I){a.Log.debug("TokenRevocationClient.revoke: Revoking "+x);var R=C._settings.client_id,K=C._settings.client_secret;return C._revoke(I,R,K,F,x)}if(P)throw a.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},d.prototype._revoke=function(F,P,C,x,I){var R=this;return new Promise(function(K,V){var X=new R._XMLHttpRequestCtor;X.open("POST",F),X.onload=function(){a.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",X.status),X.status===200?K():V(Error(X.statusText+" ("+X.status+")"))},X.onerror=function(){a.Log.debug("TokenRevocationClient.revoke: Network Error."),V("Network Error")};var k="client_id="+encodeURIComponent(P);C&&(k+="&client_secret="+encodeURIComponent(C)),k+="&token_type_hint="+encodeURIComponent(I),k+="&token="+encodeURIComponent(x),X.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),X.send(k)})},d}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaPopupWindow=void 0;var a=function(){function y(l,f){for(var g=0;g<f.length;g++){var d=f[g];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,f,g){return f&&y(l.prototype,f),g&&y(l,g),l}}(),c=i(0);e.CordovaPopupWindow=function(){function y(l){var f=this;(function(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")})(this,y),this._promise=new Promise(function(g,d){f._resolve=g,f._reject=d}),this.features=l.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=l.popupWindowTarget||"_blank",this.redirect_uri=l.startUrl,c.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return y.prototype._isInAppBrowserInstalled=function(f){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(g){return f.hasOwnProperty(g)})},y.prototype.navigate=function(f){if(f&&f.url){if(!window.cordova)return this._error("cordova is undefined");var g=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(g)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(f.url,this.target,this.features),this._popup?(c.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},y.prototype._loadStartCallback=function(f){f.url.indexOf(this.redirect_uri)===0&&this._success({url:f.url})},y.prototype._exitCallback=function(f){this._error(f)},y.prototype._success=function(f){this._cleanup(),c.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(f)},y.prototype._error=function(f){this._cleanup(),c.Log.error(f),this._reject(new Error(f))},y.prototype.close=function(){this._cleanup()},y.prototype._cleanup=function(){this._popup&&(c.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},a(y,[{key:"promise",get:function(){return this._promise}}]),y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(0),c=i(10),y=i(5),l=i(6),f=i(37),g=i(38),d=i(16),w=i(2),F=i(48),P=i(49),C=i(19),x=i(20),I=i(18),R=i(1),K=i(15),V=i(50);e.default={Version:V.Version,Log:a.Log,OidcClient:c.OidcClient,OidcClientSettings:y.OidcClientSettings,WebStorageStateStore:l.WebStorageStateStore,InMemoryWebStorage:f.InMemoryWebStorage,UserManager:g.UserManager,AccessTokenEvents:d.AccessTokenEvents,MetadataService:w.MetadataService,CordovaPopupNavigator:F.CordovaPopupNavigator,CordovaIFrameNavigator:P.CordovaIFrameNavigator,CheckSessionIFrame:C.CheckSessionIFrame,TokenRevocationClient:x.TokenRevocationClient,SessionMonitor:I.SessionMonitor,Global:R.Global,User:K.User},s.exports=e.default},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ClockService=function(){function a(){(function(y,l){if(!(y instanceof l))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},a}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResponseValidator=void 0;var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c=i(0),y=i(2),l=i(25),f=i(11),g=i(12),d=i(4);function w(P,C){if(!(P instanceof C))throw new TypeError("Cannot call a class as a function")}var F=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];e.ResponseValidator=function(){function P(C){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y.MetadataService,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.UserInfoService,R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:d.JoseUtil,K=arguments.length>4&&arguments[4]!==void 0?arguments[4]:f.TokenClient;if(w(this,P),!C)throw c.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=C,this._metadataService=new x(this._settings),this._userInfoService=new I(this._settings),this._joseUtil=R,this._tokenClient=new K(this._settings)}return P.prototype.validateSigninResponse=function(x,I){var R=this;return c.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(x,I).then(function(K){return c.Log.debug("ResponseValidator.validateSigninResponse: state processed"),R._validateTokens(x,K).then(function(V){return c.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),R._processClaims(x,V).then(function(X){return c.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),X})})})},P.prototype.validateSignoutResponse=function(x,I){return x.id!==I.state?(c.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(c.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),I.state=x.data,I.error?(c.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",I.error),Promise.reject(new g.ErrorResponse(I))):Promise.resolve(I))},P.prototype._processSigninParams=function(x,I){if(x.id!==I.state)return c.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!x.client_id)return c.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!x.authority)return c.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==x.authority)return c.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=x.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==x.client_id)return c.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=x.client_id;return c.Log.debug("ResponseValidator._processSigninParams: state validated"),I.state=x.data,I.error?(c.Log.warn("ResponseValidator._processSigninParams: Response was error",I.error),Promise.reject(new g.ErrorResponse(I))):x.nonce&&!I.id_token?(c.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!x.nonce&&I.id_token?(c.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):x.code_verifier&&!I.code?(c.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!x.code_verifier&&I.code?(c.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(I.scope||(I.scope=x.scope),Promise.resolve(I))},P.prototype._processClaims=function(x,I){var R=this;if(I.isOpenIdConnect){if(c.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),I.profile=this._filterProtocolClaims(I.profile),x.skipUserInfo!==!0&&this._settings.loadUserInfo&&I.access_token)return c.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(I.access_token).then(function(K){return c.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),K.sub!==I.profile.sub?(c.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(I.profile=R._mergeClaims(I.profile,K),c.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",I.profile),I)});c.Log.debug("ResponseValidator._processClaims: not loading user info")}else c.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(I)},P.prototype._mergeClaims=function(x,I){var R=Object.assign({},x);for(var K in I){var V=I[K];Array.isArray(V)||(V=[V]);for(var X=0;X<V.length;X++){var k=V[X];R[K]?Array.isArray(R[K])?R[K].indexOf(k)<0&&R[K].push(k):R[K]!==k&&((k===void 0?"undefined":a(k))==="object"&&this._settings.mergeClaims?R[K]=this._mergeClaims(R[K],k):R[K]=[R[K],k]):R[K]=k}}return R},P.prototype._filterProtocolClaims=function(x){c.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",x);var I=Object.assign({},x);return this._settings._filterProtocolClaims?(F.forEach(function(R){delete I[R]}),c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",I)):c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),I},P.prototype._validateTokens=function(x,I){return I.code?(c.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(x,I)):I.id_token?I.access_token?(c.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(x,I)):(c.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(x,I)):(c.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(I))},P.prototype._processCode=function(x,I){var R=this,K={client_id:x.client_id,client_secret:x.client_secret,code:I.code,redirect_uri:x.redirect_uri,code_verifier:x.code_verifier};return x.extraTokenParams&&a(x.extraTokenParams)==="object"&&Object.assign(K,x.extraTokenParams),this._tokenClient.exchangeCode(K).then(function(V){for(var X in V)I[X]=V[X];return I.id_token?(c.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),R._validateIdTokenAttributes(x,I)):(c.Log.debug("ResponseValidator._processCode: token response successful, returning response"),I)})},P.prototype._validateIdTokenAttributes=function(x,I){var R=this;return this._metadataService.getIssuer().then(function(K){var V=x.client_id,X=R._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",X),R._settings.getEpochTime().then(function(k){return R._joseUtil.validateJwtAttributes(I.id_token,K,V,X,k).then(function(A){return x.nonce&&x.nonce!==A.nonce?(c.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):A.sub?(I.profile=A,I):(c.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},P.prototype._validateIdTokenAndAccessToken=function(x,I){var R=this;return this._validateIdToken(x,I).then(function(K){return R._validateAccessToken(K)})},P.prototype._getSigningKeyForJwt=function(x){var I=this;return this._metadataService.getSigningKeys().then(function(R){var K=x.header.kid;if(!R)return c.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));c.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var V=void 0;if(K)V=R.filter(function(X){return X.kid===K})[0];else{if((R=I._filterByAlg(R,x.header.alg)).length>1)return c.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));V=R[0]}return Promise.resolve(V)})},P.prototype._getSigningKeyForJwtWithSingleRetry=function(x){var I=this;return this._getSigningKeyForJwt(x).then(function(R){return R?Promise.resolve(R):(I._metadataService.resetSigningKeys(),I._getSigningKeyForJwt(x))})},P.prototype._validateIdToken=function(x,I){var R=this;if(!x.nonce)return c.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var K=this._joseUtil.parseJwt(I.id_token);return K&&K.header&&K.payload?x.nonce!==K.payload.nonce?(c.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(V){return c.Log.debug("ResponseValidator._validateIdToken: Received issuer"),R._getSigningKeyForJwtWithSingleRetry(K).then(function(X){if(!X)return c.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var k=x.client_id,A=R._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",A),R._joseUtil.validateJwt(I.id_token,X,V,k,A).then(function(){return c.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),K.payload.sub?(I.profile=K.payload,I):(c.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(c.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",K),Promise.reject(new Error("Failed to parse id_token")))},P.prototype._filterByAlg=function(x,I){var R=null;if(I.startsWith("RS"))R="RSA";else if(I.startsWith("PS"))R="PS";else{if(!I.startsWith("ES"))return c.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",I),[];R="EC"}return c.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",R),x=x.filter(function(K){return K.kty===R}),c.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",R,x.length),x},P.prototype._validateAccessToken=function(x){if(!x.profile)return c.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!x.profile.at_hash)return c.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!x.id_token)return c.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var I=this._joseUtil.parseJwt(x.id_token);if(!I||!I.header)return c.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",I),Promise.reject(new Error("Failed to parse id_token"));var R=I.header.alg;if(!R||R.length!==5)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R),Promise.reject(new Error("Unsupported alg: "+R));var K=R.substr(2,3);if(!K)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,K),Promise.reject(new Error("Unsupported alg: "+R));if((K=parseInt(K))!==256&&K!==384&&K!==512)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,K),Promise.reject(new Error("Unsupported alg: "+R));var V="sha"+K,X=this._joseUtil.hashString(x.access_token,V);if(!X)return c.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",V),Promise.reject(new Error("Failed to validate at_hash"));var k=X.substr(0,X.length/2),A=this._joseUtil.hexToBase64Url(k);return A!==x.profile.at_hash?(c.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",A,x.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(c.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(x))},P}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserInfoService=void 0;var a=i(7),c=i(2),y=i(0),l=i(4);function f(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")}e.UserInfoService=function(){function g(d){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.JsonService,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.JoseUtil;if(f(this,g),!d)throw y.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=d,this._jsonService=new w(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new F(this._settings),this._joseUtil=P}return g.prototype.getClaims=function(w){var F=this;return w?this._metadataService.getUserInfoEndpoint().then(function(P){return y.Log.debug("UserInfoService.getClaims: received userinfo url",P),F._jsonService.getJson(P,w).then(function(C){return y.Log.debug("UserInfoService.getClaims: claims received",C),C})}):(y.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},g.prototype._getClaimsFromJwt=function(w){var F=this;try{var P=this._joseUtil.parseJwt(w.responseText);if(!P||!P.header||!P.payload)return y.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",P),Promise.reject(new Error("Failed to parse id_token"));var C=P.header.kid,x=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":x=this._metadataService.getIssuer();break;case"ANY":x=Promise.resolve(P.payload.iss);break;default:x=Promise.resolve(this._settings.userInfoJwtIssuer)}return x.then(function(I){return y.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+I),F._metadataService.getSigningKeys().then(function(R){if(!R)return y.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));y.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var K=void 0;if(C)K=R.filter(function(k){return k.kid===C})[0];else{if((R=F._filterByAlg(R,P.header.alg)).length>1)return y.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));K=R[0]}if(!K)return y.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var V=F._settings.client_id,X=F._settings.clockSkew;return y.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",X),F._joseUtil.validateJwt(w.responseText,K,I,V,X,void 0,!0).then(function(){return y.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),P.payload})})})}catch(I){return y.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",I.message),void reject(I)}},g.prototype._filterByAlg=function(w,F){var P=null;if(F.startsWith("RS"))P="RSA";else if(F.startsWith("PS"))P="PS";else{if(!F.startsWith("ES"))return y.Log.debug("UserInfoService._filterByAlg: alg not supported: ",F),[];P="EC"}return y.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",P),w=w.filter(function(C){return C.kty===P}),y.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",P,w.length),w},g}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AllowedSigningAlgs=e.b64tohex=e.hextob64u=e.crypto=e.X509=e.KeyUtil=e.jws=void 0;var a=i(27);e.jws=a.jws,e.KeyUtil=a.KEYUTIL,e.X509=a.X509,e.crypto=a.crypto,e.hextob64u=a.hextob64u,e.b64tohex=a.b64tohex,e.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(s,e,i){"use strict";(function(a){Object.defineProperty(e,"__esModule",{value:!0});var c,y,l,f,g,d,w,F,P,C,x,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},R={userAgent:!1},K={},V=V||(c=Math,l=(y={}).lib={},f=l.Base=function(){function r(){}return{extend:function(n){r.prototype=this;var o=new r;return n&&o.mixIn(n),o.hasOwnProperty("init")||(o.init=function(){o.$super.init.apply(this,arguments)}),o.init.prototype=o,o.$super=this,o},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var o in n)n.hasOwnProperty(o)&&(this[o]=n[o]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=l.WordArray=f.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n??4*t.length},toString:function(t){return(t||w).stringify(this)},concat:function(t){var n=this.words,o=t.words,h=this.sigBytes,m=t.sigBytes;if(this.clamp(),h%4)for(var b=0;b<m;b++){var N=o[b>>>2]>>>24-b%4*8&255;n[h+b>>>2]|=N<<24-(h+b)%4*8}else for(b=0;b<m;b+=4)n[h+b>>>2]=o[b>>>2];return this.sigBytes+=m,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=c.ceil(n/4)},clone:function(){var t=f.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var n=[],o=0;o<t;o+=4)n.push(4294967296*c.random()|0);return new g.init(n,t)}}),d=y.enc={},w=d.Hex={stringify:function(t){for(var n=t.words,o=t.sigBytes,h=[],m=0;m<o;m++){var b=n[m>>>2]>>>24-m%4*8&255;h.push((b>>>4).toString(16)),h.push((15&b).toString(16))}return h.join("")},parse:function(t){for(var n=t.length,o=[],h=0;h<n;h+=2)o[h>>>3]|=parseInt(t.substr(h,2),16)<<24-h%8*4;return new g.init(o,n/2)}},F=d.Latin1={stringify:function(t){for(var n=t.words,o=t.sigBytes,h=[],m=0;m<o;m++){var b=n[m>>>2]>>>24-m%4*8&255;h.push(String.fromCharCode(b))}return h.join("")},parse:function(t){for(var n=t.length,o=[],h=0;h<n;h++)o[h>>>2]|=(255&t.charCodeAt(h))<<24-h%4*8;return new g.init(o,n)}},P=d.Utf8={stringify:function(t){try{return decodeURIComponent(escape(F.stringify(t)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(t){return F.parse(unescape(encodeURIComponent(t)))}},C=l.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(t){typeof t=="string"&&(t=P.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var n=this._data,o=n.words,h=n.sigBytes,m=this.blockSize,b=h/(4*m),N=(b=t?c.ceil(b):c.max((0|b)-this._minBufferSize,0))*m,T=c.min(4*N,h);if(N){for(var U=0;U<N;U+=m)this._doProcessBlock(o,U);var B=o.splice(0,N);n.sigBytes-=T}return new g.init(B,T)},clone:function(){var t=f.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),l.Hasher=C.extend({cfg:f.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){C.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(n,o){return new t.init(o).finalize(n)}},_createHmacHelper:function(t){return function(n,o){return new x.HMAC.init(t,o).finalize(n)}}}),x=y.algo={},y);(function(r){var t,n=(t=V).lib,o=n.Base,h=n.WordArray;(t=t.x64={}).Word=o.extend({init:function(b,N){this.high=b,this.low=N}}),t.WordArray=o.extend({init:function(b,N){b=this.words=b||[],this.sigBytes=N??8*b.length},toX32:function(){for(var b=this.words,N=b.length,T=[],U=0;U<N;U++){var B=b[U];T.push(B.high),T.push(B.low)}return h.create(T,this.sigBytes)},clone:function(){for(var b=o.clone.call(this),N=b.words=this.words.slice(0),T=N.length,U=0;U<T;U++)N[U]=N[U].clone();return b}})})(),function(){var r=V,t=r.lib.WordArray;r.enc.Base64={stringify:function(o){var h=o.words,m=o.sigBytes,b=this._map;o.clamp(),o=[];for(var N=0;N<m;N+=3)for(var T=(h[N>>>2]>>>24-N%4*8&255)<<16|(h[N+1>>>2]>>>24-(N+1)%4*8&255)<<8|h[N+2>>>2]>>>24-(N+2)%4*8&255,U=0;4>U&&N+.75*U<m;U++)o.push(b.charAt(T>>>6*(3-U)&63));if(h=b.charAt(64))for(;o.length%4;)o.push(h);return o.join("")},parse:function(o){var h=o.length,m=this._map;(b=m.charAt(64))&&(b=o.indexOf(b))!=-1&&(h=b);for(var b=[],N=0,T=0;T<h;T++)if(T%4){var U=m.indexOf(o.charAt(T-1))<<T%4*2,B=m.indexOf(o.charAt(T))>>>6-T%4*2;b[N>>>2]|=(U|B)<<24-N%4*8,N++}return t.create(b,N)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(r){for(var t=V,n=(h=t.lib).WordArray,o=h.Hasher,h=t.algo,m=[],b=[],N=function(ne){return 4294967296*(ne-(0|ne))|0},T=2,U=0;64>U;){var B;e:{B=T;for(var j=r.sqrt(B),W=2;W<=j;W++)if(!(B%W)){B=!1;break e}B=!0}B&&(8>U&&(m[U]=N(r.pow(T,.5))),b[U]=N(r.pow(T,1/3)),U++),T++}var z=[];h=h.SHA256=o.extend({_doReset:function(){this._hash=new n.init(m.slice(0))},_doProcessBlock:function(ne,ie){for(var S=this._hash.words,O=S[0],H=S[1],q=S[2],ee=S[3],oe=S[4],ge=S[5],fe=S[6],Ie=S[7],de=0;64>de;de++){if(16>de)z[de]=0|ne[ie+de];else{var Se=z[de-15],Ke=z[de-2];z[de]=((Se<<25|Se>>>7)^(Se<<14|Se>>>18)^Se>>>3)+z[de-7]+((Ke<<15|Ke>>>17)^(Ke<<13|Ke>>>19)^Ke>>>10)+z[de-16]}Se=Ie+((oe<<26|oe>>>6)^(oe<<21|oe>>>11)^(oe<<7|oe>>>25))+(oe&ge^~oe&fe)+b[de]+z[de],Ke=((O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22))+(O&H^O&q^H&q),Ie=fe,fe=ge,ge=oe,oe=ee+Se|0,ee=q,q=H,H=O,O=Se+Ke|0}S[0]=S[0]+O|0,S[1]=S[1]+H|0,S[2]=S[2]+q|0,S[3]=S[3]+ee|0,S[4]=S[4]+oe|0,S[5]=S[5]+ge|0,S[6]=S[6]+fe|0,S[7]=S[7]+Ie|0},_doFinalize:function(){var ne=this._data,ie=ne.words,S=8*this._nDataBytes,O=8*ne.sigBytes;return ie[O>>>5]|=128<<24-O%32,ie[14+(O+64>>>9<<4)]=r.floor(S/4294967296),ie[15+(O+64>>>9<<4)]=S,ne.sigBytes=4*ie.length,this._process(),this._hash},clone:function(){var ne=o.clone.call(this);return ne._hash=this._hash.clone(),ne}}),t.SHA256=o._createHelper(h),t.HmacSHA256=o._createHmacHelper(h)}(Math),function(){function r(){return o.create.apply(o,arguments)}for(var t=V,n=t.lib.Hasher,o=(m=t.x64).Word,h=m.WordArray,m=t.algo,b=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],N=[],T=0;80>T;T++)N[T]=r();m=m.SHA512=n.extend({_doReset:function(){this._hash=new h.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(B,j){for(var W=(H=this._hash.words)[0],z=H[1],Z=H[2],ne=H[3],ie=H[4],S=H[5],O=H[6],H=H[7],q=W.high,ee=W.low,oe=z.high,ge=z.low,fe=Z.high,Ie=Z.low,de=ne.high,Se=ne.low,Ke=ie.high,Ge=ie.low,Je=S.high,xt=S.low,mt=O.high,St=O.low,et=H.high,ct=H.low,pt=q,bt=ee,xr=oe,cr=ge,Fr=fe,hr=Ie,Mn=de,Ar=Se,Ut=Ke,Rt=Ge,tn=Je,Ir=xt,rn=mt,Pr=St,Hn=et,Tr=ct,Nt=0;80>Nt;Nt++){var Yt=N[Nt];if(16>Nt)var Mt=Yt.high=0|B[j+2*Nt],ze=Yt.low=0|B[j+2*Nt+1];else{Mt=((ze=(Mt=N[Nt-15]).high)>>>1|(Ht=Mt.low)<<31)^(ze>>>8|Ht<<24)^ze>>>7;var Ht=(Ht>>>1|ze<<31)^(Ht>>>8|ze<<24)^(Ht>>>7|ze<<25),lr=((ze=(lr=N[Nt-2]).high)>>>19|(ht=lr.low)<<13)^(ze<<3|ht>>>29)^ze>>>6,ht=(ht>>>19|ze<<13)^(ht<<3|ze>>>29)^(ht>>>6|ze<<26),Kn=(ze=N[Nt-7]).high,Xt=(Qt=N[Nt-16]).high,Qt=Qt.low;Mt=(Mt=(Mt=Mt+Kn+((ze=Ht+ze.low)>>>0<Ht>>>0?1:0))+lr+((ze=ze+ht)>>>0<ht>>>0?1:0))+Xt+((ze=ze+Qt)>>>0<Qt>>>0?1:0),Yt.high=Mt,Yt.low=ze}Kn=Ut&tn^~Ut&rn,Qt=Rt&Ir^~Rt&Pr,Yt=pt&xr^pt&Fr^xr&Fr;var Ms=bt&cr^bt&hr^cr&hr,Hs=(Ht=(pt>>>28|bt<<4)^(pt<<30|bt>>>2)^(pt<<25|bt>>>7),lr=(bt>>>28|pt<<4)^(bt<<30|pt>>>2)^(bt<<25|pt>>>7),(ht=b[Nt]).high),oo=ht.low;Xt=Hn+((Ut>>>14|Rt<<18)^(Ut>>>18|Rt<<14)^(Ut<<23|Rt>>>9))+((ht=Tr+((Rt>>>14|Ut<<18)^(Rt>>>18|Ut<<14)^(Rt<<23|Ut>>>9)))>>>0<Tr>>>0?1:0),Hn=rn,Tr=Pr,rn=tn,Pr=Ir,tn=Ut,Ir=Rt,Ut=Mn+(Xt=(Xt=(Xt=Xt+Kn+((ht=ht+Qt)>>>0<Qt>>>0?1:0))+Hs+((ht=ht+oo)>>>0<oo>>>0?1:0))+Mt+((ht=ht+ze)>>>0<ze>>>0?1:0))+((Rt=Ar+ht|0)>>>0<Ar>>>0?1:0)|0,Mn=Fr,Ar=hr,Fr=xr,hr=cr,xr=pt,cr=bt,pt=Xt+(Yt=Ht+Yt+((ze=lr+Ms)>>>0<lr>>>0?1:0))+((bt=ht+ze|0)>>>0<ht>>>0?1:0)|0}ee=W.low=ee+bt,W.high=q+pt+(ee>>>0<bt>>>0?1:0),ge=z.low=ge+cr,z.high=oe+xr+(ge>>>0<cr>>>0?1:0),Ie=Z.low=Ie+hr,Z.high=fe+Fr+(Ie>>>0<hr>>>0?1:0),Se=ne.low=Se+Ar,ne.high=de+Mn+(Se>>>0<Ar>>>0?1:0),Ge=ie.low=Ge+Rt,ie.high=Ke+Ut+(Ge>>>0<Rt>>>0?1:0),xt=S.low=xt+Ir,S.high=Je+tn+(xt>>>0<Ir>>>0?1:0),St=O.low=St+Pr,O.high=mt+rn+(St>>>0<Pr>>>0?1:0),ct=H.low=ct+Tr,H.high=et+Hn+(ct>>>0<Tr>>>0?1:0)},_doFinalize:function(){var B=this._data,j=B.words,W=8*this._nDataBytes,z=8*B.sigBytes;return j[z>>>5]|=128<<24-z%32,j[30+(z+128>>>10<<5)]=Math.floor(W/4294967296),j[31+(z+128>>>10<<5)]=W,B.sigBytes=4*j.length,this._process(),this._hash.toX32()},clone:function(){var B=n.clone.call(this);return B._hash=this._hash.clone(),B},blockSize:32}),t.SHA512=n._createHelper(m),t.HmacSHA512=n._createHmacHelper(m)}(),function(){var r=V,t=(h=r.x64).Word,n=h.WordArray,o=(h=r.algo).SHA512,h=h.SHA384=o.extend({_doReset:function(){this._hash=new n.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var b=o._doFinalize.call(this);return b.sigBytes-=16,b}});r.SHA384=o._createHelper(h),r.HmacSHA384=o._createHmacHelper(h)}();var X,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function A(r){var t,n,o="";for(t=0;t+3<=r.length;t+=3)n=parseInt(r.substring(t,t+3),16),o+=k.charAt(n>>6)+k.charAt(63&n);for(t+1==r.length?(n=parseInt(r.substring(t,t+1),16),o+=k.charAt(n<<2)):t+2==r.length&&(n=parseInt(r.substring(t,t+2),16),o+=k.charAt(n>>2)+k.charAt((3&n)<<4)),"=";(3&o.length)>0;)o+="=";return o}function Q(r){var t,n,o,h="",m=0;for(t=0;t<r.length&&r.charAt(t)!="=";++t)(o=k.indexOf(r.charAt(t)))<0||(m==0?(h+=je(o>>2),n=3&o,m=1):m==1?(h+=je(n<<2|o>>4),n=15&o,m=2):m==2?(h+=je(n),h+=je(o>>2),n=3&o,m=3):(h+=je(n<<2|o>>4),h+=je(15&o),m=0));return m==1&&(h+=je(n<<2)),h}function re(r){var t,n=Q(r),o=new Array;for(t=0;2*t<n.length;++t)o[t]=parseInt(n.substring(2*t,2*t+2),16);return o}function D(r,t,n){r!=null&&(typeof r=="number"?this.fromNumber(r,t,n):t==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,t))}function he(){return new D(null)}R.appName=="Microsoft Internet Explorer"?(D.prototype.am=function(t,n,o,h,m,b){for(var N=32767&n,T=n>>15;--b>=0;){var U=32767&this[t],B=this[t++]>>15,j=T*U+B*N;m=((U=N*U+((32767&j)<<15)+o[h]+(1073741823&m))>>>30)+(j>>>15)+T*B+(m>>>30),o[h++]=1073741823&U}return m},X=30):R.appName!="Netscape"?(D.prototype.am=function(t,n,o,h,m,b){for(;--b>=0;){var N=n*this[t++]+o[h]+m;m=Math.floor(N/67108864),o[h++]=67108863&N}return m},X=26):(D.prototype.am=function(t,n,o,h,m,b){for(var N=16383&n,T=n>>14;--b>=0;){var U=16383&this[t],B=this[t++]>>14,j=T*U+B*N;m=((U=N*U+((16383&j)<<14)+o[h]+m)>>28)+(j>>14)+T*B,o[h++]=268435455&U}return m},X=28),D.prototype.DB=X,D.prototype.DM=(1<<X)-1,D.prototype.DV=1<<X,D.prototype.FV=Math.pow(2,52),D.prototype.F1=52-X,D.prototype.F2=2*X-52;var pe,Ee,$e=new Array;for(pe=48,Ee=0;Ee<=9;++Ee)$e[pe++]=Ee;for(pe=97,Ee=10;Ee<36;++Ee)$e[pe++]=Ee;for(pe=65,Ee=10;Ee<36;++Ee)$e[pe++]=Ee;function je(r){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(r)}function Qe(r,t){var n=$e[r.charCodeAt(t)];return n??-1}function Ze(r){var t=he();return t.fromInt(r),t}function lt(r){var t,n=1;return(t=r>>>16)!=0&&(r=t,n+=16),(t=r>>8)!=0&&(r=t,n+=8),(t=r>>4)!=0&&(r=t,n+=4),(t=r>>2)!=0&&(r=t,n+=2),(t=r>>1)!=0&&(r=t,n+=1),n}function xe(r){this.m=r}function Pe(r){this.m=r,this.mp=r.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function it(r,t){return r&t}function Re(r,t){return r|t}function De(r,t){return r^t}function ft(r,t){return r&~t}function _t(r){if(r==0)return-1;var t=0;return!(65535&r)&&(r>>=16,t+=16),!(255&r)&&(r>>=8,t+=8),!(15&r)&&(r>>=4,t+=4),!(3&r)&&(r>>=2,t+=2),!(1&r)&&++t,t}function Pt(r){for(var t=0;r!=0;)r&=r-1,++t;return t}function ot(){}function dt(r){return r}function Ve(r){this.r2=he(),this.q3=he(),D.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}xe.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},xe.prototype.revert=function(t){return t},xe.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},xe.prototype.mulTo=function(t,n,o){t.multiplyTo(n,o),this.reduce(o)},xe.prototype.sqrTo=function(t,n){t.squareTo(n),this.reduce(n)},Pe.prototype.convert=function(t){var n=he();return t.abs().dlShiftTo(this.m.t,n),n.divRemTo(this.m,null,n),t.s<0&&n.compareTo(D.ZERO)>0&&this.m.subTo(n,n),n},Pe.prototype.revert=function(t){var n=he();return t.copyTo(n),this.reduce(n),n},Pe.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var n=0;n<this.m.t;++n){var o=32767&t[n],h=o*this.mpl+((o*this.mph+(t[n]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[o=n+this.m.t]+=this.m.am(0,h,t,n,0,this.m.t);t[o]>=t.DV;)t[o]-=t.DV,t[++o]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},Pe.prototype.mulTo=function(t,n,o){t.multiplyTo(n,o),this.reduce(o)},Pe.prototype.sqrTo=function(t,n){t.squareTo(n),this.reduce(n)},D.prototype.copyTo=function(t){for(var n=this.t-1;n>=0;--n)t[n]=this[n];t.t=this.t,t.s=this.s},D.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},D.prototype.fromString=function(t,n){var o;if(n==16)o=4;else if(n==8)o=3;else if(n==256)o=8;else if(n==2)o=1;else if(n==32)o=5;else{if(n!=4)return void this.fromRadix(t,n);o=2}this.t=0,this.s=0;for(var h=t.length,m=!1,b=0;--h>=0;){var N=o==8?255&t[h]:Qe(t,h);N<0?t.charAt(h)=="-"&&(m=!0):(m=!1,b==0?this[this.t++]=N:b+o>this.DB?(this[this.t-1]|=(N&(1<<this.DB-b)-1)<<b,this[this.t++]=N>>this.DB-b):this[this.t-1]|=N<<b,(b+=o)>=this.DB&&(b-=this.DB))}o==8&&128&t[0]&&(this.s=-1,b>0&&(this[this.t-1]|=(1<<this.DB-b)-1<<b)),this.clamp(),m&&D.ZERO.subTo(this,this)},D.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},D.prototype.dlShiftTo=function(t,n){var o;for(o=this.t-1;o>=0;--o)n[o+t]=this[o];for(o=t-1;o>=0;--o)n[o]=0;n.t=this.t+t,n.s=this.s},D.prototype.drShiftTo=function(t,n){for(var o=t;o<this.t;++o)n[o-t]=this[o];n.t=Math.max(this.t-t,0),n.s=this.s},D.prototype.lShiftTo=function(t,n){var o,h=t%this.DB,m=this.DB-h,b=(1<<m)-1,N=Math.floor(t/this.DB),T=this.s<<h&this.DM;for(o=this.t-1;o>=0;--o)n[o+N+1]=this[o]>>m|T,T=(this[o]&b)<<h;for(o=N-1;o>=0;--o)n[o]=0;n[N]=T,n.t=this.t+N+1,n.s=this.s,n.clamp()},D.prototype.rShiftTo=function(t,n){n.s=this.s;var o=Math.floor(t/this.DB);if(o>=this.t)n.t=0;else{var h=t%this.DB,m=this.DB-h,b=(1<<h)-1;n[0]=this[o]>>h;for(var N=o+1;N<this.t;++N)n[N-o-1]|=(this[N]&b)<<m,n[N-o]=this[N]>>h;h>0&&(n[this.t-o-1]|=(this.s&b)<<m),n.t=this.t-o,n.clamp()}},D.prototype.subTo=function(t,n){for(var o=0,h=0,m=Math.min(t.t,this.t);o<m;)h+=this[o]-t[o],n[o++]=h&this.DM,h>>=this.DB;if(t.t<this.t){for(h-=t.s;o<this.t;)h+=this[o],n[o++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;o<t.t;)h-=t[o],n[o++]=h&this.DM,h>>=this.DB;h-=t.s}n.s=h<0?-1:0,h<-1?n[o++]=this.DV+h:h>0&&(n[o++]=h),n.t=o,n.clamp()},D.prototype.multiplyTo=function(t,n){var o=this.abs(),h=t.abs(),m=o.t;for(n.t=m+h.t;--m>=0;)n[m]=0;for(m=0;m<h.t;++m)n[m+o.t]=o.am(0,h[m],n,m,0,o.t);n.s=0,n.clamp(),this.s!=t.s&&D.ZERO.subTo(n,n)},D.prototype.squareTo=function(t){for(var n=this.abs(),o=t.t=2*n.t;--o>=0;)t[o]=0;for(o=0;o<n.t-1;++o){var h=n.am(o,n[o],t,2*o,0,1);(t[o+n.t]+=n.am(o+1,2*n[o],t,2*o+1,h,n.t-o-1))>=n.DV&&(t[o+n.t]-=n.DV,t[o+n.t+1]=1)}t.t>0&&(t[t.t-1]+=n.am(o,n[o],t,2*o,0,1)),t.s=0,t.clamp()},D.prototype.divRemTo=function(t,n,o){var h=t.abs();if(!(h.t<=0)){var m=this.abs();if(m.t<h.t)return n?.fromInt(0),void(o!=null&&this.copyTo(o));o==null&&(o=he());var b=he(),N=this.s,T=t.s,U=this.DB-lt(h[h.t-1]);U>0?(h.lShiftTo(U,b),m.lShiftTo(U,o)):(h.copyTo(b),m.copyTo(o));var B=b.t,j=b[B-1];if(j!=0){var W=j*(1<<this.F1)+(B>1?b[B-2]>>this.F2:0),z=this.FV/W,Z=(1<<this.F1)/W,ne=1<<this.F2,ie=o.t,S=ie-B,O=n??he();for(b.dlShiftTo(S,O),o.compareTo(O)>=0&&(o[o.t++]=1,o.subTo(O,o)),D.ONE.dlShiftTo(B,O),O.subTo(b,b);b.t<B;)b[b.t++]=0;for(;--S>=0;){var H=o[--ie]==j?this.DM:Math.floor(o[ie]*z+(o[ie-1]+ne)*Z);if((o[ie]+=b.am(0,H,o,S,0,B))<H)for(b.dlShiftTo(S,O),o.subTo(O,o);o[ie]<--H;)o.subTo(O,o)}n!=null&&(o.drShiftTo(B,n),N!=T&&D.ZERO.subTo(n,n)),o.t=B,o.clamp(),U>0&&o.rShiftTo(U,o),N<0&&D.ZERO.subTo(o,o)}}},D.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(!(1&t))return 0;var n=3&t;return(n=(n=(n=(n=n*(2-(15&t)*n)&15)*(2-(255&t)*n)&255)*(2-((65535&t)*n&65535))&65535)*(2-t*n%this.DV)%this.DV)>0?this.DV-n:-n},D.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},D.prototype.exp=function(t,n){if(t>4294967295||t<1)return D.ONE;var o=he(),h=he(),m=n.convert(this),b=lt(t)-1;for(m.copyTo(o);--b>=0;)if(n.sqrTo(o,h),(t&1<<b)>0)n.mulTo(h,m,o);else{var N=o;o=h,h=N}return n.revert(o)},D.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var n;if(t==16)n=4;else if(t==8)n=3;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4)return this.toRadix(t);n=2}var o,h=(1<<n)-1,m=!1,b="",N=this.t,T=this.DB-N*this.DB%n;if(N-- >0)for(T<this.DB&&(o=this[N]>>T)>0&&(m=!0,b=je(o));N>=0;)T<n?(o=(this[N]&(1<<T)-1)<<n-T,o|=this[--N]>>(T+=this.DB-n)):(o=this[N]>>(T-=n)&h,T<=0&&(T+=this.DB,--N)),o>0&&(m=!0),m&&(b+=je(o));return m?b:"0"},D.prototype.negate=function(){var t=he();return D.ZERO.subTo(this,t),t},D.prototype.abs=function(){return this.s<0?this.negate():this},D.prototype.compareTo=function(t){var n=this.s-t.s;if(n!=0)return n;var o=this.t;if((n=o-t.t)!=0)return this.s<0?-n:n;for(;--o>=0;)if((n=this[o]-t[o])!=0)return n;return 0},D.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+lt(this[this.t-1]^this.s&this.DM)},D.prototype.mod=function(t){var n=he();return this.abs().divRemTo(t,null,n),this.s<0&&n.compareTo(D.ZERO)>0&&t.subTo(n,n),n},D.prototype.modPowInt=function(t,n){var o;return o=t<256||n.isEven()?new xe(n):new Pe(n),this.exp(t,o)},D.ZERO=Ze(0),D.ONE=Ze(1),ot.prototype.convert=dt,ot.prototype.revert=dt,ot.prototype.mulTo=function(t,n,o){t.multiplyTo(n,o)},ot.prototype.sqrTo=function(t,n){t.squareTo(n)},Ve.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var n=he();return t.copyTo(n),this.reduce(n),n},Ve.prototype.revert=function(t){return t},Ve.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},Ve.prototype.mulTo=function(t,n,o){t.multiplyTo(n,o),this.reduce(o)},Ve.prototype.sqrTo=function(t,n){t.squareTo(n),this.reduce(n)};var Be=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],$=(1<<26)/Be[Be.length-1];function v(){this.i=0,this.j=0,this.S=new Array}D.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},D.prototype.toRadix=function(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var n=this.chunkSize(t),o=Math.pow(t,n),h=Ze(o),m=he(),b=he(),N="";for(this.divRemTo(h,m,b);m.signum()>0;)N=(o+b.intValue()).toString(t).substr(1)+N,m.divRemTo(h,m,b);return b.intValue().toString(t)+N},D.prototype.fromRadix=function(t,n){this.fromInt(0),n==null&&(n=10);for(var o=this.chunkSize(n),h=Math.pow(n,o),m=!1,b=0,N=0,T=0;T<t.length;++T){var U=Qe(t,T);U<0?t.charAt(T)=="-"&&this.signum()==0&&(m=!0):(N=n*N+U,++b>=o&&(this.dMultiply(h),this.dAddOffset(N,0),b=0,N=0))}b>0&&(this.dMultiply(Math.pow(n,b)),this.dAddOffset(N,0)),m&&D.ZERO.subTo(this,this)},D.prototype.fromNumber=function(t,n,o){if(typeof n=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,o),this.testBit(t-1)||this.bitwiseTo(D.ONE.shiftLeft(t-1),Re,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(n);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(D.ONE.shiftLeft(t-1),this);else{var h=new Array,m=7&t;h.length=1+(t>>3),n.nextBytes(h),m>0?h[0]&=(1<<m)-1:h[0]=0,this.fromString(h,256)}},D.prototype.bitwiseTo=function(t,n,o){var h,m,b=Math.min(t.t,this.t);for(h=0;h<b;++h)o[h]=n(this[h],t[h]);if(t.t<this.t){for(m=t.s&this.DM,h=b;h<this.t;++h)o[h]=n(this[h],m);o.t=this.t}else{for(m=this.s&this.DM,h=b;h<t.t;++h)o[h]=n(m,t[h]);o.t=t.t}o.s=n(this.s,t.s),o.clamp()},D.prototype.changeBit=function(t,n){var o=D.ONE.shiftLeft(t);return this.bitwiseTo(o,n,o),o},D.prototype.addTo=function(t,n){for(var o=0,h=0,m=Math.min(t.t,this.t);o<m;)h+=this[o]+t[o],n[o++]=h&this.DM,h>>=this.DB;if(t.t<this.t){for(h+=t.s;o<this.t;)h+=this[o],n[o++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;o<t.t;)h+=t[o],n[o++]=h&this.DM,h>>=this.DB;h+=t.s}n.s=h<0?-1:0,h>0?n[o++]=h:h<-1&&(n[o++]=this.DV+h),n.t=o,n.clamp()},D.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},D.prototype.dAddOffset=function(t,n){if(t!=0){for(;this.t<=n;)this[this.t++]=0;for(this[n]+=t;this[n]>=this.DV;)this[n]-=this.DV,++n>=this.t&&(this[this.t++]=0),++this[n]}},D.prototype.multiplyLowerTo=function(t,n,o){var h,m=Math.min(this.t+t.t,n);for(o.s=0,o.t=m;m>0;)o[--m]=0;for(h=o.t-this.t;m<h;++m)o[m+this.t]=this.am(0,t[m],o,m,0,this.t);for(h=Math.min(t.t,n);m<h;++m)this.am(0,t[m],o,m,0,n-m);o.clamp()},D.prototype.multiplyUpperTo=function(t,n,o){--n;var h=o.t=this.t+t.t-n;for(o.s=0;--h>=0;)o[h]=0;for(h=Math.max(n-this.t,0);h<t.t;++h)o[this.t+h-n]=this.am(n-h,t[h],o,0,0,this.t+h-n);o.clamp(),o.drShiftTo(1,o)},D.prototype.modInt=function(t){if(t<=0)return 0;var n=this.DV%t,o=this.s<0?t-1:0;if(this.t>0)if(n==0)o=this[0]%t;else for(var h=this.t-1;h>=0;--h)o=(n*o+this[h])%t;return o},D.prototype.millerRabin=function(t){var n=this.subtract(D.ONE),o=n.getLowestSetBit();if(o<=0)return!1;var h=n.shiftRight(o);(t=t+1>>1)>Be.length&&(t=Be.length);for(var m=he(),b=0;b<t;++b){m.fromInt(Be[Math.floor(Math.random()*Be.length)]);var N=m.modPow(h,this);if(N.compareTo(D.ONE)!=0&&N.compareTo(n)!=0){for(var T=1;T++<o&&N.compareTo(n)!=0;)if((N=N.modPowInt(2,this)).compareTo(D.ONE)==0)return!1;if(N.compareTo(n)!=0)return!1}}return!0},D.prototype.clone=function(){var t=he();return this.copyTo(t),t},D.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},D.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},D.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},D.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},D.prototype.toByteArray=function(){var t=this.t,n=new Array;n[0]=this.s;var o,h=this.DB-t*this.DB%8,m=0;if(t-- >0)for(h<this.DB&&(o=this[t]>>h)!=(this.s&this.DM)>>h&&(n[m++]=o|this.s<<this.DB-h);t>=0;)h<8?(o=(this[t]&(1<<h)-1)<<8-h,o|=this[--t]>>(h+=this.DB-8)):(o=this[t]>>(h-=8)&255,h<=0&&(h+=this.DB,--t)),128&o&&(o|=-256),m==0&&(128&this.s)!=(128&o)&&++m,(m>0||o!=this.s)&&(n[m++]=o);return n},D.prototype.equals=function(t){return this.compareTo(t)==0},D.prototype.min=function(t){return this.compareTo(t)<0?this:t},D.prototype.max=function(t){return this.compareTo(t)>0?this:t},D.prototype.and=function(t){var n=he();return this.bitwiseTo(t,it,n),n},D.prototype.or=function(t){var n=he();return this.bitwiseTo(t,Re,n),n},D.prototype.xor=function(t){var n=he();return this.bitwiseTo(t,De,n),n},D.prototype.andNot=function(t){var n=he();return this.bitwiseTo(t,ft,n),n},D.prototype.not=function(){for(var t=he(),n=0;n<this.t;++n)t[n]=this.DM&~this[n];return t.t=this.t,t.s=~this.s,t},D.prototype.shiftLeft=function(t){var n=he();return t<0?this.rShiftTo(-t,n):this.lShiftTo(t,n),n},D.prototype.shiftRight=function(t){var n=he();return t<0?this.lShiftTo(-t,n):this.rShiftTo(t,n),n},D.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+_t(this[t]);return this.s<0?this.t*this.DB:-1},D.prototype.bitCount=function(){for(var t=0,n=this.s&this.DM,o=0;o<this.t;++o)t+=Pt(this[o]^n);return t},D.prototype.testBit=function(t){var n=Math.floor(t/this.DB);return n>=this.t?this.s!=0:(this[n]&1<<t%this.DB)!=0},D.prototype.setBit=function(t){return this.changeBit(t,Re)},D.prototype.clearBit=function(t){return this.changeBit(t,ft)},D.prototype.flipBit=function(t){return this.changeBit(t,De)},D.prototype.add=function(t){var n=he();return this.addTo(t,n),n},D.prototype.subtract=function(t){var n=he();return this.subTo(t,n),n},D.prototype.multiply=function(t){var n=he();return this.multiplyTo(t,n),n},D.prototype.divide=function(t){var n=he();return this.divRemTo(t,n,null),n},D.prototype.remainder=function(t){var n=he();return this.divRemTo(t,null,n),n},D.prototype.divideAndRemainder=function(t){var n=he(),o=he();return this.divRemTo(t,n,o),new Array(n,o)},D.prototype.modPow=function(t,n){var o,h,m=t.bitLength(),b=Ze(1);if(m<=0)return b;o=m<18?1:m<48?3:m<144?4:m<768?5:6,h=m<8?new xe(n):n.isEven()?new Ve(n):new Pe(n);var N=new Array,T=3,U=o-1,B=(1<<o)-1;if(N[1]=h.convert(this),o>1){var j=he();for(h.sqrTo(N[1],j);T<=B;)N[T]=he(),h.mulTo(j,N[T-2],N[T]),T+=2}var W,z,Z=t.t-1,ne=!0,ie=he();for(m=lt(t[Z])-1;Z>=0;){for(m>=U?W=t[Z]>>m-U&B:(W=(t[Z]&(1<<m+1)-1)<<U-m,Z>0&&(W|=t[Z-1]>>this.DB+m-U)),T=o;!(1&W);)W>>=1,--T;if((m-=T)<0&&(m+=this.DB,--Z),ne)N[W].copyTo(b),ne=!1;else{for(;T>1;)h.sqrTo(b,ie),h.sqrTo(ie,b),T-=2;T>0?h.sqrTo(b,ie):(z=b,b=ie,ie=z),h.mulTo(ie,N[W],b)}for(;Z>=0&&!(t[Z]&1<<m);)h.sqrTo(b,ie),z=b,b=ie,ie=z,--m<0&&(m=this.DB-1,--Z)}return h.revert(b)},D.prototype.modInverse=function(t){var n=t.isEven();if(this.isEven()&&n||t.signum()==0)return D.ZERO;for(var o=t.clone(),h=this.clone(),m=Ze(1),b=Ze(0),N=Ze(0),T=Ze(1);o.signum()!=0;){for(;o.isEven();)o.rShiftTo(1,o),n?(m.isEven()&&b.isEven()||(m.addTo(this,m),b.subTo(t,b)),m.rShiftTo(1,m)):b.isEven()||b.subTo(t,b),b.rShiftTo(1,b);for(;h.isEven();)h.rShiftTo(1,h),n?(N.isEven()&&T.isEven()||(N.addTo(this,N),T.subTo(t,T)),N.rShiftTo(1,N)):T.isEven()||T.subTo(t,T),T.rShiftTo(1,T);o.compareTo(h)>=0?(o.subTo(h,o),n&&m.subTo(N,m),b.subTo(T,b)):(h.subTo(o,h),n&&N.subTo(m,N),T.subTo(b,T))}return h.compareTo(D.ONE)!=0?D.ZERO:T.compareTo(t)>=0?T.subtract(t):T.signum()<0?(T.addTo(t,T),T.signum()<0?T.add(t):T):T},D.prototype.pow=function(t){return this.exp(t,new ot)},D.prototype.gcd=function(t){var n=this.s<0?this.negate():this.clone(),o=t.s<0?t.negate():t.clone();if(n.compareTo(o)<0){var h=n;n=o,o=h}var m=n.getLowestSetBit(),b=o.getLowestSetBit();if(b<0)return n;for(m<b&&(b=m),b>0&&(n.rShiftTo(b,n),o.rShiftTo(b,o));n.signum()>0;)(m=n.getLowestSetBit())>0&&n.rShiftTo(m,n),(m=o.getLowestSetBit())>0&&o.rShiftTo(m,o),n.compareTo(o)>=0?(n.subTo(o,n),n.rShiftTo(1,n)):(o.subTo(n,o),o.rShiftTo(1,o));return b>0&&o.lShiftTo(b,o),o},D.prototype.isProbablePrime=function(t){var n,o=this.abs();if(o.t==1&&o[0]<=Be[Be.length-1]){for(n=0;n<Be.length;++n)if(o[0]==Be[n])return!0;return!1}if(o.isEven())return!1;for(n=1;n<Be.length;){for(var h=Be[n],m=n+1;m<Be.length&&h<$;)h*=Be[m++];for(h=o.modInt(h);n<m;)if(h%Be[n++]==0)return!1}return o.millerRabin(t)},D.prototype.square=function(){var t=he();return this.squareTo(t),t},v.prototype.init=function(t){var n,o,h;for(n=0;n<256;++n)this.S[n]=n;for(o=0,n=0;n<256;++n)o=o+this.S[n]+t[n%t.length]&255,h=this.S[n],this.S[n]=this.S[o],this.S[o]=h;this.i=0,this.j=0},v.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var _,M,J;function te(){(function(t){M[J++]^=255&t,M[J++]^=t>>8&255,M[J++]^=t>>16&255,M[J++]^=t>>24&255,J>=256&&(J-=256)})(new Date().getTime())}if(M==null){var se;if(M=new Array,J=0,K!==void 0&&(K.crypto!==void 0||K.msCrypto!==void 0)){var me=K.crypto||K.msCrypto;if(me.getRandomValues){var be=new Uint8Array(32);for(me.getRandomValues(be),se=0;se<32;++se)M[J++]=be[se]}else if(R.appName=="Netscape"&&R.appVersion<"5"){var Ne=K.crypto.random(32);for(se=0;se<Ne.length;++se)M[J++]=255&Ne.charCodeAt(se)}}for(;J<256;)se=Math.floor(65536*Math.random()),M[J++]=se>>>8,M[J++]=255&se;J=0,te()}function Te(){if(_==null){for(te(),(_=function(){return new v}()).init(M),J=0;J<M.length;++J)M[J]=0;J=0}return _.next()}function Ce(){}function qe(r,t){return new D(r,t)}function wt(r,t,n){for(var o="",h=0;o.length<t;)o+=n(String.fromCharCode.apply(String,r.concat([(4278190080&h)>>24,(16711680&h)>>16,(65280&h)>>8,255&h]))),h+=1;return o}function we(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Le(r,t){this.x=t,this.q=r}function Ae(r,t,n,o){this.curve=r,this.x=t,this.y=n,this.z=o??D.ONE,this.zinv=null}function E(r,t,n){this.q=r,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(n),this.infinity=new Ae(this,null,null)}Ce.prototype.nextBytes=function(t){var n;for(n=0;n<t.length;++n)t[n]=Te()},we.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},we.prototype.setPublic=function(t,n){if(this.isPublic=!0,this.isPrivate=!1,typeof t!="string")this.n=t,this.e=n;else{if(!(t!=null&&n!=null&&t.length>0&&n.length>0))throw"Invalid RSA public key";this.n=qe(t,16),this.e=parseInt(n,16)}},we.prototype.encrypt=function(t){var n=function(b,N){if(N<b.length+11)throw"Message too long for RSA";for(var T=new Array,U=b.length-1;U>=0&&N>0;){var B=b.charCodeAt(U--);B<128?T[--N]=B:B>127&&B<2048?(T[--N]=63&B|128,T[--N]=B>>6|192):(T[--N]=63&B|128,T[--N]=B>>6&63|128,T[--N]=B>>12|224)}T[--N]=0;for(var j=new Ce,W=new Array;N>2;){for(W[0]=0;W[0]==0;)j.nextBytes(W);T[--N]=W[0]}return T[--N]=2,T[--N]=0,new D(T)}(t,this.n.bitLength()+7>>3);if(n==null)return null;var o=this.doPublic(n);if(o==null)return null;var h=o.toString(16);return 1&h.length?"0"+h:h},we.prototype.encryptOAEP=function(t,n,o){var h=function(T,U,B,j){var W=u.crypto.MessageDigest,z=u.crypto.Util,Z=null;if(B||(B="sha1"),typeof B=="string"&&(Z=W.getCanonicalAlgName(B),j=W.getHashLength(Z),B=function(fe){return Tt(z.hashHex(Dt(fe),Z))}),T.length+2*j+2>U)throw"Message too long for RSA";var ne,ie="";for(ne=0;ne<U-T.length-2*j-2;ne+=1)ie+="\0";var S=B("")+ie+""+T,O=new Array(j);new Ce().nextBytes(O);var H=wt(O,S.length,B),q=[];for(ne=0;ne<S.length;ne+=1)q[ne]=S.charCodeAt(ne)^H.charCodeAt(ne);var ee=wt(q,O.length,B),oe=[0];for(ne=0;ne<O.length;ne+=1)oe[ne+1]=O[ne]^ee.charCodeAt(ne);return new D(oe.concat(q))}(t,this.n.bitLength()+7>>3,n,o);if(h==null)return null;var m=this.doPublic(h);if(m==null)return null;var b=m.toString(16);return 1&b.length?"0"+b:b},we.prototype.type="RSA",Le.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.x.equals(t.x)},Le.prototype.toBigInteger=function(){return this.x},Le.prototype.negate=function(){return new Le(this.q,this.x.negate().mod(this.q))},Le.prototype.add=function(t){return new Le(this.q,this.x.add(t.toBigInteger()).mod(this.q))},Le.prototype.subtract=function(t){return new Le(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))},Le.prototype.multiply=function(t){return new Le(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))},Le.prototype.square=function(){return new Le(this.q,this.x.square().mod(this.q))},Le.prototype.divide=function(t){return new Le(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))},Ae.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Ae.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Ae.prototype.equals=function(t){return t==this||(this.isInfinity()?t.isInfinity():t.isInfinity()?this.isInfinity():!!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(D.ZERO)&&t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(D.ZERO))},Ae.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(D.ZERO)&&!this.y.toBigInteger().equals(D.ZERO)},Ae.prototype.negate=function(){return new Ae(this.curve,this.x,this.y.negate(),this.z)},Ae.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var n=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),o=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q);if(D.ZERO.equals(o))return D.ZERO.equals(n)?this.twice():this.curve.getInfinity();var h=new D("3"),m=this.x.toBigInteger(),b=this.y.toBigInteger(),N=(t.x.toBigInteger(),t.y.toBigInteger(),o.square()),T=N.multiply(o),U=m.multiply(N),B=n.square().multiply(this.z),j=B.subtract(U.shiftLeft(1)).multiply(t.z).subtract(T).multiply(o).mod(this.curve.q),W=U.multiply(h).multiply(n).subtract(b.multiply(T)).subtract(B.multiply(n)).multiply(t.z).add(n.multiply(T)).mod(this.curve.q),z=T.multiply(this.z).multiply(t.z).mod(this.curve.q);return new Ae(this.curve,this.curve.fromBigInteger(j),this.curve.fromBigInteger(W),z)},Ae.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=new D("3"),n=this.x.toBigInteger(),o=this.y.toBigInteger(),h=o.multiply(this.z),m=h.multiply(o).mod(this.curve.q),b=this.curve.a.toBigInteger(),N=n.square().multiply(t);D.ZERO.equals(b)||(N=N.add(this.z.square().multiply(b)));var T=(N=N.mod(this.curve.q)).square().subtract(n.shiftLeft(3).multiply(m)).shiftLeft(1).multiply(h).mod(this.curve.q),U=N.multiply(t).multiply(n).subtract(m.shiftLeft(1)).shiftLeft(2).multiply(m).subtract(N.square().multiply(N)).mod(this.curve.q),B=h.square().multiply(h).shiftLeft(3).mod(this.curve.q);return new Ae(this.curve,this.curve.fromBigInteger(T),this.curve.fromBigInteger(U),B)},Ae.prototype.multiply=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var n,o=t,h=o.multiply(new D("3")),m=this.negate(),b=this,N=this.curve.q.subtract(t),T=N.multiply(new D("3")),U=new Ae(this.curve,this.x,this.y),B=U.negate();for(n=h.bitLength()-2;n>0;--n){b=b.twice();var j=h.testBit(n);j!=o.testBit(n)&&(b=b.add(j?this:m))}for(n=T.bitLength()-2;n>0;--n){U=U.twice();var W=T.testBit(n);W!=N.testBit(n)&&(U=U.add(W?U:B))}return b},Ae.prototype.multiplyTwo=function(t,n,o){var h;h=t.bitLength()>o.bitLength()?t.bitLength()-1:o.bitLength()-1;for(var m=this.curve.getInfinity(),b=this.add(n);h>=0;)m=m.twice(),t.testBit(h)?m=o.testBit(h)?m.add(b):m.add(this):o.testBit(h)&&(m=m.add(n)),--h;return m},E.prototype.getQ=function(){return this.q},E.prototype.getA=function(){return this.a},E.prototype.getB=function(){return this.b},E.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)},E.prototype.getInfinity=function(){return this.infinity},E.prototype.fromBigInteger=function(t){return new Le(this.q,t)},E.prototype.decodePointHex=function(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var n=(t.length-2)/2,o=t.substr(2,n),h=t.substr(n+2,n);return new Ae(this,this.fromBigInteger(new D(o,16)),this.fromBigInteger(new D(h,16)));default:return null}},Le.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Ae.prototype.getEncoded=function(r){var t=function(b,N){var T=b.toByteArrayUnsigned();if(N<T.length)T=T.slice(T.length-N);else for(;N>T.length;)T.unshift(0);return T},n=this.getX().toBigInteger(),o=this.getY().toBigInteger(),h=t(n,32);return r?o.isEven()?h.unshift(2):h.unshift(3):(h.unshift(4),h=h.concat(t(o,32))),h},Ae.decodeFrom=function(r,t){t[0];var n=t.length-1,o=t.slice(1,1+n/2),h=t.slice(1+n/2,1+n);o.unshift(0),h.unshift(0);var m=new D(o),b=new D(h);return new Ae(r,r.fromBigInteger(m),r.fromBigInteger(b))},Ae.decodeFromHex=function(r,t){t.substr(0,2);var n=t.length-2,o=t.substr(2,n/2),h=t.substr(2+n/2,n/2),m=new D(o,16),b=new D(h,16);return new Ae(r,r.fromBigInteger(m),r.fromBigInteger(b))},Ae.prototype.add2D=function(r){if(this.isInfinity())return r;if(r.isInfinity())return this;if(this.x.equals(r.x))return this.y.equals(r.y)?this.twice():this.curve.getInfinity();var t=r.x.subtract(this.x),n=r.y.subtract(this.y).divide(t),o=n.square().subtract(this.x).subtract(r.x),h=n.multiply(this.x.subtract(o)).subtract(this.y);return new Ae(this.curve,o,h)},Ae.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var r=this.curve.fromBigInteger(D.valueOf(2)),t=this.curve.fromBigInteger(D.valueOf(3)),n=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(r)),o=n.square().subtract(this.x.multiply(r)),h=n.multiply(this.x.subtract(o)).subtract(this.y);return new Ae(this.curve,o,h)},Ae.prototype.multiply2D=function(r){if(this.isInfinity())return this;if(r.signum()==0)return this.curve.getInfinity();var t,n=r,o=n.multiply(new D("3")),h=this.negate(),m=this;for(t=o.bitLength()-2;t>0;--t){m=m.twice();var b=o.testBit(t);b!=n.testBit(t)&&(m=m.add2D(b?this:h))}return m},Ae.prototype.isOnCurve=function(){var r=this.getX().toBigInteger(),t=this.getY().toBigInteger(),n=this.curve.getA().toBigInteger(),o=this.curve.getB().toBigInteger(),h=this.curve.getQ(),m=t.multiply(t).mod(h),b=r.multiply(r).multiply(r).add(n.multiply(r)).add(o).mod(h);return m.equals(b)},Ae.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Ae.prototype.validate=function(){var r=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),n=this.getY().toBigInteger();if(t.compareTo(D.ONE)<0||t.compareTo(r.subtract(D.ONE))>0)throw new Error("x coordinate out of bounds");if(n.compareTo(D.ONE)<0||n.compareTo(r.subtract(D.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(r).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var p=function(){var r=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function o(b,N,T){return N?n[N]:String.fromCharCode(parseInt(T,16))}var h=new String(""),m=Object.hasOwnProperty;return function(b,N){var T,U,B=b.match(r),j=B[0],W=!1;j==="{"?T={}:j==="["?T=[]:(T=[],W=!0);for(var z=[T],Z=1-W,ne=B.length;Z<ne;++Z){var ie;switch((j=B[Z]).charCodeAt(0)){default:(ie=z[0])[U||ie.length]=+j,U=void 0;break;case 34:if((j=j.substring(1,j.length-1)).indexOf("\\")!==-1&&(j=j.replace(t,o)),ie=z[0],!U){if(!(ie instanceof Array)){U=j||h;break}U=ie.length}ie[U]=j,U=void 0;break;case 91:ie=z[0],z.unshift(ie[U||ie.length]=[]),U=void 0;break;case 93:z.shift();break;case 102:(ie=z[0])[U||ie.length]=!1,U=void 0;break;case 110:(ie=z[0])[U||ie.length]=null,U=void 0;break;case 116:(ie=z[0])[U||ie.length]=!0,U=void 0;break;case 123:ie=z[0],z.unshift(ie[U||ie.length]={}),U=void 0;break;case 125:z.shift()}}if(W){if(z.length!==1)throw new Error;T=T[0]}else if(z.length)throw new Error;return N&&(T=function S(O,H){var q=O[H];if(q&&(q===void 0?"undefined":I(q))==="object"){var ee=null;for(var oe in q)if(m.call(q,oe)&&q!==O){var ge=S(q,oe);ge!==void 0?q[oe]=ge:(ee||(ee=[]),ee.push(oe))}if(ee)for(var fe=ee.length;--fe>=0;)delete q[ee[fe]]}return N.call(O,H,q)}({"":T},"")),T}}();u!==void 0&&u||(e.KJUR=u={}),u.asn1!==void 0&&u.asn1||(u.asn1={}),u.asn1.ASN1Util=new function(){this.integerToByteHex=function(r){var t=r.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(r){var t=r.toString(16);if(t.substr(0,1)!="-")t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var n=t.substr(1).length;n%2==1?n+=1:t.match(/^[0-7]/)||(n+=2);for(var o="",h=0;h<n;h++)o+="f";t=new D(o,16).xor(r).add(D.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(r,t){return Et(r,t)},this.newObject=function(r){var t=u.asn1,n=t.ASN1Object,o=t.DERBoolean,h=t.DERInteger,m=t.DERBitString,b=t.DEROctetString,N=t.DERNull,T=t.DERObjectIdentifier,U=t.DEREnumerated,B=t.DERUTF8String,j=t.DERNumericString,W=t.DERPrintableString,z=t.DERTeletexString,Z=t.DERIA5String,ne=t.DERUTCTime,ie=t.DERGeneralizedTime,S=t.DERVisibleString,O=t.DERBMPString,H=t.DERSequence,q=t.DERSet,ee=t.DERTaggedObject,oe=t.ASN1Util.newObject;if(r instanceof t.ASN1Object)return r;var ge=Object.keys(r);if(ge.length!=1)throw new Error("key of param shall be only one.");var fe=ge[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+fe+":")==-1)throw new Error("undefined key: "+fe);if(fe=="bool")return new o(r[fe]);if(fe=="int")return new h(r[fe]);if(fe=="bitstr")return new m(r[fe]);if(fe=="octstr")return new b(r[fe]);if(fe=="null")return new N(r[fe]);if(fe=="oid")return new T(r[fe]);if(fe=="enum")return new U(r[fe]);if(fe=="utf8str")return new B(r[fe]);if(fe=="numstr")return new j(r[fe]);if(fe=="prnstr")return new W(r[fe]);if(fe=="telstr")return new z(r[fe]);if(fe=="ia5str")return new Z(r[fe]);if(fe=="utctime")return new ne(r[fe]);if(fe=="gentime")return new ie(r[fe]);if(fe=="visstr")return new S(r[fe]);if(fe=="bmpstr")return new O(r[fe]);if(fe=="asn1")return new n(r[fe]);if(fe=="seq"){for(var Ie=r[fe],de=[],Se=0;Se<Ie.length;Se++){var Ke=oe(Ie[Se]);de.push(Ke)}return new H({array:de})}if(fe=="set"){for(Ie=r[fe],de=[],Se=0;Se<Ie.length;Se++)Ke=oe(Ie[Se]),de.push(Ke);return new q({array:de})}if(fe=="tag"){var Ge=r[fe];if(Object.prototype.toString.call(Ge)==="[object Array]"&&Ge.length==3){var Je=oe(Ge[2]);return new ee({tag:Ge[0],explicit:Ge[1],obj:Je})}return new ee(Ge)}},this.jsonToASN1HEX=function(r){return this.newObject(r).getEncodedHex()}},u.asn1.ASN1Util.oidHexToInt=function(r){for(var t="",n=parseInt(r.substr(0,2),16),o=(t=Math.floor(n/40)+"."+n%40,""),h=2;h<r.length;h+=2){var m=("00000000"+parseInt(r.substr(h,2),16).toString(2)).slice(-8);o+=m.substr(1,7),m.substr(0,1)=="0"&&(t=t+"."+new D(o,2).toString(10),o="")}return t},u.asn1.ASN1Util.oidIntToHex=function(r){var t=function(T){var U=T.toString(16);return U.length==1&&(U="0"+U),U},n=function(T){var U="",B=new D(T,10).toString(2),j=7-B.length%7;j==7&&(j=0);for(var W="",z=0;z<j;z++)W+="0";for(B=W+B,z=0;z<B.length-1;z+=7){var Z=B.substr(z,7);z!=B.length-7&&(Z="1"+Z),U+=t(parseInt(Z,2))}return U};if(!r.match(/^[0-9.]+$/))throw"malformed oid string: "+r;var o="",h=r.split("."),m=40*parseInt(h[0])+parseInt(h[1]);o+=t(m),h.splice(0,2);for(var b=0;b<h.length;b++)o+=n(h[b]);return o},u.asn1.ASN1Object=function(r){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var t=this.hV.length/2,n=t.toString(16);if(n.length%2==1&&(n="0"+n),t<128)return n;var o=n.length/2;if(o>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+o).toString(16)+n},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(t){this.params=t},r!=null&&r.tlv!=null&&(this.hTLV=r.tlv,this.isModified=!1)},u.asn1.DERAbstractString=function(r){u.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=Dn(this.s).toLowerCase()},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},r!==void 0&&(typeof r=="string"?this.setString(r):r.str!==void 0?this.setString(r.str):r.hex!==void 0&&this.setStringHex(r.hex))},Ye(u.asn1.DERAbstractString,u.asn1.ASN1Object),u.asn1.DERAbstractTime=function(r){u.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(t){var n=t.getTime()+6e4*t.getTimezoneOffset();return new Date(n)},this.formatDate=function(t,n,o){var h=this.zeroPadding,m=this.localDateToUTC(t),b=String(m.getFullYear());n=="utc"&&(b=b.substr(2,2));var N=b+h(String(m.getMonth()+1),2)+h(String(m.getDate()),2)+h(String(m.getHours()),2)+h(String(m.getMinutes()),2)+h(String(m.getSeconds()),2);if(o===!0){var T=m.getMilliseconds();if(T!=0){var U=h(String(T),3);N=N+"."+(U=U.replace(/[0]+$/,""))}}return N+"Z"},this.zeroPadding=function(t,n){return t.length>=n?t:new Array(n-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=ke(t)},this.setByDateValue=function(t,n,o,h,m,b){var N=new Date(Date.UTC(t,n-1,o,h,m,b,0));this.setByDate(N)},this.getFreshValueHex=function(){return this.hV}},Ye(u.asn1.DERAbstractTime,u.asn1.ASN1Object),u.asn1.DERAbstractStructured=function(r){u.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,r!==void 0&&r.array!==void 0&&(this.asn1Array=r.array)},Ye(u.asn1.DERAbstractStructured,u.asn1.ASN1Object),u.asn1.DERBoolean=function(r){u.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=r==0?"010100":"0101ff"},Ye(u.asn1.DERBoolean,u.asn1.ASN1Object),u.asn1.DERInteger=function(r){u.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=u.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var n=new D(String(t),10);this.setByBigInteger(n)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},r!==void 0&&(r.bigint!==void 0?this.setByBigInteger(r.bigint):r.int!==void 0?this.setByInteger(r.int):typeof r=="number"?this.setByInteger(r):r.hex!==void 0&&this.setValueHex(r.hex))},Ye(u.asn1.DERInteger,u.asn1.ASN1Object),u.asn1.DERBitString=function(r){if(r!==void 0&&r.obj!==void 0){var t=u.asn1.ASN1Util.newObject(r.obj);r.hex="00"+t.getEncodedHex()}u.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(n){this.hTLV=null,this.isModified=!0,this.hV=n},this.setUnusedBitsAndHexValue=function(n,o){if(n<0||7<n)throw"unused bits shall be from 0 to 7: u = "+n;var h="0"+n;this.hTLV=null,this.isModified=!0,this.hV=h+o},this.setByBinaryString=function(n){var o=8-(n=n.replace(/0+$/,"")).length%8;o==8&&(o=0);for(var h=0;h<=o;h++)n+="0";var m="";for(h=0;h<n.length-1;h+=8){var b=n.substr(h,8),N=parseInt(b,2).toString(16);N.length==1&&(N="0"+N),m+=N}this.hTLV=null,this.isModified=!0,this.hV="0"+o+m},this.setByBooleanArray=function(n){for(var o="",h=0;h<n.length;h++)n[h]==1?o+="1":o+="0";this.setByBinaryString(o)},this.newFalseArray=function(n){for(var o=new Array(n),h=0;h<n;h++)o[h]=!1;return o},this.getFreshValueHex=function(){return this.hV},r!==void 0&&(typeof r=="string"&&r.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(r):r.hex!==void 0?this.setHexValueIncludingUnusedBits(r.hex):r.bin!==void 0?this.setByBinaryString(r.bin):r.array!==void 0&&this.setByBooleanArray(r.array))},Ye(u.asn1.DERBitString,u.asn1.ASN1Object),u.asn1.DEROctetString=function(r){if(r!==void 0&&r.obj!==void 0){var t=u.asn1.ASN1Util.newObject(r.obj);r.hex=t.getEncodedHex()}u.asn1.DEROctetString.superclass.constructor.call(this,r),this.hT="04"},Ye(u.asn1.DEROctetString,u.asn1.DERAbstractString),u.asn1.DERNull=function(){u.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Ye(u.asn1.DERNull,u.asn1.ASN1Object),u.asn1.DERObjectIdentifier=function(r){u.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){var n=function(h){var m=function(W){var z=W.toString(16);return z.length==1&&(z="0"+z),z},b=function(W){var z="",Z=parseInt(W,10).toString(2),ne=7-Z.length%7;ne==7&&(ne=0);for(var ie="",S=0;S<ne;S++)ie+="0";for(Z=ie+Z,S=0;S<Z.length-1;S+=7){var O=Z.substr(S,7);S!=Z.length-7&&(O="1"+O),z+=m(parseInt(O,2))}return z};try{if(!h.match(/^[0-9.]+$/))return null;var N="",T=h.split("."),U=40*parseInt(T[0],10)+parseInt(T[1],10);N+=m(U),T.splice(0,2);for(var B=0;B<T.length;B++)N+=b(T[B]);return N}catch{return null}}(t);if(n==null)throw new Error("malformed oid string: "+t);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.setValueName=function(t){var n=u.asn1.x509.OID.name2oid(t);if(n==="")throw new Error("DERObjectIdentifier oidName undefined: "+t);this.setValueOidString(n)},this.setValueNameOrOid=function(t){t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(t){typeof t=="string"?this.setValueNameOrOid(t):t.oid!==void 0?this.setValueNameOrOid(t.oid):t.name!==void 0?this.setValueNameOrOid(t.name):t.hex!==void 0&&this.setValueHex(t.hex)},r!==void 0&&this.setByParam(r)},Ye(u.asn1.DERObjectIdentifier,u.asn1.ASN1Object),u.asn1.DEREnumerated=function(r){u.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=u.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var n=new D(String(t),10);this.setByBigInteger(n)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},r!==void 0&&(r.int!==void 0?this.setByInteger(r.int):typeof r=="number"?this.setByInteger(r):r.hex!==void 0&&this.setValueHex(r.hex))},Ye(u.asn1.DEREnumerated,u.asn1.ASN1Object),u.asn1.DERUTF8String=function(r){u.asn1.DERUTF8String.superclass.constructor.call(this,r),this.hT="0c"},Ye(u.asn1.DERUTF8String,u.asn1.DERAbstractString),u.asn1.DERNumericString=function(r){u.asn1.DERNumericString.superclass.constructor.call(this,r),this.hT="12"},Ye(u.asn1.DERNumericString,u.asn1.DERAbstractString),u.asn1.DERPrintableString=function(r){u.asn1.DERPrintableString.superclass.constructor.call(this,r),this.hT="13"},Ye(u.asn1.DERPrintableString,u.asn1.DERAbstractString),u.asn1.DERTeletexString=function(r){u.asn1.DERTeletexString.superclass.constructor.call(this,r),this.hT="14"},Ye(u.asn1.DERTeletexString,u.asn1.DERAbstractString),u.asn1.DERIA5String=function(r){u.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="16"},Ye(u.asn1.DERIA5String,u.asn1.DERAbstractString),u.asn1.DERVisibleString=function(r){u.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="1a"},Ye(u.asn1.DERVisibleString,u.asn1.DERAbstractString),u.asn1.DERBMPString=function(r){u.asn1.DERBMPString.superclass.constructor.call(this,r),this.hT="1e"},Ye(u.asn1.DERBMPString,u.asn1.DERAbstractString),u.asn1.DERUTCTime=function(r){u.asn1.DERUTCTime.superclass.constructor.call(this,r),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=ke(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=ke(this.s)),this.hV},r!==void 0&&(r.str!==void 0?this.setString(r.str):typeof r=="string"&&r.match(/^[0-9]{12}Z$/)?this.setString(r):r.hex!==void 0?this.setStringHex(r.hex):r.date!==void 0&&this.setByDate(r.date))},Ye(u.asn1.DERUTCTime,u.asn1.DERAbstractTime),u.asn1.DERGeneralizedTime=function(r){u.asn1.DERGeneralizedTime.superclass.constructor.call(this,r),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ke(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ke(this.s)),this.hV},r!==void 0&&(r.str!==void 0?this.setString(r.str):typeof r=="string"&&r.match(/^[0-9]{14}Z$/)?this.setString(r):r.hex!==void 0?this.setStringHex(r.hex):r.date!==void 0&&this.setByDate(r.date),r.millis===!0&&(this.withMillis=!0))},Ye(u.asn1.DERGeneralizedTime,u.asn1.DERAbstractTime),u.asn1.DERSequence=function(r){u.asn1.DERSequence.superclass.constructor.call(this,r),this.hT="30",this.getFreshValueHex=function(){for(var t="",n=0;n<this.asn1Array.length;n++)t+=this.asn1Array[n].getEncodedHex();return this.hV=t,this.hV}},Ye(u.asn1.DERSequence,u.asn1.DERAbstractStructured),u.asn1.DERSet=function(r){u.asn1.DERSet.superclass.constructor.call(this,r),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,n=0;n<this.asn1Array.length;n++){var o=this.asn1Array[n];t.push(o.getEncodedHex())}return this.sortFlag==1&&t.sort(),this.hV=t.join(""),this.hV},r!==void 0&&r.sortflag!==void 0&&r.sortflag==0&&(this.sortFlag=!1)},Ye(u.asn1.DERSet,u.asn1.DERAbstractStructured),u.asn1.DERTaggedObject=function(r){u.asn1.DERTaggedObject.superclass.constructor.call(this);var t=u.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(n,o,h){this.hT=o,this.isExplicit=n,this.asn1Object=h,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=h.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,o),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(n){n.tag!=null&&(this.hT=n.tag),n.explicit!=null&&(this.isExplicit=n.explicit),n.tage!=null&&(this.hT=n.tage,this.isExplicit=!0),n.tagi!=null&&(this.hT=n.tagi,this.isExplicit=!1),n.obj!=null&&(n.obj instanceof t.ASN1Object?(this.asn1Object=n.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):I(n.obj)=="object"&&(this.asn1Object=t.ASN1Util.newObject(n.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},r!=null&&this.setByParam(r)},Ye(u.asn1.DERTaggedObject,u.asn1.ASN1Object);var u,L,Y,G=new function(){};function le(r){for(var t=new Array,n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t}function Fe(r){for(var t="",n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t}function Me(r){for(var t="",n=0;n<r.length;n++){var o=r[n].toString(16);o.length==1&&(o="0"+o),t+=o}return t}function ke(r){return Me(le(r))}function He(r){return r=(r=(r=r.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Ue(r){return r.length%4==2?r+="==":r.length%4==3&&(r+="="),r=(r=r.replace(/-/g,"+")).replace(/_/g,"/")}function st(r){return r.length%2==1&&(r="0"+r),He(A(r))}function We(r){return Q(Ue(r))}function Dn(r){return Qr(en(r))}function at(r){return decodeURIComponent(Zr(r))}function Tt(r){for(var t="",n=0;n<r.length-1;n+=2)t+=String.fromCharCode(parseInt(r.substr(n,2),16));return t}function Dt(r){for(var t="",n=0;n<r.length;n++)t+=("0"+r.charCodeAt(n).toString(16)).slice(-2);return t}function $i(r){return A(r)}function Gi(r){var t=$i(r).replace(/(.{64})/g,`$1\r
`);return t=t.replace(/\r\n$/,"")}function zi(r){return Q(r.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Et(r,t){return"-----BEGIN "+t+`-----\r
`+Gi(r)+`\r
-----END `+t+`-----\r
`}function Bt(r,t){if(r.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+t;return zi(r=t!==void 0?(r=r.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(r=r.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Bn(r){var t,n,o,h,m,b,N,T,U,B,j;if(j=r.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return T=j[1],t=parseInt(T),T.length===2&&(50<=t&&t<100?t=1900+t:0<=t&&t<50&&(t=2e3+t)),n=parseInt(j[2])-1,o=parseInt(j[3]),h=parseInt(j[4]),m=parseInt(j[5]),b=parseInt(j[6]),N=0,(U=j[7])!==""&&(B=(U.substr(1)+"00").substr(0,3),N=parseInt(B)),Date.UTC(t,n,o,h,m,b,N);throw"unsupported zulu format: "+r}function Yi(r){return~~(Bn(r)/1e3)}function Qr(r){return r.replace(/%/g,"")}function Zr(r){return r.replace(/(..)/g,"%$1")}function Xi(r){var t="malformed IPv6 address";if(!r.match(/^[0-9A-Fa-f:]+$/))throw t;var n=(r=r.toLowerCase()).split(":").length-1;if(n<2)throw t;var o=":".repeat(7-n+2),h=(r=r.replace("::",o)).split(":");if(h.length!=8)throw t;for(var m=0;m<8;m++)h[m]=("0000"+h[m]).slice(-4);return h.join("")}function Qi(r){if(!r.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var t=(r=r.toLowerCase()).match(/.{1,4}/g),n=0;n<8;n++)t[n]=t[n].replace(/^0+/,""),t[n]==""&&(t[n]="0");var o=(r=":"+t.join(":")+":").match(/:(0:){2,}/g);if(o===null)return r.slice(1,-1);var h="";for(n=0;n<o.length;n++)o[n].length>h.length&&(h=o[n]);return(r=r.replace(h,"::")).slice(1,-1)}function On(r){var t="malformed hex value";if(!r.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(r.length!=8)return r.length==32?Qi(r):r;try{return parseInt(r.substr(0,2),16)+"."+parseInt(r.substr(2,2),16)+"."+parseInt(r.substr(4,2),16)+"."+parseInt(r.substr(6,2),16)}catch{throw t}}function Zi(r){return r.match(/.{4}/g).map(function(n){var o=parseInt(n.substr(0,2),16),h=parseInt(n.substr(2),16);if(o==0&h<128)return String.fromCharCode(h);if(o<8){var m=128|63&h;return at((192|(7&o)<<3|(192&h)>>6).toString(16)+m.toString(16))}m=128|(15&o)<<2|(192&h)>>6;var b=128|63&h;return at((224|(240&o)>>4).toString(16)+m.toString(16)+b.toString(16))}).join("")}function en(r){for(var t=encodeURIComponent(r),n="",o=0;o<t.length;o++)t[o]=="%"?(n+=t.substr(o,3),o+=2):n=n+"%"+ke(t[o]);return n}function eo(r){return!(r.length%2!=0||!r.match(/^[0-9a-f]+$/)&&!r.match(/^[0-9A-F]+$/))}function jn(r){return r.length%2==1?"0"+r:r.substr(0,1)>"7"?"00"+r:r}G.getLblen=function(r,t){if(r.substr(t+2,1)!="8")return 1;var n=parseInt(r.substr(t+3,1));return n==0?-1:0<n&&n<10?n+1:-2},G.getL=function(r,t){var n=G.getLblen(r,t);return n<1?"":r.substr(t+2,2*n)},G.getVblen=function(r,t){var n;return(n=G.getL(r,t))==""?-1:(n.substr(0,1)==="8"?new D(n.substr(2),16):new D(n,16)).intValue()},G.getVidx=function(r,t){var n=G.getLblen(r,t);return n<0?n:t+2*(n+1)},G.getV=function(r,t){var n=G.getVidx(r,t),o=G.getVblen(r,t);return r.substr(n,2*o)},G.getTLV=function(r,t){return r.substr(t,2)+G.getL(r,t)+G.getV(r,t)},G.getTLVblen=function(r,t){return 2+2*G.getLblen(r,t)+2*G.getVblen(r,t)},G.getNextSiblingIdx=function(r,t){return G.getVidx(r,t)+2*G.getVblen(r,t)},G.getChildIdx=function(r,t){var n,o,h,m=G,b=[];n=m.getVidx(r,t),o=2*m.getVblen(r,t),r.substr(t,2)=="03"&&(n+=2,o-=2),h=0;for(var N=n;h<=o;){var T=m.getTLVblen(r,N);if((h+=T)<=o&&b.push(N),N+=T,h>=o)break}return b},G.getNthChildIdx=function(r,t,n){return G.getChildIdx(r,t)[n]},G.getIdxbyList=function(r,t,n,o){var h,m,b=G;return n.length==0?o!==void 0&&r.substr(t,2)!==o?-1:t:(h=n.shift())>=(m=b.getChildIdx(r,t)).length?-1:b.getIdxbyList(r,m[h],n,o)},G.getIdxbyListEx=function(r,t,n,o){var h,m,b=G;if(n.length==0)return o!==void 0&&r.substr(t,2)!==o?-1:t;h=n.shift(),m=b.getChildIdx(r,t);for(var N=0,T=0;T<m.length;T++){var U=r.substr(m[T],2);if(typeof h=="number"&&!b.isContextTag(U)&&N==h||typeof h=="string"&&b.isContextTag(U,h))return b.getIdxbyListEx(r,m[T],n,o);b.isContextTag(U)||N++}return-1},G.getTLVbyList=function(r,t,n,o){var h=G,m=h.getIdxbyList(r,t,n,o);return m==-1||m>=r.length?null:h.getTLV(r,m)},G.getTLVbyListEx=function(r,t,n,o){var h=G,m=h.getIdxbyListEx(r,t,n,o);return m==-1?null:h.getTLV(r,m)},G.getVbyList=function(r,t,n,o,h){var m,b,N=G;return(m=N.getIdxbyList(r,t,n,o))==-1||m>=r.length?null:(b=N.getV(r,m),h===!0&&(b=b.substr(2)),b)},G.getVbyListEx=function(r,t,n,o,h){var m,b,N=G;return(m=N.getIdxbyListEx(r,t,n,o))==-1?null:(b=N.getV(r,m),r.substr(m,2)=="03"&&h!==!1&&(b=b.substr(2)),b)},G.getInt=function(r,t,n){n==null&&(n=-1);try{var o=r.substr(t,2);if(o!="02"&&o!="03")return n;var h=G.getV(r,t);return o=="02"?parseInt(h,16):function(b){try{var N=b.substr(0,2);if(N=="00")return parseInt(b.substr(2),16);var T=parseInt(N,16),U=b.substr(2),B=parseInt(U,16).toString(2);return B=="0"&&(B="00000000"),B=B.slice(0,0-T),parseInt(B,2)}catch{return-1}}(h)}catch{return n}},G.getOID=function(r,t,n){n==null&&(n=null);try{return r.substr(t,2)!="06"?n:function(h){if(!eo(h))return null;try{var m=[],b=h.substr(0,2),N=parseInt(b,16);m[0]=new String(Math.floor(N/40)),m[1]=new String(N%40);for(var T=h.substr(2),U=[],B=0;B<T.length/2;B++)U.push(parseInt(T.substr(2*B,2),16));var j=[],W="";for(B=0;B<U.length;B++)128&U[B]?W+=to((127&U[B]).toString(2),7):(W+=to((127&U[B]).toString(2),7),j.push(new String(parseInt(W,2))),W="");var z=m.join(".");return j.length>0&&(z=z+"."+j.join(".")),z}catch{return null}}(G.getV(r,t))}catch{return n}},G.getOIDName=function(r,t,n){n==null&&(n=null);try{var o=G.getOID(r,t,n);if(o==n)return n;var h=u.asn1.x509.OID.oid2name(o);return h==""?o:h}catch{return n}},G.getString=function(r,t,n){n==null&&(n=null);try{return Tt(G.getV(r,t))}catch{return n}},G.hextooidstr=function(r){var t=function(W,z){return W.length>=z?W:new Array(z-W.length+1).join("0")+W},n=[],o=r.substr(0,2),h=parseInt(o,16);n[0]=new String(Math.floor(h/40)),n[1]=new String(h%40);for(var m=r.substr(2),b=[],N=0;N<m.length/2;N++)b.push(parseInt(m.substr(2*N,2),16));var T=[],U="";for(N=0;N<b.length;N++)128&b[N]?U+=t((127&b[N]).toString(2),7):(U+=t((127&b[N]).toString(2),7),T.push(new String(parseInt(U,2))),U="");var B=n.join(".");return T.length>0&&(B=B+"."+T.join(".")),B},G.dump=function(r,t,n,o){var h=G,m=h.getV,b=h.dump,N=h.getChildIdx,T=r;r instanceof u.asn1.ASN1Object&&(T=r.getEncodedHex());var U=function(fe,Ie){return fe.length<=2*Ie?fe:fe.substr(0,Ie)+"..(total "+fe.length/2+"bytes).."+fe.substr(fe.length-Ie,Ie)};t===void 0&&(t={ommit_long_octet:32}),n===void 0&&(n=0),o===void 0&&(o="");var B,j=t.ommit_long_octet;if((B=T.substr(n,2))=="01")return(W=m(T,n))=="00"?o+`BOOLEAN FALSE
`:o+`BOOLEAN TRUE
`;if(B=="02")return o+"INTEGER "+U(W=m(T,n),j)+`
`;if(B=="03"){var W=m(T,n);if(h.isASN1HEX(W.substr(2))){var z=o+`BITSTRING, encapsulates
`;return z+=b(W.substr(2),t,0,o+"  ")}return o+"BITSTRING "+U(W,j)+`
`}if(B=="04")return W=m(T,n),h.isASN1HEX(W)?(z=o+`OCTETSTRING, encapsulates
`,z+=b(W,t,0,o+"  ")):o+"OCTETSTRING "+U(W,j)+`
`;if(B=="05")return o+`NULL
`;if(B=="06"){var Z=m(T,n),ne=u.asn1.ASN1Util.oidHexToInt(Z),ie=u.asn1.x509.OID.oid2name(ne),S=ne.replace(/\./g," ");return ie!=""?o+"ObjectIdentifier "+ie+" ("+S+`)
`:o+"ObjectIdentifier ("+S+`)
`}if(B=="0a")return o+"ENUMERATED "+parseInt(m(T,n))+`
`;if(B=="0c")return o+"UTF8String '"+at(m(T,n))+`'
`;if(B=="13")return o+"PrintableString '"+at(m(T,n))+`'
`;if(B=="14")return o+"TeletexString '"+at(m(T,n))+`'
`;if(B=="16")return o+"IA5String '"+at(m(T,n))+`'
`;if(B=="17")return o+"UTCTime "+at(m(T,n))+`
`;if(B=="18")return o+"GeneralizedTime "+at(m(T,n))+`
`;if(B=="1a")return o+"VisualString '"+at(m(T,n))+`'
`;if(B=="1e")return o+"BMPString '"+Zi(m(T,n))+`'
`;if(B=="30"){if(T.substr(n,4)=="3000")return o+`SEQUENCE {}
`;z=o+`SEQUENCE
`;var O=t;if(((ee=N(T,n)).length==2||ee.length==3)&&T.substr(ee[0],2)=="06"&&T.substr(ee[ee.length-1],2)=="04"){ie=h.oidname(m(T,ee[0]));var H=JSON.parse(JSON.stringify(t));H.x509ExtName=ie,O=H}for(var q=0;q<ee.length;q++)z+=b(T,O,ee[q],o+"  ");return z}if(B=="31"){z=o+`SET
`;var ee=N(T,n);for(q=0;q<ee.length;q++)z+=b(T,t,ee[q],o+"  ");return z}if(128&(B=parseInt(B,16))){var oe=31&B;if(32&B){for(z=o+"["+oe+`]
`,ee=N(T,n),q=0;q<ee.length;q++)z+=b(T,t,ee[q],o+"  ");return z}if(W=m(T,n),G.isASN1HEX(W)){var z=o+"["+oe+`]
`;return z+=b(W,t,0,o+"  ")}return(W.substr(0,8)=="68747470"||t.x509ExtName==="subjectAltName"&&oe==2)&&(W=at(W)),z=o+"["+oe+"] "+W+`
`}return o+"UNKNOWN("+B+") "+m(T,n)+`
`},G.isContextTag=function(r,t){var n,o;r=r.toLowerCase();try{n=parseInt(r,16)}catch{return-1}if(t===void 0)return(192&n)==128;try{return t.match(/^\[[0-9]+\]$/)!=null&&!((o=parseInt(t.substr(1,t.length-1),10))>31)&&(192&n)==128&&(31&n)==o}catch{return!1}},G.isASN1HEX=function(r){var t=G;if(r.length%2==1)return!1;var n=t.getVblen(r,0),o=r.substr(0,2),h=t.getL(r,0);return r.length-o.length-h.length==2*n},G.checkStrictDER=function(r,t,n,o,h){var m=G;if(n===void 0){if(typeof r!="string")throw new Error("not hex string");if(r=r.toLowerCase(),!u.lang.String.isHex(r))throw new Error("not hex string");n=r.length,h=(o=r.length/2)<128?1:Math.ceil(o.toString(16))+1}if(m.getL(r,t).length>2*h)throw new Error("L of TLV too long: idx="+t);var b=m.getVblen(r,t);if(b>o)throw new Error("value of L too long than hex: idx="+t);var N=m.getTLV(r,t),T=N.length-2-m.getL(r,t).length;if(T!==2*b)throw new Error("V string length and L's value not the same:"+T+"/"+2*b);if(t===0&&r.length!=N.length)throw new Error("total length and TLV length unmatch:"+r.length+"!="+N.length);var U=r.substr(t,2);if(U==="02"){var B=m.getVidx(r,t);if(r.substr(B,2)=="00"&&r.charCodeAt(B+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(U,16)){for(var j=m.getVblen(r,t),W=0,z=m.getChildIdx(r,t),Z=0;Z<z.length;Z++)W+=m.getTLV(r,z[Z]).length,m.checkStrictDER(r,z[Z],n,o,h);if(2*j!=W)throw new Error("sum of children's TLV length and L unmatch: "+2*j+"!="+W)}},G.oidname=function(r){var t=u.asn1;u.lang.String.isHex(r)&&(r=t.ASN1Util.oidHexToInt(r));var n=t.x509.OID.oid2name(r);return n===""&&(n=r),n},u!==void 0&&u||(e.KJUR=u={}),u.lang!==void 0&&u.lang||(u.lang={}),u.lang.String=function(){},typeof a=="function"?(e.utf8tob64u=L=function(t){return He(a.from(t,"utf8").toString("base64"))},e.b64utoutf8=Y=function(t){return a.from(Ue(t),"base64").toString("utf8")}):(e.utf8tob64u=L=function(t){return st(Qr(en(t)))},e.b64utoutf8=Y=function(t){return decodeURIComponent(Zr(We(t)))}),u.lang.String.isInteger=function(r){return!!r.match(/^[0-9]+$/)||!!r.match(/^-[0-9]+$/)},u.lang.String.isHex=function(r){return eo(r)},u.lang.String.isBase64=function(r){return!(!(r=r.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||r.length%4!=0)},u.lang.String.isBase64URL=function(r){return!r.match(/[+/=]/)&&(r=Ue(r),u.lang.String.isBase64(r))},u.lang.String.isIntegerArray=function(r){return!!(r=r.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},u.lang.String.isPrintable=function(r){return r.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},u.lang.String.isIA5=function(r){return r.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},u.lang.String.isMail=function(r){return r.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var to=function(t,n,o){return o==null&&(o="0"),t.length>=n?t:new Array(n-t.length+1).join(o)+t};function Ye(r,t){var n=function(){};n.prototype=t.prototype,r.prototype=new n,r.prototype.constructor=r,r.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}u!==void 0&&u||(e.KJUR=u={}),u.crypto!==void 0&&u.crypto||(u.crypto={}),u.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:V.algo.MD5,sha1:V.algo.SHA1,sha224:V.algo.SHA224,sha256:V.algo.SHA256,sha384:V.algo.SHA384,sha512:V.algo.SHA512,ripemd160:V.algo.RIPEMD160},this.getDigestInfoHex=function(r,t){if(this.DIGESTINFOHEAD[t]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+r},this.getPaddedDigestInfoHex=function(r,t,n){var o=this.getDigestInfoHex(r,t),h=n/4;if(o.length+22>h)throw"key is too short for SigAlg: keylen="+n+","+t;for(var m="0001",b="00"+o,N="",T=h-m.length-b.length,U=0;U<T;U+=2)N+="ff";return m+N+b},this.hashString=function(r,t){return new u.crypto.MessageDigest({alg:t}).digestString(r)},this.hashHex=function(r,t){return new u.crypto.MessageDigest({alg:t}).digestHex(r)},this.sha1=function(r){return this.hashString(r,"sha1")},this.sha256=function(r){return this.hashString(r,"sha256")},this.sha256Hex=function(r){return this.hashHex(r,"sha256")},this.sha512=function(r){return this.hashString(r,"sha512")},this.sha512Hex=function(r){return this.hashHex(r,"sha512")},this.isKey=function(r){return r instanceof we||r instanceof u.crypto.DSA||r instanceof u.crypto.ECDSA}},u.crypto.Util.md5=function(r){return new u.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(r)},u.crypto.Util.ripemd160=function(r){return new u.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(r)},u.crypto.Util.SECURERANDOMGEN=new Ce,u.crypto.Util.getRandomHexOfNbytes=function(r){var t=new Array(r);return u.crypto.Util.SECURERANDOMGEN.nextBytes(t),Me(t)},u.crypto.Util.getRandomBigIntegerOfNbytes=function(r){return new D(u.crypto.Util.getRandomHexOfNbytes(r),16)},u.crypto.Util.getRandomHexOfNbits=function(r){var t=r%8,n=new Array((r-t)/8+1);return u.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<t&255^255)&n[0],Me(n)},u.crypto.Util.getRandomBigIntegerOfNbits=function(r){return new D(u.crypto.Util.getRandomHexOfNbits(r),16)},u.crypto.Util.getRandomBigIntegerZeroToMax=function(r){for(var t=r.bitLength();;){var n=u.crypto.Util.getRandomBigIntegerOfNbits(t);if(r.compareTo(n)!=-1)return n}},u.crypto.Util.getRandomBigIntegerMinToMax=function(r,t){var n=r.compareTo(t);if(n==1)throw"biMin is greater than biMax";if(n==0)return r;var o=t.subtract(r);return u.crypto.Util.getRandomBigIntegerZeroToMax(o).add(r)},u.crypto.MessageDigest=function(r){this.setAlgAndProvider=function(t,n){if((t=u.crypto.MessageDigest.getCanonicalAlgName(t))!==null&&n===void 0&&(n=u.crypto.Util.DEFAULTPROVIDER[t]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(t)!=-1&&n=="cryptojs"){try{this.md=u.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[t].create()}catch(o){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+o}this.updateString=function(o){this.md.update(o)},this.updateHex=function(o){var h=V.enc.Hex.parse(o);this.md.update(h)},this.digest=function(){return this.md.finalize().toString(V.enc.Hex)},this.digestString=function(o){return this.updateString(o),this.digest()},this.digestHex=function(o){return this.updateHex(o),this.digest()}}if(":sha256:".indexOf(t)!=-1&&n=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(o){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+o}this.updateString=function(o){this.md.update(o)},this.updateHex=function(o){var h=sjcl.codec.hex.toBits(o);this.md.update(h)},this.digest=function(){var o=this.md.finalize();return sjcl.codec.hex.fromBits(o)},this.digestString=function(o){return this.updateString(o),this.digest()},this.digestHex=function(o){return this.updateHex(o),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},r!==void 0&&r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0&&(this.provName=u.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},u.crypto.MessageDigest.getCanonicalAlgName=function(r){return typeof r=="string"&&(r=(r=r.toLowerCase()).replace(/-/,"")),r},u.crypto.MessageDigest.getHashLength=function(r){var t=u.crypto.MessageDigest,n=t.getCanonicalAlgName(r);if(t.HASHLENGTH[n]===void 0)throw"not supported algorithm: "+r;return t.HASHLENGTH[n]},u.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},u.crypto.Mac=function(r){this.setAlgAndProvider=function(t,n){if((t=t.toLowerCase())==null&&(t="hmacsha1"),(t=t.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+t;n===void 0&&(n=u.crypto.Util.DEFAULTPROVIDER[t]),this.algProv=t+"/"+n;var o=t.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(o)!=-1&&n=="cryptojs"){try{var h=u.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[o];this.mac=V.algo.HMAC.create(h,this.pass)}catch(m){throw"setAlgAndProvider hash alg set fail hashAlg="+o+"/"+m}this.updateString=function(m){this.mac.update(m)},this.updateHex=function(m){var b=V.enc.Hex.parse(m);this.mac.update(b)},this.doFinal=function(){return this.mac.finalize().toString(V.enc.Hex)},this.doFinalString=function(m){return this.updateString(m),this.doFinal()},this.doFinalHex=function(m){return this.updateHex(m),this.doFinal()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(t){if(typeof t=="string"){var n=t;return t.length%2!=1&&t.match(/^[0-9A-Fa-f]+$/)||(n=Dt(t)),void(this.pass=V.enc.Hex.parse(n))}if((t===void 0?"undefined":I(t))!="object")throw"KJUR.crypto.Mac unsupported password type: "+t;if(n=null,t.hex!==void 0){if(t.hex.length%2!=0||!t.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+t.hex;n=t.hex}if(t.utf8!==void 0&&(n=Dn(t.utf8)),t.rstr!==void 0&&(n=Dt(t.rstr)),t.b64!==void 0&&(n=Q(t.b64)),t.b64u!==void 0&&(n=We(t.b64u)),n==null)throw"KJUR.crypto.Mac unsupported password type: "+t;this.pass=V.enc.Hex.parse(n)},r!==void 0&&(r.pass!==void 0&&this.setPassword(r.pass),r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0&&(this.provName=u.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},u.crypto.Signature=function(r){var t=null;if(this._setAlgNames=function(){var n=this.algName.match(/^(.+)with(.+)$/);n&&(this.mdAlgName=n[1].toLowerCase(),this.pubkeyAlgName=n[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(n,o){for(var h="",m=o/4-n.length,b=0;b<m;b++)h+="0";return h+n},this.setAlgAndProvider=function(n,o){if(this._setAlgNames(),o!="cryptojs/jsrsa")throw new Error("provider not supported: "+o);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new u.crypto.MessageDigest({alg:this.mdAlgName})}catch(h){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+h)}this.init=function(h,m){var b=null;try{b=m===void 0?rt.getKey(h):rt.getKey(h,m)}catch(N){throw"init failed:"+N}if(b.isPrivate===!0)this.prvKey=b,this.state="SIGN";else{if(b.isPublic!==!0)throw"init failed.:"+b;this.pubKey=b,this.state="VERIFY"}},this.updateString=function(h){this.md.updateString(h)},this.updateHex=function(h){this.md.updateHex(h)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&u.crypto.ECDSA!==void 0&&(this.prvKey=new u.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof we&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof we&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof u.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof u.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(h){return this.updateString(h),this.sign()},this.signHex=function(h){return this.updateHex(h),this.sign()},this.verify=function(h){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&u.crypto.ECDSA!==void 0&&(this.pubKey=new u.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof we&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,h,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof we&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,h);if(u.crypto.ECDSA!==void 0&&this.pubKey instanceof u.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,h);if(u.crypto.DSA!==void 0&&this.pubKey instanceof u.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,h);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(n,o){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(n){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(n){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(n){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(n){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(n){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=r,r!==void 0&&(r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0?this.provName=u.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=r.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),r.psssaltlen!==void 0&&(this.pssSaltLen=r.psssaltlen),r.prvkeypem!==void 0)){if(r.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{t=rt.getKey(r.prvkeypem),this.init(t)}catch(n){throw"fatal error to load pem private key: "+n}}},u.crypto.Cipher=function(r){},u.crypto.Cipher.encrypt=function(r,t,n){if(t instanceof we&&t.isPublic){var o=u.crypto.Cipher.getAlgByKeyAndName(t,n);if(o==="RSA")return t.encrypt(r);if(o==="RSAOAEP")return t.encryptOAEP(r,"sha1");var h=o.match(/^RSAOAEP(\d+)$/);if(h!==null)return t.encryptOAEP(r,"sha"+h[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.encrypt: unsupported key or algorithm"},u.crypto.Cipher.decrypt=function(r,t,n){if(t instanceof we&&t.isPrivate){var o=u.crypto.Cipher.getAlgByKeyAndName(t,n);if(o==="RSA")return t.decrypt(r);if(o==="RSAOAEP")return t.decryptOAEP(r,"sha1");var h=o.match(/^RSAOAEP(\d+)$/);if(h!==null)return t.decryptOAEP(r,"sha"+h[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.decrypt: unsupported key or algorithm"},u.crypto.Cipher.getAlgByKeyAndName=function(r,t){if(r instanceof we){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t)!=-1)return t;if(t==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},u.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},u!==void 0&&u||(e.KJUR=u={}),u.crypto!==void 0&&u.crypto||(u.crypto={}),u.crypto.ECDSA=function(r){var t=Error,n=D,o=Ae,h=u.crypto.ECDSA,m=u.crypto.ECParameterDB,b=h.getName,N=G,T=N.getVbyListEx,U=N.isASN1HEX,B=new Ce;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(j){return new n(j.bitLength(),B).mod(j.subtract(n.ONE)).add(n.ONE)},this.setNamedCurve=function(j){this.ecparams=m.getByName(j),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=j},this.setPrivateKeyHex=function(j){this.isPrivate=!0,this.prvKeyHex=j},this.setPublicKeyHex=function(j){this.isPublic=!0,this.pubKeyHex=j},this.getPublicKeyXYHex=function(){var j=this.pubKeyHex;if(j.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var W=this.ecparams.keylen/4;if(j.length!==2+2*W)throw"malformed public key hex length";var z={};return z.x=j.substr(2,W),z.y=j.substr(2+W),z},this.getShortNISTPCurveName=function(){var j=this.curveName;return j==="secp256r1"||j==="NIST P-256"||j==="P-256"||j==="prime256v1"?"P-256":j==="secp384r1"||j==="NIST P-384"||j==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var j=this.ecparams.n,W=this.getBigRandom(j),z=this.ecparams.G.multiply(W),Z=z.getX().toBigInteger(),ne=z.getY().toBigInteger(),ie=this.ecparams.keylen/4,S=("0000000000"+W.toString(16)).slice(-ie),O="04"+("0000000000"+Z.toString(16)).slice(-ie)+("0000000000"+ne.toString(16)).slice(-ie);return this.setPrivateKeyHex(S),this.setPublicKeyHex(O),{ecprvhex:S,ecpubhex:O}},this.signWithMessageHash=function(j){return this.signHex(j,this.prvKeyHex)},this.signHex=function(j,W){var z=new n(W,16),Z=this.ecparams.n,ne=new n(j.substring(0,this.ecparams.keylen/4),16);do var ie=this.getBigRandom(Z),S=this.ecparams.G.multiply(ie).getX().toBigInteger().mod(Z);while(S.compareTo(n.ZERO)<=0);var O=ie.modInverse(Z).multiply(ne.add(z.multiply(S))).mod(Z);return h.biRSSigToASN1Sig(S,O)},this.sign=function(j,W){var z=W,Z=this.ecparams.n,ne=n.fromByteArrayUnsigned(j);do var ie=this.getBigRandom(Z),S=this.ecparams.G.multiply(ie).getX().toBigInteger().mod(Z);while(S.compareTo(D.ZERO)<=0);var O=ie.modInverse(Z).multiply(ne.add(z.multiply(S))).mod(Z);return this.serializeSig(S,O)},this.verifyWithMessageHash=function(j,W){return this.verifyHex(j,W,this.pubKeyHex)},this.verifyHex=function(j,W,z){try{var Z,ne,ie=h.parseSigHex(W);Z=ie.r,ne=ie.s;var S=o.decodeFromHex(this.ecparams.curve,z),O=new n(j.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(O,Z,ne,S)}catch{return!1}},this.verify=function(j,W,z){var Z,ne,ie;if(Bitcoin.Util.isArray(W)){var S=this.parseSig(W);Z=S.r,ne=S.s}else{if((W===void 0?"undefined":I(W))!=="object"||!W.r||!W.s)throw"Invalid value for signature";Z=W.r,ne=W.s}if(z instanceof Ae)ie=z;else{if(!Bitcoin.Util.isArray(z))throw"Invalid format for pubkey value, must be byte array or ECPointFp";ie=o.decodeFrom(this.ecparams.curve,z)}var O=n.fromByteArrayUnsigned(j);return this.verifyRaw(O,Z,ne,ie)},this.verifyRaw=function(j,W,z,Z){var ne=this.ecparams.n,ie=this.ecparams.G;if(W.compareTo(n.ONE)<0||W.compareTo(ne)>=0||z.compareTo(n.ONE)<0||z.compareTo(ne)>=0)return!1;var S=z.modInverse(ne),O=j.multiply(S).mod(ne),H=W.multiply(S).mod(ne);return ie.multiply(O).add(Z.multiply(H)).getX().toBigInteger().mod(ne).equals(W)},this.serializeSig=function(j,W){var z=j.toByteArraySigned(),Z=W.toByteArraySigned(),ne=[];return ne.push(2),ne.push(z.length),(ne=ne.concat(z)).push(2),ne.push(Z.length),(ne=ne.concat(Z)).unshift(ne.length),ne.unshift(48),ne},this.parseSig=function(j){var W;if(j[0]!=48)throw new Error("Signature not a valid DERSequence");if(j[W=2]!=2)throw new Error("First element in signature must be a DERInteger");var z=j.slice(W+2,W+2+j[W+1]);if(j[W+=2+j[W+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var Z=j.slice(W+2,W+2+j[W+1]);return W+=2+j[W+1],{r:n.fromByteArrayUnsigned(z),s:n.fromByteArrayUnsigned(Z)}},this.parseSigCompact=function(j){if(j.length!==65)throw"Signature has the wrong length";var W=j[0]-27;if(W<0||W>7)throw"Invalid signature type";var z=this.ecparams.n;return{r:n.fromByteArrayUnsigned(j.slice(1,33)).mod(z),s:n.fromByteArrayUnsigned(j.slice(33,65)).mod(z),i:W}},this.readPKCS5PrvKeyHex=function(j){if(U(j)===!1)throw new Error("not ASN.1 hex string");var W,z,Z;try{W=T(j,0,["[0]",0],"06"),z=T(j,0,[1],"04");try{Z=T(j,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=b(W),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(Z),this.setPrivateKeyHex(z),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(j){if(U(j)===!1)throw new t("not ASN.1 hex string");var W,z,Z;try{T(j,0,[1,0],"06"),W=T(j,0,[1,1],"06"),z=T(j,0,[2,0,1],"04");try{Z=T(j,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=b(W),this.curveName===void 0)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(Z),this.setPrivateKeyHex(z),this.isPublic=!1},this.readPKCS8PubKeyHex=function(j){if(U(j)===!1)throw new t("not ASN.1 hex string");var W,z;try{T(j,0,[0,0],"06"),W=T(j,0,[0,1],"06"),z=T(j,0,[1],"03")}catch{throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=b(W),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},this.readCertPubKeyHex=function(j,W){if(U(j)===!1)throw new t("not ASN.1 hex string");var z,Z;try{z=T(j,0,[0,5,0,1],"06"),Z=T(j,0,[0,5,1],"03")}catch{throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=b(z),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(Z)},r!==void 0&&r.curve!==void 0&&(this.curveName=r.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),r!==void 0&&(r.prv!==void 0&&this.setPrivateKeyHex(r.prv),r.pub!==void 0&&this.setPublicKeyHex(r.pub))},u.crypto.ECDSA.parseSigHex=function(r){var t=u.crypto.ECDSA.parseSigHexInHexRS(r);return{r:new D(t.r,16),s:new D(t.s,16)}},u.crypto.ECDSA.parseSigHexInHexRS=function(r){var t=G,n=t.getChildIdx,o=t.getV;if(t.checkStrictDER(r,0),r.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var h=n(r,0);if(h.length!=2)throw new Error("signature shall have two elements");var m=h[0],b=h[1];if(r.substr(m,2)!="02")throw new Error("1st item not ASN.1 integer");if(r.substr(b,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:o(r,m),s:o(r,b)}},u.crypto.ECDSA.asn1SigToConcatSig=function(r){var t=u.crypto.ECDSA.parseSigHexInHexRS(r),n=t.r,o=t.s;if(n.substr(0,2)=="00"&&n.length%32==2&&(n=n.substr(2)),o.substr(0,2)=="00"&&o.length%32==2&&(o=o.substr(2)),n.length%32==30&&(n="00"+n),o.length%32==30&&(o="00"+o),n.length%32!=0)throw"unknown ECDSA sig r length error";if(o.length%32!=0)throw"unknown ECDSA sig s length error";return n+o},u.crypto.ECDSA.concatSigToASN1Sig=function(r){if(r.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var t=r.substr(0,r.length/2),n=r.substr(r.length/2);return u.crypto.ECDSA.hexRSSigToASN1Sig(t,n)},u.crypto.ECDSA.hexRSSigToASN1Sig=function(r,t){var n=new D(r,16),o=new D(t,16);return u.crypto.ECDSA.biRSSigToASN1Sig(n,o)},u.crypto.ECDSA.biRSSigToASN1Sig=function(r,t){var n=u.asn1,o=new n.DERInteger({bigint:r}),h=new n.DERInteger({bigint:t});return new n.DERSequence({array:[o,h]}).getEncodedHex()},u.crypto.ECDSA.getName=function(r){return r==="2b8104001f"?"secp192k1":r==="2a8648ce3d030107"?"secp256r1":r==="2b8104000a"?"secp256k1":r==="2b81040021"?"secp224r1":r==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(r)!==-1?"secp256r1":"|secp256k1|".indexOf(r)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(r)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(r)!==-1?"secp384r1":null},u!==void 0&&u||(e.KJUR=u={}),u.crypto!==void 0&&u.crypto||(u.crypto={}),u.crypto.ECParameterDB=new function(){var r={},t={};function n(o){return new D(o,16)}this.getByName=function(o){var h=o;if(t[h]!==void 0&&(h=t[o]),r[h]!==void 0)return r[h];throw"unregistered EC curve name: "+h},this.regist=function(o,h,m,b,N,T,U,B,j,W,z,Z){r[o]={};var ne=n(m),ie=n(b),S=n(N),O=n(T),H=n(U),q=new E(ne,ie,S),ee=q.decodePointHex("04"+B+j);r[o].name=o,r[o].keylen=h,r[o].curve=q,r[o].G=ee,r[o].n=O,r[o].h=H,r[o].oid=z,r[o].info=Z;for(var oe=0;oe<W.length;oe++)t[W[oe]]=o}},u.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),u.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),u.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),u.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),u.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),u.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),u.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),u.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),u.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),u.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var rt=function(){var r=function(U,B,j){return t(V.AES,U,B,j)},t=function(U,B,j,W){var z=V.enc.Hex.parse(B),Z=V.enc.Hex.parse(j),ne=V.enc.Hex.parse(W),ie={};ie.key=Z,ie.iv=ne,ie.ciphertext=z;var S=U.decrypt(ie,Z,{iv:ne});return V.enc.Hex.stringify(S)},n=function(U,B,j){return o(V.AES,U,B,j)},o=function(U,B,j,W){var z=V.enc.Hex.parse(B),Z=V.enc.Hex.parse(j),ne=V.enc.Hex.parse(W),ie=U.encrypt(z,Z,{iv:ne}),S=V.enc.Hex.parse(ie.toString());return V.enc.Base64.stringify(S)},h={"AES-256-CBC":{proc:r,eproc:n,keylen:32,ivlen:16},"AES-192-CBC":{proc:r,eproc:n,keylen:24,ivlen:16},"AES-128-CBC":{proc:r,eproc:n,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(U,B,j){return t(V.TripleDES,U,B,j)},eproc:function(U,B,j){return o(V.TripleDES,U,B,j)},keylen:24,ivlen:8},"DES-CBC":{proc:function(U,B,j){return t(V.DES,U,B,j)},eproc:function(U,B,j){return o(V.DES,U,B,j)},keylen:8,ivlen:8}},m=function(U){var B={},j=U.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));j&&(B.cipher=j[1],B.ivsalt=j[2]);var W=U.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));W&&(B.type=W[1]);var z=-1,Z=0;U.indexOf(`\r
\r
`)!=-1&&(z=U.indexOf(`\r
\r
`),Z=2),U.indexOf(`

`)!=-1&&(z=U.indexOf(`

`),Z=1);var ne=U.indexOf("-----END");if(z!=-1&&ne!=-1){var ie=U.substring(z+2*Z,ne-Z);ie=ie.replace(/\s+/g,""),B.data=ie}return B},b=function(U,B,j){for(var W=j.substring(0,16),z=V.enc.Hex.parse(W),Z=V.enc.Utf8.parse(B),ne=h[U].keylen+h[U].ivlen,ie="",S=null;;){var O=V.algo.MD5.create();if(S!=null&&O.update(S),O.update(Z),O.update(z),S=O.finalize(),(ie+=V.enc.Hex.stringify(S)).length>=2*ne)break}var H={};return H.keyhex=ie.substr(0,2*h[U].keylen),H.ivhex=ie.substr(2*h[U].keylen,2*h[U].ivlen),H},N=function(U,B,j,W){var z=V.enc.Base64.parse(U),Z=V.enc.Hex.stringify(z);return(0,h[B].proc)(Z,j,W)};return{version:"1.0.0",parsePKCS5PEM:function(U){return m(U)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(U,B,j){return b(U,B,j)},decryptKeyB64:function(U,B,j,W){return N(U,B,j,W)},getDecryptedKeyHex:function(U,B){var j=m(U),W=(j.type,j.cipher),z=j.ivsalt,Z=j.data,ne=b(W,B,z).keyhex;return N(Z,W,ne,z)},getEncryptedPKCS5PEMFromPrvKeyHex:function(U,B,j,W,z){var Z="";if(W!==void 0&&W!=null||(W="AES-256-CBC"),h[W]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+W);z!==void 0&&z!=null||(z=function(S){var O=V.lib.WordArray.random(S);return V.enc.Hex.stringify(O)}(h[W].ivlen).toUpperCase());var ne=function(S,O,H,q){return(0,h[O].eproc)(S,H,q)}(B,W,b(W,j,z).keyhex,z);return Z="-----BEGIN "+U+` PRIVATE KEY-----\r
`,Z+=`Proc-Type: 4,ENCRYPTED\r
`,Z+="DEK-Info: "+W+","+z+`\r
`,Z+=`\r
`,Z+=ne.replace(/(.{64})/g,`$1\r
`),Z+=`\r
-----END `+U+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(U){var B=G,j=B.getChildIdx,W=B.getV,z={},Z=j(U,0);if(Z.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+Z.length);z.ciphertext=W(U,Z[1]);var ne=j(U,Z[0]);if(ne.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+ne.length);if(W(U,ne[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ie=j(U,ne[1]);if(ne.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ie.length);var S=j(U,ie[1]);if(S.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+S.length);if(W(U,S[0])!="2a864886f70d0307")throw"this only supports TripleDES";z.encryptionSchemeAlg="TripleDES",z.encryptionSchemeIV=W(U,S[1]);var O=j(U,ie[0]);if(O.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+O.length);if(W(U,O[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var H=j(U,O[1]);if(H.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+H.length);z.pbkdf2Salt=W(U,H[0]);var q=W(U,H[1]);try{z.pbkdf2Iter=parseInt(q,16)}catch{throw new Error("malformed format pbkdf2Iter: "+q)}return z},getPBKDF2KeyHexFromParam:function(U,B){var j=V.enc.Hex.parse(U.pbkdf2Salt),W=U.pbkdf2Iter,z=V.PBKDF2(B,j,{keySize:6,iterations:W});return V.enc.Hex.stringify(z)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(U,B){var j=Bt(U,"ENCRYPTED PRIVATE KEY"),W=this.parseHexOfEncryptedPKCS8(j),z=rt.getPBKDF2KeyHexFromParam(W,B),Z={};Z.ciphertext=V.enc.Hex.parse(W.ciphertext);var ne=V.enc.Hex.parse(z),ie=V.enc.Hex.parse(W.encryptionSchemeIV),S=V.TripleDES.decrypt(Z,ne,{iv:ie});return V.enc.Hex.stringify(S)},getKeyFromEncryptedPKCS8PEM:function(U,B){var j=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(U,B);return this.getKeyFromPlainPrivatePKCS8Hex(j)},parsePlainPrivatePKCS8Hex:function(U){var B=G,j=B.getChildIdx,W=B.getV,z={algparam:null};if(U.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var Z=j(U,0);if(Z.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(U.substr(Z[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var ne=j(U,Z[1]);if(ne.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(U.substr(ne[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(z.algoid=W(U,ne[0]),U.substr(ne[1],2)=="06"&&(z.algparam=W(U,ne[1])),U.substr(Z[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return z.keyidx=B.getVidx(U,Z[2]),z},getKeyFromPlainPrivatePKCS8PEM:function(U){var B=Bt(U,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(B)},getKeyFromPlainPrivatePKCS8Hex:function(U){var B,j=this.parsePlainPrivatePKCS8Hex(U);if(j.algoid=="2a864886f70d010101")B=new we;else if(j.algoid=="2a8648ce380401")B=new u.crypto.DSA;else{if(j.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");B=new u.crypto.ECDSA}return B.readPKCS8PrvKeyHex(U),B},_getKeyFromPublicPKCS8Hex:function(U){var B,j=G.getVbyList(U,0,[0,0],"06");if(j==="2a864886f70d010101")B=new we;else if(j==="2a8648ce380401")B=new u.crypto.DSA;else{if(j!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");B=new u.crypto.ECDSA}return B.readPKCS8PubKeyHex(U),B},parsePublicRawRSAKeyHex:function(U){var B=G,j=B.getChildIdx,W=B.getV,z={};if(U.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var Z=j(U,0);if(Z.length!=2)throw new Error("malformed RSA key(code:002)");if(U.substr(Z[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(z.n=W(U,Z[0]),U.substr(Z[1],2)!="02")throw new Error("malformed RSA key(code:004)");return z.e=W(U,Z[1]),z},parsePublicPKCS8Hex:function(U){var B=G,j=B.getChildIdx,W=B.getV,z={algparam:null},Z=j(U,0);if(Z.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+Z.length);var ne=Z[0];if(U.substr(ne,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ie=j(U,ne);if(ie.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(U.substr(ie[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(z.algoid=W(U,ie[0]),U.substr(ie[1],2)=="06"?z.algparam=W(U,ie[1]):U.substr(ie[1],2)=="30"&&(z.algparam={},z.algparam.p=B.getVbyList(U,ie[1],[0],"02"),z.algparam.q=B.getVbyList(U,ie[1],[1],"02"),z.algparam.g=B.getVbyList(U,ie[1],[2],"02")),U.substr(Z[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return z.key=W(U,Z[1]).substr(2),z}}}();rt.getKey=function(r,t,n){var o=(ie=G).getChildIdx,h=(ie.getV,ie.getVbyList),m=u.crypto,b=m.ECDSA,N=m.DSA,T=we,U=Bt,B=rt;if(T!==void 0&&r instanceof T||b!==void 0&&r instanceof b||N!==void 0&&r instanceof N)return r;if(r.curve!==void 0&&r.xy!==void 0&&r.d===void 0)return new b({pub:r.xy,curve:r.curve});if(r.curve!==void 0&&r.d!==void 0)return new b({prv:r.d,curve:r.curve});if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d===void 0)return(Se=new T).setPublic(r.n,r.e),Se;if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p!==void 0&&r.q!==void 0&&r.dp!==void 0&&r.dq!==void 0&&r.co!==void 0&&r.qi===void 0)return(Se=new T).setPrivateEx(r.n,r.e,r.d,r.p,r.q,r.dp,r.dq,r.co),Se;if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p===void 0)return(Se=new T).setPrivate(r.n,r.e,r.d),Se;if(r.p!==void 0&&r.q!==void 0&&r.g!==void 0&&r.y!==void 0&&r.x===void 0)return(Se=new N).setPublic(r.p,r.q,r.g,r.y),Se;if(r.p!==void 0&&r.q!==void 0&&r.g!==void 0&&r.y!==void 0&&r.x!==void 0)return(Se=new N).setPrivate(r.p,r.q,r.g,r.y,r.x),Se;if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d===void 0)return(Se=new T).setPublic(We(r.n),We(r.e)),Se;if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p!==void 0&&r.q!==void 0&&r.dp!==void 0&&r.dq!==void 0&&r.qi!==void 0)return(Se=new T).setPrivateEx(We(r.n),We(r.e),We(r.d),We(r.p),We(r.q),We(r.dp),We(r.dq),We(r.qi)),Se;if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0)return(Se=new T).setPrivate(We(r.n),We(r.e),We(r.d)),Se;if(r.kty==="EC"&&r.crv!==void 0&&r.x!==void 0&&r.y!==void 0&&r.d===void 0){var j=(de=new b({curve:r.crv})).ecparams.keylen/4,W="04"+("0000000000"+We(r.x)).slice(-j)+("0000000000"+We(r.y)).slice(-j);return de.setPublicKeyHex(W),de}if(r.kty==="EC"&&r.crv!==void 0&&r.x!==void 0&&r.y!==void 0&&r.d!==void 0){j=(de=new b({curve:r.crv})).ecparams.keylen/4,W="04"+("0000000000"+We(r.x)).slice(-j)+("0000000000"+We(r.y)).slice(-j);var z=("0000000000"+We(r.d)).slice(-j);return de.setPublicKeyHex(W),de.setPrivateKeyHex(z),de}if(n==="pkcs5prv"){var Z,ne=r,ie=G;if((Z=o(ne,0)).length===9)(Se=new T).readPKCS5PrvKeyHex(ne);else if(Z.length===6)(Se=new N).readPKCS5PrvKeyHex(ne);else{if(!(Z.length>2&&ne.substr(Z[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(Se=new b).readPKCS5PrvKeyHex(ne)}return Se}if(n==="pkcs8prv")return Se=B.getKeyFromPlainPrivatePKCS8Hex(r);if(n==="pkcs8pub")return B._getKeyFromPublicPKCS8Hex(r);if(n==="x509pub")return ut.getPublicKeyFromCertHex(r);if(r.indexOf("-END CERTIFICATE-",0)!=-1||r.indexOf("-END X509 CERTIFICATE-",0)!=-1||r.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return ut.getPublicKeyFromCertPEM(r);if(r.indexOf("-END PUBLIC KEY-")!=-1){var S=Bt(r,"PUBLIC KEY");return B._getKeyFromPublicPKCS8Hex(S)}if(r.indexOf("-END RSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1){var O=U(r,"RSA PRIVATE KEY");return B.getKey(O,null,"pkcs5prv")}if(r.indexOf("-END DSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1){var H=h(Je=U(r,"DSA PRIVATE KEY"),0,[1],"02"),q=h(Je,0,[2],"02"),ee=h(Je,0,[3],"02"),oe=h(Je,0,[4],"02"),ge=h(Je,0,[5],"02");return(Se=new N).setPrivate(new D(H,16),new D(q,16),new D(ee,16),new D(oe,16),new D(ge,16)),Se}if(r.indexOf("-END EC PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1)return O=U(r,"EC PRIVATE KEY"),B.getKey(O,null,"pkcs5prv");if(r.indexOf("-END PRIVATE KEY-")!=-1)return B.getKeyFromPlainPrivatePKCS8PEM(r);if(r.indexOf("-END RSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var fe=B.getDecryptedKeyHex(r,t),Ie=new we;return Ie.readPKCS5PrvKeyHex(fe),Ie}if(r.indexOf("-END EC PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var de,Se=h(Je=B.getDecryptedKeyHex(r,t),0,[1],"04"),Ke=h(Je,0,[2,0],"06"),Ge=h(Je,0,[3,0],"03").substr(2);if(u.crypto.OID.oidhex2name[Ke]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ke);return(de=new b({curve:u.crypto.OID.oidhex2name[Ke]})).setPublicKeyHex(Ge),de.setPrivateKeyHex(Se),de.isPublic=!1,de}if(r.indexOf("-END DSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var Je;return H=h(Je=B.getDecryptedKeyHex(r,t),0,[1],"02"),q=h(Je,0,[2],"02"),ee=h(Je,0,[3],"02"),oe=h(Je,0,[4],"02"),ge=h(Je,0,[5],"02"),(Se=new N).setPrivate(new D(H,16),new D(q,16),new D(ee,16),new D(oe,16),new D(ge,16)),Se}if(r.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return B.getKeyFromEncryptedPKCS8PEM(r,t);throw new Error("not supported argument")},rt.generateKeypair=function(r,t){if(r=="RSA"){var n=t;(b=new we).generate(n,"10001"),b.isPrivate=!0,b.isPublic=!0;var o=new we,h=b.n.toString(16),m=b.e.toString(16);return o.setPublic(h,m),o.isPrivate=!1,o.isPublic=!0,(N={}).prvKeyObj=b,N.pubKeyObj=o,N}if(r=="EC"){var b,N,T=t,U=new u.crypto.ECDSA({curve:T}).generateKeyPairHex();return(b=new u.crypto.ECDSA({curve:T})).setPublicKeyHex(U.ecpubhex),b.setPrivateKeyHex(U.ecprvhex),b.isPrivate=!0,b.isPublic=!1,(o=new u.crypto.ECDSA({curve:T})).setPublicKeyHex(U.ecpubhex),o.isPrivate=!1,o.isPublic=!0,(N={}).prvKeyObj=b,N.pubKeyObj=o,N}throw new Error("unknown algorithm: "+r)},rt.getPEM=function(r,t,n,o,h,m){var b=u,N=b.asn1,T=N.DERObjectIdentifier,U=N.DERInteger,B=N.ASN1Util.newObject,j=N.x509.SubjectPublicKeyInfo,W=b.crypto,z=W.DSA,Z=W.ECDSA,ne=we;function ie(de){return B({seq:[{int:0},{int:{bigint:de.n}},{int:de.e},{int:{bigint:de.d}},{int:{bigint:de.p}},{int:{bigint:de.q}},{int:{bigint:de.dmp1}},{int:{bigint:de.dmq1}},{int:{bigint:de.coeff}}]})}function S(de){return B({seq:[{int:1},{octstr:{hex:de.prvKeyHex}},{tag:["a0",!0,{oid:{name:de.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+de.pubKeyHex}}]}]})}function O(de){return B({seq:[{int:0},{int:{bigint:de.p}},{int:{bigint:de.q}},{int:{bigint:de.g}},{int:{bigint:de.y}},{int:{bigint:de.x}}]})}if((ne!==void 0&&r instanceof ne||z!==void 0&&r instanceof z||Z!==void 0&&r instanceof Z)&&r.isPublic==1&&(t===void 0||t=="PKCS8PUB"))return Et(oe=new j(r).getEncodedHex(),"PUBLIC KEY");if(t=="PKCS1PRV"&&ne!==void 0&&r instanceof ne&&(n===void 0||n==null)&&r.isPrivate==1)return Et(oe=ie(r).getEncodedHex(),"RSA PRIVATE KEY");if(t=="PKCS1PRV"&&Z!==void 0&&r instanceof Z&&(n===void 0||n==null)&&r.isPrivate==1){var H=new T({name:r.curveName}).getEncodedHex(),q=S(r).getEncodedHex(),ee="";return ee+=Et(H,"EC PARAMETERS"),ee+=Et(q,"EC PRIVATE KEY")}if(t=="PKCS1PRV"&&z!==void 0&&r instanceof z&&(n===void 0||n==null)&&r.isPrivate==1)return Et(oe=O(r).getEncodedHex(),"DSA PRIVATE KEY");if(t=="PKCS5PRV"&&ne!==void 0&&r instanceof ne&&n!==void 0&&n!=null&&r.isPrivate==1){var oe=ie(r).getEncodedHex();return o===void 0&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",oe,n,o,m)}if(t=="PKCS5PRV"&&Z!==void 0&&r instanceof Z&&n!==void 0&&n!=null&&r.isPrivate==1)return oe=S(r).getEncodedHex(),o===void 0&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",oe,n,o,m);if(t=="PKCS5PRV"&&z!==void 0&&r instanceof z&&n!==void 0&&n!=null&&r.isPrivate==1)return oe=O(r).getEncodedHex(),o===void 0&&(o="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",oe,n,o,m);var ge=function(Se,Ke){var Ge=fe(Se,Ke);return new B({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:Ge.pbkdf2Salt}},{int:Ge.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:Ge.encryptionSchemeIV}}]}]}]},{octstr:{hex:Ge.ciphertext}}]}).getEncodedHex()},fe=function(Se,Ke){var Ge=V.lib.WordArray.random(8),Je=V.lib.WordArray.random(8),xt=V.PBKDF2(Ke,Ge,{keySize:6,iterations:100}),mt=V.enc.Hex.parse(Se),St=V.TripleDES.encrypt(mt,xt,{iv:Je})+"",et={};return et.ciphertext=St,et.pbkdf2Salt=V.enc.Hex.stringify(Ge),et.pbkdf2Iter=100,et.encryptionSchemeAlg="DES-EDE3-CBC",et.encryptionSchemeIV=V.enc.Hex.stringify(Je),et};if(t=="PKCS8PRV"&&ne!=null&&r instanceof ne&&r.isPrivate==1){var Ie=ie(r).getEncodedHex();return oe=B({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Ie}}]}).getEncodedHex(),n===void 0||n==null?Et(oe,"PRIVATE KEY"):Et(q=ge(oe,n),"ENCRYPTED PRIVATE KEY")}if(t=="PKCS8PRV"&&Z!==void 0&&r instanceof Z&&r.isPrivate==1)return Ie=new B({seq:[{int:1},{octstr:{hex:r.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+r.pubKeyHex}}]}]}).getEncodedHex(),oe=B({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:r.curveName}}]},{octstr:{hex:Ie}}]}).getEncodedHex(),n===void 0||n==null?Et(oe,"PRIVATE KEY"):Et(q=ge(oe,n),"ENCRYPTED PRIVATE KEY");if(t=="PKCS8PRV"&&z!==void 0&&r instanceof z&&r.isPrivate==1)return Ie=new U({bigint:r.x}).getEncodedHex(),oe=B({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:r.p}},{int:{bigint:r.q}},{int:{bigint:r.g}}]}]},{octstr:{hex:Ie}}]}).getEncodedHex(),n===void 0||n==null?Et(oe,"PRIVATE KEY"):Et(q=ge(oe,n),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},rt.getKeyFromCSRPEM=function(r){var t=Bt(r,"CERTIFICATE REQUEST");return rt.getKeyFromCSRHex(t)},rt.getKeyFromCSRHex=function(r){var t=rt.parseCSRHex(r);return rt.getKey(t.p8pubkeyhex,null,"pkcs8pub")},rt.parseCSRHex=function(r){var t=G,n=t.getChildIdx,o=t.getTLV,h={},m=r;if(m.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var b=n(m,0);if(b.length<1)throw new Error("malformed CSR(code:002)");if(m.substr(b[0],2)!="30")throw new Error("malformed CSR(code:003)");var N=n(m,b[0]);if(N.length<3)throw new Error("malformed CSR(code:004)");return h.p8pubkeyhex=o(m,N[2]),h},rt.getKeyID=function(r){var t=rt,n=G;typeof r=="string"&&r.indexOf("BEGIN ")!=-1&&(r=t.getKey(r));var o=Bt(t.getPEM(r)),h=n.getIdxbyList(o,0,[1]),m=n.getV(o,h).substring(2);return u.crypto.Util.hashHex(m,"sha1")},rt.getJWKFromKey=function(r){var t={};if(r instanceof we&&r.isPrivate)return t.kty="RSA",t.n=st(r.n.toString(16)),t.e=st(r.e.toString(16)),t.d=st(r.d.toString(16)),t.p=st(r.p.toString(16)),t.q=st(r.q.toString(16)),t.dp=st(r.dmp1.toString(16)),t.dq=st(r.dmq1.toString(16)),t.qi=st(r.coeff.toString(16)),t;if(r instanceof we&&r.isPublic)return t.kty="RSA",t.n=st(r.n.toString(16)),t.e=st(r.e.toString(16)),t;if(r instanceof u.crypto.ECDSA&&r.isPrivate){if((o=r.getShortNISTPCurveName())!=="P-256"&&o!=="P-384")throw new Error("unsupported curve name for JWT: "+o);var n=r.getPublicKeyXYHex();return t.kty="EC",t.crv=o,t.x=st(n.x),t.y=st(n.y),t.d=st(r.prvKeyHex),t}if(r instanceof u.crypto.ECDSA&&r.isPublic){var o;if((o=r.getShortNISTPCurveName())!=="P-256"&&o!=="P-384")throw new Error("unsupported curve name for JWT: "+o);return n=r.getPublicKeyXYHex(),t.kty="EC",t.crv=o,t.x=st(n.x),t.y=st(n.y),t}throw new Error("not supported key object")},we.getPosArrayOfChildrenFromHex=function(r){return G.getChildIdx(r,0)},we.getHexValueArrayOfChildrenFromHex=function(r){var t,n=G.getV,o=n(r,(t=we.getPosArrayOfChildrenFromHex(r))[0]),h=n(r,t[1]),m=n(r,t[2]),b=n(r,t[3]),N=n(r,t[4]),T=n(r,t[5]),U=n(r,t[6]),B=n(r,t[7]),j=n(r,t[8]);return(t=new Array).push(o,h,m,b,N,T,U,B,j),t},we.prototype.readPrivateKeyFromPEMString=function(r){var t=Bt(r),n=we.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},we.prototype.readPKCS5PrvKeyHex=function(r){var t=we.getHexValueArrayOfChildrenFromHex(r);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},we.prototype.readPKCS8PrvKeyHex=function(r){var t,n,o,h,m,b,N,T,U=G,B=U.getVbyListEx;if(U.isASN1HEX(r)===!1)throw new Error("not ASN.1 hex string");try{t=B(r,0,[2,0,1],"02"),n=B(r,0,[2,0,2],"02"),o=B(r,0,[2,0,3],"02"),h=B(r,0,[2,0,4],"02"),m=B(r,0,[2,0,5],"02"),b=B(r,0,[2,0,6],"02"),N=B(r,0,[2,0,7],"02"),T=B(r,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,n,o,h,m,b,N,T)},we.prototype.readPKCS5PubKeyHex=function(r){var t=G,n=t.getV;if(t.isASN1HEX(r)===!1)throw new Error("keyHex is not ASN.1 hex string");var o=t.getChildIdx(r,0);if(o.length!==2||r.substr(o[0],2)!=="02"||r.substr(o[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var h=n(r,o[0]),m=n(r,o[1]);this.setPublic(h,m)},we.prototype.readPKCS8PubKeyHex=function(r){var t=G;if(t.isASN1HEX(r)===!1)throw new Error("not ASN.1 hex string");if(t.getTLVbyListEx(r,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var n=t.getTLVbyListEx(r,0,[1,0]);this.readPKCS5PubKeyHex(n)},we.prototype.readCertPubKeyHex=function(r,t){var n,o;(n=new ut).readCertHex(r),o=n.getPublicKeyHex(),this.readPKCS8PubKeyHex(o)},new RegExp("[^0-9a-f]","gi");function ro(r,t){for(var n="",o=t/4-r.length,h=0;h<o;h++)n+="0";return n+r}function no(r,t,n){for(var o="",h=0;o.length<t;)o+=Tt(n(Dt(r+String.fromCharCode.apply(String,[(4278190080&h)>>24,(16711680&h)>>16,(65280&h)>>8,255&h])))),h+=1;return o}function io(r){for(var t in u.crypto.Util.DIGESTINFOHEAD){var n=u.crypto.Util.DIGESTINFOHEAD[t],o=n.length;if(r.substring(0,o)==n)return[t,r.substring(o)]}return[]}function ut(r){var t,n=G,o=n.getChildIdx,h=n.getV,m=n.getTLV,b=n.getVbyList,N=n.getVbyListEx,T=n.getTLVbyList,U=n.getTLVbyListEx,B=n.getIdxbyList,j=n.getIdxbyListEx,W=n.getVidx,z=n.getInt,Z=n.oidname,ne=n.hextooidstr,ie=Bt;try{t=u.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var S=T(this.hex,0,[0,0]);if(S.substr(0,2)=="a0"){var O=T(S,0,[0]),H=z(O,0);if(H<0||2<H)throw new Error("malformed version field");return this.version=H+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return N(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var S=U(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(S)},this.getAlgorithmIdentifierName=function(S){for(var O in t)if(S===t[O])return O;return Z(N(S,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return T(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return T(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var S=b(this.hex,0,[0,4+this.foffset,0]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getNotAfter=function(){var S=b(this.hex,0,[0,4+this.foffset,1]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getPublicKeyHex=function(){return n.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return B(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var S=this.getPublicKeyIdx();return B(this.hex,S,[1,0],"30")},this.getPublicKey=function(){return rt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var S=T(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(S)},this.getSignatureValueHex=function(){return b(this.hex,0,[2],"03",!0)},this.verifySignature=function(S){var O=this.getSignatureAlgorithmField(),H=this.getSignatureValueHex(),q=T(this.hex,0,[0],"30"),ee=new u.crypto.Signature({alg:O});return ee.init(S),ee.updateHex(q),ee.verify(H)},this.parseExt=function(S){var O,H,q;if(S===void 0){if(q=this.hex,this.version!==3)return-1;O=B(q,0,[0,7,0],"30"),H=o(q,O)}else{q=Bt(S);var ee=B(q,0,[0,3,0,0],"06");if(h(q,ee)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);O=B(q,0,[0,3,0,1,0],"30"),H=o(q,O),this.hex=q}this.aExtInfo=new Array;for(var oe=0;oe<H.length;oe++){var ge={critical:!1},fe=0;o(q,H[oe]).length===3&&(ge.critical=!0,fe=1),ge.oid=n.hextooidstr(b(q,H[oe],[0],"06"));var Ie=B(q,H[oe],[1+fe]);ge.vidx=W(q,Ie),this.aExtInfo.push(ge)}},this.getExtInfo=function(S){var O=this.aExtInfo,H=S;if(S.match(/^[0-9.]+$/)||(H=u.asn1.x509.OID.name2oid(S)),H!==""){for(var q=0;q<O.length;q++)if(O[q].oid===H)return O[q]}},this.getExtBasicConstraints=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("basicConstraints");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"basicConstraints"};if(O&&(q.critical=!0),S==="3000")return q;if(S==="30030101ff")return q.cA=!0,q;if(S.substr(0,12)==="30060101ff02"){var ee=h(S,10),oe=parseInt(ee,16);return q.cA=!0,q.pathLen=oe,q}throw new Error("hExtV parse error: "+S)},this.getExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("keyUsage");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"keyUsage"};return O&&(q.critical=!0),q.names=this.getExtKeyUsageString(S).split(","),q},this.getExtKeyUsageBin=function(S){if(S===void 0){var O=this.getExtInfo("keyUsage");if(O===void 0)return"";S=m(this.hex,O.vidx)}if(S.length!=8&&S.length!=10)throw new Error("malformed key usage value: "+S);var H="000000000000000"+parseInt(S.substr(6),16).toString(2);return S.length==8&&(H=H.slice(-8)),S.length==10&&(H=H.slice(-16)),(H=H.replace(/0+$/,""))==""&&(H="0"),H},this.getExtKeyUsageString=function(S){for(var O=this.getExtKeyUsageBin(S),H=new Array,q=0;q<O.length;q++)O.substr(q,1)=="1"&&H.push(ut.KEYUSAGE_NAME[q]);return H.join(",")},this.getExtSubjectKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("subjectKeyIdentifier");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"subjectKeyIdentifier"};O&&(q.critical=!0);var ee=h(S,0);return q.kid={hex:ee},q},this.getExtAuthorityKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("authorityKeyIdentifier");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"authorityKeyIdentifier"};O&&(q.critical=!0);for(var ee=o(S,0),oe=0;oe<ee.length;oe++){var ge=S.substr(ee[oe],2);if(ge==="80"&&(q.kid={hex:h(S,ee[oe])}),ge==="a1"){var fe=m(S,ee[oe]),Ie=this.getGeneralNames(fe);q.issuer=Ie[0].dn}ge==="82"&&(q.sn={hex:h(S,ee[oe])})}return q},this.getExtExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("extKeyUsage");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"extKeyUsage",array:[]};O&&(q.critical=!0);for(var ee=o(S,0),oe=0;oe<ee.length;oe++)q.array.push(Z(h(S,ee[oe])));return q},this.getExtExtKeyUsageName=function(){var S=this.getExtInfo("extKeyUsage");if(S===void 0)return S;var O=new Array,H=m(this.hex,S.vidx);if(H==="")return O;for(var q=o(H,0),ee=0;ee<q.length;ee++)O.push(Z(h(H,q[ee])));return O},this.getExtSubjectAltName=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("subjectAltName");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"subjectAltName",array:[]};return O&&(q.critical=!0),q.array=this.getGeneralNames(S),q},this.getExtIssuerAltName=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("issuerAltName");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"issuerAltName",array:[]};return O&&(q.critical=!0),q.array=this.getGeneralNames(S),q},this.getGeneralNames=function(S){for(var O=o(S,0),H=[],q=0;q<O.length;q++){var ee=this.getGeneralName(m(S,O[q]));ee!==void 0&&H.push(ee)}return H},this.getGeneralName=function(S){var O=S.substr(0,2),H=h(S,0),q=Tt(H);return O=="81"?{rfc822:q}:O=="82"?{dns:q}:O=="86"?{uri:q}:O=="87"?{ip:On(H)}:O=="a4"?{dn:this.getX500Name(H)}:void 0},this.getExtSubjectAltName2=function(){var S,O,H,q=this.getExtInfo("subjectAltName");if(q===void 0)return q;for(var ee=new Array,oe=m(this.hex,q.vidx),ge=o(oe,0),fe=0;fe<ge.length;fe++)H=oe.substr(ge[fe],2),S=h(oe,ge[fe]),H==="81"&&(O=at(S),ee.push(["MAIL",O])),H==="82"&&(O=at(S),ee.push(["DNS",O])),H==="84"&&(O=ut.hex2dn(S,0),ee.push(["DN",O])),H==="86"&&(O=at(S),ee.push(["URI",O])),H==="87"&&(O=On(S),ee.push(["IP",O]));return ee},this.getExtCRLDistributionPoints=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("cRLDistributionPoints");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"cRLDistributionPoints",array:[]};O&&(q.critical=!0);for(var ee=o(S,0),oe=0;oe<ee.length;oe++){var ge=m(S,ee[oe]);q.array.push(this.getDistributionPoint(ge))}return q},this.getDistributionPoint=function(S){for(var O={},H=o(S,0),q=0;q<H.length;q++){var ee=S.substr(H[q],2),oe=m(S,H[q]);ee=="a0"&&(O.dpname=this.getDistributionPointName(oe))}return O},this.getDistributionPointName=function(S){for(var O={},H=o(S,0),q=0;q<H.length;q++){var ee=S.substr(H[q],2),oe=m(S,H[q]);ee=="a0"&&(O.full=this.getGeneralNames(oe))}return O},this.getExtCRLDistributionPointsURI=function(){var S=this.getExtInfo("cRLDistributionPoints");if(S===void 0)return S;for(var O=new Array,H=o(this.hex,S.vidx),q=0;q<H.length;q++)try{var ee=at(b(this.hex,H[q],[0,0,0],"86"));O.push(ee)}catch{}return O},this.getExtAIAInfo=function(){var S=this.getExtInfo("authorityInfoAccess");if(S===void 0)return S;for(var O={ocsp:[],caissuer:[]},H=o(this.hex,S.vidx),q=0;q<H.length;q++){var ee=b(this.hex,H[q],[0],"06"),oe=b(this.hex,H[q],[1],"86");ee==="2b06010505073001"&&O.ocsp.push(at(oe)),ee==="2b06010505073002"&&O.caissuer.push(at(oe))}return O},this.getExtAuthorityInfoAccess=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("authorityInfoAccess");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"authorityInfoAccess",array:[]};O&&(q.critical=!0);for(var ee=o(S,0),oe=0;oe<ee.length;oe++){var ge=N(S,ee[oe],[0],"06"),fe=at(b(S,ee[oe],[1],"86"));if(ge=="2b06010505073001")q.array.push({ocsp:fe});else{if(ge!="2b06010505073002")throw new Error("unknown method: "+ge);q.array.push({caissuer:fe})}}return q},this.getExtCertificatePolicies=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("certificatePolicies");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"certificatePolicies",array:[]};O&&(q.critical=!0);for(var ee=o(S,0),oe=0;oe<ee.length;oe++){var ge=m(S,ee[oe]),fe=this.getPolicyInformation(ge);q.array.push(fe)}return q},this.getPolicyInformation=function(S){var O={},H=b(S,0,[0],"06");O.policyoid=Z(H);var q=j(S,0,[1],"30");if(q!=-1){O.array=[];for(var ee=o(S,q),oe=0;oe<ee.length;oe++){var ge=m(S,ee[oe]),fe=this.getPolicyQualifierInfo(ge);O.array.push(fe)}}return O},this.getPolicyQualifierInfo=function(S){var O={},H=b(S,0,[0],"06");if(H==="2b06010505070201"){var q=N(S,0,[1],"16");O.cps=Tt(q)}else if(H==="2b06010505070202"){var ee=T(S,0,[1],"30");O.unotice=this.getUserNotice(ee)}return O},this.getUserNotice=function(S){for(var O={},H=o(S,0),q=0;q<H.length;q++){var ee=m(S,H[q]);ee.substr(0,2)!="30"&&(O.exptext=this.getDisplayText(ee))}return O},this.getDisplayText=function(S){var O={};return O.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[S.substr(0,2)],O.str=Tt(h(S,0)),O},this.getExtCRLNumber=function(S,O){var H={extname:"cRLNumber"};if(O&&(H.critical=!0),S.substr(0,2)=="02")return H.num={hex:h(S,0)},H;throw new Error("hExtV parse error: "+S)},this.getExtCRLReason=function(S,O){var H={extname:"cRLReason"};if(O&&(H.critical=!0),S.substr(0,2)=="0a")return H.code=parseInt(h(S,0),16),H;throw new Error("hExtV parse error: "+S)},this.getExtOcspNonce=function(S,O){var H={extname:"ocspNonce"};O&&(H.critical=!0);var q=h(S,0);return H.hex=q,H},this.getExtOcspNoCheck=function(S,O){var H={extname:"ocspNoCheck"};return O&&(H.critical=!0),H},this.getExtAdobeTimeStamp=function(S,O){if(S===void 0&&O===void 0){var H=this.getExtInfo("adobeTimeStamp");if(H===void 0)return;S=m(this.hex,H.vidx),O=H.critical}var q={extname:"adobeTimeStamp"};O&&(q.critical=!0);var ee=o(S,0);if(ee.length>1){var oe=m(S,ee[1]),ge=this.getGeneralName(oe);ge.uri!=null&&(q.uri=ge.uri)}if(ee.length>2){var fe=m(S,ee[2]);fe=="0101ff"&&(q.reqauth=!0),fe=="010100"&&(q.reqauth=!1)}return q},this.getX500NameRule=function(S){for(var O=null,H=[],q=0;q<S.length;q++)for(var ee=S[q],oe=0;oe<ee.length;oe++)H.push(ee[oe]);for(q=0;q<H.length;q++){var ge=H[q],fe=ge.ds,Ie=ge.value,de=ge.type;if(""+fe,fe!="prn"&&fe!="utf8"&&fe!="ia5")return"mixed";if(fe=="ia5"){if(de!="CN")return"mixed";if(u.lang.String.isMail(Ie))continue;return"mixed"}if(de=="C"){if(fe=="prn")continue;return"mixed"}if(""+fe,O==null)O=fe;else if(O!==fe)return"mixed"}return O??"prn"},this.getX500Name=function(S){var O=this.getX500NameArray(S);return{array:O,str:this.dnarraytostr(O)}},this.getX500NameArray=function(S){for(var O=[],H=o(S,0),q=0;q<H.length;q++)O.push(this.getRDN(m(S,H[q])));return O},this.getRDN=function(S){for(var O=[],H=o(S,0),q=0;q<H.length;q++)O.push(this.getAttrTypeAndValue(m(S,H[q])));return O},this.getAttrTypeAndValue=function(S){var O={type:null,value:null,ds:null},H=o(S,0),q=b(S,H[0],[],"06"),ee=b(S,H[1],[]),oe=u.asn1.ASN1Util.oidHexToInt(q);return O.type=u.asn1.x509.OID.oid2atype(oe),O.ds=this.HEX2STAG[S.substr(H[1],2)],O.ds!="bmp"?O.value=at(ee):O.value=Zi(ee),O},this.readCertPEM=function(S){this.readCertHex(ie(S))},this.readCertHex=function(S){this.hex=S,this.getVersion();try{B(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var S={};return S.version=this.getVersion(),S.serial={hex:this.getSerialNumberHex()},S.sigalg=this.getSignatureAlgorithmField(),S.issuer=this.getIssuer(),S.notbefore=this.getNotBefore(),S.notafter=this.getNotAfter(),S.subject=this.getSubject(),S.sbjpubkey=Et(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(S.ext=this.getExtParamArray()),S.sighex=this.getSignatureValueHex(),S},this.getExtParamArray=function(S){S==null&&j(this.hex,0,[0,"[3]"])!=-1&&(S=U(this.hex,0,[0,"[3]",0],"30"));for(var O=[],H=o(S,0),q=0;q<H.length;q++){var ee=m(S,H[q]),oe=this.getExtParam(ee);oe!=null&&O.push(oe)}return O},this.getExtParam=function(S){var O=o(S,0).length;if(O!=2&&O!=3)throw new Error("wrong number elements in Extension: "+O+" "+S);var H=ne(b(S,0,[0],"06")),q=!1;O==3&&T(S,0,[1])=="0101ff"&&(q=!0);var ee=T(S,0,[O-1,0]),oe=void 0;if(H=="2.5.29.14"?oe=this.getExtSubjectKeyIdentifier(ee,q):H=="2.5.29.15"?oe=this.getExtKeyUsage(ee,q):H=="2.5.29.17"?oe=this.getExtSubjectAltName(ee,q):H=="2.5.29.18"?oe=this.getExtIssuerAltName(ee,q):H=="2.5.29.19"?oe=this.getExtBasicConstraints(ee,q):H=="2.5.29.31"?oe=this.getExtCRLDistributionPoints(ee,q):H=="2.5.29.32"?oe=this.getExtCertificatePolicies(ee,q):H=="2.5.29.35"?oe=this.getExtAuthorityKeyIdentifier(ee,q):H=="2.5.29.37"?oe=this.getExtExtKeyUsage(ee,q):H=="1.3.6.1.5.5.7.1.1"?oe=this.getExtAuthorityInfoAccess(ee,q):H=="2.5.29.20"?oe=this.getExtCRLNumber(ee,q):H=="2.5.29.21"?oe=this.getExtCRLReason(ee,q):H=="1.3.6.1.5.5.7.48.1.2"?oe=this.getExtOcspNonce(ee,q):H=="1.3.6.1.5.5.7.48.1.5"?oe=this.getExtOcspNoCheck(ee,q):H=="1.2.840.113583.1.1.9.1"&&(oe=this.getExtAdobeTimeStamp(ee,q)),oe!=null)return oe;var ge={extname:H,extn:ee};return q&&(ge.critical=!0),ge},this.findExt=function(S,O){for(var H=0;H<S.length;H++)if(S[H].extname==O)return S[H];return null},this.updateExtCDPFullURI=function(S,O){var H=this.findExt(S,"cRLDistributionPoints");if(H!=null&&H.array!=null){for(var q=H.array,ee=0;ee<q.length;ee++)if(q[ee].dpname!=null&&q[ee].dpname.full!=null)for(var oe=q[ee].dpname.full,ge=0;ge<oe.length;ge++){var fe=oe[ee];fe.uri!=null&&(fe.uri=O)}}},this.updateExtAIAOCSP=function(S,O){var H=this.findExt(S,"authorityInfoAccess");if(H!=null&&H.array!=null)for(var q=H.array,ee=0;ee<q.length;ee++)q[ee].ocsp!=null&&(q[ee].ocsp=O)},this.updateExtAIACAIssuer=function(S,O){var H=this.findExt(S,"authorityInfoAccess");if(H!=null&&H.array!=null)for(var q=H.array,ee=0;ee<q.length;ee++)q[ee].caissuer!=null&&(q[ee].caissuer=O)},this.dnarraytostr=function(S){return"/"+S.map(function(O){return function(q){return q.map(function(ee){return function(ge){return ge.type+"="+ge.value}(ee).replace(/\+/,"\\+")}).join("+")}(O).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var S,O,H,q=function(xt){return JSON.stringify(xt.array).replace(/[\[\]\{\}\"]/g,"")},ee=function(xt){for(var mt="",St=xt.array,et=0;et<St.length;et++){var ct=St[et];if(mt+="    policy oid: "+ct.policyoid+`
`,ct.array!==void 0)for(var pt=0;pt<ct.array.length;pt++){var bt=ct.array[pt];bt.cps!==void 0&&(mt+="    cps: "+bt.cps+`
`)}}return mt},oe=function(xt){for(var mt="",St=xt.array,et=0;et<St.length;et++){var ct=St[et];try{ct.dpname.full[0].uri!==void 0&&(mt+="    "+ct.dpname.full[0].uri+`
`)}catch{}try{ct.dname.full[0].dn.hex!==void 0&&(mt+="    "+ut.hex2dn(ct.dpname.full[0].dn.hex)+`
`)}catch{}}return mt},ge=function(xt){for(var mt="",St=xt.array,et=0;et<St.length;et++){var ct=St[et];ct.caissuer!==void 0&&(mt+="    caissuer: "+ct.caissuer+`
`),ct.ocsp!==void 0&&(mt+="    ocsp: "+ct.ocsp+`
`)}return mt};if(S=`Basic Fields
`,S+="  serial number: "+this.getSerialNumberHex()+`
`,S+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,S+="  issuer: "+this.getIssuerString()+`
`,S+="  notBefore: "+this.getNotBefore()+`
`,S+="  notAfter: "+this.getNotAfter()+`
`,S+="  subject: "+this.getSubjectString()+`
`,S+=`  subject public key info: 
`,S+="    key algorithm: "+(O=this.getPublicKey()).type+`
`,O.type==="RSA"&&(S+="    n="+jn(O.n.toString(16)).substr(0,16)+`...
`,S+="    e="+jn(O.e.toString(16))+`
`),(H=this.aExtInfo)!=null){S+=`X509v3 Extensions:
`;for(var fe=0;fe<H.length;fe++){var Ie=H[fe],de=u.asn1.x509.OID.oid2name(Ie.oid);de===""&&(de=Ie.oid);var Se="";if(Ie.critical===!0&&(Se="CRITICAL"),S+="  "+de+" "+Se+`:
`,de==="basicConstraints"){var Ke=this.getExtBasicConstraints();Ke.cA===void 0?S+=`    {}
`:(S+="    cA=true",Ke.pathLen!==void 0&&(S+=", pathLen="+Ke.pathLen),S+=`
`)}else if(de==="keyUsage")S+="    "+this.getExtKeyUsageString()+`
`;else if(de==="subjectKeyIdentifier")S+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(de==="authorityKeyIdentifier"){var Ge=this.getExtAuthorityKeyIdentifier();Ge.kid!==void 0&&(S+="    kid="+Ge.kid.hex+`
`)}else de==="extKeyUsage"?S+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:de==="subjectAltName"?S+="    "+q(this.getExtSubjectAltName())+`
`:de==="cRLDistributionPoints"?S+=oe(this.getExtCRLDistributionPoints()):de==="authorityInfoAccess"?S+=ge(this.getExtAuthorityInfoAccess()):de==="certificatePolicies"&&(S+=ee(this.getExtCertificatePolicies()))}}return S+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,S+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof r=="string"&&(r.indexOf("-----BEGIN")!=-1?this.readCertPEM(r):u.lang.String.isHex(r)&&this.readCertHex(r))}we.prototype.sign=function(r,t){var n=function(h){return u.crypto.Util.hashString(h,t)}(r);return this.signWithMessageHash(n,t)},we.prototype.signWithMessageHash=function(r,t){var n=qe(u.crypto.Util.getPaddedDigestInfoHex(r,t,this.n.bitLength()),16);return ro(this.doPrivate(n).toString(16),this.n.bitLength())},we.prototype.signPSS=function(r,t,n){var o=function(m){return u.crypto.Util.hashHex(m,t)}(Dt(r));return n===void 0&&(n=-1),this.signWithMessageHashPSS(o,t,n)},we.prototype.signWithMessageHashPSS=function(r,t,n){var o,h=Tt(r),m=h.length,b=this.n.bitLength()-1,N=Math.ceil(b/8),T=function(S){return u.crypto.Util.hashHex(S,t)};if(n===-1||n===void 0)n=m;else if(n===-2)n=N-m-2;else if(n<-2)throw new Error("invalid salt length");if(N<m+n+2)throw new Error("data too long");var U="";n>0&&(U=new Array(n),new Ce().nextBytes(U),U=String.fromCharCode.apply(String,U));var B=Tt(T(Dt("\0\0\0\0\0\0\0\0"+h+U))),j=[];for(o=0;o<N-n-m-2;o+=1)j[o]=0;var W=String.fromCharCode.apply(String,j)+""+U,z=no(B,W.length,T),Z=[];for(o=0;o<W.length;o+=1)Z[o]=W.charCodeAt(o)^z.charCodeAt(o);var ne=65280>>8*N-b&255;for(Z[0]&=~ne,o=0;o<m;o++)Z.push(B.charCodeAt(o));return Z.push(188),ro(this.doPrivate(new D(Z)).toString(16),this.n.bitLength())},we.prototype.verify=function(r,t){if((t=t.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var n=qe(t,16),o=this.n.bitLength();if(n.bitLength()>o)return!1;var h=this.doPublic(n).toString(16);if(h.length+3!=o/4)return!1;var m=io(h.replace(/^1f+00/,""));if(m.length==0)return!1;var b=m[0];return m[1]==function(T){return u.crypto.Util.hashString(T,b)}(r)},we.prototype.verifyWithMessageHash=function(r,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var n=qe(t,16);if(n.bitLength()>this.n.bitLength())return 0;var o=io(this.doPublic(n).toString(16).replace(/^1f+00/,""));return o.length==0?!1:(o[0],o[1]==r)},we.prototype.verifyPSS=function(r,t,n,o){var h=function(b){return u.crypto.Util.hashHex(b,n)}(Dt(r));return o===void 0&&(o=-1),this.verifyWithMessageHashPSS(h,t,n,o)},we.prototype.verifyWithMessageHashPSS=function(r,t,n,o){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var h,m=new D(t,16),b=function(H){return u.crypto.Util.hashHex(H,n)},N=Tt(r),T=N.length,U=this.n.bitLength()-1,B=Math.ceil(U/8);if(o===-1||o===void 0)o=T;else if(o===-2)o=B-T-2;else if(o<-2)throw new Error("invalid salt length");if(B<T+o+2)throw new Error("data too long");var j=this.doPublic(m).toByteArray();for(h=0;h<j.length;h+=1)j[h]&=255;for(;j.length<B;)j.unshift(0);if(j[B-1]!==188)throw new Error("encoded message does not end in 0xbc");var W=(j=String.fromCharCode.apply(String,j)).substr(0,B-T-1),z=j.substr(W.length,T),Z=65280>>8*B-U&255;if(W.charCodeAt(0)&Z)throw new Error("bits beyond keysize not zero");var ne=no(z,W.length,b),ie=[];for(h=0;h<W.length;h+=1)ie[h]=W.charCodeAt(h)^ne.charCodeAt(h);ie[0]&=~Z;var S=B-T-o-2;for(h=0;h<S;h+=1)if(ie[h]!==0)throw new Error("leftmost octets not zero");if(ie[S]!==1)throw new Error("0x01 marker not found");return z===Tt(b(Dt("\0\0\0\0\0\0\0\0"+N+String.fromCharCode.apply(String,ie.slice(-o)))))},we.SALT_LEN_HLEN=-1,we.SALT_LEN_MAX=-2,we.SALT_LEN_RECOVER=-2,ut.hex2dn=function(r,t){t===void 0&&(t=0);var n=new ut;return G.getTLV(r,t),n.getX500Name(r).str},ut.hex2rdn=function(r,t){if(t===void 0&&(t=0),r.substr(t,2)!=="31")throw new Error("malformed RDN");for(var n=new Array,o=G.getChildIdx(r,t),h=0;h<o.length;h++)n.push(ut.hex2attrTypeValue(r,o[h]));return(n=n.map(function(m){return m.replace("+","\\+")})).join("+")},ut.hex2attrTypeValue=function(r,t){var n=G,o=n.getV;if(t===void 0&&(t=0),r.substr(t,2)!=="30")throw new Error("malformed attribute type and value");var h=n.getChildIdx(r,t);h.length!==2||r.substr(h[0],2);var m=o(r,h[0]),b=u.asn1.ASN1Util.oidHexToInt(m);return u.asn1.x509.OID.oid2atype(b)+"="+Tt(o(r,h[1]))},ut.getPublicKeyFromCertHex=function(r){var t=new ut;return t.readCertHex(r),t.getPublicKey()},ut.getPublicKeyFromCertPEM=function(r){var t=new ut;return t.readCertPEM(r),t.getPublicKey()},ut.getPublicKeyInfoPropOfCertPEM=function(r){var t,n,o=G.getVbyList,h={};return h.algparam=null,(t=new ut).readCertPEM(r),n=t.getPublicKeyHex(),h.keyhex=o(n,0,[1],"03").substr(2),h.algoid=o(n,0,[0,0],"06"),h.algoid==="2a8648ce3d0201"&&(h.algparam=o(n,0,[0,1],"06")),h},ut.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],u!==void 0&&u||(e.KJUR=u={}),u.jws!==void 0&&u.jws||(u.jws={}),u.jws.JWS=function(){var r=u.jws.JWS.isSafeJSONString;this.parseJWS=function(t,n){if(this.parsedJWS===void 0||!n&&this.parsedJWS.sigvalH===void 0){var o=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(o==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var h=o[1],m=o[2],b=o[3],N=h+"."+m;if(this.parsedJWS={},this.parsedJWS.headB64U=h,this.parsedJWS.payloadB64U=m,this.parsedJWS.sigvalB64U=b,this.parsedJWS.si=N,!n){var T=We(b),U=qe(T,16);this.parsedJWS.sigvalH=T,this.parsedJWS.sigvalBI=U}var B=Y(h),j=Y(m);if(this.parsedJWS.headS=B,this.parsedJWS.payloadS=j,!r(B,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+B}}},u.jws.JWS.sign=function(r,t,n,o,h){var m,b,N,T=u,U=T.jws.JWS,B=U.readSafeJSONString,j=U.isSafeJSONString,W=T.crypto,z=(W.ECDSA,W.Mac),Z=W.Signature,ne=JSON;if(typeof t!="string"&&(t===void 0?"undefined":I(t))!="object")throw"spHeader must be JSON string or object: "+t;if((t===void 0?"undefined":I(t))=="object"&&(b=t,m=ne.stringify(b)),typeof t=="string"){if(!j(m=t))throw"JWS Head is not safe JSON string: "+m;b=B(m)}if(N=n,(n===void 0?"undefined":I(n))=="object"&&(N=ne.stringify(n)),r!=""&&r!=null||b.alg===void 0||(r=b.alg),r!=""&&r!=null&&b.alg===void 0&&(b.alg=r,m=ne.stringify(b)),r!==b.alg)throw"alg and sHeader.alg doesn't match: "+r+"!="+b.alg;var ie=null;if(U.jwsalg2sigalg[r]===void 0)throw"unsupported alg name: "+r;ie=U.jwsalg2sigalg[r];var S=L(m)+"."+L(N),O="";if(ie.substr(0,4)=="Hmac"){if(o===void 0)throw"mac key shall be specified for HS* alg";var H=new z({alg:ie,prov:"cryptojs",pass:o});H.updateString(S),O=H.doFinal()}else if(ie.indexOf("withECDSA")!=-1){(ee=new Z({alg:ie})).init(o,h),ee.updateString(S);var q=ee.sign();O=u.crypto.ECDSA.asn1SigToConcatSig(q)}else{var ee;ie!="none"&&((ee=new Z({alg:ie})).init(o,h),ee.updateString(S),O=ee.sign())}return S+"."+st(O)},u.jws.JWS.verify=function(r,t,n){var o,h=u,m=h.jws.JWS,b=m.readSafeJSONString,N=h.crypto,T=N.ECDSA,U=N.Mac,B=N.Signature;I(we)!==void 0&&(o=we);var j=r.split(".");if(j.length!==3)return!1;var W=j[0]+"."+j[1],z=We(j[2]),Z=b(Y(j[0])),ne=null,ie=null;if(Z.alg===void 0)throw"algorithm not specified in header";if(ie=(ne=Z.alg).substr(0,2),n!=null&&Object.prototype.toString.call(n)==="[object Array]"&&n.length>0&&(":"+n.join(":")+":").indexOf(":"+ne+":")==-1)throw"algorithm '"+ne+"' not accepted in the list";if(ne!="none"&&t===null)throw"key shall be specified to verify.";if(typeof t=="string"&&t.indexOf("-----BEGIN ")!=-1&&(t=rt.getKey(t)),!(ie!="RS"&&ie!="PS"||t instanceof o))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ie=="ES"&&!(t instanceof T))throw"key shall be a ECDSA obj for ES* algs";var S=null;if(m.jwsalg2sigalg[Z.alg]===void 0)throw"unsupported alg name: "+ne;if((S=m.jwsalg2sigalg[ne])=="none")throw"not supported";if(S.substr(0,4)=="Hmac"){if(t===void 0)throw"hexadecimal key shall be specified for HMAC";var O=new U({alg:S,pass:t});return O.updateString(W),z==O.doFinal()}if(S.indexOf("withECDSA")!=-1){var H,q=null;try{q=T.concatSigToASN1Sig(z)}catch{return!1}return(H=new B({alg:S})).init(t),H.updateString(W),H.verify(q)}return(H=new B({alg:S})).init(t),H.updateString(W),H.verify(z)},u.jws.JWS.parse=function(r){var t,n,o,h=r.split("."),m={};if(h.length!=2&&h.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return t=h[0],n=h[1],h.length==3&&(o=h[2]),m.headerObj=u.jws.JWS.readSafeJSONString(Y(t)),m.payloadObj=u.jws.JWS.readSafeJSONString(Y(n)),m.headerPP=JSON.stringify(m.headerObj,null,"  "),m.payloadObj==null?m.payloadPP=Y(n):m.payloadPP=JSON.stringify(m.payloadObj,null,"  "),o!==void 0&&(m.sigHex=We(o)),m},u.jws.JWS.verifyJWT=function(r,t,n){var o=u.jws,h=o.JWS,m=h.readSafeJSONString,b=h.inArray,N=h.includedArray,T=r.split("."),U=T[0],B=T[1],j=(We(T[2]),m(Y(U))),W=m(Y(B));if(j.alg===void 0)return!1;if(n.alg===void 0)throw"acceptField.alg shall be specified";if(!b(j.alg,n.alg)||W.iss!==void 0&&I(n.iss)==="object"&&!b(W.iss,n.iss)||W.sub!==void 0&&I(n.sub)==="object"&&!b(W.sub,n.sub))return!1;if(W.aud!==void 0&&I(n.aud)==="object"){if(typeof W.aud=="string"){if(!b(W.aud,n.aud))return!1}else if(I(W.aud)=="object"&&!N(W.aud,n.aud))return!1}var z=o.IntDate.getNow();return n.verifyAt!==void 0&&typeof n.verifyAt=="number"&&(z=n.verifyAt),n.gracePeriod!==void 0&&typeof n.gracePeriod=="number"||(n.gracePeriod=0),!(W.exp!==void 0&&typeof W.exp=="number"&&W.exp+n.gracePeriod<z)&&!(W.nbf!==void 0&&typeof W.nbf=="number"&&z<W.nbf-n.gracePeriod)&&!(W.iat!==void 0&&typeof W.iat=="number"&&z<W.iat-n.gracePeriod)&&(W.jti===void 0||n.jti===void 0||W.jti===n.jti)&&!!h.verify(r,t,n.alg)},u.jws.JWS.includedArray=function(r,t){var n=u.jws.JWS.inArray;if(r===null||(r===void 0?"undefined":I(r))!=="object"||typeof r.length!="number")return!1;for(var o=0;o<r.length;o++)if(!n(r[o],t))return!1;return!0},u.jws.JWS.inArray=function(r,t){if(t===null||(t===void 0?"undefined":I(t))!=="object"||typeof t.length!="number")return!1;for(var n=0;n<t.length;n++)if(t[n]==r)return!0;return!1},u.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},u.jws.JWS.isSafeJSONString=function(r,t,n){var o=null;try{return((o=p(r))===void 0?"undefined":I(o))!="object"||o.constructor===Array?0:(t&&(t[n]=o),1)}catch{return 0}},u.jws.JWS.readSafeJSONString=function(r){var t=null;try{return((t=p(r))===void 0?"undefined":I(t))!="object"||t.constructor===Array?null:t}catch{return null}},u.jws.JWS.getEncodedSignatureValueFromJWS=function(r){var t=r.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(t==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},u.jws.JWS.getJWKthumbprint=function(r){if(r.kty!=="RSA"&&r.kty!=="EC"&&r.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var t="{";if(r.kty==="RSA"){if(typeof r.n!="string"||typeof r.e!="string")throw"wrong n and e value for RSA key";t+='"e":"'+r.e+'",',t+='"kty":"'+r.kty+'",',t+='"n":"'+r.n+'"}'}else if(r.kty==="EC"){if(typeof r.crv!="string"||typeof r.x!="string"||typeof r.y!="string")throw"wrong crv, x and y value for EC key";t+='"crv":"'+r.crv+'",',t+='"kty":"'+r.kty+'",',t+='"x":"'+r.x+'",',t+='"y":"'+r.y+'"}'}else if(r.kty==="oct"){if(typeof r.k!="string")throw"wrong k value for oct(symmetric) key";t+='"kty":"'+r.kty+'",',t+='"k":"'+r.k+'"}'}var n=Dt(t);return st(u.crypto.Util.hashHex(n,"sha256"))},u.jws.IntDate={},u.jws.IntDate.get=function(r){var t=u.jws.IntDate,n=t.getNow,o=t.getZulu;if(r=="now")return n();if(r=="now + 1hour")return n()+3600;if(r=="now + 1day")return n()+86400;if(r=="now + 1month")return n()+2592e3;if(r=="now + 1year")return n()+31536e3;if(r.match(/Z$/))return o(r);if(r.match(/^[0-9]+$/))return parseInt(r);throw"unsupported format: "+r},u.jws.IntDate.getZulu=function(r){return Yi(r)},u.jws.IntDate.getNow=function(){return~~(new Date/1e3)},u.jws.IntDate.intDate2UTCString=function(r){return new Date(1e3*r).toUTCString()},u.jws.IntDate.intDate2Zulu=function(r){var t=new Date(1e3*r);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},e.SecureRandom=Ce,e.rng_seed_time=te,e.BigInteger=D,e.RSAKey=we;var Rs=u.crypto.EDSA;e.EDSA=Rs;var ks=u.crypto.DSA;e.DSA=ks;var Cs=u.crypto.Signature;e.Signature=Cs;var Us=u.crypto.MessageDigest;e.MessageDigest=Us;var Ns=u.crypto.Mac;e.Mac=Ns;var Ls=u.crypto.Cipher;e.Cipher=Ls,e.KEYUTIL=rt,e.ASN1HEX=G,e.X509=ut,e.CryptoJS=V,e.b64tohex=Q,e.b64toBA=re,e.stoBA=le,e.BAtos=Fe,e.BAtohex=Me,e.stohex=ke,e.stob64=function(t){return A(ke(t))},e.stob64u=function(t){return He(A(ke(t)))},e.b64utos=function(t){return Fe(re(Ue(t)))},e.b64tob64u=He,e.b64utob64=Ue,e.hex2b64=A,e.hextob64u=st,e.b64utohex=We,e.utf8tob64u=L,e.b64utoutf8=Y,e.utf8tob64=function(t){return A(Qr(en(t)))},e.b64toutf8=function(t){return decodeURIComponent(Zr(Q(t)))},e.utf8tohex=Dn,e.hextoutf8=at,e.hextorstr=Tt,e.rstrtohex=Dt,e.hextob64=$i,e.hextob64nl=Gi,e.b64nltohex=zi,e.hextopem=Et,e.pemtohex=Bt,e.hextoArrayBuffer=function(t){if(t.length%2!=0)throw"input is not even length";if(t.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var n=new ArrayBuffer(t.length/2),o=new DataView(n),h=0;h<t.length/2;h++)o.setUint8(h,parseInt(t.substr(2*h,2),16));return n},e.ArrayBuffertohex=function(t){for(var n="",o=new DataView(t),h=0;h<t.byteLength;h++)n+=("00"+o.getUint8(h).toString(16)).slice(-2);return n},e.zulutomsec=Bn,e.zulutosec=Yi,e.zulutodate=function(t){return new Date(Bn(t))},e.datetozulu=function(t,n,o){var h,m=t.getUTCFullYear();if(n){if(m<1950||2049<m)throw"not proper year for UTCTime: "+m;h=(""+m).slice(-2)}else h=("000"+m).slice(-4);if(h+=("0"+(t.getUTCMonth()+1)).slice(-2),h+=("0"+t.getUTCDate()).slice(-2),h+=("0"+t.getUTCHours()).slice(-2),h+=("0"+t.getUTCMinutes()).slice(-2),h+=("0"+t.getUTCSeconds()).slice(-2),o){var b=t.getUTCMilliseconds();b!==0&&(h+="."+(b=(b=("00"+b).slice(-3)).replace(/0+$/g,"")))}return h+="Z"},e.uricmptohex=Qr,e.hextouricmp=Zr,e.ipv6tohex=Xi,e.hextoipv6=Qi,e.hextoip=On,e.iptohex=function(t){var n="malformed IP address";if(!(t=t.toLowerCase(t)).match(/^[0-9.]+$/)){if(t.match(/^[0-9a-f:]+$/)&&t.indexOf(":")!==-1)return Xi(t);throw n}var o=t.split(".");if(o.length!==4)throw n;var h="";try{for(var m=0;m<4;m++)h+=("0"+parseInt(o[m]).toString(16)).slice(-2);return h}catch{throw n}},e.encodeURIComponentAll=en,e.newline_toUnix=function(t){return t=t.replace(/\r\n/gm,`
`)},e.newline_toDos=function(t){return t=(t=t.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},e.hextoposhex=jn,e.intarystrtohex=function(t){t=(t=(t=t.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return t.split(/,/).map(function(n,o,h){var m=parseInt(n);if(m<0||255<m)throw"integer not in range 0-255";return("00"+m.toString(16)).slice(-2)}).join("")}catch(n){throw"malformed integer array string: "+n}},e.strdiffidx=function(t,n){var o=t.length;t.length>n.length&&(o=n.length);for(var h=0;h<o;h++)if(t.charCodeAt(h)!=n.charCodeAt(h))return h;return t.length!=n.length?o:-1},e.KJUR=u;var Ds=u.crypto;e.crypto=Ds;var Bs=u.asn1;e.asn1=Bs;var Os=u.jws;e.jws=Os;var js=u.lang;e.lang=js}).call(this,i(28).Buffer)},function(s,e,i){"use strict";(function(a){var c=i(30),y=i(31),l=i(32);function f(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function g($,v){if(f()<v)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?($=new Uint8Array(v)).__proto__=d.prototype:($===null&&($=new d(v)),$.length=v),$}function d($,v,_){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d($,v,_);if(typeof $=="number"){if(typeof v=="string")throw new Error("If encoding is specified then the first argument must be a string");return P(this,$)}return w(this,$,v,_)}function w($,v,_,M){if(typeof v=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&v instanceof ArrayBuffer?function(te,se,me,be){if(se.byteLength,me<0||se.byteLength<me)throw new RangeError("'offset' is out of bounds");if(se.byteLength<me+(be||0))throw new RangeError("'length' is out of bounds");return se=me===void 0&&be===void 0?new Uint8Array(se):be===void 0?new Uint8Array(se,me):new Uint8Array(se,me,be),d.TYPED_ARRAY_SUPPORT?(te=se).__proto__=d.prototype:te=C(te,se),te}($,v,_,M):typeof v=="string"?function(te,se,me){if(typeof me=="string"&&me!==""||(me="utf8"),!d.isEncoding(me))throw new TypeError('"encoding" must be a valid string encoding');var be=0|I(se,me),Ne=(te=g(te,be)).write(se,me);return Ne!==be&&(te=te.slice(0,Ne)),te}($,v,_):function(te,se){if(d.isBuffer(se)){var me=0|x(se.length);return(te=g(te,me)).length===0||se.copy(te,0,0,me),te}if(se){if(typeof ArrayBuffer<"u"&&se.buffer instanceof ArrayBuffer||"length"in se)return typeof se.length!="number"||function(Ne){return Ne!=Ne}(se.length)?g(te,0):C(te,se);if(se.type==="Buffer"&&l(se.data))return C(te,se.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}($,v)}function F($){if(typeof $!="number")throw new TypeError('"size" argument must be a number');if($<0)throw new RangeError('"size" argument must not be negative')}function P($,v){if(F(v),$=g($,v<0?0:0|x(v)),!d.TYPED_ARRAY_SUPPORT)for(var _=0;_<v;++_)$[_]=0;return $}function C($,v){var _=v.length<0?0:0|x(v.length);$=g($,_);for(var M=0;M<_;M+=1)$[M]=255&v[M];return $}function x($){if($>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|$}function I($,v){if(d.isBuffer($))return $.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView($)||$ instanceof ArrayBuffer))return $.byteLength;typeof $!="string"&&($=""+$);var _=$.length;if(_===0)return 0;for(var M=!1;;)switch(v){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":case void 0:return dt($).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*_;case"hex":return _>>>1;case"base64":return Ve($).length;default:if(M)return dt($).length;v=(""+v).toLowerCase(),M=!0}}function R($,v,_){var M=!1;if((v===void 0||v<0)&&(v=0),v>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0)<=(v>>>=0))return"";for($||($="utf8");;)switch($){case"hex":return Ze(this,v,_);case"utf8":case"utf-8":return Ee(this,v,_);case"ascii":return je(this,v,_);case"latin1":case"binary":return Qe(this,v,_);case"base64":return pe(this,v,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return lt(this,v,_);default:if(M)throw new TypeError("Unknown encoding: "+$);$=($+"").toLowerCase(),M=!0}}function K($,v,_){var M=$[v];$[v]=$[_],$[_]=M}function V($,v,_,M,J){if($.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,isNaN(_)&&(_=J?0:$.length-1),_<0&&(_=$.length+_),_>=$.length){if(J)return-1;_=$.length-1}else if(_<0){if(!J)return-1;_=0}if(typeof v=="string"&&(v=d.from(v,M)),d.isBuffer(v))return v.length===0?-1:X($,v,_,M,J);if(typeof v=="number")return v&=255,d.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?J?Uint8Array.prototype.indexOf.call($,v,_):Uint8Array.prototype.lastIndexOf.call($,v,_):X($,[v],_,M,J);throw new TypeError("val must be string, number or Buffer")}function X($,v,_,M,J){var te,se=1,me=$.length,be=v.length;if(M!==void 0&&((M=String(M).toLowerCase())==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if($.length<2||v.length<2)return-1;se=2,me/=2,be/=2,_/=2}function Ne(wt,we){return se===1?wt[we]:wt.readUInt16BE(we*se)}if(J){var Te=-1;for(te=_;te<me;te++)if(Ne($,te)===Ne(v,Te===-1?0:te-Te)){if(Te===-1&&(Te=te),te-Te+1===be)return Te*se}else Te!==-1&&(te-=te-Te),Te=-1}else for(_+be>me&&(_=me-be),te=_;te>=0;te--){for(var Ce=!0,qe=0;qe<be;qe++)if(Ne($,te+qe)!==Ne(v,qe)){Ce=!1;break}if(Ce)return te}return-1}function k($,v,_,M){_=Number(_)||0;var J=$.length-_;M?(M=Number(M))>J&&(M=J):M=J;var te=v.length;if(te%2!=0)throw new TypeError("Invalid hex string");M>te/2&&(M=te/2);for(var se=0;se<M;++se){var me=parseInt(v.substr(2*se,2),16);if(isNaN(me))return se;$[_+se]=me}return se}function A($,v,_,M){return Be(dt(v,$.length-_),$,_,M)}function Q($,v,_,M){return Be(function(te){for(var se=[],me=0;me<te.length;++me)se.push(255&te.charCodeAt(me));return se}(v),$,_,M)}function re($,v,_,M){return Q($,v,_,M)}function D($,v,_,M){return Be(Ve(v),$,_,M)}function he($,v,_,M){return Be(function(te,se){for(var me,be,Ne,Te=[],Ce=0;Ce<te.length&&!((se-=2)<0);++Ce)be=(me=te.charCodeAt(Ce))>>8,Ne=me%256,Te.push(Ne),Te.push(be);return Te}(v,$.length-_),$,_,M)}function pe($,v,_){return v===0&&_===$.length?c.fromByteArray($):c.fromByteArray($.slice(v,_))}function Ee($,v,_){_=Math.min($.length,_);for(var M=[],J=v;J<_;){var te,se,me,be,Ne=$[J],Te=null,Ce=Ne>239?4:Ne>223?3:Ne>191?2:1;if(J+Ce<=_)switch(Ce){case 1:Ne<128&&(Te=Ne);break;case 2:(192&(te=$[J+1]))==128&&(be=(31&Ne)<<6|63&te)>127&&(Te=be);break;case 3:te=$[J+1],se=$[J+2],(192&te)==128&&(192&se)==128&&(be=(15&Ne)<<12|(63&te)<<6|63&se)>2047&&(be<55296||be>57343)&&(Te=be);break;case 4:te=$[J+1],se=$[J+2],me=$[J+3],(192&te)==128&&(192&se)==128&&(192&me)==128&&(be=(15&Ne)<<18|(63&te)<<12|(63&se)<<6|63&me)>65535&&be<1114112&&(Te=be)}Te===null?(Te=65533,Ce=1):Te>65535&&(Te-=65536,M.push(Te>>>10&1023|55296),Te=56320|1023&Te),M.push(Te),J+=Ce}return function(wt){var we=wt.length;if(we<=$e)return String.fromCharCode.apply(String,wt);for(var Le="",Ae=0;Ae<we;)Le+=String.fromCharCode.apply(String,wt.slice(Ae,Ae+=$e));return Le}(M)}e.Buffer=d,e.SlowBuffer=function(v){return+v!=v&&(v=0),d.alloc(+v)},e.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=a.TYPED_ARRAY_SUPPORT!==void 0?a.TYPED_ARRAY_SUPPORT:function(){try{var v=new Uint8Array(1);return v.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},v.foo()===42&&typeof v.subarray=="function"&&v.subarray(1,1).byteLength===0}catch{return!1}}(),e.kMaxLength=f(),d.poolSize=8192,d._augment=function($){return $.__proto__=d.prototype,$},d.from=function($,v,_){return w(null,$,v,_)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function($,v,_){return function(J,te,se,me){return F(te),te<=0?g(J,te):se!==void 0?typeof me=="string"?g(J,te).fill(se,me):g(J,te).fill(se):g(J,te)}(null,$,v,_)},d.allocUnsafe=function($){return P(null,$)},d.allocUnsafeSlow=function($){return P(null,$)},d.isBuffer=function(v){return!(v==null||!v._isBuffer)},d.compare=function(v,_){if(!d.isBuffer(v)||!d.isBuffer(_))throw new TypeError("Arguments must be Buffers");if(v===_)return 0;for(var M=v.length,J=_.length,te=0,se=Math.min(M,J);te<se;++te)if(v[te]!==_[te]){M=v[te],J=_[te];break}return M<J?-1:J<M?1:0},d.isEncoding=function(v){switch(String(v).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(v,_){if(!l(v))throw new TypeError('"list" argument must be an Array of Buffers');if(v.length===0)return d.alloc(0);var M;if(_===void 0)for(_=0,M=0;M<v.length;++M)_+=v[M].length;var J=d.allocUnsafe(_),te=0;for(M=0;M<v.length;++M){var se=v[M];if(!d.isBuffer(se))throw new TypeError('"list" argument must be an Array of Buffers');se.copy(J,te),te+=se.length}return J},d.byteLength=I,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var v=this.length;if(v%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var _=0;_<v;_+=2)K(this,_,_+1);return this},d.prototype.swap32=function(){var v=this.length;if(v%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var _=0;_<v;_+=4)K(this,_,_+3),K(this,_+1,_+2);return this},d.prototype.swap64=function(){var v=this.length;if(v%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var _=0;_<v;_+=8)K(this,_,_+7),K(this,_+1,_+6),K(this,_+2,_+5),K(this,_+3,_+4);return this},d.prototype.toString=function(){var v=0|this.length;return v===0?"":arguments.length===0?Ee(this,0,v):R.apply(this,arguments)},d.prototype.equals=function(v){if(!d.isBuffer(v))throw new TypeError("Argument must be a Buffer");return this===v||d.compare(this,v)===0},d.prototype.inspect=function(){var v="",_=e.INSPECT_MAX_BYTES;return this.length>0&&(v=this.toString("hex",0,_).match(/.{2}/g).join(" "),this.length>_&&(v+=" ... ")),"<Buffer "+v+">"},d.prototype.compare=function(v,_,M,J,te){if(!d.isBuffer(v))throw new TypeError("Argument must be a Buffer");if(_===void 0&&(_=0),M===void 0&&(M=v?v.length:0),J===void 0&&(J=0),te===void 0&&(te=this.length),_<0||M>v.length||J<0||te>this.length)throw new RangeError("out of range index");if(J>=te&&_>=M)return 0;if(J>=te)return-1;if(_>=M)return 1;if(this===v)return 0;for(var se=(te>>>=0)-(J>>>=0),me=(M>>>=0)-(_>>>=0),be=Math.min(se,me),Ne=this.slice(J,te),Te=v.slice(_,M),Ce=0;Ce<be;++Ce)if(Ne[Ce]!==Te[Ce]){se=Ne[Ce],me=Te[Ce];break}return se<me?-1:me<se?1:0},d.prototype.includes=function(v,_,M){return this.indexOf(v,_,M)!==-1},d.prototype.indexOf=function(v,_,M){return V(this,v,_,M,!0)},d.prototype.lastIndexOf=function(v,_,M){return V(this,v,_,M,!1)},d.prototype.write=function(v,_,M,J){if(_===void 0)J="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")J=_,M=this.length,_=0;else{if(!isFinite(_))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");_|=0,isFinite(M)?(M|=0,J===void 0&&(J="utf8")):(J=M,M=void 0)}var te=this.length-_;if((M===void 0||M>te)&&(M=te),v.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");J||(J="utf8");for(var se=!1;;)switch(J){case"hex":return k(this,v,_,M);case"utf8":case"utf-8":return A(this,v,_,M);case"ascii":return Q(this,v,_,M);case"latin1":case"binary":return re(this,v,_,M);case"base64":return D(this,v,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,v,_,M);default:if(se)throw new TypeError("Unknown encoding: "+J);J=(""+J).toLowerCase(),se=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $e=4096;function je($,v,_){var M="";_=Math.min($.length,_);for(var J=v;J<_;++J)M+=String.fromCharCode(127&$[J]);return M}function Qe($,v,_){var M="";_=Math.min($.length,_);for(var J=v;J<_;++J)M+=String.fromCharCode($[J]);return M}function Ze($,v,_){var M=$.length;(!v||v<0)&&(v=0),(!_||_<0||_>M)&&(_=M);for(var J="",te=v;te<_;++te)J+=ot($[te]);return J}function lt($,v,_){for(var M=$.slice(v,_),J="",te=0;te<M.length;te+=2)J+=String.fromCharCode(M[te]+256*M[te+1]);return J}function xe($,v,_){if($%1!=0||$<0)throw new RangeError("offset is not uint");if($+v>_)throw new RangeError("Trying to access beyond buffer length")}function Pe($,v,_,M,J,te){if(!d.isBuffer($))throw new TypeError('"buffer" argument must be a Buffer instance');if(v>J||v<te)throw new RangeError('"value" argument is out of bounds');if(_+M>$.length)throw new RangeError("Index out of range")}function it($,v,_,M){v<0&&(v=65535+v+1);for(var J=0,te=Math.min($.length-_,2);J<te;++J)$[_+J]=(v&255<<8*(M?J:1-J))>>>8*(M?J:1-J)}function Re($,v,_,M){v<0&&(v=4294967295+v+1);for(var J=0,te=Math.min($.length-_,4);J<te;++J)$[_+J]=v>>>8*(M?J:3-J)&255}function De($,v,_,M,J,te){if(_+M>$.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function ft($,v,_,M,J){return J||De($,0,_,4),y.write($,v,_,M,23,4),_+4}function _t($,v,_,M,J){return J||De($,0,_,8),y.write($,v,_,M,52,8),_+8}d.prototype.slice=function(v,_){var M,J=this.length;if((v=~~v)<0?(v+=J)<0&&(v=0):v>J&&(v=J),(_=_===void 0?J:~~_)<0?(_+=J)<0&&(_=0):_>J&&(_=J),_<v&&(_=v),d.TYPED_ARRAY_SUPPORT)(M=this.subarray(v,_)).__proto__=d.prototype;else{var te=_-v;M=new d(te,void 0);for(var se=0;se<te;++se)M[se]=this[se+v]}return M},d.prototype.readUIntLE=function(v,_,M){v|=0,_|=0,M||xe(v,_,this.length);for(var J=this[v],te=1,se=0;++se<_&&(te*=256);)J+=this[v+se]*te;return J},d.prototype.readUIntBE=function(v,_,M){v|=0,_|=0,M||xe(v,_,this.length);for(var J=this[v+--_],te=1;_>0&&(te*=256);)J+=this[v+--_]*te;return J},d.prototype.readUInt8=function(v,_){return _||xe(v,1,this.length),this[v]},d.prototype.readUInt16LE=function(v,_){return _||xe(v,2,this.length),this[v]|this[v+1]<<8},d.prototype.readUInt16BE=function(v,_){return _||xe(v,2,this.length),this[v]<<8|this[v+1]},d.prototype.readUInt32LE=function(v,_){return _||xe(v,4,this.length),(this[v]|this[v+1]<<8|this[v+2]<<16)+16777216*this[v+3]},d.prototype.readUInt32BE=function(v,_){return _||xe(v,4,this.length),16777216*this[v]+(this[v+1]<<16|this[v+2]<<8|this[v+3])},d.prototype.readIntLE=function(v,_,M){v|=0,_|=0,M||xe(v,_,this.length);for(var J=this[v],te=1,se=0;++se<_&&(te*=256);)J+=this[v+se]*te;return J>=(te*=128)&&(J-=Math.pow(2,8*_)),J},d.prototype.readIntBE=function(v,_,M){v|=0,_|=0,M||xe(v,_,this.length);for(var J=_,te=1,se=this[v+--J];J>0&&(te*=256);)se+=this[v+--J]*te;return se>=(te*=128)&&(se-=Math.pow(2,8*_)),se},d.prototype.readInt8=function(v,_){return _||xe(v,1,this.length),128&this[v]?-1*(255-this[v]+1):this[v]},d.prototype.readInt16LE=function(v,_){_||xe(v,2,this.length);var M=this[v]|this[v+1]<<8;return 32768&M?4294901760|M:M},d.prototype.readInt16BE=function(v,_){_||xe(v,2,this.length);var M=this[v+1]|this[v]<<8;return 32768&M?4294901760|M:M},d.prototype.readInt32LE=function(v,_){return _||xe(v,4,this.length),this[v]|this[v+1]<<8|this[v+2]<<16|this[v+3]<<24},d.prototype.readInt32BE=function(v,_){return _||xe(v,4,this.length),this[v]<<24|this[v+1]<<16|this[v+2]<<8|this[v+3]},d.prototype.readFloatLE=function(v,_){return _||xe(v,4,this.length),y.read(this,v,!0,23,4)},d.prototype.readFloatBE=function(v,_){return _||xe(v,4,this.length),y.read(this,v,!1,23,4)},d.prototype.readDoubleLE=function(v,_){return _||xe(v,8,this.length),y.read(this,v,!0,52,8)},d.prototype.readDoubleBE=function(v,_){return _||xe(v,8,this.length),y.read(this,v,!1,52,8)},d.prototype.writeUIntLE=function(v,_,M,J){v=+v,_|=0,M|=0,J||Pe(this,v,_,M,Math.pow(2,8*M)-1,0);var te=1,se=0;for(this[_]=255&v;++se<M&&(te*=256);)this[_+se]=v/te&255;return _+M},d.prototype.writeUIntBE=function(v,_,M,J){v=+v,_|=0,M|=0,J||Pe(this,v,_,M,Math.pow(2,8*M)-1,0);var te=M-1,se=1;for(this[_+te]=255&v;--te>=0&&(se*=256);)this[_+te]=v/se&255;return _+M},d.prototype.writeUInt8=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,1,255,0),d.TYPED_ARRAY_SUPPORT||(v=Math.floor(v)),this[_]=255&v,_+1},d.prototype.writeUInt16LE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[_]=255&v,this[_+1]=v>>>8):it(this,v,_,!0),_+2},d.prototype.writeUInt16BE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[_]=v>>>8,this[_+1]=255&v):it(this,v,_,!1),_+2},d.prototype.writeUInt32LE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[_+3]=v>>>24,this[_+2]=v>>>16,this[_+1]=v>>>8,this[_]=255&v):Re(this,v,_,!0),_+4},d.prototype.writeUInt32BE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[_]=v>>>24,this[_+1]=v>>>16,this[_+2]=v>>>8,this[_+3]=255&v):Re(this,v,_,!1),_+4},d.prototype.writeIntLE=function(v,_,M,J){if(v=+v,_|=0,!J){var te=Math.pow(2,8*M-1);Pe(this,v,_,M,te-1,-te)}var se=0,me=1,be=0;for(this[_]=255&v;++se<M&&(me*=256);)v<0&&be===0&&this[_+se-1]!==0&&(be=1),this[_+se]=(v/me>>0)-be&255;return _+M},d.prototype.writeIntBE=function(v,_,M,J){if(v=+v,_|=0,!J){var te=Math.pow(2,8*M-1);Pe(this,v,_,M,te-1,-te)}var se=M-1,me=1,be=0;for(this[_+se]=255&v;--se>=0&&(me*=256);)v<0&&be===0&&this[_+se+1]!==0&&(be=1),this[_+se]=(v/me>>0)-be&255;return _+M},d.prototype.writeInt8=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,1,127,-128),d.TYPED_ARRAY_SUPPORT||(v=Math.floor(v)),v<0&&(v=255+v+1),this[_]=255&v,_+1},d.prototype.writeInt16LE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[_]=255&v,this[_+1]=v>>>8):it(this,v,_,!0),_+2},d.prototype.writeInt16BE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[_]=v>>>8,this[_+1]=255&v):it(this,v,_,!1),_+2},d.prototype.writeInt32LE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[_]=255&v,this[_+1]=v>>>8,this[_+2]=v>>>16,this[_+3]=v>>>24):Re(this,v,_,!0),_+4},d.prototype.writeInt32BE=function(v,_,M){return v=+v,_|=0,M||Pe(this,v,_,4,2147483647,-2147483648),v<0&&(v=4294967295+v+1),d.TYPED_ARRAY_SUPPORT?(this[_]=v>>>24,this[_+1]=v>>>16,this[_+2]=v>>>8,this[_+3]=255&v):Re(this,v,_,!1),_+4},d.prototype.writeFloatLE=function(v,_,M){return ft(this,v,_,!0,M)},d.prototype.writeFloatBE=function(v,_,M){return ft(this,v,_,!1,M)},d.prototype.writeDoubleLE=function(v,_,M){return _t(this,v,_,!0,M)},d.prototype.writeDoubleBE=function(v,_,M){return _t(this,v,_,!1,M)},d.prototype.copy=function(v,_,M,J){if(M||(M=0),J||J===0||(J=this.length),_>=v.length&&(_=v.length),_||(_=0),J>0&&J<M&&(J=M),J===M||v.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("sourceStart out of bounds");if(J<0)throw new RangeError("sourceEnd out of bounds");J>this.length&&(J=this.length),v.length-_<J-M&&(J=v.length-_+M);var te,se=J-M;if(this===v&&M<_&&_<J)for(te=se-1;te>=0;--te)v[te+_]=this[te+M];else if(se<1e3||!d.TYPED_ARRAY_SUPPORT)for(te=0;te<se;++te)v[te+_]=this[te+M];else Uint8Array.prototype.set.call(v,this.subarray(M,M+se),_);return se},d.prototype.fill=function(v,_,M,J){if(typeof v=="string"){if(typeof _=="string"?(J=_,_=0,M=this.length):typeof M=="string"&&(J=M,M=this.length),v.length===1){var te=v.charCodeAt(0);te<256&&(v=te)}if(J!==void 0&&typeof J!="string")throw new TypeError("encoding must be a string");if(typeof J=="string"&&!d.isEncoding(J))throw new TypeError("Unknown encoding: "+J)}else typeof v=="number"&&(v&=255);if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;var se;if(_>>>=0,M=M===void 0?this.length:M>>>0,v||(v=0),typeof v=="number")for(se=_;se<M;++se)this[se]=v;else{var me=d.isBuffer(v)?v:dt(new d(v,J).toString()),be=me.length;for(se=0;se<M-_;++se)this[se+_]=me[se%be]}return this};var Pt=/[^+\/0-9A-Za-z-_]/g;function ot($){return $<16?"0"+$.toString(16):$.toString(16)}function dt($,v){var _;v=v||1/0;for(var M=$.length,J=null,te=[],se=0;se<M;++se){if((_=$.charCodeAt(se))>55295&&_<57344){if(!J){if(_>56319){(v-=3)>-1&&te.push(239,191,189);continue}if(se+1===M){(v-=3)>-1&&te.push(239,191,189);continue}J=_;continue}if(_<56320){(v-=3)>-1&&te.push(239,191,189),J=_;continue}_=65536+(J-55296<<10|_-56320)}else J&&(v-=3)>-1&&te.push(239,191,189);if(J=null,_<128){if((v-=1)<0)break;te.push(_)}else if(_<2048){if((v-=2)<0)break;te.push(_>>6|192,63&_|128)}else if(_<65536){if((v-=3)<0)break;te.push(_>>12|224,_>>6&63|128,63&_|128)}else{if(!(_<1114112))throw new Error("Invalid code point");if((v-=4)<0)break;te.push(_>>18|240,_>>12&63|128,_>>6&63|128,63&_|128)}}return te}function Ve($){return c.toByteArray(function(_){if((_=function(J){return J.trim?J.trim():J.replace(/^\s+|\s+$/g,"")}(_).replace(Pt,"")).length<2)return"";for(;_.length%4!=0;)_+="=";return _}($))}function Be($,v,_,M){for(var J=0;J<M&&!(J+_>=v.length||J>=$.length);++J)v[J+_]=$[J];return J}}).call(this,i(29))},function(s,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}s.exports=i},function(s,e,i){"use strict";e.byteLength=function(P){var C=d(P),x=C[0],I=C[1];return 3*(x+I)/4-I},e.toByteArray=function(P){var C,x,I=d(P),R=I[0],K=I[1],V=new y(function(Q,re,D){return 3*(re+D)/4-D}(0,R,K)),X=0,k=K>0?R-4:R;for(x=0;x<k;x+=4)C=c[P.charCodeAt(x)]<<18|c[P.charCodeAt(x+1)]<<12|c[P.charCodeAt(x+2)]<<6|c[P.charCodeAt(x+3)],V[X++]=C>>16&255,V[X++]=C>>8&255,V[X++]=255&C;return K===2&&(C=c[P.charCodeAt(x)]<<2|c[P.charCodeAt(x+1)]>>4,V[X++]=255&C),K===1&&(C=c[P.charCodeAt(x)]<<10|c[P.charCodeAt(x+1)]<<4|c[P.charCodeAt(x+2)]>>2,V[X++]=C>>8&255,V[X++]=255&C),V},e.fromByteArray=function(P){for(var C,x=P.length,I=x%3,R=[],K=16383,V=0,X=x-I;V<X;V+=K)R.push(w(P,V,V+K>X?X:V+K));return I===1?(C=P[x-1],R.push(a[C>>2]+a[C<<4&63]+"==")):I===2&&(C=(P[x-2]<<8)+P[x-1],R.push(a[C>>10]+a[C>>4&63]+a[C<<2&63]+"=")),R.join("")};for(var a=[],c=[],y=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,g=l.length;f<g;++f)a[f]=l[f],c[l.charCodeAt(f)]=f;function d(F){var P=F.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var C=F.indexOf("=");return C===-1&&(C=P),[C,C===P?0:4-C%4]}function w(F,P,C){for(var x,I,R=[],K=P;K<C;K+=3)x=(F[K]<<16&16711680)+(F[K+1]<<8&65280)+(255&F[K+2]),R.push(a[(I=x)>>18&63]+a[I>>12&63]+a[I>>6&63]+a[63&I]);return R.join("")}c[45]=62,c[95]=63},function(s,e){e.read=function(i,a,c,y,l){var f,g,d=8*l-y-1,w=(1<<d)-1,F=w>>1,P=-7,C=c?l-1:0,x=c?-1:1,I=i[a+C];for(C+=x,f=I&(1<<-P)-1,I>>=-P,P+=d;P>0;f=256*f+i[a+C],C+=x,P-=8);for(g=f&(1<<-P)-1,f>>=-P,P+=y;P>0;g=256*g+i[a+C],C+=x,P-=8);if(f===0)f=1-F;else{if(f===w)return g?NaN:1/0*(I?-1:1);g+=Math.pow(2,y),f-=F}return(I?-1:1)*g*Math.pow(2,f-y)},e.write=function(i,a,c,y,l,f){var g,d,w,F=8*f-l-1,P=(1<<F)-1,C=P>>1,x=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=y?0:f-1,R=y?1:-1,K=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(d=isNaN(a)?1:0,g=P):(g=Math.floor(Math.log(a)/Math.LN2),a*(w=Math.pow(2,-g))<1&&(g--,w*=2),(a+=g+C>=1?x/w:x*Math.pow(2,1-C))*w>=2&&(g++,w/=2),g+C>=P?(d=0,g=P):g+C>=1?(d=(a*w-1)*Math.pow(2,l),g+=C):(d=a*Math.pow(2,C-1)*Math.pow(2,l),g=0));l>=8;i[c+I]=255&d,I+=R,d/=256,l-=8);for(g=g<<l|d,F+=l;F>0;i[c+I]=255&g,I+=R,g/=256,F-=8);i[c+I-R]|=128*K}},function(s,e){var i={}.toString;s.exports=Array.isArray||function(a){return i.call(a)=="[object Array]"}},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(y){var l=y.jws,f=y.KeyUtil,g=y.X509,d=y.crypto,w=y.hextob64u,F=y.b64tohex,P=y.AllowedSigningAlgs;return function(){function C(){(function(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")})(this,C)}return C.parseJwt=function(I){a.Log.debug("JoseUtil.parseJwt");try{var R=l.JWS.parse(I);return{header:R.headerObj,payload:R.payloadObj}}catch(K){a.Log.error(K)}},C.validateJwt=function(I,R,K,V,X,k,A){a.Log.debug("JoseUtil.validateJwt");try{if(R.kty==="RSA")if(R.e&&R.n)R=f.getKey(R);else{if(!R.x5c||!R.x5c.length)return a.Log.error("JoseUtil.validateJwt: RSA key missing key material",R),Promise.reject(new Error("RSA key missing key material"));var Q=F(R.x5c[0]);R=g.getPublicKeyFromCertHex(Q)}else{if(R.kty!=="EC")return a.Log.error("JoseUtil.validateJwt: Unsupported key type",R&&R.kty),Promise.reject(new Error(R.kty));if(!(R.crv&&R.x&&R.y))return a.Log.error("JoseUtil.validateJwt: EC key missing key material",R),Promise.reject(new Error("EC key missing key material"));R=f.getKey(R)}return C._validateJwt(I,R,K,V,X,k,A)}catch(re){return a.Log.error(re&&re.message||re),Promise.reject("JWT validation failed")}},C.validateJwtAttributes=function(I,R,K,V,X,k){V||(V=0),X||(X=parseInt(Date.now()/1e3));var A=C.parseJwt(I).payload;if(!A.iss)return a.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(A.iss!==R)return a.Log.error("JoseUtil._validateJwt: Invalid issuer in token",A.iss),Promise.reject(new Error("Invalid issuer in token: "+A.iss));if(!A.aud)return a.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(A.aud===K||Array.isArray(A.aud)&&A.aud.indexOf(K)>=0))return a.Log.error("JoseUtil._validateJwt: Invalid audience in token",A.aud),Promise.reject(new Error("Invalid audience in token: "+A.aud));if(A.azp&&A.azp!==K)return a.Log.error("JoseUtil._validateJwt: Invalid azp in token",A.azp),Promise.reject(new Error("Invalid azp in token: "+A.azp));if(!k){var Q=X+V,re=X-V;if(!A.iat)return a.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(Q<A.iat)return a.Log.error("JoseUtil._validateJwt: iat is in the future",A.iat),Promise.reject(new Error("iat is in the future: "+A.iat));if(A.nbf&&Q<A.nbf)return a.Log.error("JoseUtil._validateJwt: nbf is in the future",A.nbf),Promise.reject(new Error("nbf is in the future: "+A.nbf));if(!A.exp)return a.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(A.exp<re)return a.Log.error("JoseUtil._validateJwt: exp is in the past",A.exp),Promise.reject(new Error("exp is in the past:"+A.exp))}return Promise.resolve(A)},C._validateJwt=function(I,R,K,V,X,k,A){return C.validateJwtAttributes(I,K,V,X,k,A).then(function(Q){try{return l.JWS.verify(I,R,P)?Q:(a.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(re){return a.Log.error(re&&re.message||re),Promise.reject(new Error("signature validation failed"))}})},C.hashString=function(I,R){try{return d.Util.hashString(I,R)}catch(K){a.Log.error(K)}},C.hexToBase64Url=function(I){try{return w(I)}catch(R){a.Log.error(R)}},C}()};var a=i(0);s.exports=e.default},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SigninResponse=void 0;var a=function(){function l(f,g){for(var d=0;d<g.length;d++){var w=g[d];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,g,d){return g&&l(f.prototype,g),d&&l(f,d),f}}(),c=i(3);function y(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}e.SigninResponse=function(){function l(f){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";y(this,l);var d=c.UrlUtility.parseUrlFragment(f,g);this.error=d.error,this.error_description=d.error_description,this.error_uri=d.error_uri,this.code=d.code,this.state=d.state,this.id_token=d.id_token,this.session_state=d.session_state,this.access_token=d.access_token,this.token_type=d.token_type,this.scope=d.scope,this.profile=void 0,this.expires_in=d.expires_in}return a(l,[{key:"expires_in",get:function(){if(this.expires_at){var g=parseInt(Date.now()/1e3);return this.expires_at-g}},set:function(g){var d=parseInt(g);if(typeof d=="number"&&d>0){var w=parseInt(Date.now()/1e3);this.expires_at=w+d}}},{key:"expired",get:function(){var g=this.expires_in;if(g!==void 0)return g<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignoutRequest=void 0;var a=i(0),c=i(3),y=i(9);e.SignoutRequest=function l(f){var g=f.url,d=f.id_token_hint,w=f.post_logout_redirect_uri,F=f.data,P=f.extraQueryParams,C=f.request_type;if(function(R,K){if(!(R instanceof K))throw new TypeError("Cannot call a class as a function")}(this,l),!g)throw a.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var x in d&&(g=c.UrlUtility.addQueryParam(g,"id_token_hint",d)),w&&(g=c.UrlUtility.addQueryParam(g,"post_logout_redirect_uri",w),F&&(this.state=new y.State({data:F,request_type:C}),g=c.UrlUtility.addQueryParam(g,"state",this.state.id))),P)g=c.UrlUtility.addQueryParam(g,x,P[x]);this.url=g}},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignoutResponse=void 0;var a=i(3);e.SignoutResponse=function c(y){(function(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")})(this,c);var l=a.UrlUtility.parseUrlFragment(y,"?");this.error=l.error,this.error_description=l.error_description,this.error_uri=l.error_uri,this.state=l.state}},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InMemoryWebStorage=void 0;var a=function(){function y(l,f){for(var g=0;g<f.length;g++){var d=f[g];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,f,g){return f&&y(l.prototype,f),g&&y(l,g),l}}(),c=i(0);e.InMemoryWebStorage=function(){function y(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,y),this._data={}}return y.prototype.getItem=function(f){return c.Log.debug("InMemoryWebStorage.getItem",f),this._data[f]},y.prototype.setItem=function(f,g){c.Log.debug("InMemoryWebStorage.setItem",f),this._data[f]=g},y.prototype.removeItem=function(f){c.Log.debug("InMemoryWebStorage.removeItem",f),delete this._data[f]},y.prototype.key=function(f){return Object.getOwnPropertyNames(this._data)[f]},a(y,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManager=void 0;var a=function(){function K(V,X){for(var k=0;k<X.length;k++){var A=X[k];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(V,A.key,A)}}return function(V,X,k){return X&&K(V.prototype,X),k&&K(V,k),V}}(),c=i(0),y=i(10),l=i(39),f=i(15),g=i(45),d=i(47),w=i(18),F=i(8),P=i(20),C=i(11),x=i(4);function I(K,V){if(!(K instanceof V))throw new TypeError("Cannot call a class as a function")}function R(K,V){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!V||typeof V!="object"&&typeof V!="function"?K:V}e.UserManager=function(K){function V(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d.SilentRenewService,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:w.SessionMonitor,Q=arguments.length>3&&arguments[3]!==void 0?arguments[3]:P.TokenRevocationClient,re=arguments.length>4&&arguments[4]!==void 0?arguments[4]:C.TokenClient,D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:x.JoseUtil;I(this,V),X instanceof l.UserManagerSettings||(X=new l.UserManagerSettings(X));var he=R(this,K.call(this,X));return he._events=new g.UserManagerEvents(X),he._silentRenewService=new k(he),he.settings.automaticSilentRenew&&(c.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),he.startSilentRenew()),he.settings.monitorSession&&(c.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),he._sessionMonitor=new A(he)),he._tokenRevocationClient=new Q(he._settings),he._tokenClient=new re(he._settings),he._joseUtil=D,he}return function(k,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);k.prototype=Object.create(A&&A.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(k,A):k.__proto__=A)}(V,K),V.prototype.getUser=function(){var k=this;return this._loadUser().then(function(A){return A?(c.Log.info("UserManager.getUser: user loaded"),k._events.load(A,!1),A):(c.Log.info("UserManager.getUser: user not found in storage"),null)})},V.prototype.removeUser=function(){var k=this;return this.storeUser(null).then(function(){c.Log.info("UserManager.removeUser: user removed from storage"),k._events.unload()})},V.prototype.signinRedirect=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(k=Object.assign({},k)).request_type="si:r";var A={useReplaceToNavigate:k.useReplaceToNavigate};return this._signinStart(k,this._redirectNavigator,A).then(function(){c.Log.info("UserManager.signinRedirect: successful")})},V.prototype.signinRedirectCallback=function(k){return this._signinEnd(k||this._redirectNavigator.url).then(function(A){return A.profile&&A.profile.sub?c.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",A.profile.sub):c.Log.info("UserManager.signinRedirectCallback: no sub"),A})},V.prototype.signinPopup=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(k=Object.assign({},k)).request_type="si:p";var A=k.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return A?(k.redirect_uri=A,k.display="popup",this._signin(k,this._popupNavigator,{startUrl:A,popupWindowFeatures:k.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:k.popupWindowTarget||this.settings.popupWindowTarget}).then(function(Q){return Q&&(Q.profile&&Q.profile.sub?c.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",Q.profile.sub):c.Log.info("UserManager.signinPopup: no sub")),Q})):(c.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},V.prototype.signinPopupCallback=function(k){return this._signinCallback(k,this._popupNavigator).then(function(A){return A&&(A.profile&&A.profile.sub?c.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",A.profile.sub):c.Log.info("UserManager.signinPopupCallback: no sub")),A}).catch(function(A){c.Log.error(A.message)})},V.prototype.signinSilent=function(){var k=this,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return A=Object.assign({},A),this._loadUser().then(function(Q){return Q&&Q.refresh_token?(A.refresh_token=Q.refresh_token,k._useRefreshToken(A)):(A.request_type="si:s",A.id_token_hint=A.id_token_hint||k.settings.includeIdTokenInSilentRenew&&Q&&Q.id_token,Q&&k._settings.validateSubOnSilentRenew&&(c.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",Q.profile.sub),A.current_sub=Q.profile.sub),k._signinSilentIframe(A))})},V.prototype._useRefreshToken=function(){var k=this,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(A).then(function(Q){return Q?Q.access_token?k._loadUser().then(function(re){if(re){var D=Promise.resolve();return Q.id_token&&(D=k._validateIdTokenFromTokenRefreshToken(re.profile,Q.id_token)),D.then(function(){return c.Log.debug("UserManager._useRefreshToken: refresh token response success"),re.id_token=Q.id_token||re.id_token,re.access_token=Q.access_token,re.refresh_token=Q.refresh_token||re.refresh_token,re.expires_in=Q.expires_in,k.storeUser(re).then(function(){return k._events.load(re),re})})}return null}):(c.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(c.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},V.prototype._validateIdTokenFromTokenRefreshToken=function(k,A){var Q=this;return this._metadataService.getIssuer().then(function(re){return Q.settings.getEpochTime().then(function(D){return Q._joseUtil.validateJwtAttributes(A,re,Q._settings.client_id,Q._settings.clockSkew,D).then(function(he){return he?he.sub!==k.sub?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):he.auth_time&&he.auth_time!==k.auth_time?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):he.azp&&he.azp!==k.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!he.azp&&k.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},V.prototype._signinSilentIframe=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=k.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return A?(k.redirect_uri=A,k.prompt=k.prompt||"none",this._signin(k,this._iframeNavigator,{startUrl:A,silentRequestTimeout:k.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(Q){return Q&&(Q.profile&&Q.profile.sub?c.Log.info("UserManager.signinSilent: successful, signed in sub: ",Q.profile.sub):c.Log.info("UserManager.signinSilent: no sub")),Q})):(c.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},V.prototype.signinSilentCallback=function(k){return this._signinCallback(k,this._iframeNavigator).then(function(A){return A&&(A.profile&&A.profile.sub?c.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",A.profile.sub):c.Log.info("UserManager.signinSilentCallback: no sub")),A})},V.prototype.signinCallback=function(k){var A=this;return this.readSigninResponseState(k).then(function(Q){var re=Q.state;return Q.response,re.request_type==="si:r"?A.signinRedirectCallback(k):re.request_type==="si:p"?A.signinPopupCallback(k):re.request_type==="si:s"?A.signinSilentCallback(k):Promise.reject(new Error("invalid response_type in state"))})},V.prototype.signoutCallback=function(k,A){var Q=this;return this.readSignoutResponseState(k).then(function(re){var D=re.state,he=re.response;return D?D.request_type==="so:r"?Q.signoutRedirectCallback(k):D.request_type==="so:p"?Q.signoutPopupCallback(k,A):Promise.reject(new Error("invalid response_type in state")):he})},V.prototype.querySessionStatus=function(){var k=this,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(A=Object.assign({},A)).request_type="si:s";var Q=A.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return Q?(A.redirect_uri=Q,A.prompt="none",A.response_type=A.response_type||this.settings.query_status_response_type,A.scope=A.scope||"openid",A.skipUserInfo=!0,this._signinStart(A,this._iframeNavigator,{startUrl:Q,silentRequestTimeout:A.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(re){return k.processSigninResponse(re.url).then(function(D){if(c.Log.debug("UserManager.querySessionStatus: got signin response"),D.session_state&&D.profile.sub)return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",D.profile.sub),{session_state:D.session_state,sub:D.profile.sub,sid:D.profile.sid};c.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(D){if(D.session_state&&k.settings.monitorAnonymousSession&&(D.message=="login_required"||D.message=="consent_required"||D.message=="interaction_required"||D.message=="account_selection_required"))return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:D.session_state};throw D})})):(c.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},V.prototype._signin=function(k,A){var Q=this,re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(k,A,re).then(function(D){return Q._signinEnd(D.url,k)})},V.prototype._signinStart=function(k,A){var Q=this,re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return A.prepare(re).then(function(D){return c.Log.debug("UserManager._signinStart: got navigator window handle"),Q.createSigninRequest(k).then(function(he){return c.Log.debug("UserManager._signinStart: got signin request"),re.url=he.url,re.id=he.state.id,D.navigate(re)}).catch(function(he){throw D.close&&(c.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),D.close()),he})})},V.prototype._signinEnd=function(k){var A=this,Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(k).then(function(re){c.Log.debug("UserManager._signinEnd: got signin response");var D=new f.User(re);if(Q.current_sub){if(Q.current_sub!==D.profile.sub)return c.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",D.profile.sub),Promise.reject(new Error("login_required"));c.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return A.storeUser(D).then(function(){return c.Log.debug("UserManager._signinEnd: user stored"),A._events.load(D),D})})},V.prototype._signinCallback=function(k,A){c.Log.debug("UserManager._signinCallback");var Q=this._settings.response_mode==="query"||!this._settings.response_mode&&F.SigninRequest.isCode(this._settings.response_type)?"?":"#";return A.callback(k,void 0,Q)},V.prototype.signoutRedirect=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(k=Object.assign({},k)).request_type="so:r";var A=k.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;A&&(k.post_logout_redirect_uri=A);var Q={useReplaceToNavigate:k.useReplaceToNavigate};return this._signoutStart(k,this._redirectNavigator,Q).then(function(){c.Log.info("UserManager.signoutRedirect: successful")})},V.prototype.signoutRedirectCallback=function(k){return this._signoutEnd(k||this._redirectNavigator.url).then(function(A){return c.Log.info("UserManager.signoutRedirectCallback: successful"),A})},V.prototype.signoutPopup=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(k=Object.assign({},k)).request_type="so:p";var A=k.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return k.post_logout_redirect_uri=A,k.display="popup",k.post_logout_redirect_uri&&(k.state=k.state||{}),this._signout(k,this._popupNavigator,{startUrl:A,popupWindowFeatures:k.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:k.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){c.Log.info("UserManager.signoutPopup: successful")})},V.prototype.signoutPopupCallback=function(k,A){return A===void 0&&typeof k=="boolean"&&(A=k,k=null),this._popupNavigator.callback(k,A,"?").then(function(){c.Log.info("UserManager.signoutPopupCallback: successful")})},V.prototype._signout=function(k,A){var Q=this,re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(k,A,re).then(function(D){return Q._signoutEnd(D.url)})},V.prototype._signoutStart=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=this,Q=arguments[1],re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Q.prepare(re).then(function(D){return c.Log.debug("UserManager._signoutStart: got navigator window handle"),A._loadUser().then(function(he){return c.Log.debug("UserManager._signoutStart: loaded current user from storage"),(A._settings.revokeAccessTokenOnSignout?A._revokeInternal(he):Promise.resolve()).then(function(){var pe=k.id_token_hint||he&&he.id_token;return pe&&(c.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),k.id_token_hint=pe),A.removeUser().then(function(){return c.Log.debug("UserManager._signoutStart: user removed, creating signout request"),A.createSignoutRequest(k).then(function(Ee){return c.Log.debug("UserManager._signoutStart: got signout request"),re.url=Ee.url,Ee.state&&(re.id=Ee.state.id),D.navigate(re)})})})}).catch(function(he){throw D.close&&(c.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),D.close()),he})})},V.prototype._signoutEnd=function(k){return this.processSignoutResponse(k).then(function(A){return c.Log.debug("UserManager._signoutEnd: got signout response"),A})},V.prototype.revokeAccessToken=function(){var k=this;return this._loadUser().then(function(A){return k._revokeInternal(A,!0).then(function(Q){if(Q)return c.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),A.access_token=null,A.refresh_token=null,A.expires_at=null,A.token_type=null,k.storeUser(A).then(function(){c.Log.debug("UserManager.revokeAccessToken: user stored"),k._events.load(A)})})}).then(function(){c.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},V.prototype._revokeInternal=function(k,A){var Q=this;if(k){var re=k.access_token,D=k.refresh_token;return this._revokeAccessTokenInternal(re,A).then(function(he){return Q._revokeRefreshTokenInternal(D,A).then(function(pe){return he||pe||c.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),he||pe})})}return Promise.resolve(!1)},V.prototype._revokeAccessTokenInternal=function(k,A){return!k||k.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(k,A).then(function(){return!0})},V.prototype._revokeRefreshTokenInternal=function(k,A){return k?this._tokenRevocationClient.revoke(k,A,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},V.prototype.startSilentRenew=function(){this._silentRenewService.start()},V.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},V.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(k){return k?(c.Log.debug("UserManager._loadUser: user storageString loaded"),f.User.fromStorageString(k)):(c.Log.debug("UserManager._loadUser: no user storageString"),null)})},V.prototype.storeUser=function(k){if(k){c.Log.debug("UserManager.storeUser: storing user");var A=k.toStorageString();return this._userStore.set(this._userStoreKey,A)}return c.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},a(V,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),V}(y.OidcClient)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManagerSettings=void 0;var a=function(){function C(x,I){for(var R=0;R<I.length;R++){var K=I[R];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(x,K.key,K)}}return function(x,I,R){return I&&C(x.prototype,I),R&&C(x,R),x}}(),c=(i(0),i(5)),y=i(40),l=i(41),f=i(43),g=i(6),d=i(1),w=i(8);function F(C,x){if(!(C instanceof x))throw new TypeError("Cannot call a class as a function")}function P(C,x){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?C:x}e.UserManagerSettings=function(C){function x(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=I.popup_redirect_uri,K=I.popup_post_logout_redirect_uri,V=I.popupWindowFeatures,X=I.popupWindowTarget,k=I.silent_redirect_uri,A=I.silentRequestTimeout,Q=I.automaticSilentRenew,re=Q!==void 0&&Q,D=I.validateSubOnSilentRenew,he=D!==void 0&&D,pe=I.includeIdTokenInSilentRenew,Ee=pe===void 0||pe,$e=I.monitorSession,je=$e===void 0||$e,Qe=I.monitorAnonymousSession,Ze=Qe!==void 0&&Qe,lt=I.checkSessionInterval,xe=lt===void 0?2e3:lt,Pe=I.stopCheckSessionOnError,it=Pe===void 0||Pe,Re=I.query_status_response_type,De=I.revokeAccessTokenOnSignout,ft=De!==void 0&&De,_t=I.accessTokenExpiringNotificationTime,Pt=_t===void 0?60:_t,ot=I.redirectNavigator,dt=ot===void 0?new y.RedirectNavigator:ot,Ve=I.popupNavigator,Be=Ve===void 0?new l.PopupNavigator:Ve,$=I.iframeNavigator,v=$===void 0?new f.IFrameNavigator:$,_=I.userStore,M=_===void 0?new g.WebStorageStateStore({store:d.Global.sessionStorage}):_;F(this,x);var J=P(this,C.call(this,arguments[0]));return J._popup_redirect_uri=R,J._popup_post_logout_redirect_uri=K,J._popupWindowFeatures=V,J._popupWindowTarget=X,J._silent_redirect_uri=k,J._silentRequestTimeout=A,J._automaticSilentRenew=re,J._validateSubOnSilentRenew=he,J._includeIdTokenInSilentRenew=Ee,J._accessTokenExpiringNotificationTime=Pt,J._monitorSession=je,J._monitorAnonymousSession=Ze,J._checkSessionInterval=xe,J._stopCheckSessionOnError=it,Re?J._query_status_response_type=Re:arguments[0]&&arguments[0].response_type?J._query_status_response_type=w.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":J._query_status_response_type="id_token",J._revokeAccessTokenOnSignout=ft,J._redirectNavigator=dt,J._popupNavigator=Be,J._iframeNavigator=v,J._userStore=M,J}return function(R,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof K);R.prototype=Object.create(K&&K.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),K&&(Object.setPrototypeOf?Object.setPrototypeOf(R,K):R.__proto__=K)}(x,C),a(x,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),x}(c.OidcClientSettings)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RedirectNavigator=void 0;var a=function(){function y(l,f){for(var g=0;g<f.length;g++){var d=f[g];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,f,g){return f&&y(l.prototype,f),g&&y(l,g),l}}(),c=i(0);e.RedirectNavigator=function(){function y(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,y)}return y.prototype.prepare=function(){return Promise.resolve(this)},y.prototype.navigate=function(f){return f&&f.url?(f.useReplaceToNavigate?window.location.replace(f.url):window.location=f.url,Promise.resolve()):(c.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},a(y,[{key:"url",get:function(){return window.location.href}}]),y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PopupNavigator=void 0;var a=i(0),c=i(42);e.PopupNavigator=function(){function y(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,y)}return y.prototype.prepare=function(f){var g=new c.PopupWindow(f);return Promise.resolve(g)},y.prototype.callback=function(f,g,d){a.Log.debug("PopupNavigator.callback");try{return c.PopupWindow.notifyOpener(f,g,d),Promise.resolve()}catch(w){return Promise.reject(w)}},y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PopupWindow=void 0;var a=function(){function l(f,g){for(var d=0;d<g.length;d++){var w=g[d];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,g,d){return g&&l(f.prototype,g),d&&l(f,d),f}}(),c=i(0),y=i(3);e.PopupWindow=function(){function l(f){var g=this;(function(P,C){if(!(P instanceof C))throw new TypeError("Cannot call a class as a function")})(this,l),this._promise=new Promise(function(F,P){g._resolve=F,g._reject=P});var d=f.popupWindowTarget||"_blank",w=f.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",d,w),this._popup&&(c.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return l.prototype.navigate=function(g){return this._popup?g&&g.url?(c.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=g.id,this._id&&(window["popupCallback_"+g.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=g.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},l.prototype._success=function(g){c.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(g)},l.prototype._error=function(g){c.Log.error("PopupWindow.error: ",g),this._cleanup(),this._reject(new Error(g))},l.prototype.close=function(){this._cleanup(!1)},l.prototype._cleanup=function(g){c.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!g&&this._popup.close(),this._popup=null},l.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},l.prototype._callback=function(g,d){this._cleanup(d),g?(c.Log.debug("PopupWindow.callback success"),this._success({url:g})):(c.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},l.notifyOpener=function(g,d,w){if(window.opener){if(g=g||window.location.href){var F=y.UrlUtility.parseUrlFragment(g,w);if(F.state){var P="popupCallback_"+F.state,C=window.opener[P];C?(c.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),C(g,d)):c.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else c.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else c.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},a(l,[{key:"promise",get:function(){return this._promise}}]),l}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IFrameNavigator=void 0;var a=i(0),c=i(44);e.IFrameNavigator=function(){function y(){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,y)}return y.prototype.prepare=function(f){var g=new c.IFrameWindow(f);return Promise.resolve(g)},y.prototype.callback=function(f){a.Log.debug("IFrameNavigator.callback");try{return c.IFrameWindow.notifyParent(f),Promise.resolve()}catch(g){return Promise.reject(g)}},y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IFrameWindow=void 0;var a=function(){function y(l,f){for(var g=0;g<f.length;g++){var d=f[g];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,f,g){return f&&y(l.prototype,f),g&&y(l,g),l}}(),c=i(0);e.IFrameWindow=function(){function y(l){var f=this;(function(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")})(this,y),this._promise=new Promise(function(g,d){f._resolve=g,f._reject=d}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return y.prototype.navigate=function(f){if(f&&f.url){var g=f.silentRequestTimeout||1e4;c.Log.debug("IFrameWindow.navigate: Using timeout of:",g),this._timer=window.setTimeout(this._timeout.bind(this),g),this._frame.src=f.url}else this._error("No url provided");return this.promise},y.prototype._success=function(f){this._cleanup(),c.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(f)},y.prototype._error=function(f){this._cleanup(),c.Log.error(f),this._reject(new Error(f))},y.prototype.close=function(){this._cleanup()},y.prototype._cleanup=function(){this._frame&&(c.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},y.prototype._timeout=function(){c.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},y.prototype._message=function(f){if(c.Log.debug("IFrameWindow.message"),this._timer&&f.origin===this._origin&&f.source===this._frame.contentWindow&&typeof f.data=="string"&&(f.data.startsWith("http://")||f.data.startsWith("https://"))){var g=f.data;g?this._success({url:g}):this._error("Invalid response from frame")}},y.notifyParent=function(f){c.Log.debug("IFrameWindow.notifyParent"),(f=f||window.location.href)&&(c.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(f,location.protocol+"//"+location.host))},a(y,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),y}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserManagerEvents=void 0;var a=i(0),c=i(16),y=i(17);e.UserManagerEvents=function(l){function f(g){(function(F,P){if(!(F instanceof P))throw new TypeError("Cannot call a class as a function")})(this,f);var d=function(F,P){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!P||typeof P!="object"&&typeof P!="function"?F:P}(this,l.call(this,g));return d._userLoaded=new y.Event("User loaded"),d._userUnloaded=new y.Event("User unloaded"),d._silentRenewError=new y.Event("Silent renew error"),d._userSignedIn=new y.Event("User signed in"),d._userSignedOut=new y.Event("User signed out"),d._userSessionChanged=new y.Event("User session changed"),d}return function(d,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);d.prototype=Object.create(w&&w.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(d,w):d.__proto__=w)}(f,l),f.prototype.load=function(d){var w=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];a.Log.debug("UserManagerEvents.load"),l.prototype.load.call(this,d),w&&this._userLoaded.raise(d)},f.prototype.unload=function(){a.Log.debug("UserManagerEvents.unload"),l.prototype.unload.call(this),this._userUnloaded.raise()},f.prototype.addUserLoaded=function(d){this._userLoaded.addHandler(d)},f.prototype.removeUserLoaded=function(d){this._userLoaded.removeHandler(d)},f.prototype.addUserUnloaded=function(d){this._userUnloaded.addHandler(d)},f.prototype.removeUserUnloaded=function(d){this._userUnloaded.removeHandler(d)},f.prototype.addSilentRenewError=function(d){this._silentRenewError.addHandler(d)},f.prototype.removeSilentRenewError=function(d){this._silentRenewError.removeHandler(d)},f.prototype._raiseSilentRenewError=function(d){a.Log.debug("UserManagerEvents._raiseSilentRenewError",d.message),this._silentRenewError.raise(d)},f.prototype.addUserSignedIn=function(d){this._userSignedIn.addHandler(d)},f.prototype.removeUserSignedIn=function(d){this._userSignedIn.removeHandler(d)},f.prototype._raiseUserSignedIn=function(){a.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},f.prototype.addUserSignedOut=function(d){this._userSignedOut.addHandler(d)},f.prototype.removeUserSignedOut=function(d){this._userSignedOut.removeHandler(d)},f.prototype._raiseUserSignedOut=function(){a.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},f.prototype.addUserSessionChanged=function(d){this._userSessionChanged.addHandler(d)},f.prototype.removeUserSessionChanged=function(d){this._userSessionChanged.removeHandler(d)},f.prototype._raiseUserSessionChanged=function(){a.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},f}(c.AccessTokenEvents)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0;var a=function(){function d(w,F){for(var P=0;P<F.length;P++){var C=F[P];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(w,C.key,C)}}return function(w,F,P){return F&&d(w.prototype,F),P&&d(w,P),w}}(),c=i(0),y=i(1),l=i(17);function f(d,w){if(!(d instanceof w))throw new TypeError("Cannot call a class as a function")}function g(d,w){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!w||typeof w!="object"&&typeof w!="function"?d:w}e.Timer=function(d){function w(F){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y.Global.timer,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;f(this,w);var x=g(this,d.call(this,F));return x._timer=P,x._nowFunc=C||function(){return Date.now()/1e3},x}return function(P,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);P.prototype=Object.create(C&&C.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(P,C):P.__proto__=C)}(w,d),w.prototype.init=function(P){P<=0&&(P=1),P=parseInt(P);var C=this.now+P;if(this.expiration===C&&this._timerHandle)c.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),c.Log.debug("Timer.init timer "+this._name+" for duration:",P),this._expiration=C;var x=5;P<x&&(x=P),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*x)}},w.prototype.cancel=function(){this._timerHandle&&(c.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},w.prototype._callback=function(){var P=this._expiration-this.now;c.Log.debug("Timer.callback; "+this._name+" timer expires in:",P),this._expiration<=this.now&&(this.cancel(),d.prototype.raise.call(this))},a(w,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),w}(l.Event)},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SilentRenewService=void 0;var a=i(0);e.SilentRenewService=function(){function c(y){(function(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")})(this,c),this._userManager=y}return c.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(l){}).catch(function(l){a.Log.error("SilentRenewService.start: Error from getUser:",l.message)}))},c.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},c.prototype._tokenExpiring=function(){var l=this;this._userManager.signinSilent().then(function(f){a.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(f){a.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",f.message),l._userManager.events._raiseSilentRenewError(f)})},c}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaPopupNavigator=void 0;var a=i(21);e.CordovaPopupNavigator=function(){function c(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(l){var f=new a.CordovaPopupWindow(l);return Promise.resolve(f)},c}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CordovaIFrameNavigator=void 0;var a=i(21);e.CordovaIFrameNavigator=function(){function c(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(l){l.popupWindowFeatures="hidden=yes";var f=new a.CordovaPopupWindow(l);return Promise.resolve(f)},c}()},function(s,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Version="1.11.6"}])})});var ys=ao((wp,gs)=>{ae();ce();ue();var ps;gs.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):s=>(ps||(ps=Promise.resolve())).then(s).catch(e=>setTimeout(()=>{throw e},0))});ae();ce();ue();ae();ce();ue();ae();ce();ue();globalThis.assertEnabled=!1;function kr(s,e){if(globalThis.assertEnabled){let i=Kt(s,e);if(i)throw console.error("\u{1F170}\uFE0F  Assertions failed because of:",i,"in this source:",s),new Error("Assertions failed",{cause:{problems:i,source:s}})}}function fr(s){return function(i,a,c){if(typeof i<"u"&&i!=null&&typeof s<"u")return Kt(i,s,a,c)}}function Cr(s){return function(i,a,c){return i==null||typeof i>"u"?vt("data is required",i,s||"any value",c):typeof s<"u"?Kt(i,s,a,c):!1}}function yo(...s){return function(i,a,c){for(let y of s)if(!Kt(i,y,a,c))return!1;return vt("data does not match oneOf patterns",i,s,c)}}function on(s,e,i){try{s instanceof URL&&(s=s.href);let a=new URL(s);if(a.href!=s&&!(a.href+"/"==s||a.href==s+"/"))return vt("data is not a valid url",s,"validURL",i)}catch{return vt("data is not a valid url",s,"validURL",i)}}function mo(s){return function(i,a,c){if(!(i instanceof s))return vt("data is not an instanceof pattern",i,s,c)}}function Kt(s,e,i,a=""){i||(i=s);let c=[];if(e===Boolean)typeof s!="boolean"&&!(s instanceof Boolean)&&c.push(vt("data is not a boolean",s,e,a));else if(e===Number)typeof s!="number"&&!(s instanceof Number)&&c.push(vt("data is not a number",s,e,a));else if(e===String)typeof s!="string"&&!(s instanceof String)&&c.push(vt("data is not a string",s,e,a)),s==""&&c.push(vt("data is an empty string, which is not allowed",s,e,a));else if(e instanceof RegExp)if(Array.isArray(s)){let y=s.findIndex((l,f)=>Kt(l,e,i,a+"["+f+"]"));y>-1&&c.push(vt("data["+y+"] does not match pattern",s[y],e,a+"["+y+"]"))}else typeof s>"u"?c.push(vt("data is undefined, should match pattern",s,e,a)):e.test(s)||c.push(vt("data does not match pattern",s,e,a));else if(e instanceof Function){let y=e(s,i,a);y&&(Array.isArray(y)?c=c.concat(y):c.push(y))}else if(Array.isArray(e)){Array.isArray(s)||c.push(vt("data is not an array",s,[],a));for(let y of e)for(let l of s.keys()){let f=Kt(s[l],y,i,a+"["+l+"]");Array.isArray(f)?c=c.concat(f):f&&c.push(f)}}else if(e&&typeof e=="object")if(Array.isArray(s)){let y=s.findIndex((l,f)=>Kt(l,e,i,a+"["+f+"]"));y>-1&&c.push(vt("data["+y+"] does not match pattern",s[y],e,a+"["+y+"]"))}else if(!s||typeof s!="object")c.push(vt("data is not an object, pattern is",s,e,a));else if(s instanceof URLSearchParams&&(s=Object.fromEntries(s)),e instanceof Function){let y=Kt(s,e,i,a);y&&(c=c.concat(y))}else for(let[y,l]of Object.entries(e)){let f=Kt(s[y],l,i,a+"."+y);f&&(c=c.concat(f))}else e!=s&&c.push(vt("data and pattern are not equal",s,e,a));return c.length?c:!1}function vt(s,e,i,a,c){let y={message:s,found:e,expected:i,path:a};return c&&(y.problems=c),y}ae();ce();ue();ae();ce();ue();ae();ce();ue();ae();ce();ue();ae();ce();ue();ae();ce();ue();var kt=crypto,dr=s=>s instanceof CryptoKey;var Ft=new TextEncoder,Lt=new TextDecoder,Ku=2**32;function sn(...s){let e=s.reduce((c,{length:y})=>c+y,0),i=new Uint8Array(e),a=0;for(let c of s)i.set(c,a),a+=c.length;return i}var Xs=s=>{let e=s;typeof e=="string"&&(e=Ft.encode(e));let i=32768,a=[];for(let c=0;c<e.length;c+=i)a.push(String.fromCharCode.apply(null,e.subarray(c,c+i)));return btoa(a.join(""))},pr=s=>Xs(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Qs=s=>{let e=atob(s),i=new Uint8Array(e.length);for(let a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return i},Ot=s=>{let e=s;e instanceof Uint8Array&&(e=Lt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Qs(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};ae();ce();ue();var nt=class extends Error{constructor(e,i){super(e,i),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}};nt.code="ERR_JOSE_GENERIC";var At=class extends nt{constructor(e,i,a="unspecified",c="unspecified"){super(e,{cause:{claim:a,reason:c,payload:i}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=a,this.reason=c,this.payload=i}};At.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var gr=class extends nt{constructor(e,i,a="unspecified",c="unspecified"){super(e,{cause:{claim:a,reason:c,payload:i}}),this.code="ERR_JWT_EXPIRED",this.claim=a,this.reason=c,this.payload=i}};gr.code="ERR_JWT_EXPIRED";var Ur=class extends nt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}};Ur.code="ERR_JOSE_ALG_NOT_ALLOWED";var Xe=class extends nt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}};Xe.code="ERR_JOSE_NOT_SUPPORTED";var $n=class extends nt{constructor(e="decryption operation failed",i){super(e,i),this.code="ERR_JWE_DECRYPTION_FAILED"}};$n.code="ERR_JWE_DECRYPTION_FAILED";var Gn=class extends nt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}};Gn.code="ERR_JWE_INVALID";var Oe=class extends nt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}};Oe.code="ERR_JWS_INVALID";var Vt=class extends nt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}};Vt.code="ERR_JWT_INVALID";var zn=class extends nt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}};zn.code="ERR_JWK_INVALID";var yr=class extends nt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}};yr.code="ERR_JWKS_INVALID";var nr=class extends nt{constructor(e="no applicable key found in the JSON Web Key Set",i){super(e,i),this.code="ERR_JWKS_NO_MATCHING_KEY"}};nr.code="ERR_JWKS_NO_MATCHING_KEY";var Nr=class extends nt{constructor(e="multiple matching keys found in the JSON Web Key Set",i){super(e,i),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}};Nr.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var Lr=class extends nt{constructor(e="request timed out",i){super(e,i),this.code="ERR_JWKS_TIMEOUT"}};Lr.code="ERR_JWKS_TIMEOUT";var Dr=class extends nt{constructor(e="signature verification failed",i){super(e,i),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};Dr.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";ae();ce();ue();function qt(s,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${s}`)}function an(s,e){return s.name===e}function Yn(s){return parseInt(s.name.slice(4),10)}function ea(s){switch(s){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function ta(s,e){if(e.length&&!e.some(i=>s.usages.includes(i))){let i="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let a=e.pop();i+=`one of ${e.join(", ")}, or ${a}.`}else e.length===2?i+=`one of ${e[0]} or ${e[1]}.`:i+=`${e[0]}.`;throw new TypeError(i)}}function vo(s,e,...i){switch(e){case"HS256":case"HS384":case"HS512":{if(!an(s.algorithm,"HMAC"))throw qt("HMAC");let a=parseInt(e.slice(2),10);if(Yn(s.algorithm.hash)!==a)throw qt(`SHA-${a}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!an(s.algorithm,"RSASSA-PKCS1-v1_5"))throw qt("RSASSA-PKCS1-v1_5");let a=parseInt(e.slice(2),10);if(Yn(s.algorithm.hash)!==a)throw qt(`SHA-${a}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!an(s.algorithm,"RSA-PSS"))throw qt("RSA-PSS");let a=parseInt(e.slice(2),10);if(Yn(s.algorithm.hash)!==a)throw qt(`SHA-${a}`,"algorithm.hash");break}case"EdDSA":{if(s.algorithm.name!=="Ed25519"&&s.algorithm.name!=="Ed448")throw qt("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!an(s.algorithm,"ECDSA"))throw qt("ECDSA");let a=ea(e);if(s.algorithm.namedCurve!==a)throw qt(a,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}ta(s,i)}ae();ce();ue();function _o(s,e,...i){if(i=i.filter(Boolean),i.length>2){let a=i.pop();s+=`one of type ${i.join(", ")}, or ${a}.`}else i.length===2?s+=`one of type ${i[0]} or ${i[1]}.`:s+=`of type ${i[0]}.`;return e==null?s+=` Received ${e}`:typeof e=="function"&&e.name?s+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor?.name&&(s+=` Received an instance of ${e.constructor.name}`),s}var Br=(s,...e)=>_o("Key must be ",s,...e);function Xn(s,e,...i){return _o(`Key for the ${s} algorithm must be `,e,...i)}ae();ce();ue();var Qn=s=>dr(s)?!0:s?.[Symbol.toStringTag]==="KeyObject",$t=["CryptoKey"];ae();ce();ue();var ra=(...s)=>{let e=s.filter(Boolean);if(e.length===0||e.length===1)return!0;let i;for(let a of e){let c=Object.keys(a);if(!i||i.size===0){i=new Set(c);continue}for(let y of c){if(i.has(y))return!1;i.add(y)}}return!0},un=ra;ae();ce();ue();function na(s){return typeof s=="object"&&s!==null}function gt(s){if(!na(s)||Object.prototype.toString.call(s)!=="[object Object]")return!1;if(Object.getPrototypeOf(s)===null)return!0;let e=s;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}ae();ce();ue();var cn=(s,e)=>{if(s.startsWith("RS")||s.startsWith("PS")){let{modulusLength:i}=e.algorithm;if(typeof i!="number"||i<2048)throw new TypeError(`${s} requires key modulusLength to be 2048 bits or larger`)}};ae();ce();ue();ae();ce();ue();function Wt(s){return gt(s)&&typeof s.kty=="string"}function wo(s){return s.kty!=="oct"&&typeof s.d=="string"}function So(s){return s.kty!=="oct"&&typeof s.d>"u"}function bo(s){return Wt(s)&&s.kty==="oct"&&typeof s.k=="string"}ae();ce();ue();function oa(s){let e,i;switch(s.kty){case"RSA":{switch(s.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${s.alg.slice(-3)}`},i=s.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.alg.slice(-3)}`},i=s.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(s.alg.slice(-3),10)||1}`},i=s.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(s.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},i=s.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},i=s.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},i=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:s.crv},i=s.d?["deriveBits"]:[];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(s.alg){case"EdDSA":e={name:s.crv},i=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:s.crv},i=s.d?["deriveBits"]:[];break;default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Xe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:i}}var sa=async s=>{if(!s.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:e,keyUsages:i}=oa(s),a=[e,s.ext??!1,s.key_ops??i],c={...s};return delete c.alg,delete c.use,kt.subtle.importKey("jwk",c,...a)},hn=sa;var Eo=s=>Ot(s),mr,vr,xo=s=>s?.[Symbol.toStringTag]==="KeyObject",ln=async(s,e,i,a,c=!1)=>{let y=s.get(e);if(y?.[a])return y[a];let l=await hn({...i,alg:a});return c&&Object.freeze(e),y?y[a]=l:s.set(e,{[a]:l}),l},aa=(s,e)=>{if(xo(s)){let i=s.export({format:"jwk"});return delete i.d,delete i.dp,delete i.dq,delete i.p,delete i.q,delete i.qi,i.k?Eo(i.k):(vr||(vr=new WeakMap),ln(vr,s,i,e))}return Wt(s)?s.k?Ot(s.k):(vr||(vr=new WeakMap),ln(vr,s,s,e,!0)):s},ua=(s,e)=>{if(xo(s)){let i=s.export({format:"jwk"});return i.k?Eo(i.k):(mr||(mr=new WeakMap),ln(mr,s,i,e))}return Wt(s)?s.k?Ot(s.k):(mr||(mr=new WeakMap),ln(mr,s,s,e,!0)):s},Zn={normalizePublicKey:aa,normalizePrivateKey:ua};ae();ce();ue();async function fn(s,e){if(!gt(s))throw new TypeError("JWK must be an object");switch(e||(e=s.alg),s.kty){case"oct":if(typeof s.k!="string"||!s.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Ot(s.k);case"RSA":if(s.oth!==void 0)throw new Xe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return hn({...s,alg:e});default:throw new Xe('Unsupported "kty" (Key Type) Parameter value')}}ae();ce();ue();var _r=s=>s?.[Symbol.toStringTag],ei=(s,e,i)=>{if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&e.key_ops.includes?.(i)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${i}`);if(e.alg!==void 0&&e.alg!==s)throw new TypeError(`Invalid key for this operation, when present its alg must be ${s}`);return!0},ca=(s,e,i,a)=>{if(!(e instanceof Uint8Array)){if(a&&Wt(e)){if(bo(e)&&ei(s,e,i))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Qn(e))throw new TypeError(Xn(s,e,...$t,"Uint8Array",a?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${_r(e)} instances for symmetric algorithms must be of type "secret"`)}},ha=(s,e,i,a)=>{if(a&&Wt(e))switch(i){case"sign":if(wo(e)&&ei(s,e,i))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(So(e)&&ei(s,e,i))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Qn(e))throw new TypeError(Xn(s,e,...$t,a?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${_r(e)} instances for asymmetric algorithms must not be of type "secret"`);if(i==="sign"&&e.type==="public")throw new TypeError(`${_r(e)} instances for asymmetric algorithm signing must be of type "private"`);if(i==="decrypt"&&e.type==="public")throw new TypeError(`${_r(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&i==="verify"&&e.type==="private")throw new TypeError(`${_r(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&i==="encrypt"&&e.type==="private")throw new TypeError(`${_r(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Fo(s,e,i,a){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?ca(e,i,a,s):ha(e,i,a,s)}var Zc=Fo.bind(void 0,!1),Or=Fo.bind(void 0,!0);ae();ce();ue();function la(s,e,i,a,c){if(c.crit!==void 0&&a?.crit===void 0)throw new s('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||a.crit===void 0)return new Set;if(!Array.isArray(a.crit)||a.crit.length===0||a.crit.some(l=>typeof l!="string"||l.length===0))throw new s('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let y;i!==void 0?y=new Map([...Object.entries(i),...e.entries()]):y=e;for(let l of a.crit){if(!y.has(l))throw new Xe(`Extension Header Parameter "${l}" is not recognized`);if(c[l]===void 0)throw new s(`Extension Header Parameter "${l}" is missing`);if(y.get(l)&&a[l]===void 0)throw new s(`Extension Header Parameter "${l}" MUST be integrity protected`)}return new Set(a.crit)}var dn=la;ae();ce();ue();var fa=(s,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(i=>typeof i!="string")))throw new TypeError(`"${s}" option must be an array of strings`);if(e)return new Set(e)},Ao=fa;ae();ce();ue();ae();ce();ue();var da=async s=>{if(s instanceof Uint8Array)return{kty:"oct",k:pr(s)};if(!dr(s))throw new TypeError(Br(s,...$t,"Uint8Array"));if(!s.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:e,key_ops:i,alg:a,use:c,...y}=await kt.subtle.exportKey("jwk",s);return y},Io=da;async function pn(s){return Io(s)}ae();ce();ue();ae();ce();ue();ae();ce();ue();ae();ce();ue();function jr(s,e){let i=`SHA-${s.slice(-3)}`;switch(s){case"HS256":case"HS384":case"HS512":return{hash:i,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:i,name:"RSA-PSS",saltLength:s.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:i,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:i,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Xe(`alg ${s} is not supported either by JOSE or your javascript runtime`)}}ae();ce();ue();async function Mr(s,e,i){if(i==="sign"&&(e=await Zn.normalizePrivateKey(e,s)),i==="verify"&&(e=await Zn.normalizePublicKey(e,s)),dr(e))return vo(e,s,i),e;if(e instanceof Uint8Array){if(!s.startsWith("HS"))throw new TypeError(Br(e,...$t));return kt.subtle.importKey("raw",e,{hash:`SHA-${s.slice(-3)}`,name:"HMAC"},!1,[i])}throw new TypeError(Br(e,...$t,"Uint8Array","JSON Web Key"))}var pa=async(s,e,i,a)=>{let c=await Mr(s,e,"verify");cn(s,c);let y=jr(s,c.algorithm);try{return await kt.subtle.verify(y,c,i,a)}catch{return!1}},Po=pa;async function To(s,e,i){if(!gt(s))throw new Oe("Flattened JWS must be an object");if(s.protected===void 0&&s.header===void 0)throw new Oe('Flattened JWS must have either of the "protected" or "header" members');if(s.protected!==void 0&&typeof s.protected!="string")throw new Oe("JWS Protected Header incorrect type");if(s.payload===void 0)throw new Oe("JWS Payload missing");if(typeof s.signature!="string")throw new Oe("JWS Signature missing or incorrect type");if(s.header!==void 0&&!gt(s.header))throw new Oe("JWS Unprotected Header incorrect type");let a={};if(s.protected)try{let I=Ot(s.protected);a=JSON.parse(Lt.decode(I))}catch{throw new Oe("JWS Protected Header is invalid")}if(!un(a,s.header))throw new Oe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let c={...a,...s.header},y=dn(Oe,new Map([["b64",!0]]),i?.crit,a,c),l=!0;if(y.has("b64")&&(l=a.b64,typeof l!="boolean"))throw new Oe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:f}=c;if(typeof f!="string"||!f)throw new Oe('JWS "alg" (Algorithm) Header Parameter missing or invalid');let g=i&&Ao("algorithms",i.algorithms);if(g&&!g.has(f))throw new Ur('"alg" (Algorithm) Header Parameter value not allowed');if(l){if(typeof s.payload!="string")throw new Oe("JWS Payload must be a string")}else if(typeof s.payload!="string"&&!(s.payload instanceof Uint8Array))throw new Oe("JWS Payload must be a string or an Uint8Array instance");let d=!1;typeof e=="function"?(e=await e(a,s),d=!0,Or(f,e,"verify"),Wt(e)&&(e=await fn(e,f))):Or(f,e,"verify");let w=sn(Ft.encode(s.protected??""),Ft.encode("."),typeof s.payload=="string"?Ft.encode(s.payload):s.payload),F;try{F=Ot(s.signature)}catch{throw new Oe("Failed to base64url decode the signature")}if(!await Po(f,e,F,w))throw new Dr;let C;if(l)try{C=Ot(s.payload)}catch{throw new Oe("Failed to base64url decode the payload")}else typeof s.payload=="string"?C=Ft.encode(s.payload):C=s.payload;let x={payload:C};return s.protected!==void 0&&(x.protectedHeader=a),s.header!==void 0&&(x.unprotectedHeader=s.header),d?{...x,key:e}:x}async function Ro(s,e,i){if(s instanceof Uint8Array&&(s=Lt.decode(s)),typeof s!="string")throw new Oe("Compact JWS must be a string or Uint8Array");let{0:a,1:c,2:y,length:l}=s.split(".");if(l!==3)throw new Oe("Invalid Compact JWS");let f=await To({payload:c,protected:a,signature:y},e,i),g={payload:f.payload,protectedHeader:f.protectedHeader};return typeof e=="function"?{...g,key:f.key}:g}ae();ce();ue();ae();ce();ue();ae();ce();ue();var jt=s=>Math.floor(s.getTime()/1e3);ae();ce();ue();var ga=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,ir=s=>{let e=ga.exec(s);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let i=parseFloat(e[2]),a=e[3].toLowerCase(),c;switch(a){case"sec":case"secs":case"second":case"seconds":case"s":c=Math.round(i);break;case"minute":case"minutes":case"min":case"mins":case"m":c=Math.round(i*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":c=Math.round(i*3600);break;case"day":case"days":case"d":c=Math.round(i*86400);break;case"week":case"weeks":case"w":c=Math.round(i*604800);break;default:c=Math.round(i*31557600);break}return e[1]==="-"||e[4]==="ago"?-c:c};var ko=s=>s.toLowerCase().replace(/^application\//,""),ya=(s,e)=>typeof s=="string"?e.includes(s):Array.isArray(s)?e.some(Set.prototype.has.bind(new Set(s))):!1,Co=(s,e,i={})=>{let a;try{a=JSON.parse(Lt.decode(e))}catch{}if(!gt(a))throw new Vt("JWT Claims Set must be a top-level JSON object");let{typ:c}=i;if(c&&(typeof s.typ!="string"||ko(s.typ)!==ko(c)))throw new At('unexpected "typ" JWT header value',a,"typ","check_failed");let{requiredClaims:y=[],issuer:l,subject:f,audience:g,maxTokenAge:d}=i,w=[...y];d!==void 0&&w.push("iat"),g!==void 0&&w.push("aud"),f!==void 0&&w.push("sub"),l!==void 0&&w.push("iss");for(let x of new Set(w.reverse()))if(!(x in a))throw new At(`missing required "${x}" claim`,a,x,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(a.iss))throw new At('unexpected "iss" claim value',a,"iss","check_failed");if(f&&a.sub!==f)throw new At('unexpected "sub" claim value',a,"sub","check_failed");if(g&&!ya(a.aud,typeof g=="string"?[g]:g))throw new At('unexpected "aud" claim value',a,"aud","check_failed");let F;switch(typeof i.clockTolerance){case"string":F=ir(i.clockTolerance);break;case"number":F=i.clockTolerance;break;case"undefined":F=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:P}=i,C=jt(P||new Date);if((a.iat!==void 0||d)&&typeof a.iat!="number")throw new At('"iat" claim must be a number',a,"iat","invalid");if(a.nbf!==void 0){if(typeof a.nbf!="number")throw new At('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>C+F)throw new At('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(a.exp!==void 0){if(typeof a.exp!="number")throw new At('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=C-F)throw new gr('"exp" claim timestamp check failed',a,"exp","check_failed")}if(d){let x=C-a.iat,I=typeof d=="number"?d:ir(d);if(x-F>I)throw new gr('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(x<0-F)throw new At('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function ti(s,e,i){let a=await Ro(s,e,i);if(a.protectedHeader.crit?.includes("b64")&&a.protectedHeader.b64===!1)throw new Vt("JWTs MUST NOT use unencoded payload");let y={payload:Co(a.protectedHeader,a.payload,i),protectedHeader:a.protectedHeader};return typeof e=="function"?{...y,key:a.key}:y}ae();ce();ue();ae();ce();ue();ae();ce();ue();var ma=async(s,e,i)=>{let a=await Mr(s,e,"sign");cn(s,a);let c=await kt.subtle.sign(jr(s,a.algorithm),a,i);return new Uint8Array(c)},Uo=ma;var gn=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,i){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Oe("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!un(this._protectedHeader,this._unprotectedHeader))throw new Oe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...this._protectedHeader,...this._unprotectedHeader},c=dn(Oe,new Map([["b64",!0]]),i?.crit,this._protectedHeader,a),y=!0;if(c.has("b64")&&(y=this._protectedHeader.b64,typeof y!="boolean"))throw new Oe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=a;if(typeof l!="string"||!l)throw new Oe('JWS "alg" (Algorithm) Header Parameter missing or invalid');Or(l,e,"sign");let f=this._payload;y&&(f=Ft.encode(pr(f)));let g;this._protectedHeader?g=Ft.encode(pr(JSON.stringify(this._protectedHeader))):g=Ft.encode("");let d=sn(g,Ft.encode("."),f),w=await Uo(l,e,d),F={signature:pr(w),payload:""};return y&&(F.payload=Lt.decode(f)),this._unprotectedHeader&&(F.header=this._unprotectedHeader),this._protectedHeader&&(F.protected=Lt.decode(g)),F}};var yn=class{constructor(e){this._flattened=new gn(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,i){let a=await this._flattened.sign(e,i);if(a.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${a.protected}.${a.payload}.${a.signature}`}};ae();ce();ue();ae();ce();ue();function or(s,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${s} input`);return e}var mn=class{constructor(e={}){if(!gt(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:or("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:or("setNotBefore",jt(e))}:this._payload={...this._payload,nbf:jt(new Date)+ir(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:or("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:or("setExpirationTime",jt(e))}:this._payload={...this._payload,exp:jt(new Date)+ir(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:jt(new Date)}:e instanceof Date?this._payload={...this._payload,iat:or("setIssuedAt",jt(e))}:typeof e=="string"?this._payload={...this._payload,iat:or("setIssuedAt",jt(new Date)+ir(e))}:this._payload={...this._payload,iat:or("setIssuedAt",e)},this}};var Hr=class extends mn{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,i){let a=new yn(Ft.encode(JSON.stringify(this._payload)));if(a.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Vt("JWTs MUST NOT use unencoded payload");return a.sign(e,i)}};ae();ce();ue();function va(s){switch(typeof s=="string"&&s.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Xe('Unsupported "alg" value for a JSON Web Key Set')}}function _a(s){return s&&typeof s=="object"&&Array.isArray(s.keys)&&s.keys.every(wa)}function wa(s){return gt(s)}function Lo(s){return typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}var ri=class{constructor(e){if(this._cached=new WeakMap,!_a(e))throw new yr("JSON Web Key Set malformed");this._jwks=Lo(e)}async getKey(e,i){let{alg:a,kid:c}={...e,...i?.header},y=va(a),l=this._jwks.keys.filter(d=>{let w=y===d.kty;if(w&&typeof c=="string"&&(w=c===d.kid),w&&typeof d.alg=="string"&&(w=a===d.alg),w&&typeof d.use=="string"&&(w=d.use==="sig"),w&&Array.isArray(d.key_ops)&&(w=d.key_ops.includes("verify")),w&&a==="EdDSA"&&(w=d.crv==="Ed25519"||d.crv==="Ed448"),w)switch(a){case"ES256":w=d.crv==="P-256";break;case"ES256K":w=d.crv==="secp256k1";break;case"ES384":w=d.crv==="P-384";break;case"ES512":w=d.crv==="P-521";break}return w}),{0:f,length:g}=l;if(g===0)throw new nr;if(g!==1){let d=new Nr,{_cached:w}=this;throw d[Symbol.asyncIterator]=async function*(){for(let F of l)try{yield await No(w,F,a)}catch{}},d}return No(this._cached,f,a)}};async function No(s,e,i){let a=s.get(e)||s.set(e,{}).get(e);if(a[i]===void 0){let c=await fn({...e,ext:!0},i);if(c instanceof Uint8Array||c.type!=="public")throw new yr("JSON Web Key Set members must be public keys");a[i]=c}return a[i]}function ni(s){let e=new ri(s),i=async(a,c)=>e.getKey(a,c);return Object.defineProperties(i,{jwks:{value:()=>Lo(e._jwks),enumerable:!0,configurable:!1,writable:!1}}),i}ae();ce();ue();ae();ce();ue();var Sa=async(s,e,i)=>{let a,c,y=!1;typeof AbortController=="function"&&(a=new AbortController,c=setTimeout(()=>{y=!0,a.abort()},e));let l=await fetch(s.href,{signal:a?a.signal:void 0,redirect:"manual",headers:i.headers}).catch(f=>{throw y?new Lr:f});if(c!==void 0&&clearTimeout(c),l.status!==200)throw new nt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await l.json()}catch{throw new nt("Failed to parse the JSON Web Key Set HTTP response as JSON")}},Do=Sa;function ba(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}var ii;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(ii="jose/v5.9.6");var vn=Symbol();function Ea(s,e){return!(typeof s!="object"||s===null||!("uat"in s)||typeof s.uat!="number"||Date.now()-s.uat>=e||!("jwks"in s)||!gt(s.jwks)||!Array.isArray(s.jwks.keys)||!Array.prototype.every.call(s.jwks.keys,gt))}var oi=class{constructor(e,i){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:i?.agent,headers:i?.headers},this._timeoutDuration=typeof i?.timeoutDuration=="number"?i?.timeoutDuration:5e3,this._cooldownDuration=typeof i?.cooldownDuration=="number"?i?.cooldownDuration:3e4,this._cacheMaxAge=typeof i?.cacheMaxAge=="number"?i?.cacheMaxAge:6e5,i?.[vn]!==void 0&&(this._cache=i?.[vn],Ea(i?.[vn],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=ni(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,i){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(e,i)}catch(a){if(a instanceof nr&&this.coolingDown()===!1)return await this.reload(),this._local(e,i);throw a}}async reload(){this._pendingFetch&&ba()&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);ii&&!e.has("User-Agent")&&(e.set("User-Agent",ii),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=Do(this._url,this._timeoutDuration,this._options).then(i=>{this._local=ni(i),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=i),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(i=>{throw this._pendingFetch=void 0,i})),await this._pendingFetch}};function si(s,e){let i=new oi(s,e),a=async(c,y)=>i.getKey(c,y);return Object.defineProperties(a,{coolingDown:{get:()=>i.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>i.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>i.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!i._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>i._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a}ae();ce();ue();ae();ce();ue();function ai(s){let e=s?.modulusLength??2048;if(typeof e!="number"||e<2048)throw new Xe("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return e}async function Bo(s,e){let i,a;switch(s){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ai(e)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ai(e)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(s.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ai(e)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"EdDSA":{a=["sign","verify"];let c=e?.crv??"Ed25519";switch(c){case"Ed25519":case"Ed448":i={name:c};break;default:throw new Xe("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let c=e?.crv??"P-256";switch(c){case"P-256":case"P-384":case"P-521":{i={name:"ECDH",namedCurve:c};break}case"X25519":case"X448":i={name:c};break;default:throw new Xe("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new Xe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return kt.subtle.generateKey(i,e?.extractable??!1,a)}async function ui(s,e){return Bo(s,e)}ae();ce();ue();ae();ce();ue();var yt=[];for(_n=0;_n<256;++_n)yt.push((_n+256).toString(16).slice(1));var _n;function Oo(s,e=0){return(yt[s[e+0]]+yt[s[e+1]]+yt[s[e+2]]+yt[s[e+3]]+"-"+yt[s[e+4]]+yt[s[e+5]]+"-"+yt[s[e+6]]+yt[s[e+7]]+"-"+yt[s[e+8]]+yt[s[e+9]]+"-"+yt[s[e+10]]+yt[s[e+11]]+yt[s[e+12]]+yt[s[e+13]]+yt[s[e+14]]+yt[s[e+15]]).toLowerCase()}ae();ce();ue();var wn,xa=new Uint8Array(16);function ci(){if(!wn&&(wn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wn(xa)}ae();ce();ue();ae();ce();ue();var Fa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hi={randomUUID:Fa};function Aa(s,e,i){if(hi.randomUUID&&!e&&!s)return hi.randomUUID();s=s||{};var a=s.random||(s.rng||ci)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){i=i||0;for(var c=0;c<16;++c)e[i+c]=a[c];return e}return Oo(a)}var wr=Aa;var pi="solidClientAuthn:",Kr=["ES256","RS256"],tt={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},jo=5,Ia="openid",Pa="offline_access",Ta="webid",In=[Ia,Pa,Ta].join(" "),Sn=class{constructor(e){this.handleables=e,this.handleables=e}async getProperHandler(e){let i=await Promise.all(this.handleables.map(a=>a.canHandle(...e)));for(let a=0;a<i.length;a+=1)if(i[a])return this.handleables[a];return null}async canHandle(...e){return await this.getProperHandler(e)!==null}async handle(...e){let i=await this.getProperHandler(e);if(i)return i.handle(...e);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map(a=>{try{return JSON.stringify(a)}catch{return a.toString()}}).join(", ")}`)}};async function gi(s,e,i,a){let c,y;try{let{payload:l}=await ti(s,si(new URL(e)),{issuer:i,audience:a});c=l}catch(l){throw new Error(`Token verification failed: ${l.stack}`)}if(typeof c.azp=="string"&&(y=c.azp),typeof c.webid=="string")return{webId:c.webid,clientId:y};if(typeof c.sub!="string")throw new Error(`The token ${JSON.stringify(c)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(c.sub),{webId:c.sub,clientId:y}}catch(l){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${c.sub}] is invalid as a URL - error [${l}].`)}}function yi(s){try{let e=new URL(s),i=!e.searchParams.has("code")&&!e.searchParams.has("state"),a=e.hash==="";return i&&a}catch{return!1}}function Pn(s){let e=new URL(s);return e.searchParams.delete("state"),e.searchParams.delete("code"),e.searchParams.delete("error"),e.searchParams.delete("error_description"),e.searchParams.delete("iss"),e}function Ra(s,e){return typeof s=="boolean"?!!s:!!e}var bn=class{constructor(e,i){this.storageUtility=e,this.redirector=i,this.parametersGuard=a=>a.issuerConfiguration.grantTypesSupported!==void 0&&a.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&a.redirectUrl!==void 0,this.storageUtility=e,this.redirector=i}async canHandle(e){return this.parametersGuard(e)}async handleRedirect({oidcLoginOptions:e,state:i,codeVerifier:a,targetUrl:c}){if(!this.parametersGuard(e))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(i,{sessionId:e.sessionId}),this.storageUtility.setForUser(e.sessionId,{codeVerifier:a,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:(!!e.dpop).toString(),keepAlive:Ra(e.keepAlive,!0).toString()})]),this.redirector.redirect(c,{handleRedirect:e.handleRedirect})}},fi=class{constructor(e){this.sessionInfoManager=e,this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}},di=class{constructor(e){this.redirector=e,this.redirector=e}async canHandle(e,i){return i?.logoutType==="idp"}async handle(e,i){if(i?.logoutType!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(i.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(i.toLogoutUrl(i),{handleRedirect:i.handleRedirect})}},En=class{constructor(e,i){this.handlers=[new fi(e),new di(i)]}async canHandle(){return!0}async handle(e,i){for(let a of this.handlers)await a.canHandle(e,i)&&await a.handle(e,i)}};function mi(){return{isLoggedIn:!1,sessionId:wr(),fetch:(...s)=>fetch(...s)}}async function vi(s,e){await Promise.all([e.deleteAllUserData(s,{secure:!1}),e.deleteAllUserData(s,{secure:!0})])}var xn=class{constructor(e){this.storageUtility=e,this.storageUtility=e}update(e,i){throw new Error("Not Implemented")}get(e){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(e){return vi(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}};function ka({endSessionEndpoint:s,idTokenHint:e,postLogoutRedirectUri:i,state:a}){let c=new URL(s);return e!==void 0&&c.searchParams.append("id_token_hint",e),i!==void 0&&(c.searchParams.append("post_logout_redirect_uri",i),a!==void 0&&c.searchParams.append("state",a)),c.toString()}function Ko({endSessionEndpoint:s,idTokenHint:e}){if(s!==void 0)return function({state:a,postLogoutUrl:c}){return ka({endSessionEndpoint:s,idTokenHint:e,state:a,postLogoutRedirectUri:c})}}function Vo(s){return typeof s=="string"&&["DPoP","Bearer"].includes(s)}function qo(s){try{return new URL(s),!0}catch{return!1}}function Wo(s,e){var i;return(i=e.find(a=>s.includes(a)))!==null&&i!==void 0?i:null}function Ca(s){return s.clientId!==void 0&&!qo(s.clientId)}function Ua(s,e){return e.scopesSupported.includes("webid")&&s.clientId!==void 0&&qo(s.clientId)}function Jo(s){return typeof s=="string"&&["dynamic","static","solid-oidc"].includes(s)}async function $o(s,e,i,a){let c;if(Ua(s,e))c={clientId:s.clientId,clientName:s.clientName,clientType:"solid-oidc"};else if(Ca(s))c={clientId:s.clientId,clientSecret:s.clientSecret,clientName:s.clientName,clientType:"static"};else return a.getClient({sessionId:s.sessionId,clientName:s.clientName,redirectUrl:s.redirectUrl},e);let y={clientId:c.clientId,clientType:c.clientType};return c.clientType==="static"&&(y.clientSecret=c.clientSecret),c.clientName&&(y.clientName=c.clientName),await i.setForUser(s.sessionId,y),c}var Mo=(s,e)=>fetch(s,e),Fn=class{constructor(e,i,a,c,y){this.loginHandler=e,this.redirectHandler=i,this.logoutHandler=a,this.sessionInfoManager=c,this.issuerConfigFetcher=y,this.fetch=Mo,this.logout=async(l,f)=>{await this.logoutHandler.handle(l,f?.logoutType==="idp"?{...f,toLogoutUrl:this.boundLogout}:f),this.fetch=Mo,delete this.boundLogout},this.getSessionInfo=async l=>this.sessionInfoManager.get(l),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.loginHandler=e,this.redirectHandler=i,this.logoutHandler=a,this.sessionInfoManager=c,this.issuerConfigFetcher=y}};async function _i(s,e,i){try{let[a,c,y,l,f]=await Promise.all([e.getForUser(s,"issuer",{errorIfNull:!0}),e.getForUser(s,"codeVerifier"),e.getForUser(s,"redirectUrl"),e.getForUser(s,"dpop",{errorIfNull:!0}),e.getForUser(s,"keepAlive")]);await e.deleteForUser(s,"codeVerifier");let g=await i.fetchConfig(a);return{codeVerifier:c,redirectUrl:y,issuerConfig:g,dpop:l==="true",keepAlive:typeof f=="string"?f==="true":!0}}catch(a){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${s}]: ${a}`)}}async function Go(s,e,i,a,c,y,l,f){y!==void 0&&await s.setForUser(e,{refreshToken:y},{secure:l}),i!==void 0&&await s.setForUser(e,{webId:i},{secure:l}),a!==void 0&&await s.setForUser(e,{clientId:a},{secure:l}),c!==void 0&&await s.setForUser(e,{isLoggedIn:c},{secure:l}),f!==void 0&&await s.setForUser(e,{publicKey:JSON.stringify(f.publicKey),privateKey:JSON.stringify(await pn(f.privateKey))},{secure:l})}var An=class{constructor(e,i){this.secureStorage=e,this.insecureStorage=i,this.secureStorage=e,this.insecureStorage=i}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,i){let a=await(i?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(a===void 0)return{};try{return JSON.parse(a)}catch{throw new Error(`Data for user [${e}] in [${i?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${a}`)}}async setUserData(e,i,a){await(a?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(i))}async get(e,i){let a=await(i?.secure?this.secureStorage:this.insecureStorage).get(e);if(a===void 0&&i?.errorIfNull)throw new Error(`[${e}] is not stored`);return a}async set(e,i,a){return(a?.secure?this.secureStorage:this.insecureStorage).set(e,i)}async delete(e,i){return(i?.secure?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,i,a){let c=await this.getUserData(e,a?.secure),y;if((!c||!c[i])&&(y=void 0),y=c[i],y===void 0&&a?.errorIfNull)throw new Error(`Field [${i}] for user [${e}] is not stored`);return y||void 0}async setForUser(e,i,a){let c;try{c=await this.getUserData(e,a?.secure)}catch{c={}}await this.setUserData(e,{...c,...i},a?.secure)}async deleteForUser(e,i,a){let c=await this.getUserData(e,a?.secure);delete c[i],await this.setUserData(e,c,a?.secure)}async deleteAllUserData(e,i){await(i?.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}},Vr=class{constructor(){this.map={}}async get(e){return this.map[e]||void 0}async set(e,i){this.map[e]=i}async delete(e){delete this.map[e]}},sr=class extends Error{constructor(e){super(e)}};var Gt=class extends Error{constructor(e){super(`Invalid response from OIDC provider: missing fields ${e}`),this.missingFields=e}},qr=class extends Error{constructor(e,i,a){super(e),this.error=i,this.errorDescription=a}};function Na(s){let e=new URL(s);return new URL(e.pathname,e.origin).toString()}async function Tn(s,e,i){return new Hr({htu:Na(s),htm:e.toUpperCase(),jti:wr()}).setProtectedHeader({alg:Kr[0],jwk:i.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(i.privateKey,{})}async function zo(){let{privateKey:s,publicKey:e}=await ui(Kr[0]),i={privateKey:s,publicKey:await pn(e)};return[i.publicKey.alg]=Kr,i}var Yo=600;function La(s){return[401,403].includes(s)}async function Da(s,e,i,a){var c;let y=new Headers(a?.headers);return y.set("Authorization",`DPoP ${e}`),y.set("DPoP",await Tn(s,(c=a?.method)!==null&&c!==void 0?c:"get",i)),{...a,headers:y}}async function Ba(s,e,i,a){if(i!==void 0)return Da(s,e,i,a);let c=new Headers(a?.headers);return c.set("Authorization",`Bearer ${e}`),{...a,headers:c}}async function Ho(s,e,i,a){return fetch(e,await Ba(e.toString(),s,a,i))}async function Oa(s,e,i){var a;let c=await s.tokenRefresher.refresh(s.sessionId,s.refreshToken,e);return i?.emit(tt.SESSION_EXTENDED,(a=c.expiresIn)!==null&&a!==void 0?a:Yo),typeof c.refreshToken=="string"&&i?.emit(tt.NEW_REFRESH_TOKEN,c.refreshToken),{accessToken:c.accessToken,refreshToken:c.refreshToken,expiresIn:c.expiresIn}}var li=s=>s!==void 0?s-jo>0?s-jo:s:Yo;async function Xo(s,e){var i;let a=s,c,y=e?.refreshOptions;if(y!==void 0){let l=async()=>{var f,g,d,w;try{let{accessToken:F,refreshToken:P,expiresIn:C}=await Oa(y,e.dpopKey,e.eventEmitter);a=F,P!==void 0&&(y.refreshToken=P),clearTimeout(c),c=setTimeout(l,li(C)*1e3),(f=e.eventEmitter)===null||f===void 0||f.emit(tt.TIMEOUT_SET,c)}catch(F){F instanceof qr&&((g=e?.eventEmitter)===null||g===void 0||g.emit(tt.ERROR,F.error,F.errorDescription),(d=e?.eventEmitter)===null||d===void 0||d.emit(tt.SESSION_EXPIRED)),F instanceof Gt&&F.missingFields.includes("access_token")&&((w=e?.eventEmitter)===null||w===void 0||w.emit(tt.SESSION_EXPIRED))}};c=setTimeout(l,li(e.expiresIn)*1e3),(i=e.eventEmitter)===null||i===void 0||i.emit(tt.TIMEOUT_SET,c)}else if(e!==void 0&&e.eventEmitter!==void 0){let l=setTimeout(()=>{e.eventEmitter.emit(tt.SESSION_EXPIRED)},li(e.expiresIn)*1e3);e.eventEmitter.emit(tt.TIMEOUT_SET,l)}return async(l,f)=>{let g=await Ho(a,l,f,e?.dpopKey),d=!g.ok&&!La(g.status);return g.ok||d||g.url!==l&&e?.dpopKey!==void 0&&(g=await Ho(a,g.url,f,e.dpopKey)),g}}Zo();ae();ce();ue();var kn=Vn(Si()),Ct=Vn(Si());function Ma(s,e){var i,a,c,y;throw s.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(i=e.redirectUrl)===null||i===void 0?void 0:i.toString()}] is invalid - ${(a=s.error_description)!==null&&a!==void 0?a:""}`):s.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(e)} is invalid - ${(c=s.error_description)!==null&&c!==void 0?c:""}`):new Error(`Dynamic client registration failed: ${s.error} - ${(y=s.error_description)!==null&&y!==void 0?y:""}`)}function Ha(s,e){if(s.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(s)}`);if(e.redirectUrl&&(s.redirect_uris===void 0||s.redirect_uris[0]!==e.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(s.redirect_uris)} don't match the provided ${JSON.stringify([e.redirectUrl.toString()])}`)}async function ts(s,e){var i;if(!e.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(e.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");let a=Wo(e.idTokenSigningAlgValuesSupported,Kr),c={client_name:s.clientName,application_type:"web",redirect_uris:[(i=s.redirectUrl)===null||i===void 0?void 0:i.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:a,grant_types:["authorization_code","refresh_token"]},y={"Content-Type":"application/json"},l=await fetch(e.registrationEndpoint.toString(),{method:"POST",headers:y,body:JSON.stringify(c)});if(l.ok){let f=await l.json();return Ha(f,s),{clientId:f.client_id,clientSecret:f.client_secret,idTokenSignedResponseAlg:f.id_token_signed_response_alg,clientType:"dynamic"}}throw l.status===400&&Ma(await l.json(),s),new Error(`Dynamic client registration failed: the server returned ${l.status} ${l.statusText} - ${await l.text()}`)}function Ka(s){return s.error!==void 0&&typeof s.error=="string"}function es(s){return s.error_description!==void 0&&typeof s.error_description=="string"}function Va(s){return s.error_uri!==void 0&&typeof s.error_uri=="string"}function qa(s){return s.access_token!==void 0&&typeof s.access_token=="string"}function Wa(s){return s.id_token!==void 0&&typeof s.id_token=="string"}function Ja(s){return s.refresh_token!==void 0&&typeof s.refresh_token=="string"}function $a(s){return s.token_type!==void 0&&typeof s.token_type=="string"}function Ga(s){return s.expires_in===void 0||typeof s.expires_in=="number"}function za(s,e){if(e.grantType&&(!s.grantTypesSupported||!s.grantTypesSupported.includes(e.grantType)))throw new Error(`The issuer [${s.issuer}] does not support the [${e.grantType}] grant`);if(!s.tokenEndpoint)throw new Error(`This issuer [${s.issuer}] does not have a token endpoint`)}function rs(s,e){if(Ka(s))throw new qr(`Token endpoint returned error [${s.error}]${es(s)?`: ${s.error_description}`:""}${Va(s)?` (see ${s.error_uri})`:""}`,s.error,es(s)?s.error_description:void 0);if(!qa(s))throw new Gt(["access_token"]);if(!Wa(s))throw new Gt(["id_token"]);if(!$a(s))throw new Gt(["token_type"]);if(!Ga(s))throw new Gt(["expires_in"]);if(!e&&s.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${s.token_type}].`);return s}async function ns(s,e,i,a){za(s,i);let c={"content-type":"application/x-www-form-urlencoded"},y;a&&(y=await zo(),c.DPoP=await Tn(s.tokenEndpoint,"POST",y)),e.clientSecret&&(c.Authorization=`Basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`);let l={grant_type:i.grantType,redirect_uri:i.redirectUrl,code:i.code,code_verifier:i.codeVerifier,client_id:e.clientId},f={method:"POST",headers:c,body:new URLSearchParams(l).toString()},d=await(await fetch(s.tokenEndpoint,f)).json(),w=rs(d,a),{webId:F,clientId:P}=await gi(w.id_token,s.jwksUri,s.issuer,e.clientId);return{accessToken:w.access_token,idToken:w.id_token,refreshToken:Ja(w)?w.refresh_token:void 0,webId:F,clientId:P,dpopKey:y,expiresIn:w.expires_in}}var Ya=s=>{try{return new URL(s),!0}catch{return!1}};async function is(s,e,i,a){if(i.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");let c={grant_type:"refresh_token",refresh_token:s,scope:In},y={};a!==void 0&&(y={DPoP:await Tn(e.tokenEndpoint,"POST",a)});let l={};i.clientSecret!==void 0?l={Authorization:`Basic ${btoa(`${i.clientId}:${i.clientSecret}`)}`}:Ya(i.clientId)&&(c.client_id=i.clientId);let f=await fetch(e.tokenEndpoint,{method:"POST",body:new URLSearchParams(c).toString(),headers:{...y,...l,"Content-Type":"application/x-www-form-urlencoded"}}),g;try{g=await f.json()}catch{throw new Error(`The token endpoint of issuer ${e.issuer} returned a malformed response.`)}let d=rs(g,a!==void 0),{webId:w}=await gi(d.id_token,e.jwksUri,e.issuer,i.clientId);return{accessToken:d.access_token,idToken:d.id_token,refreshToken:typeof d.refresh_token=="string"?d.refresh_token:void 0,webId:w,dpopKey:a,expiresIn:d.expires_in}}function os(s){let e=Pn(s);return e.hash="",s.includes(`${e.origin}/`)?e.href:`${e.origin}${e.href.substring(e.origin.length+1)}`}async function ss(){await new kn.OidcClient({response_mode:"query"}).clearStaleState(new kn.WebStorageStateStore({}));let e=window.localStorage,i=[];for(let a=0;a<=e.length;a+=1){let c=e.key(a);c&&(c.match(/^oidc\..+$/)||c.match(/^solidClientAuthenticationUser:.+$/))&&i.push(c)}i.forEach(a=>e.removeItem(a))}var xi=class extends An{constructor(e,i){super(e,i)}},Fi=class extends Fn{constructor(){super(...arguments),this.login=async(e,i)=>{var a,c;await this.sessionInfoManager.clear(e.sessionId);let y=(a=e.redirectUrl)!==null&&a!==void 0?a:os(window.location.href);if(!yi(y))throw new Error(`${y} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...e,redirectUrl:y,clientName:(c=e.clientName)!==null&&c!==void 0?c:e.clientId,eventEmitter:i})},this.validateCurrentSession=async e=>{let i=await this.sessionInfoManager.get(e);return i===void 0||i.clientAppId===void 0||i.issuer===void 0?null:i},this.handleIncomingRedirect=async(e,i)=>{try{let a=await this.redirectHandler.handle(e,i,void 0);return this.fetch=a.fetch.bind(window),this.boundLogout=a.getLogoutUrl,await this.cleanUrlAfterRedirect(e),{isLoggedIn:a.isLoggedIn,webId:a.webId,sessionId:a.sessionId,expirationDate:a.expirationDate,clientAppId:a.clientAppId}}catch(a){await this.cleanUrlAfterRedirect(e),i.emit(tt.ERROR,"redirect",a);return}}}async cleanUrlAfterRedirect(e){let i=Pn(e).href;for(window.history.replaceState(null,"",i);window.location.href!==i;)await new Promise(a=>{setTimeout(()=>a(),1)})}};function as(s){return typeof s.oidcIssuer=="string"}function us(s){return typeof s.redirectUrl=="string"}var Ai=class{constructor(e,i,a,c){this.storageUtility=e,this.oidcHandler=i,this.issuerConfigFetcher=a,this.clientRegistrar=c,this.storageUtility=e,this.oidcHandler=i,this.issuerConfigFetcher=a,this.clientRegistrar=c}async canHandle(e){return as(e)&&us(e)}async handle(e){if(!as(e))throw new sr(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!us(e))throw new sr(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);let i=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),a=await $o(e,i,this.storageUtility,this.clientRegistrar),c={issuer:i.issuer,dpop:e.tokenType.toLowerCase()==="dpop",...e,issuerConfiguration:i,client:a};return this.oidcHandler.handle(c)}},Ii=class extends bn{async handle(e){var i;let a={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl,response_type:"code",scope:In,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(i=e.prompt)!==null&&i!==void 0?i:"consent"},c=new Ct.OidcClient(a);try{let y=await c.createSigninRequest();return await this.handleRedirect({oidcLoginOptions:e,state:y.state._id,codeVerifier:y.state._code_verifier,targetUrl:y.url.toString()})}catch(y){console.error(y)}}},Xa=".well-known/openid-configuration",cs={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function Qa(s){let e={};return Object.keys(s).forEach(i=>{cs[i]&&(e[cs[i].toKey]=s[i])}),Array.isArray(e.scopesSupported)||(e.scopesSupported=["openid"]),e}var Pi=class s{constructor(e){this.storageUtility=e,this.storageUtility=e}static getLocalStorageKey(e){return`issuerConfig:${e}`}async fetchConfig(e){let i,a=new URL(Xa,e.endsWith("/")?e:`${e}/`).href,c=await fetch(a);try{i=Qa(await c.json())}catch(y){throw new sr(`[${e.toString()}] has an invalid configuration: ${y.message}`)}return await this.storageUtility.set(s.getLocalStorageKey(e),JSON.stringify(i)),i}};async function Za(s,e){await vi(s,e),await ss()}var Ti=class extends xn{async get(e){let[i,a,c,y,l,f,g,d]=await Promise.all([this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(e,"webId",{secure:!0}),this.storageUtility.getForUser(e,"clientId",{secure:!1}),this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),this.storageUtility.getForUser(e,"issuer",{secure:!1}),this.storageUtility.getForUser(e,"tokenType",{secure:!1})]);if(typeof l=="string"&&!yi(l)){await Promise.all([this.storageUtility.deleteAllUserData(e,{secure:!1}),this.storageUtility.deleteAllUserData(e,{secure:!0})]);return}if(d!==void 0&&!Vo(d))throw new Error(`Tokens of type [${d}] are not supported.`);if(!(c===void 0&&i===void 0&&a===void 0&&f===void 0))return{sessionId:e,webId:a,isLoggedIn:i==="true",redirectUrl:l,refreshToken:f,issuer:g,clientAppId:c,clientAppSecret:y,tokenType:d??"DPoP"}}async clear(e){return Za(e,this.storageUtility)}},Ri=class{async canHandle(e){try{return new URL(e),!0}catch(i){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${i}`)}}async handle(e){return mi()}},ki=class{constructor(e,i,a,c,y){this.storageUtility=e,this.sessionInfoManager=i,this.issuerConfigFetcher=a,this.clientRegistrar=c,this.tokerRefresher=y,this.storageUtility=e,this.sessionInfoManager=i,this.issuerConfigFetcher=a,this.clientRegistrar=c,this.tokerRefresher=y}async canHandle(e){try{let i=new URL(e);return i.searchParams.get("code")!==null&&i.searchParams.get("state")!==null}catch(i){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${i}`)}}async handle(e,i){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);let a=new URL(e),c=a.searchParams.get("state"),y=await this.storageUtility.getForUser(c,"sessionId",{errorIfNull:!0}),{issuerConfig:l,codeVerifier:f,redirectUrl:g,dpop:d}=await _i(y,this.storageUtility,this.issuerConfigFetcher),w=a.searchParams.get("iss");if(typeof w=="string"&&w!==l.issuer)throw new Error(`The value of the iss parameter (${w}) does not match the issuer identifier of the authorization server (${l.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(f===void 0)throw new Error(`The code verifier for session ${y} is missing from storage.`);if(g===void 0)throw new Error(`The redirect URL for session ${y} is missing from storage.`);let F=await this.clientRegistrar.getClient({sessionId:y},l),P=Date.now(),C=await ns(l,F,{grantType:"authorization_code",code:a.searchParams.get("code"),codeVerifier:f,redirectUrl:g},d);window.localStorage.removeItem(`oidc.${c}`);let x;C.refreshToken!==void 0&&(x={sessionId:y,refreshToken:C.refreshToken,tokenRefresher:this.tokerRefresher});let I=await Xo(C.accessToken,{dpopKey:C.dpopKey,refreshOptions:x,eventEmitter:i,expiresIn:C.expiresIn});await Go(this.storageUtility,y,C.webId,C.clientId,"true",void 0,!0);let R=await this.sessionInfoManager.get(y);if(!R)throw new Error(`Could not retrieve session: [${y}].`);return Object.assign(R,{fetch:I,getLogoutUrl:Ko({idTokenHint:C.idToken,endSessionEndpoint:l.endSessionEndpoint}),expirationDate:typeof C.expiresIn=="number"?P+C.expiresIn*1e3:void 0})}},Ci=class extends Sn{constructor(e){super(e)}},Ui=class{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,i){this.storage.setItem(e,i)}async delete(e){this.storage.removeItem(e)}},Ni=class{redirect(e,i){i&&i.handleRedirect?i.handleRedirect(e):i&&i.redirectByReplacingState?window.history.replaceState({},"",e):window.location.href=e}},Li=class{constructor(e){this.storageUtility=e,this.storageUtility=e}async getClient(e,i){let[a,c,y,l]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientType",{secure:!1})]);if(a&&Jo(l))return{clientId:a,clientSecret:c,clientName:y,clientType:l};try{let f=await ts(e,i),g={clientId:f.clientId,clientType:"dynamic"};return f.clientSecret&&(g.clientSecret=f.clientSecret),f.idTokenSignedResponseAlg&&(g.idTokenSignedResponseAlg=f.idTokenSignedResponseAlg),await this.storageUtility.setForUser(e.sessionId,g,{secure:!1}),f}catch(f){throw new Error(`Client registration failed: [${f}]`)}}},Di=class{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(i){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${i}`)}}async handle(e,i){if(i!==void 0){let a=new URL(e),c=a.searchParams.get("error"),y=a.searchParams.get("error_description");i.emit(tt.ERROR,c,y)}return mi()}},Bi=class{constructor(e,i,a){this.storageUtility=e,this.issuerConfigFetcher=i,this.clientRegistrar=a,this.storageUtility=e,this.issuerConfigFetcher=i,this.clientRegistrar=a}async refresh(e,i,a,c){let y=await _i(e,this.storageUtility,this.issuerConfigFetcher),l=await this.clientRegistrar.getClient({sessionId:e},y.issuerConfig);if(i===void 0)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(y.dpop&&a===void 0)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);let f=await is(i,y.issuerConfig,l,a);return f.refreshToken!==void 0&&c?.emit(tt.NEW_REFRESH_TOKEN,f.refreshToken),f}};function hs(s){let e=new Vr,i=s.secureStorage||e,a=s.insecureStorage||new Ui,c=new xi(i,a),y=new Pi(c),l=new Li(c),f=new Ti(c),g=new Bi(c,y,l),d=new Ni,w=new Ai(c,new Ii(c,d),y,l),F=new Ci([new Di,new ki(c,f,y,l,g),new Ri]);return new Fi(w,F,new En(f,d),f,y)}var bi=`${pi}currentSession`,Oi=`${pi}currentUrl`;async function eu(s,e,i){var a;let c=await e.validateCurrentSession(s);return c!==null?(window.localStorage.setItem(Oi,window.location.href),await e.login({sessionId:s,prompt:"none",oidcIssuer:c.issuer,redirectUrl:c.redirectUrl,clientId:c.clientAppId,clientSecret:c.clientAppSecret,tokenType:(a=c.tokenType)!==null&&a!==void 0?a:"DPoP"},i.events),!0):!1}function tu(s){return!!s?.isLoggedIn}var ji=class{constructor(e={},i=void 0){this.tokenRequestInProgress=!1,this.login=async a=>{var c;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...a,tokenType:(c=a.tokenType)!==null&&c!==void 0?c:"DPoP"},this.events),new Promise(()=>{})},this.fetch=(a,c)=>this.clientAuthentication.fetch(a,c),this.internalLogout=async(a,c)=>{window.localStorage.removeItem(bi),await this.clientAuthentication.logout(this.info.sessionId,c),this.info.isLoggedIn=!1,a&&this.events.emit(tt.LOGOUT)},this.logout=async a=>this.internalLogout(!0,a),this.handleIncomingRedirect=async(a={})=>{var c;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;let y=typeof a=="string"?{url:a}:a,l=(c=y.url)!==null&&c!==void 0?c:window.location.href;this.tokenRequestInProgress=!0;let f=await this.clientAuthentication.handleIncomingRedirect(l,this.events);if(tu(f)){this.setSessionInfo(f);let g=window.localStorage.getItem(Oi);g===null?this.events.emit(tt.LOGIN):(window.localStorage.removeItem(Oi),this.events.emit(tt.SESSION_RESTORED,g))}else if(y.restorePreviousSession===!0){let g=window.localStorage.getItem(bi);if(g!==null&&await eu(g,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,f},this.events=new Sr,e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=hs({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=hs({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId,clientAppId:e.sessionInfo.clientAppId}:this.info={sessionId:i??wr(),isLoggedIn:!1},this.events.on(tt.LOGIN,()=>window.localStorage.setItem(bi,this.info.sessionId)),this.events.on(tt.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(tt.ERROR,()=>this.internalLogout(!1))}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.clientAppId=e.clientAppId,this.info.expirationDate=e.expirationDate,this.events.on(tt.SESSION_EXTENDED,i=>{this.info.expirationDate=Date.now()+i*1e3})}},Ei;function ar(){return typeof Ei>"u"&&(Ei=new ji),Ei}var Mi=(...s)=>ar().fetch(...s),ls=(...s)=>ar().login(...s),fs=(...s)=>ar().logout(...s),ds=(...s)=>ar().handleIncomingRedirect(...s);ae();ce();ue();ae();ce();ue();Jn();var vs=Vn(ys());ae();ce();ue();var Jr="http://www.w3.org/1999/02/22-rdf-syntax-ns#",$r="http://www.w3.org/2001/XMLSchema#",Hi="http://www.w3.org/2000/10/swap/",It={xsd:{decimal:`${$r}decimal`,boolean:`${$r}boolean`,double:`${$r}double`,integer:`${$r}integer`,string:`${$r}string`},rdf:{type:`${Jr}type`,nil:`${Jr}nil`,first:`${Jr}first`,rest:`${Jr}rest`,langString:`${Jr}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${Hi}reify#forSome`,forAll:`${Hi}reify#forAll`},log:{implies:`${Hi}log#implies`}};var{xsd:Cn}=It,ru=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,ms={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},nu=/[\x00-\x20<>\\"\{\}\|\^\`]/,iu={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},ou=/$0^/,Gr=class{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(let i in this)!(i in iu)&&this[i]instanceof RegExp&&(this[i]=ou)}else this._n3Mode=e.n3!==!1;this.comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,i){let a=this._input,c=a.length;for(;;){let f,g;for(;f=this._newline.exec(a);)this.comments&&(g=this._comment.exec(f[0]))&&y("comment",g[1],"",this._line,f[0].length),a=a.substr(f[0].length,a.length),c=a.length,this._line++;if(!f&&(f=this._whitespace.exec(a))&&(a=a.substr(f[0].length,a.length)),this._endOfFile.test(a))return i&&(this.comments&&(g=this._comment.exec(a))&&y("comment",g[1],"",this._line,a.length),a=null,y("eof","","",this._line,0)),this._input=a;let d=this._line,w=a[0],F="",P="",C="",x=null,I=0,R=!1;switch(w){case"^":if(a.length<3)break;if(a[1]==="^"){if(this._previousMarker="^^",a=a.substr(2),a[0]!=="<"){R=!0;break}}else{this._n3Mode&&(I=1,F="^");break}case"<":if(x=this._unescapedIri.exec(a))F="IRI",P=x[1];else if(x=this._iri.exec(a)){if(P=this._unescape(x[1]),P===null||nu.test(P))return l(this);F="IRI"}else a.length>1&&a[1]==="<"?(F="<<",I=2):this._n3Mode&&a.length>1&&a[1]==="="&&(F="inverse",I=2,P=">");break;case">":a.length>1&&a[1]===">"&&(F=">>",I=2);break;case"_":((x=this._blank.exec(a))||i&&(x=this._blank.exec(`${a} `)))&&(F="blank",C="_",P=x[1]);break;case'"':if(x=this._simpleQuotedString.exec(a))P=x[1];else if({value:P,matchLength:I}=this._parseLiteral(a),P===null)return l(this);(x!==null||I!==0)&&(F="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(x=this._simpleApostropheString.exec(a))P=x[1];else if({value:P,matchLength:I}=this._parseLiteral(a),P===null)return l(this);(x!==null||I!==0)&&(F="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(x=this._variable.exec(a))&&(F="var",P=x[0]);break;case"@":this._previousMarker==="literal"&&(x=this._langcode.exec(a))?(F="langcode",P=x[1]):(x=this._keyword.exec(a))&&(F=x[0]);break;case".":if(a.length===1?i:a[1]<"0"||a[1]>"9"){F=".",I=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(x=this._number.exec(a)||i&&(x=this._number.exec(`${a} `)))&&(F="literal",P=x[0],C=typeof x[1]=="string"?Cn.double:typeof x[2]=="string"?Cn.decimal:Cn.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(x=this._sparqlKeyword.exec(a))?F=x[0].toUpperCase():R=!0;break;case"f":case"t":(x=this._boolean.exec(a))?(F="literal",P=x[0],C=Cn.boolean):R=!0;break;case"a":(x=this._shortPredicates.exec(a))?(F="abbreviation",P="a"):R=!0;break;case"=":this._n3Mode&&a.length>1&&(F="abbreviation",a[1]!==">"?(I=1,P="="):(I=2,P=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(I=1,F=w);break;case"{":!this._lineMode&&a.length>=2&&(a[1]==="|"?(F="{|",I=2):(F=w,I=1));break;case"|":a.length>=2&&a[1]==="}"&&(F="|}",I=2);break;default:R=!0}if(R&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(x=this._prefix.exec(a))?(F="prefix",P=x[1]||""):((x=this._prefixed.exec(a))||i&&(x=this._prefixed.exec(`${a} `)))&&(F="prefixed",C=x[1]||"",P=this._unescape(x[2]))),this._previousMarker==="^^")switch(F){case"prefixed":F="type";break;case"IRI":F="typeIRI";break;default:F=""}if(!F)return i||!/^'''|^"""/.test(a)&&/\n|\r/.test(a)?l(this):this._input=a;let K=I||x[0].length,V=y(F,P,C,d,K);this.previousToken=V,this._previousMarker=F,a=a.substr(K,a.length)}function y(f,g,d,w,F){let P=a?c-a.length:c,C=P+F,x={type:f,value:g,prefix:d,line:w,start:P,end:C};return e(null,x),x}function l(f){e(f._syntaxError(/^\S*/.exec(a)[0]))}}_unescape(e){let i=!1,a=e.replace(ru,(c,y,l,f)=>{if(typeof y=="string")return String.fromCharCode(Number.parseInt(y,16));if(typeof l=="string"){let g=Number.parseInt(l,16);return g<=65535?String.fromCharCode(Number.parseInt(l,16)):String.fromCharCode(55296+((g-=65536)>>10),56320+(g&1023))}return f in ms?ms[f]:(i=!0,"")});return i?null:a}_parseLiteral(e){if(e.length>=3){let i=e.match(/^(?:"""|"|'''|'|)/)[0],a=i.length,c=Math.max(this._literalClosingPos,a);for(;(c=e.indexOf(i,c))>0;){let y=0;for(;e[c-y-1]==="\\";)y++;if(y%2===0){let l=e.substring(a,c),f=l.split(/\r\n|\r|\n/).length-1,g=c+a;if(a===1&&f!==0||a===3&&this._lineMode)break;return this._line+=f,{value:this._unescape(l),matchLength:g}}c++}this._literalClosingPos=e.length-a+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;let i=new Error(`Unexpected "${e}" on line ${this._line}.`);return i.context={token:void 0,line:this._line,previousToken:this.previousToken},i}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,i){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof i=="function")(0,vs.default)(()=>this._tokenizeToEnd(i,!0));else{let a=[],c;if(this._tokenizeToEnd((y,l)=>y?c=y:a.push(l),!0),c)throw c;return a}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",a=>{this._input!==null&&a.length!==0&&(this._pendingBuffer&&(a=ye.concat([this._pendingBuffer,a]),this._pendingBuffer=null),a[a.length-1]&128?this._pendingBuffer=a:(typeof this._input>"u"?this._input=this._readStartingBom(typeof a=="string"?a:a.toString()):this._input+=a,this._tokenizeToEnd(i,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(i,!0)}),e.on("error",i)}};ae();ce();ue();ae();ce();ue();var{rdf:su,xsd:br}=It,Xr,au=0;var uu={namedNode:ws,blankNode:Ss,variable:Es,literal:bs,defaultGraph:cu,quad:Wi,triple:Wi,fromTerm:zr,fromQuad:xs},_s=uu,Jt=class s{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof s?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}},Un=class extends Jt{get termType(){return"NamedNode"}},Yr=class s extends Jt{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){let e=this.id,i=e.lastIndexOf('"')+1;return i<e.length&&e[i++]==="@"?e.substr(i).toLowerCase():""}get datatype(){return new Un(this.datatypeString)}get datatypeString(){let e=this.id,i=e.lastIndexOf('"')+1,a=i<e.length?e[i]:"";return a==="^"?e.substr(i+2):a!=="@"?br.string:su.langString}equals(e){return e instanceof s?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}},Ki=class extends Jt{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}},Vi=class extends Jt{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}},qi=class extends Jt{constructor(){return super(""),Xr||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}};Xr=new qi;var Nn=class extends Jt{constructor(e,i,a,c){super(""),this._subject=e,this._predicate=i,this._object=a,this._graph=c||Xr}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}};function ws(s){return new Un(s)}function Ss(s){return new Ki(s||`n3-${au++}`)}function bs(s,e){if(typeof e=="string")return new Yr(`"${s}"@${e.toLowerCase()}`);let i=e?e.value:"";return i===""&&(typeof s=="boolean"?i=br.boolean:typeof s=="number"&&(Number.isFinite(s)?i=Number.isInteger(s)?br.integer:br.double:(i=br.double,Number.isNaN(s)||(s=s>0?"INF":"-INF")))),i===""||i===br.string?new Yr(`"${s}"`):new Yr(`"${s}"^^${i}`)}function Es(s){return new Vi(s)}function cu(){return Xr}function Wi(s,e,i,a){return new Nn(s,e,i,a)}function zr(s){if(s instanceof Jt)return s;switch(s.termType){case"NamedNode":return ws(s.value);case"BlankNode":return Ss(s.value);case"Variable":return Es(s.value);case"DefaultGraph":return Xr;case"Literal":return bs(s.value,s.language||s.datatype);case"Quad":return xs(s);default:throw new Error(`Unexpected termType: ${s.termType}`)}}function xs(s){if(s instanceof Nn)return s;if(s.termType!=="Quad")throw new Error(`Unexpected termType: ${s.termType}`);return Wi(zr(s.subject),zr(s.predicate),zr(s.object),zr(s.graph))}var Fs=0,ur=class{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&As(this,e.factory);let i=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",a=/turtle/.test(i),c=/trig/.test(i),y=/triple/.test(i),l=/quad/.test(i),f=this._n3Mode=/n3/.test(i),g=y||l;(this._supportsNamedGraphs=!(a||f))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(a||c||y||f),this._supportsRDFStar=i===""||/star|\*$/.test(i),g&&(this._resolveRelativeIRI=d=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new Gr({lineMode:g,n3:f}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){Fs=0}_setBase(e){if(!e)this._base="",this._basePath="";else{let i=e.indexOf("#");i>=0&&(e=e.substr(0,i)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,i,a,c,y){let l=this._n3Mode;this._contextStack.push({type:e,subject:a,predicate:c,object:y,graph:i,inverse:l?this._inversePredicate:!1,blankPrefix:l?this._prefixes._:"",quantified:l?this._quantified:null}),l&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,i){let a=this._contextStack.pop();if(!a||a.type!==e)return this._error(`Unexpected ${i.type}`,i);this._subject=a.subject,this._predicate=a.predicate,this._object=a.object,this._graph=a.graph,this._n3Mode&&(this._inversePredicate=a.inverse,this._prefixes._=a.blankPrefix,this._quantified=a.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,i){let a;switch(e.type){case"IRI":case"typeIRI":let c=this._resolveIRI(e.value);if(c===null)return this._error("Invalid IRI",e);a=this._namedNode(c);break;case"type":case"prefixed":let y=this._prefixes[e.prefix];if(y===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);a=this._namedNode(y+e.value);break;case"blank":a=this._blankNode(this._prefixes[e.prefix]+e.value);break;case"var":a=this._variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!i&&this._n3Mode&&a.id in this._quantified&&(a=this._quantified[a.id]),a}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier=this._blankNode,this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier=this._variable,this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._literal(e.value,this._namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){let i=e.type;switch(i){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${i}`,e):(this._subject=null,i==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._literal(e.value,this._namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);let i=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:i?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let i=null,a=null,c=this._readListItem,y=this._subject,l=this._contextStack,f=l[l.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,a=this._blankNode(),this.RDF_FIRST,this._subject=i=this._blankNode()),c=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,a=this._blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),l.length!==0&&l[l.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(c=this._readPredicate,this._subject===this.RDF_NIL)return c}else if(c=this._getContextEndReader(),this._object===this.RDF_NIL)return c;a=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,c=this._readListItemDataTypeOrLang):(i=this._literal(e.value,this._namedNode(e.prefix)),c=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((i=this._readEntity(e))===void 0)return}if(a===null&&(this._subject=a=this._blankNode()),y===null?f.predicate===null?f.subject=a:f.object=a:this._emit(y,this.RDF_REST,a,this._graph),i!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,a,this.RDF_FIRST,i),this._subject=i,this._predicate=null,this._getPathReader(this._readListItem);this._emit(a,this.RDF_FIRST,i,this._graph)}return c}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let i=this._literal(this._literalValue);switch(e.type){case"type":case"typeIRI":let a=this._readEntity(e);if(a===void 0)return;i=this._literal(this._literalValue,a),e=null;break;case"langcode":i=this._literal(this._literalValue,e.value),e=null;break}return{token:e,literal:i}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,i){let a=this._completeLiteral(e);if(a)return this._object=a.literal,i&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),a.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(a.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let i,a=this._graph,c=this._subject,y=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,i=this._contextStack.length?this._readSubject:this._readInTopContext,y&&(this._inversePredicate=!1);break;case";":i=this._readPredicate;break;case",":i=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF-star syntax",e);let l=this._predicate,f=this._object;this._subject=this._quad(c,l,f,this.DEFAULTGRAPH),i=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,i=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(a=this._readEntity(e))!==void 0){i=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(c!==null){let l=this._predicate,f=this._object;y?this._emit(f,l,c,a):this._emit(c,l,f,a)}return i}_readBlankNodePunctuation(e){let i;switch(e.type){case";":i=this._readPredicate;break;case",":i=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),i}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);let i=this._readEntity(e);return this._prefixes[this._prefix]=i.value,this._prefixCallback(this._prefix,i),this._readDeclarationPunctuation}_readBaseIRI(e){let i=e.type==="IRI"&&this._resolveIRI(e.value);return i?(this._setBase(i),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let i;switch(e.type){case"IRI":case"prefixed":if((i=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,i,this.QUANTIFIERS_GRAPH)):this._quantified[i.id]=this._quantifier(this._blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:let i=this._contextStack,a=i.length&&i[i.length-1];if(a&&a.type==="item"){let c=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,c,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let i,a,c=this._blankNode();if((a=this._readEntity(e))!==void 0)return this._predicate===null?(i=this._subject,this._subject=c):(i=this._object,this._object=c),this._emit(i,a,c,this._graph),this._readPath}_readBackwardPath(e){let i=this._blankNode(),a,c;if((a=this._readEntity(e))!==void 0)return this._predicate===null?(c=this._subject,this._subject=i):(c=this._object,this._object=i),this._emit(i,a,c,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);let i=this._quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=i,this._readPredicate):(this._object=i,this._getContextEndReader())}_getContextEndReader(){let e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,i,a,c){this._callback(null,this._quad(e,i,a,c||this.DEFAULTGRAPH))}_error(e,i){let a=new Error(`${e} on line ${i.line}.`);a.context={token:i,line:i.line,previousToken:this._lexer.previousToken},this._callback(a),this._callback=Ln}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;let i=e.length,a="",c=-1,y=-1,l=0,f="/";for(;c<i;){switch(f){case":":if(y<0&&e[++c]==="/"&&e[++c]==="/")for(;(y=c+1)<i&&e[y]!=="/";)c=y;break;case"?":case"#":c=i;break;case"/":if(e[c+1]===".")switch(f=e[++c+1],f){case"/":a+=e.substring(l,c-1),l=c+1;break;case void 0:case"?":case"#":return a+e.substring(l,c)+e.substr(c+1);case".":if(f=e[++c+1],f===void 0||f==="/"||f==="?"||f==="#"){if(a+=e.substring(l,c-2),(l=a.lastIndexOf("/"))>=y&&(a=a.substr(0,l)),f!=="/")return`${a}/${e.substr(c+1)}`;l=c+1}}}f=e[++c]}return a+e.substring(l)}parse(e,i,a){let c,y,l;if(i&&(i.onQuad||i.onPrefix||i.onComment)?(c=i.onQuad,y=i.onPrefix,l=i.onComment):(c=i,y=a),this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${Fs++}_`,this._prefixCallback=y||Ln,this._inversePredicate=!1,this._quantified=Object.create(null),!c){let g=[],d;if(this._callback=(w,F)=>{w?d=w:F&&g.push(F)},this._lexer.tokenize(e).every(w=>this._readCallback=this._readCallback(w)),d)throw d;return g}let f=(g,d)=>{g!==null?(this._callback(g),this._callback=Ln):this._readCallback&&(this._readCallback=this._readCallback(d))};l&&(this._lexer.comments=!0,f=(g,d)=>{g!==null?(this._callback(g),this._callback=Ln):this._readCallback&&(d.type==="comment"?l(d.value):this._readCallback=this._readCallback(d))}),this._callback=c,this._lexer.tokenize(e,f)}};function Ln(){}function As(s,e){let i=e.namedNode;s._namedNode=i,s._blankNode=e.blankNode,s._literal=e.literal,s._variable=e.variable,s._quad=e.quad,s.DEFAULTGRAPH=e.defaultGraph(),s.RDF_FIRST=i(It.rdf.first),s.RDF_REST=i(It.rdf.rest),s.RDF_NIL=i(It.rdf.nil),s.N3_FORALL=i(It.r.forAll),s.N3_FORSOME=i(It.r.forSome),s.ABBREVIATIONS={a:i(It.rdf.type),"=":i(It.owl.sameAs),">":i(It.log.implies)},s.QUANTIFIERS_GRAPH=i("urn:n3:quantifiers")}As(ur.prototype,_s);var hu="https://idp.dev.jouw.id",zt,Er;async function Is(s={}){let e={client_id:Cr(String),client_secret:Cr(String),redirect_url:Cr(on),idpRedirect:fr(mo(Function)),silent:fr(Boolean),keepLoggedIn:fr(Boolean)};kr(s,e),s=Object.assign({},{silent:!1,keepLoggedIn:!0},s);let a=await ds({restorePreviousSession:s.keepLoggedIn,onError:errorHandle});return a?.webId&&(Er.webId=a.webId),zt||(zt=ar(),zt?.info?.webId&&(Er.webId=zt.info.webId)),!Er.webId&&!s.silent&&(s.idpRedirect?s.idpRedirect():ls({redirectUrl:s.redirect_url,oidcIssuer:hu,clientId:s.client_id,clientSecret:s.client_secret})),Er}function Ji(s={}){let e={keepLoggedIn:fr(Boolean)};return kr(s,e),zt||(zt=ar()),zt.isLoggedIn}async function Ps(s){let e={redirect_url:"/"},i={redirect_url:fr(yo(on,lu))};kr(s,i),s=Object.assign({},e,s),Ji()&&(fs(),s.redirect_url&&(window.location=s.redirect_url))}async function Ts(s){let e={},i={resourcePath:Cr(String)};if(kr(s,i),s=Object.assign({},e,s),zt&&Er?.webId){let a=await Mi(Er.webId),c=fu(a,MASTER_POD_ALIAS),y=await Mi(new URL(s.resourcePath,c).href),l=y.heading.get("content-type");return l.match(/^application\/(.*\+)?json/)?y.json():l.match(/^text\//)?y.text():y.blob()}return!1}var lu=s=>{let e=new URL("/",window.location.href);return on(e.href+s)};function fu(s,e){let i=new ur,a=null;return i.parse(s,(c,y)=>{y.predicate.value=="http://www.w3.org/ns/pim/space#storage"&&(a=y.object.value)}),a}globalThis.jouwid={login:Is,isLoggedIn:Ji,logout:Ps,getProtectedResource:Ts};})();
/*! Bundled license information:

@jspm/core/nodelibs/browser/chunk-DtuTasat.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@inrupt/oidc-client/lib/oidc-client.min.js:
  (*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
   *)
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <http://feross.org>
   * @license  MIT
   *)
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
